<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>光明新区投资项目管理平台</title>
</head>
<body onunload="return window_onunload()" onload="window_onload()">

<div style="max-width: 1366px; margin: 10px auto;">
    <table class="TableBlock" width="100%">
        <tbody>
        <tr class="TableHeader">
            <td style="text-align: center;">
                <p style="padding: 0px; margin: 0px;">
                    <span>温馨提示：</span><span>在线编辑插件只支持IE浏览器; 如果页面无法显示在线编辑控件，请先<a
                        href="/contents/download/WebOffice.zip">下载</a>控件并安装，重新刷新页面即可！
							</span>
                </p>
            </td>
        </tr>
         <tr>
            <td style="text-align: center;"><span
                style="margin-left: 20px;">
                    <button type=button class="btn" onclick="saveToServer(attachId,'doc',closeConfirm);">保存</button>
                    <button type=button class="btn" onclick="showPrintDialog();">打印</button>
            </span></td>
        </tr>
        </tbody>
    </table>
</div>
<div style="max-width: 1366px; margin: 10px auto;">
    <script language=javascript src="/contents/libs/weboffice/main.js" charset="utf-8"></script>
    <script language=javascript src="/contents/libs/weboffice/LoadWebOffice.js" charset="utf-8"></script>

</div>

<!-- --------------------=== 调用Weboffice初始化方法 ===--------------------- -->
<script type="text/javascript" event=NotifyWordEvent(eventname) for=WebOffice1>
    WebOffice1_NotifyWordEvent(eventname);
</script>
<script type="text/javascript" event=NotifyToolBarClick(iIndex) for=WebOffice1>
    WebOffice1_NotifyToolBarClick(iIndex);
</script>
<script language=javascript event=NotifyCtrlReady for=WebOffice1>
    WebOffice_OpenOfficeFile();  //在装载完Weboffice(执行<object>...</object>)  控件后执行 "WebOffice1_NotifyCtrlReady"方法
</script>

<script type="text/javascript">
    var attachId = getQueryVariable("attachId");

    var url = window.location;
    var hostname = url.hostname;
    var protocol = url.protocol;
    var port  = url.port;
    var basePath = protocol+"//"+hostname+":"+port;

    //打开服务器上的word
    function WebOffice_OpenOfficeFile(){
        var downloadUrl = basePath+"/management/word/download/"+attachId;
        try{
            document.all.WebOffice1.OptionFlag |= 128;
            document.all.WebOffice1.LoadOriginalFile(downloadUrl,"doc");
        }catch(e){
            alert("异常\r\nError:"+e+"\r\nError Code:"+e.number+"\r\nError Des:"+e.description);
        }
    }

    function closeConfirm(){
        if(window.confirm("保存成功,是否关闭当前窗口")){
            window.close();
        }
    }

    /**
     * 上传文档到服务器
     * @param id        业务ID
     * @param docType   文件类型
     * @param fn        回调函数
     * @returns {boolean}
     */
    function saveToServer(id, docType, fn){
        if (!id) {
            alert("缺少业务主键");
            return false;
        }
        if (typeof docType == "function") {
            fn = docType;
            docType = "doc";
        } else {
            docType = docType || "doc";
        }
        try {
            var webObj = document.getElementById("WebOffice1");
            var returnValue;

            // 初始化Http引擎
            webObj.HttpInit();
            // 添加相应的Post元素
            webObj.HttpAddPostString("attachId", id);
            webObj.HttpAddPostCurrFile("docContent", "");		// 上传文件
            returnValue = webObj.HttpPost(basePath+"/management/word/upload");	// 判断上传是否成功
            if ("succeed" == returnValue) {
                if (fn && (typeof fn == "function")) {
                    fn();
                } else {
                    alert("文件上传成功");
                }
            } else {
                alert("文件上传失败");
            }
            return true;
        } catch (e) {
            alert("异常\r\nError:" + e + "\r\nError Code:" + e.number + "\r\nError Des:" + e.description);
        }
    }

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return false;
    }
</script>

</body>
</html>