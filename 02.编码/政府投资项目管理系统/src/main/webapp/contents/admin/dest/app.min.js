!function(){"use strict";function a(){var a="";if(window.global_User)return window.global_User;window.global_User="",$.ajax({url:"/common/getUser",async:!1,success:function(b){a=b}}),a=a.split("\\u");for(var b=0;b<a.length;b++)""!=a[b]&&(window.global_User+=String.fromCharCode(parseInt(a[b],16).toString(10)));return window.global_User}function b(){$("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form")}function c(a){var b="发生错误,系统已记录,我们会尽快处理！";void 0!=a.response&&(401==a.response.status&&(location.href=L.loginUrl),b=a.response.data.message||b),L.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})}function d(a){var b=function(b){L.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(a.response.status>400)b("发生错误！");else{var c=a.response.data;c&&555==c.status?b(c.message):a.fn&&a.fn(c)}}function e(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a}function f(a){var b=a.toString().replace(/[^0-9]/g,"");return parseInt(b,10)}function g(a){return isNaN(parseFloat(a,10))?0:parseFloat(a,10)}function h(){return $(window).height()-180}function i(a){a.vm.alertDialogMessage=a.msg,a.vm.alertDialogFn=function(){a.fn?a.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!0})}function j(a){a.vm.dialogConfirmTitle=a.title,a.vm.dialogConfirmMessage=a.msg,$(".confirmDialog").modal({backdrop:"static"}),a.vm.dialogConfirmSubmit=a.fn}function k(a,b){null==b&&(b=""),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(window.location.href);return null==d?b:d[1]}function l(){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0},schema:function(a){return{data:"value",total:function(a){return a.count},model:a}},transport:function(a){return{read:{url:a,dataType:"json",type:"GET",beforeSend:function(a){a.setRequestHeader("Token",L.getToken())}}}},noRecordMessage:{template:"暂时没有数据."}}}function m(a){var b=$(a).find("tr td:nth-child(1)").find("input:checked"),c=[];return b.each(function(){var a=$(this).attr("relId");c.push({name:"id",value:a})}),c}function n(a){a.headers={Token:L.getToken()},a.$http(a.httpOptions).then(a.success,function(b){common.requestError({vm:a.vm,response:b})})}function o(){var a={get:function(a,b){var c=this.getAll(a);return c?c[b]:null},getAll:function(a){var b=encodeURIComponent(a)+"=",c=document.cookie.indexOf(b),d=null,e={};if(c>-1){var f=document.cookie.indexOf(";",c);if(f==-1&&(f=document.cookie.length),d=document.cookie.substring(c+b.length,f),d.length>0){for(var g=d.split("&"),h=0,i=g.length;h<i;h++){var j=g[h].split("=");e[decodeURIComponent(j[0])]=decodeURIComponent(j[1])}return e}}return null},set:function(a,b,c,d,e,f,g){var h=this.getAll(a)||{};h[b]=c,this.setAll(a,h,d,e,f,g)},setAll:function(a,b,c,d,e,f){var g=encodeURIComponent(a)+"=",h=[];for(var i in b)i.length>0&&b.hasOwnProperty(i)&&h.push(encodeURIComponent(i)+"="+encodeURIComponent(b[i]));h.length>0?(g+=h.join("&"),c instanceof Date&&(g+=";expires="+c.toGMTString()),d&&(g+=";path="+d),e&&(g+=";domain="+e),f&&(g+=";secure")):g+=";expires="+new Date(0).toGMTString(),document.cookie=g},unset:function(a,b,c,d,e){var f=this.getAll(a);f&&(delete f[b],this.setAll(a,f,null,c,d,e))},unsetAll:function(a,b,c,d){this.setAll(a,null,new Date(0),b,c,d)}};return a}function p(){var a=o().getAll("data");return null!=a?a.token:""}function q(a){return a.error=function(a){401==a.status&&(location.href=L.loginUrl)},a}function r(){return window.global_basicData?window.global_basicData:($.ajax({url:"/common/basicData/all",async:!1,success:function(a){window.global_basicData=a}}),window.global_basicData)}function s(a){var b=$linq(common.getBasicData()).where(function(b){return b.id==a}).firstOrDefault();return b?b.description:""}function t(a){var b=$linq(r()).where(function(b){return b.identity==a&&b.pId==a}).toArray();return b?b:""}function u(a){return a?new Date(a):null}function v(a){return a?a:0}function w(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd"):null}function x(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd HH:mm:ss"):null}function y(){return{uploadSize:10485760,processState:"processState",processState_waitQianShou:"processState_1",processState_qianShou:"processState_2",processState_msFenBan:"processState_3",processState_banJie:"processState_11",processState_tuiWen:"processState_15",processState_next:"processState_16",fileSet:"fileSet",fileSet_pingJian:"fileSet_1",fileSet_pingJi:"fileSet_2",fileSet_jiJian:"fileSet_3",fileSet_teJi:"fileSet_4",fileSet_teTi:"fileSet_5",openType:"openType",openType_zhuDong:"openType_1",openType_yiShenQing:"openType_2",openType_no:"openType_3",hecretHierarchy:"hecretHierarchy",hecretHierarchy_gongKai:"hecretHierarchy_1",hecretHierarchy_guoNei:"hecretHierarchy_2",hecretHierarchy_neiBu:"hecretHierarchy_3",hecretHierarchy_miMi:"hecretHierarchy_4",hecretHierarchy_jiMi:"hecretHierarchy_5",hecretHierarchy_jueMi:"hecretHierarchy_6",postingCategory:"postingCategory",postingCategory_shang:"postingCategory_1",postingCategory_ping:"postingCategory_2",postingCategory_xia:"postingCategory_3",documentType:"documentType",documentType_han:"documentType_1",documentType_zhiShi:"documentType_2",documentType_tongZhi:"documentType_3",documentType_mingLing:"documentType_4",documentType_jueDing:"documentType_5",documentType_gongGao:"documentType_6",documentType_tongGao:"documentType_7",documentType_tongBao:"documentType_8",documentType_yiAn:"documentType_9",documentType_baoGao:"documentType_10",documentType_qingShi:"documentType_11",documentType_piFu:"documentType_12",documentType_yiJian:"documentType_13",projectShenBaoStage:"projectShenBaoStage",projectShenBaoStage_projectProposal:"projectShenBaoStage_1",projectShenBaoStage_KXXYJBG:"projectShenBaoStage_2",projectShenBaoStage_CBSJYGS:"projectShenBaoStage_3",projectShenBaoStage_prePlanFee:"projectShenBaoStage_4",projectShenBaoStage_newStratPlan:"projectShenBaoStage_5",projectShenBaoStage_xuJianPlan:"projectShenBaoStage_6",projectShenBaoStage_nextYearPlan:"projectShenBaoStage_7",projectShenBaoStage_junGong:"projectShenBaoStage_8",projectShenBaoStage_capitalApplyReport:"projectShenBaoStage_9",projectCategory:"projectCategory",projectCategory_A:"projectCategory_1",projectCategory_B:"projectCategory_2",projectCategory_C:"projectCategory_3",projectCategory_D:"projectCategory_4",projectClassify:"projectClassify",projectClassify_ZF:"projectClassify_1",projectClassify_SH:"projectClassify_2",projectConstrChar:"projectConstrChar",projectConstrChar_qianqi:"projectConstrChar_1",projectConstrChar_xinkaigong:"projectConstrChar_2",projectConstrChar_xujian:"projectConstrChar_3",projectConstrChar_chubei:"projectConstrChar_4",projectFunctionClassify:"projectFunctionClassify",projectGoverEconClassify:"projectGoverEconClassify",projectInvestmentType:"projectInvestmentType",projectInvestmentType_ZF:"projectInvestmentType_1",projectInvestmentType_SH:"projectInvestmentType_2",projectIndustry:"projectIndustry",projectIndustry_ZF:"projectIndustry_1",projectIndustry_SH:"projectIndustry_2",projectProgress:"projectProgress",projectStage:"projectStage",projectType:"projectType",approvalType:"approvalType",unitProperty:"unitProperty",area:"area",area_GM:"area_1",capitalOtherType:"capitalOtherType",taskType:"taskType",taskType_monthReport:"taskType_1",taskType_yearPlan:"taskType_2",taskType_sendMesg:"taskType_3",taskType_shenBao:"taskType_4",taskType_JYS:"taskType_5",taskType_KXXYJBG:"taskType_6",taskType_CBSJYGS:"taskType_7",taskType_qianQi:"taskType_8",taskType_newStart:"taskType_9",taskType_xuJian:"taskType_10",taskType_junGongJueSuan:"taskType_11",taskType_ZJSQBG:"taskType_12",auditState:"auditState",auditState_noAudit:"auditState_1",auditState_auditPass:"auditState_2",auditState_auditNotPass:"auditState_3",packageType:"packageType",packageType_danLie:"packageType_1",management:"管理员",credentialsType:"credentialsType",serviceRating:"serviceRating"}}function z(a,b,c){if(a){var d=a.length;d>b?$("#"+c).html("<font size='5'>0</font>"):d<=b&&$("#"+c).html("<font size='5'>"+(b-d)+"</font>")}else $("#"+c).html("<font size='5'>"+b+"</font>")}function A(){return{projectShenBaoStage_projectProposal:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["HYJY",'会议纪要及依据 <span class="required">(*)</span>'],["Project_ProPosal","项目建议书（需委托有相应资质的咨询机构按照规范编写）"],["other","其他资料"]],projectShenBaoStage_KXXYJBG:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["ProjectProPosalReply_Scanning",'项目建议书（或前期工作计划）批复扫描件 <span class="required">(*)</span>'],["KXXYJ_Report","项目可行性研究报告（包括项目建设、管养、招投标等内容）"],["GHXZProposal_Scanning","规划选址意见书扫描件"],["YDYS_Scanning","用地预审扫描件"],["HPPW_Scanning","环评批文扫描件"],["other","其他资料"]],projectShenBaoStage_CBSJYGS:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["ProjectProPosal_Reply","项目建议书（或前期工作计划）、可行性研究报告"],["CBSJYGS_Material","初步设计及项目总概算材料（项目单位需委托有相应资质的咨询机构编制项目总概算）"],["YDGHXKZ_Scanning","用地规划许可证扫描件"],["other","其他资料"]],projectShenBaoStage_prePlanFee:[["ProjectBasis",'项目依据  <span class="required">(*)</span>'],["other","其他"]],projectShenBaoStage_newStart:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["BudgetReply_Scanning",'概算批复扫描件 <span class="required">(*)</span>'],["GCGHXKZ_Scanning","工程规划许可证扫描件"],["IssuedReplyFile_Scanning",'全部已下达计划批复文件扫描件 <span class="required">(*)</span>'],["other","其他"]],projectShenBaoStage_xuJian:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["LastYearPlanReply_Copy",'上一年度计划批文复印件 <span class="required">(*)</span>'],["IssuedReplyFile_Scanning",'全部已下达计划批复文件扫描件 <span class="required">(*)</span>'],["other","其他"]],projectShenBaoStage_YearPlan:[["XXJD","项目工程形象进度及年度资金需求情况"],["WCJSNR","年度完成建设内容及各阶段工作内容完成时间表"],["TTJH",'历年政府投资计划下大文件  <span class="required">(*)</span>'],["GCXKZ","建设工程规划许可证"],["TDQK","土地落实情况、征地拆迁有关情况"],["XMJZ","项目进展情况相关资料"],["QQGZJH","前期工作计划文件"],["XMSSYJ","项目实施依据文件"],["HYJY","会议纪要"]],projectShenBaoStage_junGong:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["LastYearPlanReply_Copy",'上一年度计划批文复印件 <span class="required">(*)</span>'],["IssuedReplyFile_Scanning",'全部已下达计划批复文件扫描件 <span class="required">(*)</span>'],["other","其他"]],projectShenBaoStage_capitalApplyReport:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["LastYearPlanReply_Copy",'上一年度计划批文复印件 <span class="required">(*)</span>'],["IssuedReplyFile_Scanning",'全部已下达计划批复文件扫描件 <span class="required">(*)</span>'],["other","其他"]],projectEdit:[["XMJYSPF","项目建议书批复文本"],["KXXYJBGPF","可行性研究报告批复文本"],["ZGSPFTZ","总概算批复及调整文本"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]],projectEdit_SH:[["XMJYSPF","项目建议书批复文本"],["KXXYJBGPF","可行性研究报告批复文本"],["ZGSPFTZ","总概算批复及调整文本"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]],reviewResult:[["PSBG","1、评审报告"],["TZKSSHB","（1）投资匡算审核表"],["ZJPSYJ","（2）专家评审意见"],["ZJPSZMD","（3）专家评审组名单"],["QT","2、其他"]]}}function B(a,b){var c=[];if(null!=a&&""!=a){if(a.constructor==Array)return a;if(""==b)return c.push(a),c;for(var d=0,e=0,f=a.length;d<f;)e=a.indexOf(b,d),e!=-1?(""!=a.substring(d,e)&&c.push(a.substring(d,e)),d=e+1):(""!=a.substring(d,f)&&c.push(a.substring(d,f)),d=f)}return c}function C(a,b){var c="";if(null!=a&&a.length>0){if(a.constructor==String)return b;for(var d=0;d<a.length;d++)""!=a[d]&&(c=""==c?a[d]:c+b+a[d])}return c}function D(a){var b=parseFloat(a);if(!isNaN(b))return b=Math.round(1e4*a)/1e4}function E(){return window.global_userUnits?window.global_userUnits:($.ajax({url:"/common/userUnit",async:!1,success:function(a){window.global_userUnits=a}}),window.global_userUnits)}function F(a){E();for(var b="",c=0;c<window.global_userUnits.length;c++){var d=window.global_userUnits[c];if(a==d.id){b=d.unitName;break}}return b}function G(){return window.global_manageUser?window.global_roles:($.ajax({url:"/common/roles",async:!1,success:function(a){window.global_roles=a}}),window.global_roles)}function H(a,b){for(var c="",d=0;d<window.global_roles.length;d++){var e=window.global_roles[d];if(b==e.id){c=e.roleName;break}}return c}function I(a){function b(a,b,d){c+=parseFloat(a)}var c=0;return a.forEach(b),D(c)}function J(a){for(var b="",c=0,d=0;d<a.length;d++)c=a.charCodeAt(d),b+=String.fromCharCode(c>0&&c<128?c+65248:c);return b}function K(){$(document).on("click","#checkboxAll",function(){var a=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),$("body").on("click",".grid tr",function(a){$(this).parent().find("tr").removeClass("selected"),$(this).addClass("selected")})}var L={initJqValidation:b,requestError:c,requestSuccess:d,format:e,blockNonNumber:f,floatNumberInput:g,adminContentHeight:h,alert:i,confirm:j,getQuerystring:k,kendoGridConfig:l,getKendoCheckId:m,cookie:o,getToken:p,appPath:"",http:n,gridDataSource:q,loginUrl:"/",getBasicData:r,getBasicDataDesc:s,getBacicDataByIndectity:t,toDate:u,toMoney:v,formatDate:w,formatDateTime:x,basicDataConfig:y,checkLength:z,uploadFileTypeConfig:A,stringToArray:B,arrayToString:C,toDecimal4:D,getUserUnits:E,getUnitName:F,getSum:I,repSign:J,getLoginUser:a,getRoles:G,getRoleName:H};window.common=L,K()}(),function(){"use strict";angular.module("app",["ui.router","kendo.directives","textAngular"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",templateUrl:"/admin/welcome.html",controller:"roleCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("portal",{url:"/portal/:type",templateUrl:"/management/portal/html/list",controller:"portalCtrl",controllerAs:"vm"}).state("portalEdit",{url:"/portal/:type/:id",templateUrl:"/management/portal/html/edit",controller:"portalCtrl",controllerAs:"vm"}).state("monthReport",{url:"/monthReport",templateUrl:"/management/monthReport/html/list",controller:"monthReportCtrl",controllerAs:"vm"}).state("monthReport_SH",{url:"/monthReport_SH",templateUrl:"/management/monthReport/html/list_SH",controller:"monthReportCtrl",controllerAs:"vm"}).state("monthReportChange",{url:"/monthReportChange/:projectId/:year/:month",templateUrl:"/management/monthReport/html/edit",controller:"monthReportCtrl",controllerAs:"vm"}).state("monthReport_details",{url:"/monthReport/:projectId/:year/:month",templateUrl:"/management/monthReport/html/details",controller:"monthReportCtrl",controllerAs:"vm"}).state("project",{url:"/project",templateUrl:"/management/project/html/list.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectEdit",{url:"/projectEdit/:id/:projectInvestmentType",templateUrl:"/management/project/html/edit.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectDetails",{url:"/projectDetails/:id/:projectInvestmentType",templateUrl:"/management/project/html/details.html",controller:"projectCtrl",controllerAs:"vm"}).state("project_SH",{url:"/project_SH",templateUrl:"/management/project/html/list_SH.html",controller:"projectCtrl",controllerAs:"vm"}).state("unitManagement",{url:"/unitManagement",templateUrl:"/unitManagement/html/list.html",controller:"unitManagementCtrl",controllerAs:"vm"}).state("unitManagementEdit",{url:"/unitManagementEdit/:id",templateUrl:"/unitManagement/html/edit.html",controller:"unitManagementEditCtrl",controllerAs:"vm"}).state("basicData",{url:"/basicData",templateUrl:"/management/basicData/html/index",controller:"basicDataCtrl",controllerAs:"vm"}).state("sysConfig",{url:"/sysConfig",templateUrl:"/sys/html/index",controller:"sysConfigCtrl",controllerAs:"vm"}).state("yearPlan_shenbaoInfoList",{url:"/yearPlan/shenbaoInfoList",templateUrl:"/management/yearPlan/html/shenbaoInfoList",controller:"yearPlanCtrl",controllerAs:"vm"}).state("yearPlan_shenbaoInfoEdit",{url:"/yearPlan/shenbaoInfoEdit/:id/:projectInvestmentType/:stage",templateUrl:"/management/yearPlan/html/shenbaoInfoEdit",controller:"yearPlanCtrl",controllerAs:"vm"}).state("yearPlan_planList",{url:"/yearPlan/planList",templateUrl:"/management/yearPlan/html/planList",controller:"yearPlanCtrl",controllerAs:"vm"}).state("yearPlan_planEdit",{url:"/yearPlan/planEdit/:id",templateUrl:"/management/yearPlan/html/planEdit",controller:"yearPlanCtrl",controllerAs:"vm"}).state("yearPlan_planBZ",{url:"/yearPlan/planBZ/:id",templateUrl:"/management/yearPlan/html/planBZ",controller:"yearPlanCtrl",controllerAs:"vm"}).state("catalog_investment",{url:"/catalog/investment",templateUrl:"/management/catalog/html/investmentList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_investment_projectIndustry",{url:"/catalog/investment/projectIndustry/:id/",templateUrl:"/management/catalog/html/investmentSecondList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_investmentAlter",{url:"/catalog/investmentAlter/:id",templateUrl:"/management/catalog/html/investmentEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_addSecondCatalog",{url:"/catalog/investmentEdit/addSecondCatalog/:id",templateUrl:"/management/catalog/html/investmentEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_investmentEdit",{url:"/catalog/investmentEdit/:type",templateUrl:"/management/catalog/html/investmentEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_investmentList_projectType",{url:"/catalog/investment/projectTypeList",templateUrl:"/management/catalog/html/investmentProjectTypeList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_investmentList_constructionType",{url:"/catalog/investment/constructionTypeList",templateUrl:"/management/catalog/html/investmentConstructionTypeList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_policy",{url:"/catalog/policyCatalog",templateUrl:"/management/catalog/html/policyCatalogList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_policyAllowList",{url:"/catalog/policyCatalog/allowList",templateUrl:"/management/catalog/html/policyCatalogAllowList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_policyLimitList",{url:"/catalog/policyCatalog/limitList",templateUrl:"/management/catalog/html/policyCatalogLimitList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_policyCatalogEdit",{url:"/catalog/policyCatalogEdit/:type",templateUrl:"/management/catalog/html/policyCatalogEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_policyCatalogAlter",{url:"/catalog/policyCatalogEdit/:id/",templateUrl:"/management/catalog/html/policyCatalogEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_partApprovalMatters",{url:"/catalog/partApprovalMattersList",templateUrl:"/management/catalog/html/partApprovalMattersList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_partApprovalMattersEdit",{url:"/catalog/partApprovalMattersEdit",templateUrl:"/management/catalog/html/partApprovalMattersEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_partApprovalMattersAlter",{url:"/catalog/partApprovalMattersEdit/:id",templateUrl:"/management/catalog/html/partApprovalMattersEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_partApprovalMattersDetails",{url:"/catalog/partApprovalMattersEdit/:id/",templateUrl:"/management/catalog/html/partApprovalMattersEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_agencyServiceMatters",{url:"/catalog/agencyServiceMattersList",templateUrl:"/management/catalog/html/agencyServiceMattersList",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_agencyServiceMattersEdit",{url:"/catalog/agencyServiceMattersEdit",templateUrl:"/management/catalog/html/agencyServiceMattersEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_agencyServiceMattersAlter",{url:"/catalog/agencyServiceMattersEdit/:id",templateUrl:"/management/catalog/html/agencyServiceMattersEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("catalog_agencyServiceMattersDetails",{url:"/catalog/agencyServiceMattersEdit/:id/",templateUrl:"/management/catalog/html/agencyServiceMattersEdit",controller:"catalogCtrl",controllerAs:"vm"}).state("credit_illegalNameList",{url:"/creditInfo/illegalNameList",templateUrl:"/management/creditInfo/html/illegalNameList",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_illegalNameEdit",{url:"/creditInfo/illegalNameEdit/:id/:projectNumber/:projectName/:unitName/:createdDate/:shenBaoInfoId",templateUrl:"/management/creditInfo/html/illegalNameEdit",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_updateIllegalName",{url:"/creditInfo/updateIllegalName/:id",templateUrl:"/management/creditInfo/html/illegalNameEdit",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_illegalNameDetails",{url:"/creditInfo/illegalNameDetails/:id",templateUrl:"/management/creditInfo/html/illegalNameDetails",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_blackList",{url:"/creditInfo/blackList",templateUrl:"/management/creditInfo/html/blackList",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_blackListEdit",{url:"/creditInfo/blackList//:projectNumber/:projectName/:unitName/:createdDate/:shenBaoInfoId",templateUrl:"/management/creditInfo/html/blackListEdit",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_blackListDetails",{url:"/creditInfo/blackListDetails/:id",templateUrl:"/management/creditInfo/html/blackListDetails",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_blackListAlter",{url:"/creditInfo/blackListEdit/:id",templateUrl:"/management/creditInfo/html/blackListUpdate",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_projectAnomaly",{url:"/creditInfo/projectAnomalyList",templateUrl:"/management/creditInfo/html/projectAnomaly",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_projectAnomalyEdit",{url:"/creditInfo/projectAnomaly/:id/:projectNumber/:projectName/:unitName/:createdDate/:shenBaoInfoId",templateUrl:"/management/creditInfo/html/projectAnomalyEdit",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_projectAnomalyDetails",{url:"/creditInfo/projectAnomalyDetails/:id",templateUrl:"/management/creditInfo/html/projectAnomalyDetails",controller:"creditInfoCtrl",controllerAs:"vm"}).state("credit_updateProjectAnomaly",{url:"/creditInfo/updateProjectAnomaly/:id",templateUrl:"/management/creditInfo/html/projectAnomalyUpdate",controller:"creditInfoCtrl",controllerAs:"vm"}).state("task_todo",{url:"/task/todo",templateUrl:"/management/task/html/todo",controller:"taskCtrl",controllerAs:"vm"}).state("task_handle",{url:"/task/todo/:taskType/:taskId/:relId",templateUrl:"/management/task/html/handle",controller:"taskCtrl",controllerAs:"vm"}).state("task_complete",{url:"/task/complete",templateUrl:"/management/task/html/complete",controller:"taskCtrl",controllerAs:"vm"}).state("task_shenPi",{url:"/task/shenPi",templateUrl:"/management/task/html/complete_shenPi",controller:"taskCtrl",controllerAs:"vm"}).state("task_plan",{url:"/task/plan",templateUrl:"/management/task/html/complete_plan",controller:"taskPlanCtrl",controllerAs:"vm"}).state("task_shenPiDetails",{url:"/task/shenPi_details/:taskType/:taskId/:relId",templateUrl:"/management/task/html/shenPiDetails",controller:"taskCtrl",controllerAs:"vm"}).state("task_planDetails",{url:"/task/plan_details/:taskType/:taskId/:relId",templateUrl:"/management/task/html/planDetails",controller:"taskPlanCtrl",controllerAs:"vm"}).state("task_todo_plan",{url:"/task/todo_plan",templateUrl:"/management/task/html/todo_plan",controller:"taskPlanCtrl",controllerAs:"vm"}).state("task_handle_plan",{url:"/task/handle_plan/:taskType/:taskId/:relId",templateUrl:"/management/task/html/handle_plan",controller:"taskPlanCtrl",controllerAs:"vm"}).state("task_todo_audit",{url:"/task/todo_audit",templateUrl:"/management/task/html/todo_audit",controller:"taskAuditCtrl",controllerAs:"vm"}).state("task_handle_audit",{url:"/task/handle_audit/:taskType/:taskId/:relId",templateUrl:"/management/task/html/handle_audit",controller:"taskAuditCtrl",controllerAs:"vm"}).state("mediationUnitList",{url:"/mediationUnitList",templateUrl:"/management/mediationManagement/html/mediationUnitList",controller:"mediationManagementCtrl",controllerAs:"vm"}).state("mediationUnitChange",{url:"/mediationUnitChange/:id",templateUrl:"/management/mediationManagement/html/mediationUnitChangeDetails",controller:"mediationManagementCtrl",controllerAs:"vm"}).state("mediationUnitDetails",{url:"/mediationUnitDetails/:id",templateUrl:"/management/mediationManagement/html/mediationUnitDetails",controller:"mediationManagementCtrl",controllerAs:"vm"}).state("assistReviewList",{url:"/assistReviewList",templateUrl:"/management/mediationManagement/html/assistReviewList",controller:"mediationManagementCtrl",controllerAs:"vm"}).state("assistReviewChange",{url:"/assistReviewChange/:id",templateUrl:"/management/mediationManagement/html/assistReviewChangeDetails",controller:"mediationManagementCtrl",controllerAs:"vm"}).state("assistReviewDetails",{url:"/assistReviewDetails/:id",templateUrl:"/management/mediationManagement/html/assistReviewDetails",controller:"mediationManagementCtrl",controllerAs:"vm"}).state("serviceEvaluation",{url:"/serviceEvaluation/:id",templateUrl:"/management/mediationManagement/html/serviceEvaluation",controller:"mediationManagementCtrl",controllerAs:"vm"}).state("submitReviewEvaluation",{url:"/submitReviewEvaluation/:id",templateUrl:"/management/mediationManagement/html/submitReviewEvaluation",controller:"mediationManagementCtrl",controllerAs:"vm"})}])}(),function(){"use strict";angular.module("appSupervision",["ui.router","kendo.directives","textAngular"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",templateUrl:"/adminSupervision/welcome_supervision.html",controller:"roleCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("portal",{url:"/portal/:type",templateUrl:"/management/portal/html/list",controller:"portalCtrl",controllerAs:"vm"}).state("portalEdit",{url:"/portal/:type/:id",templateUrl:"/management/portal/html/edit",controller:"portalCtrl",controllerAs:"vm"}).state("unitManagement",{url:"/unitManagement",templateUrl:"/unitManagement/html/list.html",controller:"unitManagementCtrl",controllerAs:"vm"}).state("unitManagementEdit",{url:"/unitManagementEdit/:id",templateUrl:"/unitManagement/html/edit.html",controller:"unitManagementEditCtrl",controllerAs:"vm"}).state("basicData",{url:"/basicData",templateUrl:"/management/basicData/html/index",controller:"basicDataCtrl",controllerAs:"vm"}).state("sysConfig",{url:"/sysConfig",templateUrl:"/sys/html/index",controller:"sysConfigCtrl",controllerAs:"vm"}).state("supervision_tzxm",{url:"/supervision/tzxm",templateUrl:"/management/supervision/project/html/list",controller:"projectCtrl",controllerAs:"vm"}).state("projectEdit",{url:"/projectEdit/:id/:projectInvestmentType",templateUrl:"/management/supervision/project/html/edit.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectDetails",{url:"/projectDetails/:id/:projectInvestmentType",templateUrl:"/management/project/html/details.html",controller:"projectCtrl",controllerAs:"vm"}).state("supervision_spdw",{url:"/supervision/spdw",templateUrl:"/management/supervision/project/html/unitList",controller:"projectCtrl",controllerAs:"vm"}).state("shenpiUnitChange",{url:"/shenpiUnitChange/:id",templateUrl:"/management/supervision/project/html/shenpiUnitChange",controller:"projectCtrl",controllerAs:"vm"}).state("shenpiUnitDetail",{url:"/shenpiUnitDetail/:id",templateUrl:"/management/supervision/project/html/shenpiUnitDetail",controller:"projectCtrl",controllerAs:"vm"}).state("shenpiItemsList",{url:"/supervision/spsx",templateUrl:"/management/supervision/project/html/shenpiItemsList",controller:"projectCtrl",controllerAs:"vm"}).state("shenpiItemsChange",{url:"/shenpiItemsChange/:id",templateUrl:"/management/supervision/project/html/shenpiItemsChange",controller:"projectCtrl",controllerAs:"vm"}).state("shenpiItemsDetail",{url:"/shenpiItemsDetail/:id",templateUrl:"/management/supervision/project/html/shenpiItemsDetail",controller:"projectCtrl",controllerAs:"vm"}).state("shenpifankuiItemsList",{url:"/supervision/spfk",templateUrl:"/management/supervision/project/html/shenpifankuiItemsList",controller:"projectCtrl",controllerAs:"vm"}).state("shenpifankuiItemsChange",{url:"/shenpifankuiItemsChange/:id",templateUrl:"/management/supervision/project/html/shenpifankuiItemsChange",controller:"projectCtrl",controllerAs:"vm"}).state("shenpifankuiItemsDetail",{url:"/shenpifankuiItemsDetail/:id",templateUrl:"/management/supervision/project/html/shenpifankuiItemsDetail",controller:"projectCtrl",controllerAs:"vm"})}])}(),function(){"use strict";function a(a,b){function c(){$("#datepicker").kendoDatePicker({culture:"zh-CN"})}function d(){$("#files").kendoUpload({async:{saveUrl:"/demo/save",removeUrl:"/demo/remove",autoUpload:!0}}),$("#files2").kendoUpload({async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},showFileList:!1,select:function(a){console.log("select:"),console.log(a)},error:function(a){if(console.log("error:"),
console.log(a),200==a.XMLHttpRequest.status){var b=a.XMLHttpRequest.response;alert("文件名："+b)}},localization:{select:"选择文件"}})}function e(){c(),d(),b.treeList(f),f.init_select()}var f=this;f.title="",f.tabActive=1,f.tab=function(a){f.tabActive=a},f.showDialog=function(){$(".myDialog").modal({backdrop:"static",keyboard:!1})},f.setCookie=function(){common.cookie().set("myCookie","userName",f.cookie.userName),common.cookie().set("myCookie","password",f.cookie.password)},f.getCookie=function(){var a=common.cookie().get("myCookie","userName"),b=common.cookie().get("myCookie","password");alert(common.format("用户名:{0},密码:{1}",a,b))},f.textSubmit=function(){alert(f.content)},f.init_select=function(){f.parentCategory="",f.childCategory="";var a=common.getBasicData();f.parentList=$linq(a).where(function(a){return"projectIndustry"==a.identity&&""==a.pId}).toArray(),f.parentChange=function(){f.childList=$linq(a).where(function(a){return a.pId==f.parentCategory}).toArray()}},f.popOver=function(a){f.isPopOver=!0,f.popStyle={border:"1px solid #ccc",height:"200px",width:"120px",position:"absolute",background:"white",left:a.pageX+"px",top:a.pageY+"px"},f.content="内容"},e()}angular.module("app").controller("demoCtrl",a),a.$inject=["$location","demoSvc"]}(),function(){"use strict";function a(a){function b(a){var b="https://demos.telerik.com/kendo-ui/service",c={transport:{read:{url:b+"/EmployeeDirectory/All",dataType:"jsonp"}},schema:{model:{id:"EmployeeId",parentId:"ReportsTo",fields:{EmployeeId:{type:"number",editable:!1,nullable:!1},ReportsTo:{nullable:!0,type:"number"},FirstName:{validation:{required:!0}},LastName:{validation:{required:!0}},HireDate:{type:"date"},Phone:{type:"string"},BirthDate:{type:"date"},Extension:{type:"number",validation:{min:0,required:!0}},Position:{type:"string"}}}}},d=[{field:"FirstName",title:"First Name",width:"150px"},{field:"LastName",title:"Last Name",width:"150px"},{field:"Position"},{title:"Location",template:"{{ dataItem.City }}, {{ dataItem.Country }}"},{command:["edit"]}];a.treelistOptions={dataSource:c,columns:d}}function c(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var e={method:"put",url:d,data:b.model.password},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}}var d="/account/password",e={upload:c,treeList:b};return e}angular.module("app").factory("demoSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b){function c(){}var d=this;d.title="",d.changePwd=function(){b.changePwd(d)},c()}angular.module("app").controller("homeCtrl",a),a.$inject=["$location","homeSvc"]}(),function(){"use strict";function a(a){function b(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0;var e={method:"put",url:c,data:b.model.password},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}}var c="/account/password",d={changePwd:b};return d}angular.module("app").factory("homeSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="日志列表",c()}angular.module("app").controller("logCtrl",a),a.$inject=["$location","logSvc"]}(),function(){"use strict";function a(a,b){function c(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(d),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"id",title:"ID",width:80,filterable:!1},{field:"level",title:"级别",width:100,filterable:!0},{field:"message",title:"日志内容",filterable:!1},{field:"userId",title:"操作者",width:150,filterable:!0},{field:"createdDate",title:"操作时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var d="/log",e={grid:c};return e}angular.module("app").factory("logSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="部门列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteOrg(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("app").controller("orgCtrl",a),a.$inject=["$location","orgSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate&&b.getOrgById(e)}var e=this;e.title="新增部门",e.isorgExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新部门"),e.create=function(){b.createOrg(e)},e.update=function(){b.updateOrg(e)},d()}angular.module("app").controller("orgEditCtrl",a),a.$inject=["$location","orgSvc","$state"]}(),function(){"use strict";function a(a,b,c,d){function e(){c.getOrgById(f),d.orgUserGrid(f),d.allUserGrid(f)}var f=this;f.id=b.params.id,f.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),f.orgUserGrid.dataSource.read()},f.closeAddUserDialog=function(){$(".addUser").modal("hide")},f.add=function(a){d.add(f,a)},f.remove=function(a){d.remove(f,a)},f.removes=function(){var a=common.getKendoCheckId(".orgUserGrid");if(0==a.length)common.alert({vm:f,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");f.remove(d)}},e()}angular.module("app").controller("orgUserCtrl",a),a.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function a(a,b){function c(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"orgIdentity",title:"部门标识",width:200,filterable:!1},{field:"name",title:"部门名称",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:280,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function d(b){common.initJqValidation();var c=$("form").valid();if(c&&0==b.isorgExist){b.isSubmit=!0;var d={method:"post",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function e(b){var c={method:"get",url:common.format(h+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{},b.isUpdate};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){common.initJqValidation();var c=$("form").valid();if(c&&0==b.isorgExist){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function g(b,c){b.isSubmit=!0;var d={method:"delete",url:h,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}var h="/org",i="#/org",j={grid:c,createOrg:d,getOrgById:e,updateOrg:f,deleteOrg:g};return j}angular.module("app").factory("orgSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(b,c){var d={method:"delete",url:common.format(h,b.id),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(b,c){var d={method:"post",url:common.format(h,b.id),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.orgUserGrid.dataSource.read(),b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(g,a.id)),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(a){return common.format($("#allUserGridBtns").html(),"vm.add('"+a.id+"')",a.id)}}];a.orgUserGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(h,a.id)),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.remove('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var g="/org/{0}/userNotIn",h="/org/{0}/users",i={orgUserGrid:f,allUserGrid:e,add:d,remove:c};return i}angular.module("app").factory("orgUserSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="部门列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteOrg(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("appSupervision").controller("orgCtrl",a),a.$inject=["$location","orgSvc"]}(),function(){"use strict";function a(a,b){function c(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"orgIdentity",title:"部门标识",width:200,filterable:!1},{field:"name",title:"部门名称",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:280,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function d(b){common.initJqValidation();var c=$("form").valid();if(c&&0==b.isorgExist){b.isSubmit=!0;var d={method:"post",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function e(b){var c={method:"get",url:common.format(h+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{},b.isUpdate};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){common.initJqValidation();var c=$("form").valid();if(c&&0==b.isorgExist){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function g(b,c){b.isSubmit=!0;var d={method:"delete",url:h,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}var h="/org",i="#/org",j={grid:c,createOrg:d,getOrgById:e,updateOrg:f,deleteOrg:g};return j}angular.module("appSupervision").factory("orgSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate&&b.getOrgById(e)}var e=this;e.title="新增部门",e.isorgExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新部门"),e.create=function(){b.createOrg(e)},e.update=function(){b.updateOrg(e)},d()}angular.module("appSupervision").controller("orgEditCtrl",a),a.$inject=["$location","orgSvc","$state"]}(),function(){"use strict";function a(a,b,c,d){function e(){c.getOrgById(f),d.orgUserGrid(f),d.allUserGrid(f)}var f=this;f.id=b.params.id,f.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),f.orgUserGrid.dataSource.read()},f.closeAddUserDialog=function(){$(".addUser").modal("hide")},f.add=function(a){d.add(f,a)},f.remove=function(a){d.remove(f,a)},f.removes=function(){var a=common.getKendoCheckId(".orgUserGrid");if(0==a.length)common.alert({vm:f,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");f.remove(d)}},e()}angular.module("appSupervision").controller("orgUserCtrl",a),a.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function a(a,b){function c(b,c){var d={method:"delete",url:common.format(h,b.id),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(b,c){var d={method:"post",url:common.format(h,b.id),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.orgUserGrid.dataSource.read(),b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(g,a.id)),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(a){return common.format($("#allUserGridBtns").html(),"vm.add('"+a.id+"')",a.id)}}];a.orgUserGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(h,a.id)),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.remove('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var g="/org/{0}/userNotIn",h="/org/{0}/users",i={orgUserGrid:f,allUserGrid:e,add:d,remove:c};return i}angular.module("appSupervision").factory("orgUserSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="角色列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteRole(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("app").controller("roleCtrl",a),a.$inject=["$location","roleSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate?b.getRoleById(e):b.initZtreeClient(e)}var e=this;e.title="添加角色",e.isRoleExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新角色"),e.create=function(){b.createRole(e)},e.update=function(){b.updateRole(e)},e.checkRole=function(){b.checkRole(e)},d()}angular.module("app").controller("roleEditCtrl",a),a.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function a(a,b){function c(){var a=$.fn.zTree.getZTreeObj("zTree"),b=a.getCheckedNodes(!0);return b}function d(a){for(var b=$.fn.zTree.getZTreeObj("zTree"),c=$linq(a.model.resources).select(function(a){return a.path}).toArray(),d=b.getNodesByParam("level",1,null),e=$linq(d).where(function(a){return $linq(c).contains(a.path)}).toArray(),f=0,g=e.length;f<g;f++)b.checkNode(e[f],!0,!0)}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(b){common.initJqValidation();var d=$("form").valid();if(d&&0==b.isRoleExist){b.isSubmit=!0;var e=c(),f=$linq(e).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,name:a.name,path:a.path,method:a.method}}).toArray();b.model.resources=f;var g={method:"post",url:l,data:b.model},h=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=m}})}})};common.http({vm:b,$http:a,httpOptions:g,success:h})}}function g(a){}function h(b){var c={method:"get",url:common.format(l+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.isUpdate&&k(b)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(b){common.initJqValidation();var d=$("form").valid();if(d&&0==b.isRoleExist){b.isSubmit=!0,b.model.id=b.id;var e=c(),f=$linq(e).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,name:a.name,path:a.path,method:a.method}}).toArray();b.model.resources=f;var g={method:"put",url:l,data:b.model},h=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:g,success:h})}}function j(b,c){b.isSubmit=!0;var d={method:"delete",url:l,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function k(b){var c={method:"get",url:n},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){var c,e={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},f=a.data;c=$.fn.zTree.init($("#zTree"),e,f),b.isUpdate&&d(b)}})};common.http({vm:b,$http:a,httpOptions:c,success:e})}var l="/role",m="#/role",n="/sys/resource",o={grid:e,createRole:f,checkRole:g,getRoleById:h,updateRole:i,deleteRole:j,initZtreeClient:k};return o}angular.module("app").factory("roleSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="角色列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteRole(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("appSupervision").controller("roleCtrl",a),a.$inject=["$location","roleSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate?b.getRoleById(e):b.initZtreeClient(e)}var e=this;e.title="添加角色",e.isRoleExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新角色"),e.create=function(){b.createRole(e)},e.update=function(){b.updateRole(e)},e.checkRole=function(){b.checkRole(e)},d()}angular.module("appSupervision").controller("roleEditCtrl",a),a.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function a(a,b){function c(){var a=$.fn.zTree.getZTreeObj("zTree"),b=a.getCheckedNodes(!0);return b}function d(a){for(var b=$.fn.zTree.getZTreeObj("zTree"),c=$linq(a.model.resources).select(function(a){return a.path}).toArray(),d=b.getNodesByParam("level",1,null),e=$linq(d).where(function(a){return $linq(c).contains(a.path)}).toArray(),f=0,g=e.length;f<g;f++)b.checkNode(e[f],!0,!0)}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(b){common.initJqValidation();var d=$("form").valid();if(d&&0==b.isRoleExist){b.isSubmit=!0;var e=c(),f=$linq(e).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,name:a.name,path:a.path,method:a.method}}).toArray();b.model.resources=f;var g={method:"post",url:l,data:b.model},h=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=m}})}})};common.http({vm:b,$http:a,httpOptions:g,success:h})}}function g(a){}function h(b){var c={method:"get",url:common.format(l+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.isUpdate&&k(b)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(b){common.initJqValidation();var d=$("form").valid();if(d&&0==b.isRoleExist){b.isSubmit=!0,b.model.id=b.id;var e=c(),f=$linq(e).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,name:a.name,path:a.path,method:a.method}}).toArray();b.model.resources=f;var g={method:"put",url:l,data:b.model},h=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:g,success:h})}}function j(b,c){b.isSubmit=!0;var d={method:"delete",url:l,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function k(b){var c={method:"get",url:n},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){var c,e={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},f=a.data;c=$.fn.zTree.init($("#zTree"),e,f),b.isUpdate&&d(b)}})};common.http({vm:b,$http:a,httpOptions:c,success:e})}var l="/role",m="#/role",n="/sys/resource",o={grid:e,createRole:f,checkRole:g,getRoleById:h,updateRole:i,deleteRole:j,initZtreeClient:k};return o}angular.module("appSupervision").factory("roleSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="用户列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteUser(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("app").controller("userCtrl",a),a.$inject=["$location","userSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate?b.getUserById(e):b.initZtreeClient(e)}var e=this;e.model={},e.title="添加用户",e.isuserExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新用户"),e.create=function(){b.createUser(e)},e.update=function(){b.updateUser(e)},e.initPassword=function(a){var b=$("#initPassword").is(":checked");b?(e.model.password="888888",e.model.passwordConfirm="888888"):(e.model.password="",e.model.passwordConfirm="")},d()}angular.module("app").controller("userEditCtrl",a),a.$inject=["$location","userSvc","$state"]}(),function(){"use strict";function a(a){function b(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d=h(),e=$linq(d).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,roleName:a.name}}).toArray();b.model.roles=e;var f={method:"put",url:j,data:b.model},g=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:f,success:g})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function c(b,c){b.isSubmit=!0;var d={method:"delete",url:j,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d=h(),e=$linq(d).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,roleName:a.name}}).toArray();b.model.roles=e;var f={method:"post",url:j,data:b.model},g=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=k}})}})};common.http({vm:b,$http:a,httpOptions:f,success:g})}}function e(b){var c={method:"get",url:l},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){var c,d={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},e=$linq(a.data.value).select(function(a){return{id:a.id,name:a.roleName}}).toArray(),f={id:"",name:"角色集合",children:e};c=$.fn.zTree.init($("#zTree"),d,f),b.isUpdate&&i(b)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(j+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.isUpdate&&e(b)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(j),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function h(){var a=$.fn.zTree.getZTreeObj("zTree"),b=a.getCheckedNodes(!0);return b}function i(a){for(var b=$.fn.zTree.getZTreeObj("zTree"),c=$linq(a.model.roles).select(function(a){return a.roleName}).toArray(),d=b.getNodesByParam("level",1,null),e=$linq(d).where(function(a){return $linq(c).contains(a.name)}).toArray(),f=0,g=e.length;f<g;f++)b.checkNode(e[f],!0,!0)}var j="/user",k="#/user",l="/role",m={grid:g,getUserById:f,initZtreeClient:e,createUser:d,deleteUser:c,updateUser:b};return m}angular.module("app").factory("userSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="用户列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteUser(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("appSupervision").controller("userCtrl",a),a.$inject=["$location","userSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate?b.getUserById(e):b.initZtreeClient(e)}var e=this;e.model={},e.title="添加用户",e.isuserExist=!1,e.isSupervise=!0,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新用户"),
e.create=function(){b.createUser(e)},e.update=function(){b.updateUser(e)},e.initPassword=function(a){var b=$("#initPassword").is(":checked");b?(e.model.password="888888",e.model.passwordConfirm="888888"):(e.model.password="",e.model.passwordConfirm="")},d()}angular.module("appSupervision").controller("userEditCtrl",a),a.$inject=["$location","userSvc","$state"]}(),function(){"use strict";function a(a){function b(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d=h(),e=$linq(d).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,roleName:a.name}}).toArray();b.model.roles=e;var f={method:"put",url:j,data:b.model},g=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:f,success:g})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function c(b,c){b.isSubmit=!0;var d={method:"delete",url:j,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d=h(),e=$linq(d).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,roleName:a.name}}).toArray();b.model.roles=e;var f={method:"post",url:j,data:b.model},g=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=k}})}})};common.http({vm:b,$http:a,httpOptions:f,success:g})}}function e(b){var c={method:"get",url:l},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){var c,d={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},e=$linq(a.data.value).select(function(a){return{id:a.id,name:a.roleName}}).toArray(),f={id:"",name:"角色集合",children:e};c=$.fn.zTree.init($("#zTree"),d,f),b.isUpdate&&i(b)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(j+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.isUpdate&&e(b)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(j),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function h(){var a=$.fn.zTree.getZTreeObj("zTree"),b=a.getCheckedNodes(!0);return b}function i(a){for(var b=$.fn.zTree.getZTreeObj("zTree"),c=$linq(a.model.roles).select(function(a){return a.roleName}).toArray(),d=b.getNodesByParam("level",1,null),e=$linq(d).where(function(a){return $linq(c).contains(a.name)}).toArray(),f=0,g=e.length;f<g;f++)b.checkNode(e[f],!0,!0)}var j="/user",k="#/user",l="/role",m={grid:g,getUserById:f,initZtreeClient:e,createUser:d,deleteUser:c,updateUser:b};return m}angular.module("appSupervision").factory("userSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d){function e(){var a,c=common.getBasicData(),d={view:{nameIsHTML:!0,addHoverDom:function(a,d){if(0!=d.level&&d.canEdit){var e=$("#"+d.tId+"_span");if(d.editNameFlag||$("#addBtn_"+d.tId).length>0)return;var f="<span class='button add' id='addBtn_"+d.tId+"' title='添加子节点' onfocus='this.blur();'></span>";e.after(f);var h=$("#addBtn_"+d.tId);h&&h.bind("click",function(){window.global_basicData=null,c=common.getBasicData();var a,e,f,h=$.fn.zTree.getZTreeObj("zTree"),i=$linq(c).where(function(a){return a.pId==d.id}).select(function(a){return{id:a.id}}).toArray();if(i.length>0){for(var j=[],k=0,l=0;l<i.length;l++){var m=i[l].id,n=m.split("_");j[k+l]=parseInt(n[n.length-1],10)}var o=Math.max.apply(null,j);a=i[0].id,f=a.split("_"),f[f.length-1]=o+1,e=f.join("_")}else a=d.id,e=a+"_1";var p={id:e,name:"请编辑命名",identity:d.identity,pId:d.id,canEdit:!0};h.addNodes(d,p),g.model.id=p.id,g.model.description=p.name,g.model.identity=p.identity,g.model.pId=p.pId,g.model.canEdit=p.canEdit,b.createBasicData(g)})}},removeHoverDom:function(a,b){$("#addBtn_"+b.tId).unbind().remove()},showIcon:!0,selectedMulti:!0},edit:{enable:!0,showRenameBtn:function(a,b){return!(0==b.level||!b.canEdit)},showRemoveBtn:function(a,b){return!(b.isParent||!b.canEdit)},removeTitle:"删除",renameTitle:"编辑"},callback:{onRename:function(a,c,d){g.model.id=d.id,g.model.description=d.name,g.model.identity=d.identity,g.model.pId=d.pId,b.updateBasicData(g)},onRemove:function(a,c,d){b.deleteBasicData(g,d.id)}}},e=function(a){return $linq(c).where(function(b){return b.pId==a}).select(function(a){return{id:a.id,name:a.description,pId:a.pId,identity:a.identity,canEdit:a.canEdit,children:e(a.id)}}).toArray()},f=$linq(c).where(function(a){return""==a.pId}).select(function(a){return{id:a.id,name:common.format("{0}{1}",a.description,a.canEdit?"":'<span style="color:red">[不可编辑]</span>'),pId:a.pId,canEdit:a.canEdit,identity:a.identity,children:e(a.id)}}).toArray(),h={id:"",name:"基础数据",children:f};a=$.fn.zTree.init($("#zTree"),d,h)}function f(){g.init()}var g=this;g.init=function(){g.model={},e()},f()}angular.module("app").controller("basicDataCtrl",a),a.$inject=["$location","basicDataSvc","$state","$scope"]}(),function(){"use strict";function a(a,b){function c(b){var c={method:"put",url:f,data:b.model},d=function(a){common.requestSuccess({vm:b,response:a})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b,c){var d={method:"delete",url:f,data:c},e=function(a){common.requestSuccess({vm:b,response:a})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(b){var c={method:"post",url:f,data:b.model},d=function(a){common.requestSuccess({vm:b,response:a})};common.http({vm:b,$http:a,httpOptions:c,success:d})}var f="/management/basicData",g={createBasicData:e,deleteBasicData:d,updateBasicData:c};return g}angular.module("app").factory("basicDataSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){"catalog_investment"==c.current.name&&(x.page="investment",x.type="projectIndustry"),"catalog_investment_projectIndustry"==c.current.name&&(x.page="investment_projectIndustry"),"catalog_addSecondCatalog"==c.current.name&&(x.page="addSecondCatalog"),"catalog_investmentEdit"==c.current.name&&(x.page="investmentEdit"),"catalog_investmentAlter"==c.current.name&&(x.page="investmentAlter"),"catalog_investmentList_projectType"==c.current.name&&(x.page="investment",x.type="projectType"),"catalog_investmentList_constructionType"==c.current.name&&(x.page="investment",x.type="constructionType"),"catalog_policy"==c.current.name&&(x.page="policy",x.type="encourage"),"catalog_policyAllowList"==c.current.name&&(x.page="policy",x.type="allow"),"catalog_policyLimitList"==c.current.name&&(x.page="policy",x.type="limit"),"catalog_policyCatalogEdit"==c.current.name&&(x.page="policyCatalogEdit"),"catalog_policyCatalogAlter"==c.current.name&&(x.page="policyCatalogAlter"),"catalog_partApprovalMatters"==c.current.name&&(x.page="partApprovalMattersList"),"catalog_partApprovalMattersEdit"==c.current.name&&(x.page="partApprovalMattersEdit"),"catalog_partApprovalMattersAlter"==c.current.name&&(x.page="partApprovalMattersAlter"),"catalog_partApprovalMattersDetails"==c.current.name&&(x.page="partApprovalMattersDetails"),"catalog_agencyServiceMatters"==c.current.name&&(x.page="agencyServiceMattersList"),"catalog_agencyServiceMattersEdit"==c.current.name&&(x.page="agencyServiceMattersEdit"),"catalog_agencyServiceMattersAlter"==c.current.name&&(x.page="agencyServiceMattersAlter"),"catalog_agencyServiceMattersDetails"==c.current.name&&(x.page="agencyServiceMattersDetails"),$(document).on("click","#checkboxAll_projectIndustry",function(){var a=$(this).is(":checked");$(".projectIndustryGrid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),$(document).on("click","#checkboxAll_projectType",function(){var a=$(this).is(":checked");$(".projectTypeGrid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),$(document).on("click","#checkboxAll_constructionType",function(){var a=$(this).is(":checked");$(".constructionTypeGrid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),x.alert=function(a){x.type=a}}function g(){f(),"investment"==x.page&&w(),"investment_projectIndustry"==x.page&&s(),"investmentEdit"==x.page&&v(),"addSecondCatalog"==x.page&&u(),"investmentAlter"==x.page&&t(),"policy"==x.page&&r(),"policyCatalogEdit"==x.page&&q(),"policyCatalogAlter"==x.page&&p(),"partApprovalMattersList"==x.page&&o(),"partApprovalMattersEdit"==x.page&&n(),"partApprovalMattersAlter"==x.page&&m(),"partApprovalMattersDetails"==x.page&&l(),"agencyServiceMattersList"==x.page&&k(),"agencyServiceMattersEdit"==x.page&&j(),"agencyServiceMattersAlter"==x.page&&i(),"agencyServiceMattersDetails"==x.page&&h()}function h(){x.title="中介服务事项详情页",x.isAgencyServiceMattersDetails=!0,b.getAgencyServiceMattersById(x)}function i(){x.title="中介服务事项修改",x.isShowConfirm=!0,b.getAgencyServiceMattersById(x),x.updateAgencyServiceMatters=function(){common.initJqValidation();var a=$("form").valid();a&&b.updateAgencyServiceMatters(x)}}function j(){x.title="中介服务事项编辑",x.saveAgencyServiceMatters=function(){common.initJqValidation();var a=$("form").valid();a&&b.createAgencyServiceMatters(x)}}function k(){x.title="中介服务事项列表",b.grid_agencyServiceMatters(x),x.deleteAgencyServiceMattersCatalog=function(a){common.confirm({vm:x,msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteAgencyServiceMattersCatalog(x,a)}})},x.deleteAgencyServiceMattersCatalogs=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:x,msg:"请选择数据"});else{for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");common.confirm({vm:x,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteAgencyServiceMattersCatalogs(x,e)}})}}}function l(){x.title="部门审批事项详情",x.isPartApprovalMattersDetails=!0,b.getpartApprovalMattersById(x)}function m(){x.title="部门审批事项修改",x.isShowConfirm=!0,b.getpartApprovalMattersById(x),x.updatePartApprovalMatters=function(){common.initJqValidation();var a=$("form").valid();a&&b.updatePartApprovalMatters(x)}}function n(){x.title="部门审批事项编辑",x.savePartApprovalMatters=function(){common.initJqValidation();var a=$("form").valid();a&&b.createPartApprovalMatters(x)}}function o(){x.title="部门审批事项列表",b.grid_partApprovalMatters(x),x.deletePartApprovalMattersCatalog=function(a){common.confirm({vm:x,title:"",msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deletePartApprovalMatters(x,a)}})},x.deletePartApprovalMattersCatalogs=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:x,msg:"请选择数据"});else{for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");common.confirm({vm:x,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deletePartApprovalMattersCatalogs(x,e)}})}}}function p(){x.title="政策条目修改",x.isShowConfirm=!0,b.getPolicyCatalogById(x),x.updatePolicyCatalog=function(){common.initJqValidation();var a=$("form").valid();a&&b.updatePolicyCatalog(x)}}function q(){"encourage"==x.type&&(x.title="适用产业政策条目(鼓励类)编辑",x.policyCatalogEncourage=!0),"allow"==x.type&&(x.title="适用产业政策条目(允许类)编辑",x.policyCatalogAllow=!0),"limit"==x.type&&(x.title="适用产业政策条目(限制类)编辑",x.policyCatalogLimit=!0),x.model.type=x.type,x.savePolicyCatalog=function(){common.initJqValidation();var a=$("form").valid();a&&b.createPolicyCatalog(x)}}function r(){x.title="适用产业政策类型列表",b.grid_policyCatalog(x),b.grid_policyAllow(x),b.grid_policyLimit(x),x.deleteFirstPolicyCatalog=function(a){common.confirm({vm:x,title:"",msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deletePolicyCatalog(x,a)}})},x.deleteFirstPolicyCatalogs=function(){var a;if("encourage"==x.type?a=common.getKendoCheckId(".policyCatalogEncourageGrid"):"allow"==x.type?a=common.getKendoCheckId(".policyCatalogAllowGrid"):"limit"==x.type&&(a=common.getKendoCheckId(".policyCatalogLimitGrid")),0==a.length)common.alert({vm:x,msg:"请选择数据"});else{for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");common.confirm({vm:x,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deletePolicyCatalogs(x,e)}})}}}function s(){x.title="项目行业分类",b.getCatalogById(x),b.grid_InvestmentProjectSecondary(x),x.deleteSecondaryCatalogs=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:x,msg:"请选择数据"});else{for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");common.confirm({vm:x,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.removeSecondCatalogs(x,e)}})}},x.deleteSecondary=function(a){common.confirm({vm:x,title:"",msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteSecondaryCatalog(x,a)}})}}function t(){x.isShowConfirm=!0,b.getCatalogById(x),x.updateCatalog=function(){x.model.id=x.id,common.initJqValidation();var a=$("form").valid();a&&(x.secondary.parentId=x.id,x.secondary.type="projectIndustry",b.updateCatalog(x))}}function u(){x.title="项目行业编辑",x.projectIndustrySecondCatalog=!0,x.model.type="projectIndustry",x.model.parentId=x.id,x.saveInvestment=function(){common.initJqValidation();var a=$("form").valid();a&&b.createCatalog(x)}}function v(){"projectIndustry"==x.type&&(x.title="项目行业编辑",x.projectIndustryCatalog=!0),"projectType"==x.type&&(x.title="项目类型编辑",x.projectTypeCatalog=!0),"constructionType"==x.type&&(x.title="建设类型编辑",x.constructionTypeCatalog=!0),x.model.type=x.type,x.saveInvestment=function(){common.initJqValidation();var a=$("form").valid();a&&b.createCatalog(x)}}function w(){b.grid_InvestmentProject(x),b.grid_projectType(x),b.grid_constructionType(x),x.deleteCatalog=function(a){common.confirm({vm:x,title:"",msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteCatalog(x,a)}})},x.deleteCatalogs=function(){var a;if("projectIndustry"==x.type?a=common.getKendoCheckId(".projectIndustryGrid"):"projectType"==x.type?a=common.getKendoCheckId(".projectTypeGrid"):"constructionType"==x.type&&(a=common.getKendoCheckId(".constructionTypeGrid")),0==a.length)common.alert({vm:x,msg:"请选择数据"});else{for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");common.confirm({vm:x,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.removeFirstCatalogs(x,e)}})}}}var x=this;x.model={},x.basicData={},x.secondary={},x.id=c.params.id,x.type=c.params.type,x.title="投资项目分类列表",g()}angular.module("app").controller("catalogCtrl",a),a.$inject=["$location","catalogSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a,b){function c(b,c){var d={method:"delete",url:common.format(K+"/deleteAgencyServiceMattersCatalogs"),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),b.agencyServiceMattersGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(b,c){var d={method:"put",url:common.format(K+"/deleteAgencyServiceMatters?id={0}",c)},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"删除成功！",fn:function(){$(".alertDialog").modal("hide"),b.agencyServiceMattersGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(b){var c={method:"put",url:common.format(K+"/agencyServiceMatters"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"修改成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(K+"/agencyServiceMatters?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"post",url:common.format(K+"/agencyServiceMatters"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"添加成功!",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href="#/catalog/agencyServiceMattersList"}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(K+"/agencyServiceMatters")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:200,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.agencyServiceMattersGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function i(b,c){var d={method:"delete",url:common.format(K+"/deletePartApprovalMattersCatalogs"),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"删除成功！",fn:function(){$(".alertDialog").modal("hide"),b.partApprovalMattersGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function j(b,c){var d={method:"put",url:common.format(K+"/deletePartApprovalMatters?id={0}",c)},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"删除成功！",fn:function(){$(".alertDialog").modal("hide"),b.partApprovalMattersGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function k(b){var c={method:"put",url:common.format(K+"/partApprovalMatters"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function l(b){var c={method:"get",url:common.format(K+"/partApprovalMatters?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function m(b){var c={method:"post",url:common.format(K+"/partApprovalMatters"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href="#/catalog/partApprovalMattersList"}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function n(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(K+"/partApprovalMatters")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:200,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.partApprovalMattersGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function o(b){var c={method:"put",url:common.format(K+"/updatePolicyCatalog"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function p(b,c){var d={method:"delete",url:common.format(K+"/deletePolicyCatalogs"),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),"encourage"==b.type&&b.policyCatalogGrid.dataSource.read(),"allow"==b.type&&b.policyCatalogGrid_allow.dataSource.read(),"limit"==b.type&&b.policyCatalogGrid_limit.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function q(b,c){var d={method:"put",url:common.format(K+"/deletePolicyCatalog?id={0}",c)},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),"encourage"==b.type&&b.policyCatalogGrid.dataSource.read(),"allow"==b.type&&b.policyCatalogGrid_allow.dataSource.read(),"limit"==b.type&&b.policyCatalogGrid_limit.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function r(b){var c={method:"get",url:common.format(K+"/policyCatalog?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{},"encourage"==b.model.type?(b.title="适用产业政策条目(鼓励类)修改",b.policyCatalogEncourage=!0):"allow"==b.model.type?(b.title="适用产业政策条目(允许类)修改",b.policyCatalogAllow=!0):"limit"==b.model.type&&(b.title="适用产业政策条目(限制类)修改",b.policyCatalogLimit=!0)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function s(b){var c={method:"post",url:common.format(K+"/policyCatalog"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),"encourage"==b.type?location.href="#/catalog/policyCatalog":"allow"==b.type?location.href="#/catalog/policyCatalog/allowList":"limit"==b.type&&(location.href="#/catalog/policyCatalog/limitList")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function t(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(K+"/policyCatalog")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"},filter:{field:"type",operator:"eq",value:"encourage"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:220,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.policyCatalogGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function u(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(K+"/policyCatalog")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"},filter:{field:"type",operator:"eq",value:"allow"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:220,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.policyCatalogGrid_allow={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function v(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(K+"/policyCatalog")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"},filter:{field:"type",operator:"eq",value:"limit"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:220,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.policyCatalogGrid_limit={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function w(b,c){var d={method:"delete",url:K,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),"projectIndustry"==b.type&&b.investmentProjectGrid.dataSource.read(),"projectType"==b.type&&b.projectTypeGrid.dataSource.read(),"constructionType"==b.type&&b.constructionTypeGrid.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function x(b,c){var d={method:"put",url:common.format(K+"/delete?id={0}",c)},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),"projectIndustry"==b.type&&b.investmentProjectGrid.dataSource.read(),"projectType"==b.type&&b.projectTypeGrid.dataSource.read(),"constructionType"==b.type&&b.constructionTypeGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function y(b,c){var d={method:"delete",url:K,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.investmentProjectSecondaryGrid.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function z(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(K),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"},filter:[{field:"parentId",operator:"eq",value:""},{field:"type",operator:"eq",value:"constructionType"}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll_constructionType' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns_alter").html(),a.id)}}];a.constructionTypeGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function A(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(K),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"},filter:[{field:"parentId",operator:"eq",value:""},{field:"type",operator:"eq",value:"projectType"}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll_projectType' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns_alter").html(),a.id)}}];a.projectTypeGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function B(b){var c={method:"put",url:K,data:b.secondary},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),b.investmentProjectSecondaryGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function C(b,c){var d={method:"put",url:common.format(K+"/delete?id={0}",c)},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),b.investmentProjectSecondaryGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function D(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(K),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"},filter:{field:"parentId",operator:"eq",value:a.id}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:230,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.investmentProjectSecondaryGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function E(b){var c={method:"put",url:K,data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function F(b){var c={method:"get",url:common.format(K+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{},""!=b.model.parentId?(b.title="项目行业修改",b.projectIndustrySecondCatalog=!0):"projectIndustry"==b.model.type?(b.title="项目行业修改",b.projectIndustryCatalog=!0):"projectType"==b.model.type?(b.title="项目类型修改",b.projectTypeCatalog=!0):"constructionType"==b.model.type&&(b.title="建设类型修改",b.constructionTypeCatalog=!0)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function G(b){var c={method:"get",url:common.format(K+"?$filter=id eq '{0}'",b.secondCatalogId)},d=function(a){b.secondary=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function H(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(K),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"code",dir:"asc"},filter:[{field:"parentId",operator:"eq",value:""},{field:"type",operator:"eq",value:"projectIndustry"}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll_projectIndustry' type='checkbox'  class='checkbox'/>"},{field:"name",title:"名称",filterable:!0
},{field:"code",title:"编码",filterable:!0},{field:"",title:"操作",width:255,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.investmentProjectGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function I(b){var c={method:"post",url:common.format(K),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.id?location.href="#/catalog/investment/projectIndustry/"+b.id+"/":"projectIndustry"==b.type?location.href="#/catalog/investment":"projectType"==b.type?location.href="#/catalog/investment/projectTypeList":"constructionType"==b.type&&(location.href="#/catalog/investment/constructionTypeList")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function J(b){var c={method:"post",url:common.format(K),data:b.secondary},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.investmentProjectSecondaryGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}var K="/management/catalog",L={createCatalog:I,grid_InvestmentProject:H,getCatalogById:F,updateCatalog:E,grid_InvestmentProjectSecondary:D,deleteSecondaryCatalog:C,createSecondCatalog:J,changeSecondCatalog:B,getSecondCatalogById:G,grid_projectType:A,grid_constructionType:z,removeSecondCatalogs:y,deleteCatalog:x,removeFirstCatalogs:w,grid_policyCatalog:t,grid_policyAllow:u,grid_policyLimit:v,createPolicyCatalog:s,getPolicyCatalogById:r,deletePolicyCatalog:q,deletePolicyCatalogs:p,updatePolicyCatalog:o,grid_partApprovalMatters:n,createPartApprovalMatters:m,getpartApprovalMattersById:l,updatePartApprovalMatters:k,deletePartApprovalMatters:j,deletePartApprovalMattersCatalogs:i,grid_agencyServiceMatters:h,createAgencyServiceMatters:g,getAgencyServiceMattersById:f,updateAgencyServiceMatters:e,deleteAgencyServiceMattersCatalog:d,deleteAgencyServiceMattersCatalogs:c};return L}angular.module("app").factory("catalogSvc",a),a.$inject=["$http","$location"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){"credit_illegalNameList"==c.current.name&&(t.page="illegalNameList"),"credit_illegalNameEdit"==c.current.name&&(t.page="addIllegalName"),"credit_updateIllegalName"==c.current.name&&(t.page="updateIllegalNameEdit"),"credit_illegalNameDetails"==c.current.name&&(t.page="illegalNameDetails"),"credit_blackList"==c.current.name&&(t.title="黑名单项目申报单位列表",t.page="blackList"),"credit_blackListEdit"==c.current.name&&(t.title="黑名单项目申报单位信息录入",t.page="addBlackList"),"credit_blackListDetails"==c.current.name&&(t.title="黑名单项目申报单位信息详情",t.page="blackListDetails"),"credit_blackListAlter"==c.current.name&&(t.title="黑名单项目申报单位信息更改",t.page="blackListAlter"),"credit_projectAnomaly"==c.current.name&&(t.title="项目异常列表",t.page="projectAnomaly"),"credit_projectAnomalyEdit"==c.current.name&&(t.title="项目异常信息录入",t.page="projectAnomalyEdit"),"credit_projectAnomalyDetails"==c.current.name&&(t.title="项目异常信息详情",t.page="projectAnomalyDetails"),"credit_updateProjectAnomaly"==c.current.name&&(t.title="项目异常信息修改",t.page="updateProjectAnomaly"),t.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},t.getUnitName=function(a){return common.getUnitName(a)},t.toDate=function(a){return common.toDate(a)},t.formatDate=function(a){return common.formatDate(a)},t.html=function(a){return e.trustAsHtml(a)},t.basicData.userUnit=common.getUserUnits()}function g(){f(),"illegalNameList"==t.page&&q(),"addIllegalName"==t.page&&r(),"updateIllegalNameEdit"==t.page&&(t.isIllegalEdit=!0,s()),"illegalNameDetails"==t.page&&p(),"blackList"==t.page&&o(),"addBlackList"==t.page&&n(),"blackListDetails"==t.page&&m(),"blackListAlter"==t.page&&(t.isBlackListEdit=!0,l()),"projectAnomaly"==t.page&&k(),"projectAnomalyEdit"==t.page&&j(),"projectAnomalyDetails"==t.page&&i(),"updateProjectAnomaly"==t.page&&h()}function h(){b.getProjectAnomalyById(t),t.updateProjectAnomalyInfo=function(){common.initJqValidation();var a=$("form").valid();a&&b.updateProjectAnomalyById(t)},t.returnProjectAnomalyPage=function(){location.href="#/creditInfo/projectAnomalyList"}}function i(){b.getProjectAnomalyById(t)}function j(){t.projectAnomalyModel.projectNumber=t.projectNumber,t.projectAnomalyModel.projectName=t.projectName,t.projectAnomalyModel.unitName=t.unitName,t.projectAnomalyModel.shenbaoDate=t.createdDate,t.projectAnomalyModel.shenBaoInfoId=t.shenBaoInfoId,t.saveProjectAnomalyInfo=function(){common.initJqValidation();var a=$("form").valid();a&&(t.projectAnomalyModel.shenbaoDate=t.toDate(t.projectAnomalyModel.shenbaoDate),b.createProjectAnomaly(t))}}function k(){b.projectAnomalyGrid(t),t.searchProjectAnomaly=function(){t.projectAnomalyModel.shenbaoDate=t.toDate(t.projectAnomalyModel.shenbaoDate);var a=[];null!=t.projectAnomalyModel.unitName&&""!=t.projectAnomalyModel.unitName&&a.push({field:"unitName",operator:"eq",value:t.projectAnomalyModel.unitName}),null!=t.projectAnomalyModel.shenbaoDate&&""!=t.projectAnomalyModel.shenbaoDate&&a.push({field:"shenbaoDate",operator:"eq",value:t.projectAnomalyModel.shenbaoDate}),t.gridProjectAnomalyInfo.dataSource.filter(a)},t.addAnomalyProject=function(){b.grid(t),$("#shenbaoList").modal("show"),t.isConfirm=!0,t.change=function(){t.isConfirm=!1},t.confirmSubmit=function(){var a=common.getKendoCheckId(".grid");if(0!=a.length){var c=a[0].value,d=c.split(","),e=d[0],f=d[1],g=d[2],h=d[3],i=d[4];t.projectNumber=e,t.projectName=f,t.unitName=g,t.createdDate=h,t.shenBaoInfoId=i,b.haveProjectAnomaly(t),$(".checkbox").removeAttr("checked"),$("#shenbaoList").modal("hide"),$(".modal-backdrop").remove()}},t.closeWindow=function(){$(".checkbox").removeAttr("checked"),$("#shenbaoList").modal("hide"),$(".modal-backdrop").remove()}},t.deleteProjectAnomaly=function(a){t.id=a,common.confirm({vm:t,title:"",msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteProjectAnomalyById(t)}})}}function l(){b.getBlackListById(t),t.basicData.legalRepCertType=common.getBacicDataByIndectity(common.basicDataConfig().credentialsType),t.updateBlackListInfo=function(){common.initJqValidation();var a=$("form").valid();a&&b.updateBlackListById(t)}}function m(){b.getBlackListById(t)}function n(){t.basicData.legalRepCertType=common.getBacicDataByIndectity(common.basicDataConfig().credentialsType),t.title="黑名单信息录入",t.blackListModel.projectNumber=t.projectNumber,t.blackListModel.projectName=t.projectName,t.blackListModel.unitName=t.unitName,t.blackListModel.shenbaoDate=t.createdDate,t.blackListModel.shenBaoInfoId=t.shenBaoInfoId,t.saveBlackListInfo=function(){common.initJqValidation();var a=$("form").valid();a&&(t.blackListModel.shenbaoDate=t.toDate(t.blackListModel.shenbaoDate),b.createBlackList(t))}}function o(){b.blackListGrid(t),t.searchBlackList=function(){t.blackListModel.shenbaoDate=t.toDate(t.blackListModel.shenbaoDate);var a=[];null!=t.blackListModel.unitName&&""!=t.blackListModel.unitName&&a.push({field:"unitName",operator:"eq",value:t.blackListModel.unitName}),null!=t.blackListModel.shenbaoDate&&""!=t.blackListModel.shenbaoDate&&a.push({field:"shenbaoDate",operator:"eq",value:t.blackListModel.shenbaoDate}),t.gridBlackListGrid.dataSource.filter(a)},t.addBlackList=function(){b.grid(t),$("#shenbaoList").modal("show"),t.isConfirm=!0,t.change=function(){t.isConfirm=!1},t.confirmBlackList=function(){var a=common.getKendoCheckId(".grid");if(0!=a.length){var c=a[0].value,d=c.split(","),e=d[0],f=d[1],g=d[2],h=d[3],i=d[4];t.blackListModel.projectNumber=e,t.blackListModel.projectName=f,t.blackListModel.unitName=g,t.blackListModel.createdDate=h,t.blackListModel.shenBaoInfoId=i,b.haveBlackList(t),$(".checkbox").removeAttr("checked"),$("#shenbaoList").modal("hide"),$(".modal-backdrop").remove()}},t.closeShenBaoWindow=function(){$(".checkbox").removeAttr("checked"),$("#shenbaoList").modal("hide"),$(".modal-backdrop").remove()}},t.deleteBlackList=function(a){t.id=a,common.confirm({vm:t,title:"",msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteBlackListById(t)}})}}function p(){b.getIllegalNameById(t)}function q(){b.illegalNameGrid(t),t.searchIllegalName=function(){t.illegalNameModel.shenbaoDate=t.toDate(t.illegalNameModel.shenbaoDate);var a=[];null!=t.illegalNameModel.unitName&&""!=t.illegalNameModel.unitName&&a.push({field:"unitName",operator:"eq",value:t.illegalNameModel.unitName}),null!=t.illegalNameModel.shenbaoDate&&""!=t.illegalNameModel.shenbaoDate&&a.push({field:"shenbaoDate",operator:"eq",value:t.illegalNameModel.shenbaoDate}),t.gridIllegalNameInfo.dataSource.filter(a)},t.addIllegalName=function(){b.grid(t),$("#shenbaoList").modal("show"),t.isConfirm=!0,t.change=function(){t.isConfirm=!1},t.confirmSubmit=function(){var a=common.getKendoCheckId(".grid");if(0!=a.length){var c=a[0].value,d=c.split(","),e=d[0],f=d[1],g=d[2],h=d[3],i=d[4];t.projectNumber=e,t.projectName=f,t.unitName=g,t.createdDate=h,t.shenBaoInfoId=i,b.haveIllegalName(t),$(".checkbox").removeAttr("checked"),$("#shenbaoList").modal("hide"),$(".modal-backdrop").remove()}},t.closeWindow=function(){$(".checkbox").removeAttr("checked"),$("#shenbaoList").modal("hide"),$(".modal-backdrop").remove()}},t.deleteIllegalName=function(a){t.id=a,common.confirm({vm:t,title:"",msg:"确认要删除此记录吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteIllegalNameById(t)}})}}function r(){t.title="项目异常名录信息录入",t.illegalNameModel.projectNumber=t.projectNumber,t.illegalNameModel.projectName=t.projectName,t.illegalNameModel.unitName=t.unitName,t.illegalNameModel.shenbaoDate=t.createdDate,t.illegalNameModel.shenBaoInfoId=t.shenBaoInfoId,t.saveIllegalNameInfo=function(){common.initJqValidation();var a=$("form").valid();a&&(t.illegalNameModel.shenbaoDate=t.toDate(t.illegalNameModel.shenbaoDate),b.createIllegalName(t))}}function s(){t.title="信用异常名录信息更改",b.getIllegalNameById(t),t.updateIllegalNameInfo=function(){common.initJqValidation();var a=$("form").valid();a&&b.updateIllegalNameById(t)}}var t=this;t.title="异常项目申报单位列表",t.model={},t.standby={},t.blackListModel={},t.illegalNameModel={},t.projectAnomalyModel={},t.page="list",t.basicData={},t.id=c.params.id,t.projectNumber=c.params.projectNumber,t.projectName=c.params.projectName,t.unitName=c.params.unitName,t.createdDate=c.params.createdDate,t.shenBaoInfoId=c.params.shenBaoInfoId,g(),t.returnProjectAnomalyPage=function(){location.href="#/creditInfo/projectAnomalyList"},t.returnBlackListPage=function(){location.href="#/creditInfo/blackList"},t.returnIllegalNamePage=function(){location.href="#/creditInfo/illegalNameList"},t.dialog_shenbaoInfo=function(a){t.id=a,b.getShenBaoInfoById(t),$("#shenbaoInfo").modal({backdrop:"static",keyboard:!1}),t.tabStripOptions={}}}angular.module("app").controller("creditInfoCtrl",a),a.$inject=["$location","creditInfoSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a,b,c){function d(b){var c={method:"put",url:common.format(y+"/projectAnomaly/delete?id={0}",b.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),b.gridProjectAnomalyInfo.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(b){var c={method:"put",url:common.format(y+"/projectAnomaly"),data:b.standby},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(y+"/projectAnomaly?$filter=id eq '{0}'",b.id)},d=function(a){b.standby=a.data.value[0]||{},b.standby.shenbaoDate=b.formatDate(b.standby.shenbaoDate)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"post",url:common.format(y+"/projectAnomaly"),data:b.projectAnomalyModel},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){location.href="#/creditInfo/projectAnomalyList"}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(b){var c={method:"get",url:common.format(y+"/projectAnomaly?$filter=projectNumber eq '{0}'",b.projectNumber)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isIllegalName=a.data.value[0],b.isIllegalName?common.alert({vm:b,msg:"该条申报项目已存在",fn:function(){$(".alertDialog").modal("hide")}}):location.href="#/creditInfo/projectAnomaly//"+b.projectNumber+"/"+b.projectName+"/"+b.unitName+"/"+b.createdDate+"/"+b.shenBaoInfoId}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(y+"/projectAnomaly")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='javascript:void(0)' ng-click='vm.dialog_shenbaoInfo(\"{0}\")'>{1}</a>",a.shenBaoInfoId,a.projectName)},width:180,filterable:!0},{field:"unitName",title:"申报单位名称",filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},width:180,template:function(a){return common.getUnitName(a.unitName)}},{field:"shenbaodDate",title:"申报日期",template:function(a){return common.formatDate(a.shenbaoDate)},width:180,filterable:!1},{field:"isIllegalName",title:"项目审批和建设过程异常",width:180,filterable:!0},{field:"isBlackList",title:"被纳入黑名单异常",width:180,filterable:!0},{field:"",title:"操作",width:150,template:function(a){return common.format($("#projectAnomalyColumnBtns").html(),a.id)}}];a.gridProjectAnomalyInfo={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function j(b){var c={method:"put",url:common.format(y+"/blackList/delete?id={0}",b.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),b.gridBlackListGrid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function k(b){var c={method:"put",url:common.format(y+"/blackList"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function l(b){var c={method:"get",url:common.format(y+"/blackList?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{},b.model.blackDate=b.formatDate(b.model.blackDate),b.model.shenbaoDate=b.formatDate(b.model.shenbaoDate)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function m(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(y+"/blackList")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='javascript:void(0)' ng-click='vm.dialog_shenbaoInfo(\"{0}\")'>{1}</a>",a.shenBaoInfoId,a.projectName)},width:180,filterable:!0},{field:"unitName",title:"申报单位名称",filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},width:180,template:function(a){return common.getUnitName(a.unitName)}},{field:"shenbaodDate",title:"申报日期",template:function(a){return common.formatDate(a.shenbaoDate)},width:180,filterable:!1},{field:"enterpriseName",title:"法人单位名称",width:180,filterable:!0},{field:"blackReason",title:"列入黑名单原因",width:180,filterable:!0},{field:"departmentName",title:"监管部门",width:180,filterable:!0},{field:"",title:"操作",width:150,template:function(a){return common.format($("#blackColumnBtns").html(),a.id)}}];a.gridBlackListGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function n(b){var c={method:"post",url:common.format(y+"/blackList"),data:b.blackListModel},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){location.href="#/creditInfo/blackList"}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function o(b){var c={method:"get",url:common.format(y+"/blackList?$filter=projectNumber eq '{0}'",b.blackListModel.projectNumber)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.model=a.data.value[0],b.model?common.alert({vm:b,msg:"该条申报项目已存在",fn:function(){$(".alertDialog").modal("hide")}}):location.href="#/creditInfo/blackList//"+b.blackListModel.projectNumber+"/"+b.blackListModel.projectName+"/"+b.blackListModel.unitName+"/"+b.blackListModel.createdDate+"/"+b.blackListModel.shenBaoInfoId}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function p(b){var c={method:"get",url:common.format(y+"?$filter=projectNumber eq '{0}'",b.projectNumber)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isIllegalName=a.data.value[0],b.isIllegalName?common.alert({vm:b,msg:"该条申报项目已存在",fn:function(){$(".alertDialog").modal("hide")}}):location.href="#/creditInfo/illegalNameEdit//"+b.projectNumber+"/"+b.projectName+"/"+b.unitName+"/"+b.createdDate+"/"+b.shenBaoInfoId}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function q(b){var c={method:"put",url:common.format(y+"/delete?id={0}",b.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),b.gridIllegalNameInfo.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function r(b){var c={method:"put",url:y,data:b.illegalNameModel},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function s(b){var c={method:"get",url:common.format(y+"?$filter=id eq '{0}'",b.id)},d=function(a){b.illegalNameModel=a.data.value[0]||{},b.illegalNameModel.illegalDate=b.formatDate(b.illegalNameModel.illegalDate),b.illegalNameModel.shenbaoDate=b.formatDate(b.illegalNameModel.shenbaoDate)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function t(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(y),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='javascript:void(0)' ng-click='vm.dialog_shenbaoInfo(\"{0}\")'>{1}</a>",a.shenBaoInfoId,a.projectName)},width:180,filterable:!0},{field:"unitName",title:"申报单位名称",filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},width:180,template:function(a){return common.getUnitName(a.unitName)}},{field:"shenbaodDate",title:"申报日期",template:function(a){return common.formatDate(a.shenbaoDate)},width:180,filterable:!1},{field:"illegalType",title:"异常情形代码",width:180,filterable:!0},{field:"illegalContent",title:"异常内容",width:180,filterable:!0},{field:"departmentName",title:"监管部门",width:180,filterable:!0},{field:"",title:"操作",width:150,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.gridIllegalNameInfo={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function u(b){var c={method:"post",url:y,data:b.illegalNameModel},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){location.href="#/creditInfo/illegalNameList"}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function v(b){var c={method:"get",url:common.format(x+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model.shenBaoInfo=a.data.value[0]||{},b.projectTypes=common.stringToArray(b.model.shenBaoInfo.projectType,","),b.constructionUnits=common.stringToArray(b.model.shenBaoInfo.constructionUnit,","),b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH?b.isSHInvestment=!0:b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF&&(b.isZFInvestment=!0),b.model.shenBaoInfo.beginDate=common.formatDate(b.model.shenBaoInfo.beginDate),b.model.shenBaoInfo.endDate=common.formatDate(b.model.shenBaoInfo.endDate),b.model.shenBaoInfo.pifuJYS_date=common.formatDate(b.model.shenBaoInfo.pifuJYS_date),b.model.shenBaoInfo.pifuKXXYJBG_date=common.formatDate(b.model.shenBaoInfo.pifuKXXYJBG_date),b.model.shenBaoInfo.pifuCBSJYGS_date=common.formatDate(b.model.shenBaoInfo.pifuCBSJYGS_date),b.model.shenBaoInfo.projectInvestSum=common.toMoney(b.model.shenBaoInfo.projectInvestSum),b.model.shenBaoInfo.projectInvestAccuSum=common.toMoney(b.model.shenBaoInfo.projectInvestAccuSum),b.model.shenBaoInfo.capitalSCZ_ggys=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys),b.model.shenBaoInfo.capitalSCZ_gtzj=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj),b.model.shenBaoInfo.capitalSCZ_zxzj=common.toMoney(b.model.shenBaoInfo.capitalSCZ_zxzj),b.model.shenBaoInfo.capitalQCZ_ggys=common.toMoney(b.model.shenBaoInfo.capitalQCZ_ggys),b.model.shenBaoInfo.capitalQCZ_gtzj=common.toMoney(b.model.shenBaoInfo.capitalQCZ_gtzj),b.model.shenBaoInfo.capitalZYYS=common.toMoney(b.model.shenBaoInfo.capitalZYYS),b.model.shenBaoInfo.capitalSHTZ=common.toMoney(b.model.shenBaoInfo.capitalSHTZ),b.model.shenBaoInfo.capitalOther=common.toMoney(b.model.shenBaoInfo.capitalOther),b.model.shenBaoInfo.capitalSCZ_gtzj_TheYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj_TheYear),b.model.shenBaoInfo.capitalSCZ_ggys_TheYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys_TheYear),b.model.shenBaoInfo.capitalSCZ_qita=common.toMoney(b.model.shenBaoInfo.capitalSCZ_qita),b.model.shenBaoInfo.capitalSCZ_gtzj_LastYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj_LastYear),b.model.shenBaoInfo.capitalSCZ_ggys_LastYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys_LastYear),b.model.shenBaoInfo.capitalSCZ_qita_LastYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_qita_LastYear),b.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear),b.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear),b.model.shenBaoInfo.capitalSCZ_qita_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_qita_LastTwoYear),b.model.shenBaoInfo.apInvestSum=common.toMoney(b.model.shenBaoInfo.apInvestSum),b.model.shenBaoInfo.capitalAP_ggys_TheYear=common.toMoney(b.model.shenBaoInfo.capitalAP_ggys_TheYear),b.model.shenBaoInfo.capitalAP_gtzj_TheYear=common.toMoney(b.model.shenBaoInfo.capitalAP_gtzj_TheYear),b.model.shenBaoInfo.capitalAP_qita=common.toMoney(b.model.shenBaoInfo.capitalAP_qita),b.model.shenBaoInfo.capitalAP_gtzj_LastYear=common.toMoney(b.model.shenBaoInfo.capitalAP_gtzj_LastYear),b.model.shenBaoInfo.capitalAP_ggys_LastYear=common.toMoney(b.model.shenBaoInfo.capitalAP_ggys_LastYear),b.model.shenBaoInfo.capitalAP_qita_LastYear=common.toMoney(b.model.shenBaoInfo.capitalAP_qita_LastYear),b.model.shenBaoInfo.capitalAP_ggys_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalAP_ggys_LastTwoYear),b.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear),b.model.shenBaoInfo.capitalAP_qita_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalAP_qita_LastTwoYear),b.capitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_zxzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSHTZ)||0)+(parseFloat(b.model.shenBaoInfo.capitalZYYS)||0)+(parseFloat(b.model.shenBaoInfo.capitalOther)||0)},b.lastTwoYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear)||0)},b.lastYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_LastYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_LastYear)||0)},b.theYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_TheYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_TheYear)||0)},b.lastTwoYearAPCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalAP_ggys_LastTwoYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear)||0)},b.lastYearAPCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalAP_ggys_LastYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalAP_gtzj_LastYear)||0)},b.theYearAPCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalAP_ggys_TheYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalAP_gtzj_TheYear)||0)},b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan&&(b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_YearPlan,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]],b.isYearPlan=!0)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function w(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(x),schema:common.kendoGridConfig().schema({id:"id",fields:{isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isIncludLibrary",operator:"eq",value:!0}}),c=[{template:function(a){return kendo.format("<input type='radio' relId='{0},{1},{2},{3},{4}' id='checkbox' name='checkbox' class='checkbox' ng-click='vm.change()'/>",a.projectNumber,a.projectName,a.unitName,common.formatDateTime(a.createdDate),a.id)},filterable:!1,width:40},{field:"projectNumber",title:"项目代码",width:180,filterable:!0},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='javascript:void(0)' ng-click='vm.dialog_shenbaoInfo(\"{0}\")'>{1}</a>",a.id,a.projectName)},filterable:!0},{field:"unitName",title:"申报单位",filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},template:function(a){return common.getUnitName(a.unitName)}},{field:"createdDate",title:"创建时间",template:function(a){return common.formatDate(a.createdDate)},width:180,filterable:!1}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var x="/management/shenbao",y="/management/creditInfo",z={grid:w,getShenBaoInfoById:v,createIllegalName:u,illegalNameGrid:t,getIllegalNameById:s,updateIllegalNameById:r,deleteIllegalNameById:q,haveIllegalName:p,haveBlackList:o,createBlackList:n,blackListGrid:m,getBlackListById:l,updateBlackListById:k,deleteBlackListById:j,projectAnomalyGrid:i,haveProjectAnomaly:h,createProjectAnomaly:g,getProjectAnomalyById:f,updateProjectAnomalyById:e,deleteProjectAnomalyById:d};return z}angular.module("app").factory("creditInfoSvc",a),a.$inject=["$http","$compile","$location"]}(),function(){"use strict";function a(a,b,c,d){function e(){p.init(),"mediationUnitList"==p.page&&(p.title="中介单位列表",m()),"mediationUnitUpdate"==p.page&&(p.title="中介单位编辑",n()),"mediationUnitCreate"==p.page&&(p.title="中介单位新增",o()),"mediationUnitDetails"==p.page&&(p.title="中介单位信息查看",l()),"assistReviewList"==p.page&&(p.title="协审活动列表",k()),"assistReviewUpdate"==p.page&&(p.title="协审活动编辑",j()),"assistReviewCreate"==p.page&&(p.title="协审活动新增",i()),"assistReviewDetails"==p.page&&(p.title="协审活动详情",h()),"serviceEvaluation"==p.page&&(p.title="服务质量评价",g()),"submitReviewEvaluation"==p.page&&(p.title="送审文件质量评价",f())}function f(){p.submitReviewEvaluation=function(){b.updateAssistReview(p)},b.getAssistReviewById(p),p.basicData.rating=common.getBacicDataByIndectity(common.basicDataConfig().serviceRating),p.delFile=function(a,b){var c=p.model.submitReviewEvaluationDtos[a].attachmentDtos[b];console.log(c),c&&p.model.submitReviewEvaluationDtos[a].attachmentDtos.splice(b,1)},p.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:p,msg:"上传文件过大！"})})})},p.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){console.log(b),p.model.submitReviewEvaluationDtos[b].attachmentDtos?p.model.submitReviewEvaluationDtos[b].attachmentDtos.push({name:c.split("_")[2],url:c}):(p.model.submitReviewEvaluationDtos[b].attachmentDtos=[],p.model.submitReviewEvaluationDtos[b].attachmentDtos=[{name:c.split("_")[2],url:c}])})}},p.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:p.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:p.onSelect}}function g(){p.submitServiceEvaluation=function(){b.updateAssistReview(p)},b.getAssistReviewById(p),p.basicData.rating=common.getBacicDataByIndectity(common.basicDataConfig().serviceRating),p.delFile=function(a,b){var c=p.model.serviceEvaluationDtos[a].attachmentDtos[b];console.log(c),c&&p.model.serviceEvaluationDtos[a].attachmentDtos.splice(b,1)},p.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:p,msg:"上传文件过大！"})})})},p.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){console.log(b),p.model.serviceEvaluationDtos[b].attachmentDtos?p.model.serviceEvaluationDtos[b].attachmentDtos.push({name:c.split("_")[2],url:c}):(p.model.serviceEvaluationDtos[b].attachmentDtos=[],p.model.serviceEvaluationDtos[b].attachmentDtos=[{name:c.split("_")[2],url:c}])})}},p.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:p.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:p.onSelect}}function h(){b.getAssistReviewById(p)}function i(){p.choiceProject=function(){$(".myDialog").modal({backdrop:"static",keyboard:!1})},p.choiceMediationUnit=function(){$(".myDialog1").modal({backdrop:"static",keyboard:!1})},b.mediationUnitGrid(p),b.projectGrid(p),p.choiceProjectSubmit=function(){var a=$('input:radio[name="radio"]:checked').val();if(""==a||null==a);else{var b=[];b=a.split(","),p.model.projectDto.id=b[0],p.model.projectDto.projectName=b[1],$(".myDialog").modal("hide")}},p.choiceAssistReviewSubmit=function(){p.model.mediationUnitDtos.length>0&&(p.model.mediationUnitDtos=[]),$('input[type="checkbox"][name="mediationUnit"]:checked').each(function(a){var b=[];b=$(this).val().split(","),p.model.mediationUnitDtos.push({id:b[0],mediationUnitName:b[1]}),$(".myDialog1").modal("hide")})},p.removeProject=function(){p.model.projectDto={}},p.removeMediationUnit=function(a){p.model.mediationUnitDtos.splice(a,1)},p.createAssistReview=function(){b.createAssistReview(p);
}}function j(){b.getAssistReviewById(p),p.choiceProject=function(){$(".myDialog").modal({backdrop:"static",keyboard:!1})},p.choiceMediationUnit=function(){$(".myDialog1").modal({backdrop:"static",keyboard:!1})},b.mediationUnitGrid(p),b.projectGrid(p),p.choiceProjectSubmit=function(){var a=$('input:radio[name="radio"]:checked').val();if(""==a||null==a);else{var b=[];b=a.split(","),p.model.projectDto.id=b[0],p.model.projectDto.projectName=b[1],$(".myDialog").modal("hide")}},p.choiceAssistReviewSubmit=function(){p.model.mediationUnitDtos.length>0&&(p.model.mediationUnitDtos=[]),$('input[type="checkbox"][name="mediationUnit"]:checked').each(function(a){var b=[];b=$(this).val().split(","),p.model.mediationUnitDtos.push({id:b[0],mediationUnitName:b[1]}),$(".myDialog1").modal("hide")})},p.removeProject=function(){p.model.projectDto={}},p.removeMediationUnit=function(a){p.model.mediationUnitDtos.splice(a,1)},p.updateAssistReview=function(){b.updateOnlyAssistReview(p)}}function k(){b.assistReviewGrid(p),p.delAssistReview=function(a){common.confirm({vm:p,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.delAssistReview(p,a)}})},p.delAssistReviews=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:p,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");p.delAssistReview(d)}}}function l(){b.geMediationUnitById(p),p.basicData.credentialsType=common.getBacicDataByIndectity(common.basicDataConfig().credentialsType)}function m(){b.unitGrid(p),p.delMediationUnit=function(a){common.confirm({vm:p,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.delMediationUnit(p,a)}})},p.delMediationUnits=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:p,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");p.delMediationUnit(d)}}}function n(){b.geMediationUnitById(p),p.basicData.credentialsType=common.getBacicDataByIndectity(common.basicDataConfig().credentialsType),p.updateMediationUnit=function(){b.updateMediationUnit(p)}}function o(){p.basicData.credentialsType=common.getBacicDataByIndectity(common.basicDataConfig().credentialsType),p.createMediationUnit=function(){b.createMediationUnit(p)}}var p=this;p.model={},p.model.projectDto={},p.model.mediationUnitDtos=[],p.basicData={},p.model.display=!1,p.id=c.params.id,p.init=function(){var a=c.current.name;switch(a){case"mediationUnitList":p.page="mediationUnitList";break;case"mediationUnitChange":p.id?p.page="mediationUnitUpdate":p.page="mediationUnitCreate";break;case"mediationUnitDetails":p.page="mediationUnitDetails";break;case"assistReviewList":p.page="assistReviewList";break;case"assistReviewChange":p.id?p.page="assistReviewUpdate":p.page="assistReviewCreate";break;case"assistReviewDetails":p.page="assistReviewDetails";break;case"serviceEvaluation":p.page="serviceEvaluation";break;case"submitReviewEvaluation":p.page="submitReviewEvaluation"}p.checkLength=function(a,b,c){common.checkLength(a,b,c)}},e()}angular.module("app").controller("mediationManagementCtrl",a),a.$inject=["$location","mediationManagementSvc","$state","$scope"]}(),function(){"use strict";function a(a,b,c){function d(b,c){b.isSubmit=!0;var d={method:"delete",url:q,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.unitGridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(b,c){b.isSubmit=!0;var d={method:"delete",url:q+"/delAssistReview",data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.assistReviewGridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function f(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.type=b.type;var d={method:"post",url:q+"/createAssistReview",data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href="#/assistReviewList"}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function g(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:q,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function h(b){var c={method:"get",url:common.format(q+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(b){var c={method:"get",url:common.format(q+"/assistReviewList?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.model.assistReviewBeginDate=common.formatDateTime(b.model.assistReviewBeginDate),b.model.assistReviewEndDate=common.formatDateTime(b.model.assistReviewEndDate)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function j(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:q+"/updateAssistReview",data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function k(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:q+"/updateOnlyAssistReview",data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function l(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.type=b.type;var d={method:"post",url:q,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href="#/mediationUnitList"}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function m(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(q+"/assistReviewList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"assistReviewName",title:"协审活动名称",template:"",filterable:!0},{field:"assistReviewBeginDate",title:"协审活动开始时间",template:function(a){return common.formatDateTime(a.assistReviewBeginDate)},filterable:!0},{field:"assistReviewEndDate",title:"协审活动结束时间",template:function(a){return common.formatDateTime(a.assistReviewEndDate)},filterable:!0},{field:"",title:"操作",width:380,template:function(a){var b;return b=!a.isEvaluation,common.format($("#columnBtns").html(),a.id,b)}}];a.assistReviewGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function n(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(q),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"mediationUnitName",title:"中介单位名称",template:"",filterable:!0},{field:"businessScope",title:"中介机构经营范围",template:"",filterable:!0},{field:"",title:"操作",width:280,template:function(a){var b;return b=null==a.reviewResult||""==a.reviewResult,common.format($("#columnBtns").html(),a.id,b)}}];a.unitGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function o(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(q),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  value='{0}'  relId='{0}' name='mediationUnit' class='checkbox' />",a.id+","+a.mediationUnitName)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"mediationUnitName",title:"中介单位名称",template:"",filterable:!0},{field:"businessScope",title:"中介机构经营范围",template:"",filterable:!0}];a.mediationUnitGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function p(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(r+"/unitName")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF},{field:"isLatestVersion",operator:"eq",value:!0},{field:"isIncludLibrary",operator:"eq",value:!0}]}),c=[{template:function(a){return kendo.format("<input  type='radio'  relId='{0}' value='{0}' name='radio' class='radio' />",a.id+","+a.projectName)},filterable:!1,width:40,title:""},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='#/projectDetails/{0}/{1}'>{2}</a>",a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"projectStage",title:"项目阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectStage),dataTextField:"description",dataValueField:"id"})}}},{field:"projectClassify",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1}];a.projectGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var q="/management/mediationManagement",r="/management/project",s={unitGrid:n,geMediationUnitById:h,updateMediationUnit:g,createMediationUnit:l,delMediationUnit:d,assistReviewGrid:m,getAssistReviewById:i,mediationUnitGrid:o,projectGrid:p,updateAssistReview:j,createAssistReview:f,delAssistReview:e,updateOnlyAssistReview:k};return s}angular.module("app").factory("mediationManagementSvc",a),a.$inject=["$http","$compile","$location"]}(),function(){"use strict";function a(a,b,c,d){function e(){i.init(),"list"==i.page&&f(),"list_SH"==i.page&&g(),"details"==i.page&&h(),"edit"==i.page&&h()}function f(){b.grid(i),i.search=function(){var a=[];a.push({field:"isLatestVersion",operator:"eq",value:!0}),a.push({field:"isMonthReport",operator:"eq",value:!0}),a.push({field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF}),null!=i.search.projectName&&""!=i.search.projectName&&a.push({field:"projectName",operator:"contains",value:i.search.projectName}),null!=i.search.projectStage&&""!=i.search.projectStage&&a.push({field:"projectStage",operator:"eq",value:i.search.projectStage}),null!=i.search.projectIndustry&&""!=i.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:i.search.projectIndustry}),null!=i.search.unitName&&""!=i.search.unitName&&a.push({field:"unitName",operator:"contains",value:i.search.unitName}),i.gridOptions.dataSource.filter(a)}}function g(){b.grid_SH(i),i.search=function(){var a=[];a.push({field:"isLatestVersion",operator:"eq",value:!0}),a.push({field:"isMonthReport",operator:"eq",value:!0}),a.push({field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_SH}),null!=i.search.projectName&&""!=i.search.projectName&&a.push({field:"projectName",operator:"contains",value:i.search.projectName}),null!=i.search.projectStage&&""!=i.search.projectStage&&a.push({field:"projectStage",operator:"eq",value:i.search.projectStage}),null!=i.search.projectIndustry&&""!=i.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:i.search.projectIndustry}),null!=i.search.unitName&&""!=i.search.unitName&&a.push({field:"unitName",operator:"contains",value:i.search.unitName}),i.gridOptions_SH.dataSource.filter(a)},i.searchIndustryChildChange=function(){i.searchIndustryChild=!1,null!=i.search.projectIndustryChild&&""!=i.search.projectIndustryChild&&(i.basicData.projectIndustryChild_SH=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==i.search.projectIndustryChild}).toArray(),i.searchIndustryChild=!0)}}function h(){b.getProjectById(i),i.model.isReportExist=!1,i.createProblem=function(){i.model.monthReport.monthReportProblemDtos?i.model.monthReport.monthReportProblemDtos.push({problemIntroduction:"",solutionsAndSuggest:""}):i.model.monthReport.monthReportProblemDtos=[{problemIntroduction:"",solutionsAndSuggest:""}]},i.deleteProblem=function(a){i.model.monthReport.monthReportProblemDtos.splice(a,1)},i.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){i.model.monthReport.attachmentDtos?i.model.monthReport.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):i.model.monthReport.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},i.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:i,msg:"上传文件过大！"})})})},i.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:i.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:i.onSelect},i.delFile=function(a){i.model.monthReport.attachmentDtos.splice(a,1)},i.basicData_approvalType=$linq(common.getBasicData()).where(function(a){return"approvalType"==a.identity&&"approvalType"==a.pId}).toArray(),i.basicData_projectProgress=$linq(common.getBasicData()).where(function(a){return"projectProgress"==a.identity&&"projectProgress"==a.pId}).toArray(),i.uploadType=[["scenePicture","现场图片"],["other","其它材料"]],i.submit=function(){b.submitMonthReport(i)},i.change=function(){location.href="#/monthReportChange/"+i.projectId+"/"+i.year+"/"+i.month},i.befor=function(){i.model.display=!0,b.getProjectById(i)},i.back=function(a){a.isZFInvestment?location.href="#/monthReport":a.isSHInvestment&&(location.href="#/monthReport_SH")}}var i=this;i.projectId=c.params.projectId,i.projectInvestmentType=c.params.projectInvestmentType,i.year=c.params.year,i.month=c.params.month,i.search={},i.model={},i.basicData={},i.page="list",i.model.display=!1,i.init=function(){"monthReport_SH"==c.current.name&&(i.page="list_SH"),"monthReport_details"==c.current.name&&(i.page="details"),"monthReportChange"==c.current.name&&(i.page="edit"),i.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},i.checkLength=function(a,b,c){common.checkLength(a,b,c)},i.getUnitName=function(a){return common.getUnitName(a)},i.filterClear=function(){location.reload()},i.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),i.basicData.projectInvestmentType=common.getBacicDataByIndectity(common.basicDataConfig().projectInvestmentType),i.basicData.userUnit=common.getUserUnits(),i.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),i.basicData.projectIndustry_SH=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray()},e()}angular.module("app").controller("monthReportCtrl",a),a.$inject=["$location","monthReportSvc","$state","$scope"]}(),function(){"use strict";function a(a,b,c){function d(b){var c={method:"get",url:common.format(h+"?$filter=id eq '{0}'",b.projectId)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){if(b.model.projectInfo=a.data.value[0]||{},b.model.projectInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?b.isZFInvestment=!0:b.model.projectInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(b.isSHInvestment=!0),"details"==b.page||"edit"==b.page){var c=$linq(b.model.projectInfo.monthReportDtos).where(function(a){return a.submitYear==b.year&&a.submitMonth==b.month}).toArray();if(c.length>0){if(1==b.model.display)for(var d=0;d<c.length;d++)0==c[d].isLatestVersion&&(b.model.monthReport=c[d]);else for(var e=0;e<c.length;e++)1==c[e].isLatestVersion&&(b.model.monthReport=c[e]);b.model.monthReport.pifuJYS_date=common.toDate(b.model.projectInfo.pifuJYS_date),b.model.monthReport.pifuKXXYJBG_date=common.toDate(b.model.projectInfo.pifuKXXYJBG_date),b.model.monthReport.pifuCBSJYGS_date=common.toDate(b.model.projectInfo.pifuCBSJYGS_date),b.model.monthReport.beginDate=common.formatDate(b.model.monthReport.beginDate),b.model.monthReport.endDate=common.formatDate(b.model.monthReport.endDate),b.model.monthReport.invertPlanTotal=common.toMoney(b.model.monthReport.invertPlanTotal),b.model.monthReport.actuallyFinishiInvestment=common.toMoney(b.model.monthReport.actuallyFinishiInvestment),b.model.monthReport.thisYearPlanInvestment=common.toMoney(b.model.monthReport.thisYearPlanInvestment),b.model.monthReport.thisYearAccumulatedInvestment=common.toMoney(b.model.monthReport.thisYearAccumulatedInvestment),b.model.monthReport.thisMonthInvestTotal=common.toMoney(b.model.monthReport.thisMonthInvestTotal),b.model.monthReport.firstQuarCompInvestment=common.toMoney(b.model.monthReport.firstQuarCompInvestment),b.model.monthReport.secondQuarCompInvestment=common.toMoney(b.model.monthReport.secondQuarCompInvestment),b.model.monthReport.thirdQuarCompInvestment=common.toMoney(b.model.monthReport.thirdQuarCompInvestment),b.model.monthReport.fourthQuarCompInvestment=common.toMoney(b.model.monthReport.fourthQuarCompInvestment)}}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(b){common.initJqValidation();var d=$("form").valid();if(d){b.model.monthReport.submitYear=b.year,b.model.monthReport.submitMonth=b.month,b.model.monthReport.projectId=b.projectId;var e={method:"post",url:i,data:b.model.monthReport},f=function(a){b.model.isReportExist=!0,b.model.isSubmit=!1,common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.isZFInvestment?c.path(url_backtToZFlist):b.isSHInvestment&&c.path(j)}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}}function f(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isLatestVersion",operator:"eq",value:!0},{field:"isMonthReport",operator:"eq",value:!0},{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectName",title:"项目名称",width:300,template:function(a){return common.format('<a href="#/projectDetails/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"unitName",title:"责任单位名称",width:200,template:function(b){return a.getUnitName(b.unitName)},filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}}},{field:"projectStage",title:"项目阶段",template:function(a){return common.getBasicDataDesc(a.projectStage)},width:150,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectStage,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"projectIndustry",title:"项目行业",template:function(a){return common.getBasicDataDesc(a.projectIndustry)},width:120,filterable:!1},{field:"",title:"填报月份",template:function(a){var b="";return a.monthReportDtos.forEach(function(a,c){b+=common.format('<a class="btn btn-xs btn-success" ng-show="{3}" href="#/monthReport/{0}/{1}/{2}">{1}年{2}月</a> ',a.projectId,a.submitYear,a.submitMonth,a.isLatestVersion)}),b},filterable:!1}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}function g(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isLatestVersion",operator:"eq",value:!0},{field:"isMonthReport",operator:"eq",value:!0},{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_SH}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectName",title:"项目名称",width:300,template:function(a){return common.format('<a href="#/projectDetails/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"unitName",title:"责任单位名称",width:200,template:function(b){return a.getUnitName(b.unitName)},filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}}},{field:"projectStage",title:"项目阶段",template:function(a){return common.getBasicDataDesc(a.projectStage)},width:150,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectStage,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"projectIndustry",title:"项目行业",template:function(a){return common.getBasicDataDesc(a.projectIndustry)},width:120,filterable:!1},{field:"",title:"填报月份",template:function(a){var b="";return a.monthReportDtos.forEach(function(a,c){b+=common.format('<a class="btn btn-xs btn-success" ng-show="{3}" href="#/monthReport/{0}/{1}/{2}">{1}年{2}月</a> ',a.projectId,a.submitYear,a.submitMonth,a.isLatestVersion)}),b},filterable:!1}];a.gridOptions_SH={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}var h="/management/project",i="/management/monthReport",j="/monthReport_SH",k={grid:f,grid_SH:g,getProjectById:d,submitMonthReport:e};return k}angular.module("app").factory("monthReportSvc",a),a.$inject=["$http","$compile","$location"]}(),function(){"use strict";function a(a,b,c,d){function e(){f.init(),"list"==f.page&&b.grid(f),"update"==f.page&&b.getById(f),"create"!=f.page&&"update"!=f.page||f.init_upload()}var f=this;f.model={},f.type=c.params.type,f.id=c.params.id,f.init=function(){switch(f.type){case"tzgg":f.title="通知公告";break;case"zcfg":f.title="政策法规";break;case"bszn":f.title="办事指南";break;case"cybg":f.title="常用表格"}switch(f.id){case void 0:f.page="list";break;case"":f.page="create";break;default:f.page="update"}},f.init_upload=function(){f.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:f,msg:"上传文件过大！"})})})},$("#files").kendoUpload({async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},showFileList:!1,select:f.onSelect,success:function(a){},error:function(a){if(console.log("error:"),console.log(a),200==a.XMLHttpRequest.status){var b=a.XMLHttpRequest.response;d.$apply(function(){f.model.attachmentDtos?f.model.attachmentDtos.push({name:b.split("_")[2],url:b,type:f.type}):f.model.attachmentDtos=[{name:b.split("_")[2],url:b,type:f.type}]})}},localization:{select:"上传文件"},validation:{maxFileSize:common.basicDataConfig().uploadSize}})},f.delFile=function(a){f.model.attachmentDtos.splice(a,1)},f.del=function(a){common.confirm({vm:f,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.del(f,a)}})},f.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:f,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");f.del(d)}},f.create=function(){b.create(f)},f.update=function(){b.update(f)},e()}angular.module("app").controller("portalCtrl",a),a.$inject=["$location","portalSvc","$state","$scope"]}(),function(){"use strict";function a(a,b){function c(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"type",operator:"eq",value:a.type}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!1},{field:"createdDate",title:"创建时间",width:180,template:function(a){return common.formatDateTime(a.createdDate)},filterable:!1},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.type=b.type;var d={method:"post",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i+b.type}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function e(b){var c={method:"get",url:common.format(h+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.model.files&&(b.files=b.model.files.split(";"))};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i+b.type}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function g(b,c){b.isSubmit=!0;var d={method:"delete",url:h,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}var h="/management/portal",i="#/portal/",j={grid:c,create:d,getById:e,update:f,del:g};return j}angular.module("app").factory("portalSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){"project"==c.current.name&&(l.isZFInvestment=!0),"project_SH"==c.current.name&&(l.isSHInvestment=!0),"projectEdit"==c.current.name&&(l.page="create"),l.id&&(l.page="update"),"projectDetails"==c.current.name&&(l.page="details"),l.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},l.checkLength=function(a,b,c){common.checkLength(a,b,c)},l.html=function(a){return e.trustAsHtml(a)},l.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),l.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),l.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),l.basicData.investmentType=common.getBacicDataByIndectity(common.basicDataConfig().projectInvestmentType),l.basicData.projectIndustryAll=common.getBacicDataByIndectity(common.basicDataConfig().projectIndustry),l.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),l.basicData.projectIndustry_SH=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),l.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),l.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),l.basicData.userUnit=common.getUserUnits()}function g(){"list"==l.page&&h(),"create"==l.page&&(l.model.projectType=[],i()),"update"==l.page&&(i(),j()),"details"==l.page&&k()}function h(){l.isZFInvestment&&b.grid(l),l.isSHInvestment&&b.grid_SH(l),b.grid(l),l.search=function(){var a=[];a.push({field:"isLatestVersion",operator:"eq",value:!0}),l.isZFInvestment&&(a.push({field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF}),a.push({field:"isIncludLibrary",operator:"eq",value:!0})),l.isSHInvestment&&a.push({field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_SH}),null!=l.search.projectName&&""!=l.search.projectName&&a.push({field:"projectName",operator:"contains",value:l.search.projectName}),null!=l.search.projectStage&&""!=l.search.projectStage&&a.push({field:"projectStage",operator:"eq",value:l.search.projectStage}),null!=l.search.isMonthReport&&""!=l.search.isMonthReport&&("true"==l.search.isMonthReport?a.push({field:"isMonthReport",operator:"eq",value:!0}):"false"==l.search.isMonthReport&&a.push({field:"isMonthReport",operator:"eq",value:!1})),null!=l.search.unitName&&""!=l.search.unitName&&a.push({field:"unitName",operator:"eq",value:l.search.unitName}),null!=l.search.projectIndustry&&""!=l.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:l.search.projectIndustry}),l.isZFInvestment?l.gridOptions.dataSource.filter(a):l.isSHInvestment&&l.gridOptions_SH.dataSource.filter(a)},l.searchIndustryChildChange=function(){l.searchIndustryChild=!1,null!=l.search.projectIndustryChild&&""!=l.search.projectIndustryChild&&(l.basicData.projectIndustryChild_SH=$linq(common.getBasicData()).where(function(a){
return a.identity==common.basicDataConfig().projectIndustry&&a.pId==l.search.projectIndustryChild}).toArray(),l.searchIndustryChild=!0)},l.filterClear=function(){location.reload()},l.addProject=function(){$("#myModal_add").modal({backdrop:"static",keyboard:!1})},l.confirmInvestmentType=function(){$(".modal-backdrop").remove(),a.path("/projectEdit//"+l.model.projectInvestmentType)},l.model.projectInvestmentType=common.basicDataConfig().projectInvestmentType_ZF,l.isMonthReport=function(a,b){l.model.isMonthReport=b,l.model.id=a,$("#myModal_edit").modal({backdrop:"static",keyboard:!1})},l.updateIsMonthReport=function(){b.updateIsMonthReport(l)},l.del=function(a){common.confirm({vm:l,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteProject(l,a)}})},l.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:l,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");l.del(d)}}}function i(){l.model.projectInvestmentType=l.projectInvestmentType,l.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(l.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),l.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),l.isZFInvestment=!0,l.capitalTotal=function(){return common.getSum([l.model.capitalSCZ_ggys||0,l.model.capitalSCZ_gtzj||0,l.model.capitalSCZ_zxzj||0,l.model.capitalQCZ_ggys||0,l.model.capitalQCZ_gtzj||0,l.model.capitalSHTZ||0,l.model.capitalZYYS||0,l.model.capitalOther||0])}):l.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(l.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),l.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),l.projectIndustryChange=function(){l.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==l.model.projectIndustryParent}).toArray()},l.isSHInvestment=!0,l.investTotal=function(){return l.model.projectInvestSum=common.getSum([l.model.landPrice||0,l.model.equipmentInvestment||0,l.model.buidSafeInvestment||0,l.model.capitalOther||0]),l.model.projectInvestSum}),b.getUserUnits(l),l.updateSelection=function(a){var b=l.model.projectType.indexOf(a);b==-1?l.model.projectType.push(a):l.model.projectType.splice(b,1)},l.uploadType=[["JYS","项目建议书批复"],["KXXYJBG","可行性研究报告批复"],["CBSJYGS","初步设计与概算批复"]],l.relatedType=common.uploadFileTypeConfig().projectEdit,l.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){l.model.attachmentDtos?l.model.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):l.model.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},l.choseDocument=function(a){l.pifuType=$(a.target).parents(".uploadBox").attr("data-type"),$("#documentRecords").modal({backdrop:"static",keyboard:!0}),l.gridOptions_documentRecords.dataSource.read()},b.documentRecordsGird(l),l.pifuChoseConfirm=function(){$("#documentRecords").modal("hide"),$(".modal-backdrop").remove();var a=common.getKendoCheckId(".grid"),b=a[0].value;if(b){var c=common.stringToArray(b,","),d=c[0],e=c[1],f=c[2];l.model["pifu"+l.pifuType+"_wenhao"]=d,l.model.attachmentDtos?l.model.attachmentDtos.push({name:e,url:f,type:l.pifuType}):l.model.attachmentDtos=[{name:e,url:f,type:l.pifuType}]}},l.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:l,msg:"上传文件过大！"})})})},l.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:l.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:l.onSelect},l.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:l.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:l.onSelect},l.delFile=function(a){var b=l.model.attachmentDtos[a];if(b){var c=b.type;l.model["pifu"+c+"_wenhao"]="",l.model.attachmentDtos.splice(a,1)}},l.create=function(){b.createProject(l)}}function j(){l.title="编辑项目",b.getProjectById(l),l.update=function(){b.updateProject(l)}}function k(){b.getProjectById(l),l.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(l.isZFInvestment=!0,l.relatedType=common.uploadFileTypeConfig().projectEdit):l.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(l.isSHInvestment=!0,l.relatedType=common.uploadFileTypeConfig().projectEdit_SH),l.relatedType=common.uploadFileTypeConfig().projectEdit}var l=this;l.title="新增项目",l.search={},l.model={},l.basicData={},l.id=c.params.id,l.projectInvestmentType=c.params.projectInvestmentType,l.page="list",f(),g()}angular.module("app").controller("projectCtrl",a),a.$inject=["$location","projectSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:common.format(l+"?$filter=id eq '{0}'",b.model.unitName)},d=function(a){b.userUnit=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(b){var c={method:"get",url:l},d=function(a){b.userUnits=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.projectType=common.arrayToString(b.model.projectType,",");var d={method:"post",url:k,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.isZFInvestment?location.href=m:b.isSHInvestment&&(location.href=n)}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function e(b){b.isSumbit=!0;var c={method:"put",url:k+"/isMonthReport",data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSumbit=!1,$("#myModal_edit").modal("hide"),b.isZFInvestment?b.gridOptions.dataSource.read():b.isSHInvestment&&b.gridOptions_SH.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.projectType=common.arrayToString(b.model.projectType,",");var d={method:"put",url:k,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.isZFInvestment?location.href=m:b.isSHInvestment&&(location.href=n)}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function g(c){var d={method:"get",url:common.format(k+"?$filter=id eq '{0}'",c.id)},e=function(a){if(c.model=a.data.value[0]||{},b(c),c.model.projectType=common.stringToArray(c.model.projectType,","),c.model.beginDate=common.formatDate(c.model.beginDate),c.model.endDate=common.formatDate(c.model.endDate),c.model.pifuJYS_date=common.formatDate(c.model.pifuJYS_date),c.model.pifuKXXYJBG_date=common.formatDate(c.model.pifuKXXYJBG_date),c.model.pifuCBSJYGS_date=common.formatDate(c.model.pifuCBSJYGS_date),c.model.projectInvestSum=common.toMoney(c.model.projectInvestSum),c.model.projectInvestAccuSum=common.toMoney(c.model.projectInvestAccuSum),c.model.capitalSCZ_ggys=common.toMoney(c.model.capitalSCZ_ggys),c.model.capitalSCZ_gtzj=common.toMoney(c.model.capitalSCZ_gtzj),c.model.capitalSCZ_zxzj=common.toMoney(c.model.capitalSCZ_zxzj),c.model.capitalQCZ_ggys=common.toMoney(c.model.capitalQCZ_ggys),c.model.capitalQCZ_gtzj=common.toMoney(c.model.capitalQCZ_gtzj),c.model.capitalZYYS=common.toMoney(c.model.capitalZYYS),c.model.capitalSHTZ=common.toMoney(c.model.capitalSHTZ),c.model.capitalOther=common.toMoney(c.model.capitalOther),"update"==c.page&&c.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var d=$linq(common.getBasicData()).where(function(a){return a.id==c.model.projectIndustry}).toArray()[0];c.model.projectIndustryParent=d.pId,c.projectIndustryChange()}"details"==c.page&&(c.capitalTotal=function(){return common.getSum([c.model.capitalSCZ_ggys||0,c.model.capitalSCZ_gtzj||0,c.model.capitalSCZ_zxzj||0,c.model.capitalQCZ_ggys||0,c.model.capitalQCZ_gtzj||0,c.model.capitalSHTZ||0,c.model.capitalZYYS||0,c.model.capitalOther||0])})};common.http({vm:c,$http:a,httpOptions:d,success:e})}function h(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='radio'  relId='{0},{1},{2}' name='checkbox'/>",a.number,a.name,a.fullName)},filterable:!1,width:40,title:""},{field:"number",title:"文号",width:180,filterable:!0},{field:"name",title:"文件名",width:550,template:function(a){return common.format("<a href='/contents/upload/{1}'>{0}</a>",a.name,a.fullName)},filterable:!0}];a.gridOptions_documentRecords={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function i(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(k+"/unitName")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"projectIndustry",dir:"desc"},filter:[{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF},{field:"isLatestVersion",operator:"eq",value:!0},{field:"isIncludLibrary",operator:"eq",value:!0}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectNumber",title:"项目代码",width:130,filterable:!1},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='#/projectDetails/{0}/{1}'>{2}</a>",a.id,a.projectInvestmentType,a.projectName)},width:300,filterable:!0},{field:"unitName",title:"项目所属单位",width:150,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},template:function(a){return common.getUnitName(a.unitName)}},{field:"projectStage",title:"项目阶段",width:120,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectStage,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"projectIndustry",title:"项目行业",width:100,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectIndustry_ZF,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"isMonthReport",title:"是否月报",template:function(a){return a.isMonthReport?"是":a.isMonthReport?void 0:"否"},width:100,filterable:!0},{field:"",title:"操作",width:150,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,"vm.isMonthReport('"+a.id+"','"+a.isMonthReport+"')")}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}function j(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(k),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isLatestVersion",operator:"eq",value:!0},{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_SH}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectNumber",title:"项目代码",width:120,filterable:!1},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='#/projectDetails/{0}/{1}'>{2}</a>",a.id,a.projectInvestmentType,a.projectName)},width:300,filterable:!0},{field:"unitName",title:"责任单位",width:200,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},template:function(a){return common.getUnitName(a.unitName)}},{field:"projectStage",title:"项目阶段",width:120,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectStage),dataTextField:"description",dataValueField:"id"})}}},{field:"projectIndustry",title:"项目行业",template:function(a){return common.getBasicDataDesc(a.projectIndustry)},width:120,filterable:!1},{field:"isMonthReport",title:"是否月报",template:function(a){return a.isMonthReport?"是":a.isMonthReport?void 0:"否"},width:120,filterable:!0},{field:"",title:"操作",width:250,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,"vm.isMonthReport('"+a.id+"','"+a.isMonthReport+"')")}}];a.gridOptions_SH={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,scrollable:!0,sortable:!0}}var k="/management/project",l="/management/userUnit",m="#/project",n="#/project_SH",o="/management/replyFile",p={grid:i,grid_SH:j,getProjectById:g,getUserUnits:c,updateProject:f,createProject:d,updateIsMonthReport:e,documentRecordsGird:h};return p}angular.module("app").factory("projectSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){var a=c.current.name;switch("project"==c.current.name&&(w.isZFInvestment=!0),"project_SH"==c.current.name&&(w.isSHInvestment=!0),"projectEdit"==c.current.name&&(w.page="create"),w.id&&(w.page="update"),"projectDetails"==c.current.name&&(w.page="details"),a){case"supervision_spdw":w.page="shenpiUnitList";break;case"shenpiUnitChange":w.id?w.page="shenpiUnitUpdate":w.page="shenpiUnitCreate";break;case"shenpiUnitDetail":w.page="shenpiUnitDetail";break;case"shenpiItemsList":w.page="shenpiItemsList";break;case"shenpiItemsChange":w.id?w.page="shenpiItemsUpdate":w.page="shenpiItemsCreate";break;case"shenpifankuiItemsList":w.page="shenpifankuiItemsList";break;case"shenpifankuiItemsChange":w.page="shenpifankuiItemsChange";break;case"shenpifankuiItemsDetail":w.page="shenpifankuiItemsDetail";break;case"shenpiItemsDetail":w.page="shenpiItemsDetail"}w.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},w.checkLength=function(a,b,c){common.checkLength(a,b,c)},w.html=function(a){return e.trustAsHtml(a)},w.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),w.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),w.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),w.basicData.investmentType=common.getBacicDataByIndectity(common.basicDataConfig().projectInvestmentType),w.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),w.basicData.userUnit=common.getUserUnits()}function g(){"shenpiItemsDetail"==w.page&&(w.title="审批事项详情",h()),"shenpifankuiItemsDetail"==w.page&&(w.title="审批事项反馈详情",i()),"shenpifankuiItemsChange"==w.page&&(w.title="审批事项反馈",j()),"shenpifankuiItemsList"==w.page&&(w.title="审批事项反馈列表",k()),"shenpiItemsCreate"==w.page&&(w.title="审批事项新增",l()),"shenpiItemsUpdate"==w.page&&(w.title="审批事项编辑",m()),"shenpiItemsList"==w.page&&(w.title="审批事项列表",n()),"shenpiUnitDetail"==w.page&&o(),"shenpiUnitCreate"==w.page&&p(),"shenpiUnitUpdate"==w.page&&q(),"list"==w.page&&s(),"shenpiUnitList"==w.page&&(w.title="审批单位列表",r()),"create"==w.page&&(w.model.projectType=[],t()),"update"==w.page&&(t(),u()),"details"==w.page&&v()}function h(){b.getShenPiItemsById(w)}function i(){b.getShenPiItemsById(w)}function j(){b.getShenPiItemsById(w),w.updateShenpiFanKui=function(){b.updateShenpiItems(w)}}function k(){b.shenpifankuiItemsGrid(w),w.searchShenPiItems=function(){var a=[];null!=w.search.shenpiName&&""!=w.search.shenpiName&&a.push({field:"shenpiName",operator:"contains",value:w.search.shenpiName}),null!=w.search.projectName&&""!=w.search.projectName&&a.push({field:"projectName",operator:"contains",value:w.search.projectName}),null!=w.search.shenpiUnitName&&""!=w.search.shenpiUnitName&&a.push({field:"shenpiUnitName",operator:"contains",value:w.search.shenpiUnitName}),w.gridOptions.dataSource.filter(a)}}function l(){w.choiceProject=function(){$(".myDialog").modal({backdrop:"static",keyboard:!1})},w.choiceShenPiUnit=function(){$(".myDialog1").modal({backdrop:"static",keyboard:!1})},b.projectGrid(w),b.shenpiUnitGridSelect(w),w.choiceProjectSubmit=function(){var a=$('input:radio[name="radio"]:checked').val();if(""==a||null==a);else{var b=[];b=a.split(","),w.model.projectDto.id=b[0],w.model.projectDto.projectName=b[1],$(".myDialog").modal("hide")}},w.choiceShenPiUnitSubmit=function(){var a=$('input:radio[name="radio1"]:checked').val();if(""==a||null==a);else{var b=[];b=a.split(","),w.model.shenPiUnitDto.id=b[0],w.model.shenPiUnitDto.shenpiUnitName=b[1],$(".myDialog1").modal("hide")}},w.removeProject=function(){w.model.projectDto={}},w.removeShenPiUnit=function(){w.model.shenPiUnitDto={}},w.createShenpiUnit=function(){b.createShenpiItems(w)}}function m(){w.choiceProject=function(){$(".myDialog").modal({backdrop:"static",keyboard:!1})},w.choiceShenPiUnit=function(){$(".myDialog1").modal({backdrop:"static",keyboard:!1})},b.projectGrid(w),b.shenpiUnitGridSelect(w),b.getShenPiItemsById(w),w.choiceProjectSubmit=function(){var a=$('input:radio[name="radio"]:checked').val();if(""==a||null==a);else{var b=[];b=a.split(","),w.model.projectDto.id=b[0],w.model.projectDto.projectName=b[1],$(".myDialog").modal("hide")}},w.choiceShenPiUnitSubmit=function(){var a=$('input:radio[name="radio1"]:checked').val();if(""==a||null==a);else{var b=[];b=a.split(","),w.model.shenPiUnitDto.id=b[0],w.model.shenPiUnitDto.shenpiUnitName=b[1],$(".myDialog1").modal("hide")}},w.removeProject=function(){w.model.projectDto={}},w.removeShenPiUnit=function(){w.model.shenPiUnitDto={}},w.updateShenpiItems=function(){b.updateShenpiItems(w)}}function n(){b.shenpiItemsGrid(w),w.searchShenPiItems=function(){var a=[];null!=w.search.shenpiName&&""!=w.search.shenpiName&&a.push({field:"shenpiName",operator:"contains",value:w.search.shenpiName}),null!=w.search.projectName&&""!=w.search.projectName&&a.push({field:"projectName",operator:"contains",value:w.search.projectName}),null!=w.search.shenpiUnitName&&""!=w.search.shenpiUnitName&&a.push({field:"shenpiUnitName",operator:"contains",value:w.search.shenpiUnitName}),w.gridOptions.dataSource.filter(a)},w.delShenPiItem=function(a){common.confirm({vm:w,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.delShenPiItem(w,a)}})},w.delShenPiItems=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:w,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");w.delShenPiItem(d)}}}function o(){w.title="审批单位详情",b.getShenPiUnitById(w)}function p(){w.title="审批单位新增",w.createMediationUnit=function(){b.createShenpiUnit(w)}}function q(){w.title="审批单位编辑",b.getShenPiUnitById(w),w.updateShenpiUnit=function(){b.updateShenpiUnit(w)}}function r(){b.shenpiUnitGrid(w),w.searchShenPiUnit=function(){var a=[];null!=w.search.shenpiUnitName&&""!=w.search.shenpiUnitName&&a.push({field:"shenpiUnitName",operator:"contains",value:w.search.shenpiUnitName}),null!=w.search.contacts&&""!=w.search.contacts&&a.push({field:"contacts",operator:"contains",value:w.search.contacts}),w.gridOptions.dataSource.filter(a)},w.delShenPiUnit=function(a){common.confirm({vm:w,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.delShenPiUnit(w,a)}})},w.delShenPiUnits=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:w,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");w.delShenPiUnit(d)}}}function s(){w.isZFInvestment&&b.grid(w),w.isSHInvestment&&b.grid_SH(w),b.grid(w),w.search=function(){var a=[];a.push({field:"isLatestVersion",operator:"eq",value:!0}),w.isZFInvestment&&(a.push({field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF}),a.push({field:"isIncludLibrary",operator:"eq",value:!0})),w.isSHInvestment&&a.push({field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_SH}),null!=w.search.projectName&&""!=w.search.projectName&&a.push({field:"projectName",operator:"contains",value:w.search.projectName}),null!=w.search.projectStage&&""!=w.search.projectStage&&a.push({field:"projectStage",operator:"eq",value:w.search.projectStage}),null!=w.search.isMonthReport&&""!=w.search.isMonthReport&&("true"==w.search.isMonthReport?a.push({field:"isMonthReport",operator:"eq",value:!0}):"false"==w.search.isMonthReport&&a.push({field:"isMonthReport",operator:"eq",value:!1})),null!=w.search.unitName&&""!=w.search.unitName&&a.push({field:"unitName",operator:"eq",value:w.search.unitName}),w.isZFInvestment?w.gridOptions.dataSource.filter(a):w.isSHInvestment&&w.gridOptions_SH.dataSource.filter(a)},w.addProject=function(){$("#myModal_add").modal({backdrop:"static",keyboard:!1})},w.confirmInvestmentType=function(){$(".modal-backdrop").remove(),a.path("/projectEdit//"+w.model.projectInvestmentType)},w.model.projectInvestmentType=common.basicDataConfig().projectInvestmentType_ZF,w.isMonthReport=function(a,b){w.model.isMonthReport=b,w.model.id=a,$("#myModal_edit").modal({backdrop:"static",keyboard:!1})},w.updateIsMonthReport=function(){b.updateIsMonthReport(w)},w.del=function(a){common.confirm({vm:w,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteProject(w,a)}})},w.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:w,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");w.del(d)}}}function t(){w.model.projectInvestmentType=w.projectInvestmentType,w.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(w.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),w.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),w.isZFInvestment=!0):w.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(w.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),w.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),w.projectIndustryChange=function(){w.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==w.model.projectIndustryParent}).toArray()},w.isSHInvestment=!0),b.getUserUnits(w),w.updateSelection=function(a){var b=w.model.projectType.indexOf(a);b==-1?w.model.projectType.push(a):w.model.projectType.splice(b,1)},w.uploadType=[["JYS","项目建议书批复"],["KXXYJBG","可行性研究报告批复"],["CBSJYGS","初步设计与概算批复"]],w.relatedType=common.uploadFileTypeConfig().projectEdit,w.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){w.model.attachmentDtos?w.model.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):w.model.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},w.choseDocument=function(a){w.pifuType=$(a.target).parents(".uploadBox").attr("data-type"),$("#documentRecords").modal({backdrop:"static",keyboard:!1}),w.gridOptions_documentRecords.dataSource.read()},b.documentRecordsGird(w),w.pifuChoseConfirm=function(){$("#documentRecords").modal("hide"),$(".modal-backdrop").remove();var a=common.getKendoCheckId(".grid"),b=a[0].value;if(b){var c=common.stringToArray(b,","),d=c[0],e=c[1],f=c[2];w.model["pifu"+w.pifuType+"_wenhao"]=d,w.model.attachmentDtos?w.model.attachmentDtos.push({name:e,url:f,type:w.pifuType}):w.model.attachmentDtos=[{name:e,url:f,type:w.pifuType}]}},w.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:w,msg:"上传文件过大！"})})})},w.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:w.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:w.onSelect},w.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:w.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:w.onSelect},w.delFile=function(a){var b=w.model.attachmentDtos[a];if(b){var c=b.type;w.model["pifu"+c+"_wenhao"]="",w.model.attachmentDtos.splice(a,1)}},w.capitalTotal=function(){return common.getSum([w.model.capitalSCZ_ggys||0,w.model.capitalSCZ_gtzj||0,w.model.capitalSCZ_zxzj||0,w.model.capitalQCZ_ggys||0,w.model.capitalQCZ_gtzj||0,w.model.capitalSHTZ||0,w.model.capitalZYYS||0,w.model.capitalOther||0])},w.create=function(){b.createProject(w)}}function u(){w.title="编辑项目",b.getProjectById(w),w.update=function(){b.updateProject(w)}}function v(){b.getProjectById(w),w.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(w.isZFInvestment=!0,w.relatedType=common.uploadFileTypeConfig().projectEdit):w.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(w.isSHInvestment=!0,w.relatedType=common.uploadFileTypeConfig().projectEdit_SH),w.relatedType=common.uploadFileTypeConfig().projectEdit}var w=this;w.title="新增项目",w.search={},w.model={},w.model.projectDto={},w.model.shenPiUnitDto={},w.basicData={},w.id=c.params.id,w.projectInvestmentType=c.params.projectInvestmentType,w.page="list",f(),g()}angular.module("appSupervision").controller("projectCtrl",a),a.$inject=["$location","projectSupervisedSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a){function b(b,c){b.isSubmit=!0;var d={method:"delete",url:w+"/delShenPiItem",data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function c(b,c){b.isSubmit=!0;var d={method:"delete",url:w+"/delShenPiUnit",data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(w+"/shenpiUnit")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input  type='radio'  relId='{0}' value='{0}' name='radio1' class='radio' />",a.id+","+a.shenpiUnitName)},filterable:!1,width:40,title:""},{field:"shenpiUnitName",title:"单位名称",template:"",filterable:!0},{field:"contacts",title:"单位负责人",template:"",filterable:!0},{field:"contactsTel",title:"联系人电话",template:"",filterable:!0}];a.shenpiUnitGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format("/management/project/unitName")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF},{field:"isLatestVersion",operator:"eq",value:!0},{field:"isIncludLibrary",operator:"eq",value:!0}]}),c=[{template:function(a){return kendo.format("<input  type='radio'  relId='{0}' value='{0}' name='radio' class='radio' />",a.id+","+a.projectName)},filterable:!1,width:40,title:""},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='#/projectDetails/{0}/{1}'>{2}</a>",a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"projectStage",title:"项目阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectStage),dataTextField:"description",dataValueField:"id"})}}},{field:"projectClassify",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1}];a.projectGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.type=b.type;var d={method:"post",url:w+"/createShenpiUnit",data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href="#/supervision/spdw"}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function g(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.type=b.type;var d={method:"post",url:w+"/createShenpiItems",data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),
$(".modal-backdrop").remove(),location.href="#/supervision/spsx"}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function h(b){var c={method:"get",url:common.format(w+"/shenpiItems?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(b){var c={method:"get",url:common.format(w+"/shenpiUnit?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function j(b){var c={method:"get",url:x},d=function(a){b.userUnits=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}function k(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:w+"/updateShenpiItems",data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function l(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:w+"/updateShenpiUnit",data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function m(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.projectType=common.arrayToString(b.model.projectType,",");var d={method:"post",url:w,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.isZFInvestment?location.href=y:b.isSHInvestment&&(location.href=z)}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function n(b){var c={method:"put",url:w+"/isMonthReport",data:b.model},d=function(a){$("#myModal_edit").modal("hide"),b.isZFInvestment?b.gridOptions.dataSource.read():b.isSHInvestment&&b.gridOptions_SH.dataSource.read()};common.http({vm:b,$http:a,httpOptions:c,success:d})}function o(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.projectType=common.arrayToString(b.model.projectType,",");var d={method:"put",url:w,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.isZFInvestment?location.href=y:b.isSHInvestment&&(location.href=z)}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function p(b){var c={method:"get",url:common.format(w+"?$filter=id eq '{0}'",b.id)},d=function(a){if(b.model=a.data.value[0]||{},getProjectUnit(b),b.model.projectType=common.stringToArray(b.model.projectType,","),b.model.beginDate=common.formatDate(b.model.beginDate),b.model.endDate=common.formatDate(b.model.endDate),b.model.pifuJYS_date=common.formatDate(b.model.pifuJYS_date),b.model.pifuKXXYJBG_date=common.formatDate(b.model.pifuKXXYJBG_date),b.model.pifuCBSJYGS_date=common.formatDate(b.model.pifuCBSJYGS_date),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther),"update"==b.page&&b.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var c=$linq(common.getBasicData()).where(function(a){return a.id==b.model.projectIndustry}).toArray()[0];b.model.projectIndustryParent=c.pId,b.projectIndustryChange()}"details"==b.page&&(b.capitalTotal=function(){return common.getSum([b.model.capitalSCZ_ggys||0,b.model.capitalSCZ_gtzj||0,b.model.capitalSCZ_zxzj||0,b.model.capitalQCZ_ggys||0,b.model.capitalQCZ_gtzj||0,b.model.capitalSHTZ||0,b.model.capitalZYYS||0,b.model.capitalOther||0])})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function q(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(A),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='radio'  relId='{0},{1},{2}' name='checkbox'/>",a.number,a.name,a.fullName)},filterable:!1,width:40,title:""},{field:"number",title:"文号",width:180,filterable:!0},{field:"name",title:"文件名",width:550,template:function(a){return common.format("<a href='/contents/upload/{1}'>{0}</a>",a.name,a.fullName)},filterable:!0}];a.gridOptions_documentRecords={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function r(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(w+"/unitName")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF},{field:"isLatestVersion",operator:"eq",value:!0},{field:"isIncludLibrary",operator:"eq",value:!0}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectNumber",title:"项目代码",width:180,filterable:!1},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='#/projectDetails/{0}/{1}'>{2}</a>",a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"unitName",title:"项目所属单位",width:150,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id"})}},template:function(a){return common.getUnitName(a.unitName)}},{field:"projectStage",title:"项目阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectStage),dataTextField:"description",dataValueField:"id"})}}},{field:"projectClassify",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1},{field:"isMonthReport",title:"是否月报",template:function(a){return a.isMonthReport?"是":a.isMonthReport?void 0:"否"},width:150,filterable:!0},{field:"",title:"操作",width:250,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,"vm.isMonthReport('"+a.id+"','"+a.isMonthReport+"')")}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function s(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(w+"/shenpiItems")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"shenpiName",title:"审批事项",filterable:!1},{field:"projectName",title:"审批项目",width:"",filterable:!1},{field:"shenpiUnitName",title:"审批单位",width:"",filterable:!1},{field:"",title:"剩余天数",width:"",template:function(a){var b=new Date(a.shenpiBeginDate).getTime()-new Date(common.formatDate(new Date)).getTime(),c=(new Date(a.shenpiEndDate).getTime()-new Date(common.formatDate(new Date)).getTime())/864e5;return b>0?"尚未开始":c>0?c:"<span style='color:red'>"+c+"</span>"}},{field:"",title:"操作",width:"",template:function(a){return common.format($("#columnBtns").html(),a.id)}}],d=function(a){console.log(a)};a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,dataBound:d,resizable:!0}}function t(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(w+"/shenpiItems")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"shenpiName",title:"审批事项",filterable:!1},{field:"projectName",title:"审批项目",width:"",filterable:!1},{field:"shenpiUnitName",title:"审批单位",width:"",filterable:!1},{field:"",title:"剩余天数",width:"",template:function(a){var b=new Date(a.shenpiBeginDate).getTime()-new Date(common.formatDate(new Date)).getTime(),c=(new Date(a.shenpiEndDate).getTime()-new Date(common.formatDate(new Date)).getTime())/864e5;return b>0?"尚未开始":c>0?c:"<span style='color:red'>"+c+"</span>"}},{field:"",title:"操作",width:"",template:function(a){return common.format($("#columnBtns").html(),a.id)}}],d=function(a){console.log(a)};a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,dataBound:d,resizable:!0}}function u(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(w+"/shenpiUnit")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"shenpiUnitName",title:"单位名称",width:"",filterable:!1},{field:"contacts",title:"单位负责人",width:"",filterable:!1},{field:"contactsTel",title:"单位负责人电话",width:"",filterable:!1},{field:"",title:"操作",width:"",template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function v(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(w),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isMonthReport:{type:"boolean"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isLatestVersion",operator:"eq",value:!0},{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_SH}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectNumber",title:"项目代码",width:180,filterable:!1},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='#/projectDetails/{0}/{1}'>{2}</a>",a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"unitName",title:"建设单位",width:150,filterable:!0},{field:"projectStage",title:"项目阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectStage),dataTextField:"description",dataValueField:"id"})}}},{field:"projectClassify",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1},{field:"isMonthReport",title:"是否月报",template:function(a){return a.isMonthReport?"是":a.isMonthReport?void 0:"否"},width:150,filterable:!0},{field:"",title:"操作",width:250,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,"vm.isMonthReport('"+a.id+"','"+a.isMonthReport+"')")}}];a.gridOptions_SH={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var w="/management/supervision/project",x="/management/userUnit",y="#/supervision/tzxm",z="#/project_SH",A="/management/replyFile",B={grid:r,grid_SH:v,getProjectById:p,getUserUnits:j,updateProject:o,createProject:m,updateIsMonthReport:n,documentRecordsGird:q,shenpiUnitGrid:u,getShenPiUnitById:i,updateShenpiUnit:l,createShenpiUnit:f,delShenPiUnit:c,shenpiItemsGrid:t,getShenPiItemsById:h,projectGrid:e,shenpiUnitGridSelect:d,updateShenpiItems:k,createShenpiItems:g,delShenPiItem:b,shenpifankuiItemsGrid:s};return B}angular.module("appSupervision").factory("projectSupervisedSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d){function e(){f()}function f(){b.getSysConfigs(g),g.checked=function(a){},g.create=function(){b.editSysConfigs(g)},g.getConfigName=function(a){return $linq(common.getBasicData()).where(function(b){return b.identity==common.basicDataConfig().taskType&&b.id==a}).toArray()[0].description},g.getConfigValue=function(a){return 1==a?"是":"否"}}var g=this;g.title="",g.model={},g.model.config=[],g.model.checkedButton=[],e(),g.roles={}}angular.module("app").controller("sysConfigCtrl",a),a.$inject=["$location","sysConfigSvc","$state","$scope"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:f,data:b.model},d=function(a){b.configs=a.data};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(b){var c={method:"post",url:e,data:b.configs},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide"),location.href=d}})}})};common.http({vm:b,$http:a,httpOptions:c,success:f})}var d="#/sysConfig",e="/sys/create",f="/sys/getSysConfigs",g={getSysConfigs:b,editSysConfigs:c};return g}angular.module("app").factory("sysConfigSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){"task_todo"==c.current.name&&(m.page="todoList"),"task_handle"==c.current.name&&(m.page="handle"),"task_complete"==c.current.name&&(m.page="complete"),"task_shenPi"==c.current.name&&(m.page="complete_shenPi"),"task_shenPiDetails"==c.current.name&&(m.page="task_shenPiDetails"),m.formatDate=function(a){return common.formatDate(a)},m.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},m.checkLength=function(a,b,c){common.checkLength(a,b,c)},m.html=function(a){return e.trustAsHtml(a)},m.getUnitName=function(a){return common.getUnitName(a)},b.getDepts(m),b.getTaskById(m),m.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),m.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),m.basicData.projectShenBaoStage=common.getBacicDataByIndectity(common.basicDataConfig().projectShenBaoStage),m.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),m.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),m.basicData.projectConstrChar=common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),m.basicData.unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),m.basicData.processState=common.getBacicDataByIndectity(common.basicDataConfig().processState),m.basicData.auditState=common.getBacicDataByIndectity(common.basicDataConfig().auditState),m.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),m.basicData.userUnit=common.getUserUnits(),m.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray()}function g(){f(),"todoList"==m.page&&i(),"handle"==m.page&&l(),"complete"==m.page&&j(),"complete_shenPi"==m.page&&k(),"task_shenPiDetails"==m.page&&h()}function h(){m.getUser=function(a){for(var b=0;b<m.model.depts.length;b++)for(var c=0;c<m.model.depts[b].userDtos.length;c++)if(m.model.depts[b].userDtos[c].id==a)return m.model.depts[b].userDtos[c].displayName},m.relatedType=common.uploadFileTypeConfig().reviewResult,m.dialog_shenbaoInfo=function(){$("#shenbaoInfo").modal({backdrop:"static",keyboard:!1}),m.tabStripOptions={}},m.showReviewResult=function(){b.getComission(m),b.getReviewResult(m),$(".reviewResult").modal({backdrop:"static",keyboard:!1})},m.proxyOpen=function(){b.getApproval(m),b.getComission(m),$(".proxy").modal({backdrop:"static",keyboard:!1})},m.draftOpen=function(){b.getDraftIssued(m),$(".draft_issued").modal({backdrop:"static",keyboard:!1}),m.basicData.hecretHierarchy=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().hecretHierarchy&&a.pId==common.basicDataConfig().hecretHierarchy}).toArray(),m.basicData.fileSet=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().fileSet&&a.pId==common.basicDataConfig().fileSet}).toArray(),m.basicData.documentType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().documentType&&a.pId==common.basicDataConfig().documentType}).toArray(),m.basicData.openType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().openType&&a.pId==common.basicDataConfig().openType}).toArray(),m.basicData.postingCategory=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().postingCategory&&a.pId==common.basicDataConfig().postingCategory}).toArray()},m.editApproval=function(){b.getApproval(m),$(".approval").modal({backdrop:"static",keyboard:!1})}}function i(){b.gridForPlan(m),b.gridForShenpi(m),b.grid(m),m.search=function(){var a=[];a.push({field:"isComplete",operator:"eq",value:!1}),null!=m.search.title&&""!=m.search.title&&a.push({field:"title",operator:"contains",value:m.search.title}),null!=m.search.unitName&&""!=m.search.unitName&&a.push({field:"unitName",operator:"contains",value:m.search.unitName}),null!=m.search.projectIndustry&&""!=m.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:m.search.projectIndustry}),m.gridOptions.dataSource.filter(a)},m.filterClear=function(){location.reload()}}function j(){b.completeGird(m)}function k(){m.search=function(){var a=[];a.push({field:"isComplete",operator:"eq",value:!1}),null!=m.search.title&&""!=m.search.title&&a.push({field:"title",operator:"contains",value:m.search.title}),null!=m.search.unitName&&""!=m.search.unitName&&a.push({field:"unitName",operator:"contains",value:m.search.unitName}),null!=m.search.projectIndustry&&""!=m.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:m.search.projectIndustry}),m.gridOptions_complete_shenPi.dataSource.filter(a)},m.filterClear=function(){location.reload()},b.complete_shenPiGird(m)}function l(){m.processState_qianShou=common.basicDataConfig().processState_qianShou,m.processState_tuiWen=common.basicDataConfig().processState_tuiWen,b.getTaskById(m),m.taskType==common.basicDataConfig().taskType_monthReport?(m.isMonthReport=!0,b.getMonthReportById(m)):(m.taskType==common.basicDataConfig().taskType_yearPlan?(m.isYearPlan=!0,m.model.taskRecord.processSuggestion="符合申报"):m.taskType==common.basicDataConfig().taskType_JYS?m.isProjectProposal=!0:m.taskType==common.basicDataConfig().taskType_KXXYJBG?m.isKXXYJBG=!0:m.taskType==common.basicDataConfig().taskType_CBSJYGS&&(m.isCBSJYGS=!0),b.getShenBaoInfoById(m)),m.dialog_shenbaoInfo=function(){$("#shenbaoInfo").modal({backdrop:"static",keyboard:!1}),m.tabStripOptions={}},m.handle=function(a){common.initJqValidation();var c=$("form").valid();c&&(m.isSubmit=!0,m.model.taskRecord.processState=a,b.handle(m))}}var m=this;m.title="",m.model={},m.taskType=c.params.taskType,m.taskId=c.params.taskId,m.relId=c.params.relId,m.search={},m.basicData={},m.model.taskRecord={},m.page="todoList",m.callBack=function(){window.history.back(-1)},g()}angular.module("app").controller("taskCtrl",a),a.$inject=["$location","taskSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:common.format(C+"/"+b.task.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.review=a.data||{},""==b.review?b.projectInvestSum=b.model.shenBaoInfo.projectInvestSum:(b.nuclear=b.review.nuclear,b.cut=b.review.cut,b.projectInvestSum=b.review.projectInvestSum),b.review.approvalDate=common.formatDate(b.review.approvalDate),b.review.receiptDate=common.formatDate(b.review.receiptDate),b.review.approvalEndDate=common.formatDate(b.review.approvalEndDate)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(b){var c={method:"get",url:common.format(B+"/"+b.task.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.proxy=a.data||{},b.proxy.beginDate=common.formatDate(b.proxy.beginDate),b.proxy.approvalType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectShenBaoStage&&a.id==b.proxy.approvalType}).toArray()[0].description}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b){var c={method:"get",url:common.format(D+"/"+b.task.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.draft=a.data||{},b.draft.draftDate=common.formatDate(b.draft.draftDate)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(b){var c={method:"get",url:common.format(A+"/"+b.task.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.approval=a.data||{},b.approval.beginDate=common.formatDate(b.approval.beginDate),b.approval.approvalType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectShenBaoStage&&a.id==b.approval.approvalType}).toArray()[0].description}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(x)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.model.depts=a.data.value||{}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"get",url:common.format(v+"?$filter=id eq '{0}'",b.model.monthReport.projectId)},d=function(a){b.model.project=a.data.value[0]||{},""!=b.model.project.projectType&&void 0!=b.model.project.projectType?b.model.project.projectType=b.model.project.projectType.split(","):b.model.project.projectType=[]};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(b){var c={method:"get",url:common.format(u+"?$filter=id eq '{0}'",b.relId)},d=function(a){b.model.monthReport=a.data.value[0]||{},g(b),b.model.monthReport.beginDate=common.formatDate(b.model.monthReport.beginDate),b.model.monthReport.endDate=common.formatDate(b.model.monthReport.endDate),b.uploadType=[["scenePicture","现场图片"],["other","其它材料"]]};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(b){var c={method:"get",url:common.format(t+"?$filter=id eq '{0}'",b.relId)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.model.shenBaoInfo=a.data.value[0]||{},b.model.shenBaoInfo.projectType=common.stringToArray(b.model.shenBaoInfo.projectType,","),b.constructionUnits=common.stringToArray(b.model.shenBaoInfo.constructionUnit,","),b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH?b.isSHInvestment=!0:b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF&&(b.isZFInvestment=!0),b.model.shenBaoInfo.beginDate=common.formatDate(b.model.shenBaoInfo.beginDate),b.model.shenBaoInfo.endDate=common.formatDate(b.model.shenBaoInfo.endDate),b.model.shenBaoInfo.pifuJYS_date=common.formatDate(b.model.shenBaoInfo.pifuJYS_date),b.model.shenBaoInfo.pifuKXXYJBG_date=common.formatDate(b.model.shenBaoInfo.pifuKXXYJBG_date),b.model.shenBaoInfo.pifuCBSJYGS_date=common.formatDate(b.model.shenBaoInfo.pifuCBSJYGS_date),b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?b.isZFInvestment=!0:b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(b.isSHInvestment=!0),b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_projectProposal?(b.isProjectProposal=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_projectProposal):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_KXXYJBG?(b.isKXXYJBG=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_KXXYJBG):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_CBSJYGS?(b.isCBSJYGS=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_CBSJYGS):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_prePlanFee?(b.isPrePlanFee=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_prePlanFee):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_newStratPlan?(b.isNewStart=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_newStart):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_xuJianPlan?(b.isXuJian=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_xuJian):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan?(b.isYearPlan=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_YearPlan,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_junGong&&(b.isJunGong=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_junGong),b.capitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_zxzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSHTZ)||0)+(parseFloat(b.model.shenBaoInfo.capitalZYYS)||0)+(parseFloat(b.model.shenBaoInfo.capitalOther)||0)},b.lastTwoYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear)||0)},b.lastYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_LastYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_LastYear)||0)},b.theYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_TheYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_TheYear)||0)}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function j(b){var c={method:"put",url:q+"/"+b.taskId,data:b.model.taskRecord},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=w}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function k(b){var c={method:"get",url:common.format(q+"?$filter=id eq '{0}'",b.taskId)},d=function(a){b.task=a.data.value[0]||{},b.task&&(b.task.taskTypeDesc=common.getBasicDataDesc(b.task.taskType),b.task.isComplete&&(b.isComplete=!0))};common.http({vm:b,$http:a,httpOptions:c,success:d})}function l(b){var c={method:"get",url:z},d=function(a){$("#todoNumber_plan").html(a.data.value.length)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function m(b){var c={method:"get",url:y},d=function(a){$("#todoNumber_audit").html(a.data.value.length)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function n(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(q),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isComplete",operator:"eq",value:!1},{field:"taskType",operator:"eq",value:"taskType_2"}],requestEnd:function(a){$("#todoNumber").html(a.response.value.length)},change:function(){var a=$(".grid").data("kendoGrid");window.userOptions=a.getOptions()}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",width:500,filterable:!0,template:function(a){return common.format("<a href='#/task/todo/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.id,a.relId)}},{field:"unitName",title:"建设单位",width:300,filterable:!0},{field:"projectIndustry",title:"项目行业",width:120,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),dataTextField:"description",dataValueField:"id"})}}},{field:"taskType",title:"任务类型",width:120,filterable:!1,template:function(a){return common.getBasicDataDesc(a.taskType)}},{field:"",title:"创建日期",width:180,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];window.userOptions&&""!=window.userOptions?a.gridOptions=window.userOptions:a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}function o(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"taskType",operator:"eq",value:"taskType_2"},change:function(c){var d=b.filter();a.filters=d}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!0,
width:350,template:function(a){return common.format("<a href='#/task/todo/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.taskId,a.relId)}},{field:"unitName",title:"建设单位",width:200,filterable:!0},{field:"projectIndustry",title:"项目行业",width:120,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),dataTextField:"description",dataValueField:"id"})}}},{field:"taskType",title:"任务类型",width:120,filterable:!1,template:function(a){return common.getBasicDataDesc(a.taskType)}},{field:"",title:"创建日期",width:150,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];a.gridOptions_complete={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}function p(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},change:function(c){var d=b.filter();a.filters=d}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!0,template:function(a){return common.format("<a href='#/task/shenPi_details/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.taskId,a.relId)}},{field:"unitName",title:"建设单位",width:400,filterable:!0},{field:"projectIndustry",title:"项目行业",width:200,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),dataTextField:"description",dataValueField:"id"})}}},{field:"taskType",title:"任务类型",width:180,filterable:!1,template:function(a){return common.getBasicDataDesc(a.taskType)}},{field:"",title:"创建日期",width:180,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];a.gridOptions_complete_shenPi={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}var q="/management/task",r="/management/taskRecord",s="/management/taskRecord/shenPi",t="/management/shenbao",u="/management/monthReport",v="/management/project",w="#/task/todo",x="/org",y="/management/task/audit",z="/management/task/plan",A="/management/approval",B="/management/proxy",C="/management/review",D="/management/draft",E={grid:n,completeGird:o,getTaskById:k,getShenBaoInfoById:i,getMonthReportById:h,handle:j,gridForShenpi:m,complete_shenPiGird:p,getApproval:e,getDraftIssued:d,getComission:c,getReviewResult:b,getDepts:f,gridForPlan:l};return E}angular.module("app").factory("taskSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){"task_handle_audit"==c.current.name&&(k.page="handleAudit"),k.formatDate=function(a){return common.formatDate(a)},k.getProcessUser=function(a){return common.getUserById(a)},k.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},k.checkLength=function(a,b,c){common.checkLength(a,b,c)},k.html=function(a){return e.trustAsHtml(a)},k.getUnitName=function(a){return common.getUnitName(a)},k.processState_msFenBan=common.basicDataConfig().processState_msFenBan,k.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),k.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),k.basicData.projectShenBaoStage=common.getBacicDataByIndectity(common.basicDataConfig().projectShenBaoStage),k.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),k.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),k.basicData.projectConstrChar=common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),k.basicData.unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),k.basicData.processState=common.getBacicDataByIndectity(common.basicDataConfig().processState),k.basicData.auditState=common.getBacicDataByIndectity(common.basicDataConfig().auditState),k.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),k.basicData.userUnit=common.getUserUnits(),k.basicData.taskType=common.getBacicDataByIndectity(common.basicDataConfig().taskType)}function h(){g(),"todoAuditList"==k.page&&i(),"handleAudit"==k.page&&j()}function i(){b.grid(k),k.search=function(){var a=[];a.push({field:"isComplete",operator:"eq",value:!1}),null!=k.search.title&&""!=k.search.title&&a.push({field:"title",operator:"contains",value:k.search.title}),null!=k.search.unitName&&""!=k.search.unitName&&a.push({field:"unitName",operator:"contains",value:k.search.unitName}),null!=k.search.projectIndustry&&""!=k.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:k.search.projectIndustry}),k.gridOptions.dataSource.filter(a)},k.filterClear=function(){location.reload()}}function j(){function a(a){var b=a.taskAudit.processState;"processState_1"==b?(a.taskAudit.processState="processState_3",a.taskAudit.nextProcess="processState_4"):"processState_3"==b?(a.taskAudit.processState="processState_4",a.taskAudit.nextProcess="processState_5"):"processState_4"==b?(a.taskAudit.processState="processState_5",a.taskAudit.nextProcess="processState_6"):"processState_5"==b?(a.taskAudit.processState="processState_6",a.taskAudit.nextProcess="processState_8"):"processState_6"==b?(a.taskAudit.processState="processState_8",a.taskAudit.nextProcess="processState_9"):"processState_8"==b?(a.taskAudit.processState="processState_9",a.taskAudit.nextProcess="processState_10"):"processState_9"==b?(a.taskAudit.processState="processState_10",a.taskAudit.nextProcess="processState_17"):"processState_10"==b?(a.taskAudit.processState="processState_17",a.taskAudit.nextProcess="processState_18"):"processState_17"==b?(a.taskAudit.processState="processState_18",a.taskAudit.nextProcess="processState_19"):"processState_18"==b?(a.taskAudit.processState="processState_19",a.taskAudit.nextProcess="processState_21"):"processState_19"==b?(a.taskAudit.processState="processState_21",a.taskAudit.nextProcess="processState_22"):"processState_21"==b&&(a.taskAudit.processState="processState_23",a.taskAudit.nextProcess="")}function c(a){for(var b=0;b<k.model.roles.length;b++)if(k.model.roles[b].roleName==a)return k.model.roles[b].id}b.getTaskInfoById(k),b.getShenBaoInfoById(k),b.getDepts(k),b.replyFileGird(k),b.getRoles(k),b.opinionGird(k),b.getOpinion(k),k.cal=function(){0!=k.review.projectInvestSum&&0!=k.review.authorize&&void 0!=k.review.projectInvestSum&&void 0!=k.review.authorize?(k.cut=k.review.projectInvestSum-k.review.authorize,k.nuclear=Number(k.cut/k.review.projectInvestSum*100).toFixed(2)):(k.cut="",k.nuclear="")},k.saveReview=function(){k.taskAudit.reviewResult=!0,b.saveReview(k)},k.getBasicDataJD=function(a){return void 0!=a?(k.basicData.projectShenBaoStage=$linq(common.getBasicData()).where(function(b){return b.identity==common.basicDataConfig().projectShenBaoStage&&b.id==a}).toArray(),k.basicData.projectShenBaoStage[0].description):""},k.relatedType=common.uploadFileTypeConfig().reviewResult,k.uploadSuccess_review=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){k.review.attachmentDtos?k.review.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):k.review.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},k.uploadOptions_review={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess_review,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.delFile_review=function(a){var b=k.review.attachmentDtos[a];b&&k.review.attachmentDtos.splice(a,1)},k.showReviewResult=function(){b.getComission(k),b.getReviewResult(k),k.approvalEndDate=common.formatDate(new Date),k.projectInvestSum=k.model.shenBaoInfo.projectInvestSum,$(".reviewResult").modal({backdrop:"static",keyboard:!0})},k.closeDatum=function(){$("#datum").modal("hide")},k.removeDatum=function(a){for(var b=0;b<k.proxy.datumDtos.length;b++)k.proxy.datumDtos[b].id==a&&k.proxy.datumDtos.splice(b,1)},k.saveDatum=function(a){k.proxy.datumDtos.push({dataName:k.dataName,dataNumber:k.dataNumber}),$("#datum").modal("hide")},k.openDatum=function(){$(".datum").modal({backdrop:"static",keyboard:!0})},k.saveProxy=function(){k.taskAudit.proxy=!0,b.saveProxy(k)},k.proxyOpen=function(){b.getApproval(k),b.getComission(k),$(".proxy").modal({backdrop:"static",keyboard:!0}),k.nameAndTel=k.model.shenBaoInfo.projectRepName+":"+k.model.shenBaoInfo.projectRepMobile;for(var a=0;a<k.model.depts.length;a++)for(var c=0;c<k.model.depts[a].userDtos.length;c++)k.model.depts[a].userDtos[c].id==k.taskAudit.operator&&(k.processRole=k.model.depts[a].userDtos[c].displayName);k.beginDate=common.formatDate(new Date),k.approvalType=k.model.shenBaoInfo.projectShenBaoStage},k.editApproval=function(){b.getApproval(k);for(var a=0;a<k.model.depts.length;a++)for(var c=0;c<k.model.depts[a].userDtos.length;c++)k.model.depts[a].userDtos[c].id==k.taskAudit.operator&&(k.processRole=k.model.depts[a].userDtos[c].displayName);k.approvalType=k.model.shenBaoInfo.projectShenBaoStage,k.beginDate=common.formatDate(new Date),$(".approval").modal({backdrop:"static",keyboard:!0})},k.saveApproval=function(){k.taskAudit.approval=!0,b.saveApproval(k)},k.Selection=function(a){k.draft.openType=a},k.saveDraft=function(){b.saveDraft(k)},k.draftOpen=function(){b.getDraftIssued(k);for(var a=0;a<k.model.depts.length;a++)for(var c=0;c<k.model.depts[a].userDtos.length;c++)k.model.depts[a].userDtos[c].id==k.taskAudit.operator&&(k.userNameAndUnit=k.model.depts[a].name+"、"+k.model.depts[a].userDtos[c].displayName);$(".draft_issued").modal({backdrop:"static",keyboard:!0}),k.basicData.hecretHierarchy=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().hecretHierarchy&&a.pId==common.basicDataConfig().hecretHierarchy}).toArray(),k.basicData.fileSet=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().fileSet&&a.pId==common.basicDataConfig().fileSet}).toArray(),k.basicData.documentType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().documentType&&a.pId==common.basicDataConfig().documentType}).toArray(),k.basicData.openType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().openType&&a.pId==common.basicDataConfig().openType}).toArray(),k.basicData.postingCategory=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().postingCategory&&a.pId==common.basicDataConfig().postingCategory}).toArray()},k.opinion=function(){b.getOpinion(k)},k.saveOpinion=function(){""!=k.processSuggestion&&void 0!=k.processSuggestion&&b.saveOpinion(k)},k.closeOpin=function(){$("#opinionEdit").model("hide")},k.showOpinion=function(){$(".opinion").modal({backdrop:"static",keyboard:!0}),k.opinionGrid.dataSource.read()},k.editOpin=function(){b.editOpin(k)},k.edit=function(a,b){$(".opinionEdit").modal({backdrop:"static",keyboard:!0}),k.model.opinion={opinion:b,id:a}},k.remove=function(a){b.deleteOpin(k,a)},k.changeOpin=function(){k.processSuggestion=k.model.opinion},k.del=function(a){$(".confirmDialog").modal("hide"),b.deleteOpin(k,a)},k.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:k,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");k.del(d)}},k.changeDept=function(){for(var a=0;a<k.model.depts.length;a++)if(k.model.depts[a].id==k.model.deptId)for(var b=0;b<k.model.depts[a].userDtos.length;b++)for(var c=0;c<k.model.depts[a].userDtos[b].roles.length;c++)"科长"==k.model.depts[a].userDtos[b].roles[c].roleName&&(k.taskAudit.nextUser=k.model.depts[a].userDtos[b].id)},k.clickedYW=function(a){"yewu"==a&&(k.nextProcessRadioOfYW="yewu"),"pingshenbaopi"==a&&(k.nextProcessRadioOfYW="pingshenbaopi"),"fawen"==a&&(k.nextProcessRadioOfYW="fawen"),"keyuantuiwen"==a&&(k.nextProcessRadioOfYW="keyuantuiwen"),"pingshenweituo"==a&&(k.nextProcessRadioOfYW="pingshenweituo"),"fawennigao"==a&&(k.nextProcessRadioOfYW="fawennigao")},k.clicked=function(a){if("bumen"==a?(k.showDept=!0,k.nextProcessRadio="bumen"):k.showDept=!1,"tuiwenbanjie"==a){k.nextProcessRadio="tuiwenbanjie";for(var b=0;b<k.model.depts.length;b++)for(var c=0;c<k.model.depts[b].userDtos.length;c++)for(var d=0;d<k.model.depts[b].userDtos[c].roles.length;d++)"人秘科发文人员"==k.model.depts[b].userDtos[c].roles[d].roleName&&(k.taskAudit.processRole=k.model.depts[b].userDtos[c].roles[d].id)}if("tuiwen"==a&&(k.nextProcessRadio="tuiwen"),"banjie"==a&&(k.nextProcessRadio="banjie"),"tuihuiChongban"==a&&(k.nextProcessRadio="tuihuiChongban"),"jingBanRenBanli"==a){k.nextProcessRadio="jingBanRenBanli";for(var b=0;b<k.model.depts.length;b++)for(var c=0;c<k.model.depts[b].userDtos.length;c++)for(var d=0;d<k.model.depts[b].userDtos[c].roles.length;d++)"科长"==k.model.depts[b].userDtos[c].roles[d].roleName&&k.model.depts[b].userDtos[c].id==k.taskAudit.nextUser&&(k.model.depts[b].userDtos.splice(c,1),k.users=k.model.depts[b].userDtos)}if("keshibanli"==a&&(k.nextProcessRadio="keshibanli"),"keyuanbanli"==a){k.nextProcessRadio="keyuanbanli";for(var b=0;b<k.model.depts.length;b++)for(var c=0;c<k.model.depts[b].userDtos.length;c++)for(var d=0;d<k.model.depts[b].userDtos[c].roles.length;d++)k.model.depts[b].userDtos[c].id==k.taskAudit.nextUser&&(k.users=k.model.depts[b].userDtos)}if("kezhangshenhe"==a){k.nextProcessRadio="kezhangshenhe";for(var b=0;b<k.model.depts.length;b++)for(var c=0;c<k.model.depts[b].userDtos.length;c++)for(var d=0;d<k.model.depts[b].userDtos[c].roles.length;d++)if("科员"==k.model.depts[b].userDtos[c].roles[d].roleName&&k.model.depts[b].userDtos[c].id==k.taskAudit.nextUser)for(var e=0;e<k.model.depts[b].userDtos.length;e++)for(var f=0;f<k.model.depts[b].userDtos[e].roles.length;f++)"科长"==k.model.depts[b].userDtos[e].roles[f].roleName&&(k.taskAudit.nextUser=k.model.depts[b].userDtos[e].id)}if("tuihuijingbanren"!=a&&"jingbanrensongshen"!=a&&"pingswancheng"!=a&&"jingBanRenBanli_juzhang"!=a||("tuihuijingbanren"==a?k.nextProcessRadio="tuihuijingbanren":"jingbanrensongshen"==a?k.nextProcessRadio="jingbanrensongshen":"pingswancheng"==a?k.nextProcessRadio="pingswancheng":"jingBanRenBanli_juzhang"==a&&(k.nextProcessRadio="jingBanRenBanli_juzhang"),k.taskAudit.nextUser=k.taskAudit.operator),"julingdaoshenpi"==a){k.nextProcessRadio="julingdaoshenpi";for(var b=0;b<k.model.depts.length;b++)"局领导"==k.model.depts[b].name&&(k.users=k.model.depts[b].userDtos)}if("songshen"==a){k.nextProcessRadio="songshen";for(var b=0;b<k.model.depts.length;b++)"评审中心"==k.model.depts[b].name&&(k.users=k.model.depts[b].userDtos)}if("renmikehegao"==a){k.nextProcessRadio="renmikehegao";for(var b=0;b<k.model.depts.length;b++)for(var c=0;c<k.model.depts[b].userDtos.length;c++)for(var d=0;d<k.model.depts[b].userDtos[c].roles.length;d++)"人秘科发文人员"==k.model.depts[b].userDtos[c].roles[d].roleName&&(k.taskAudit.processRole=k.model.depts[b].userDtos[c].roles[d].id)}if("julingdaofushen"==a){k.nextProcessRadio="julingdaofushen";for(var b=0;b<k.model.depts.length;b++)"局领导"==k.model.depts[b].name&&(k.users=k.model.depts[b].userDtos)}if("bangongshifawen"==a){k.nextProcessRadio="bangongshifawen";for(var b=0;b<k.model.depts.length;b++)for(var c=0;c<k.model.depts[b].userDtos.length;c++)for(var d=0;d<k.model.depts[b].userDtos[c].roles.length;d++)"人秘科发文人员"==k.model.depts[b].userDtos[c].roles[d].roleName&&(k.taskAudit.processRole=k.model.depts[b].userDtos[c].roles[d].id)}"fawendengji"==a&&(k.nextProcessRadio="fawendengji")},k.selectUser=function(a){k.taskAudit.nextUser=a,"tuihuijingbanren"!=k.nextProcessRadio&&"jingBanRenBanli"!=k.nextProcessRadio&&"pingswancheng"!=k.nextProcessRadio||(k.taskAudit.operator=a)},k.handle=function(){k.taskAudit.tuiwen=!1,common.initJqValidation();var d=$("form").valid();d&&("bumen"==k.nextProcessRadio?("processState_4"==k.taskAudit.processState?(k.taskAudit.processState="processState_3",k.taskAudit.nextProcess="processState_4"):a(k),k.taskAudit.processRole=""):"tuiwen"==k.nextProcessRadio?(k.taskAudit.processState="processState_15",k.taskAudit.nextProcess="processState_3",k.taskAudit.processRole=""):"tuiwenbanjie"==k.nextProcessRadio?(k.taskAudit.processState="processState_3",k.taskAudit.nextUser="",k.taskAudit.nextProcess="processState_22"):"banjie"==k.nextProcessRadio?(k.taskAudit.processState="processState_11",k.taskAudit.nextProcess="",k.taskAudit.processRole=""):"tuihuiChongban"==k.nextProcessRadio?(k.taskAudit.processState="processState_4",k.taskAudit.nextProcess="processState_3",k.taskAudit.processRole=c("秘书科分办人员"),k.taskAudit.nextUser=""):"jingBanRenBanli"==k.nextProcessRadio?("processState_3"!=k.taskAudit.processState&&(k.taskAudit.processState="processState_3"),a(k),k.taskAudit.processRole=""):"keshibanli"==k.nextProcessRadio?(k.taskAudit.processState="processState_5",k.taskAudit.nextProcess="processState_4"):"keyuanbanli"==k.nextProcessRadio?(k.taskAudit.processState="processState_4",k.taskAudit.nextProcess="processState_5",k.taskAudit.processRole=""):"kezhangshenhe"==k.nextProcessRadio&&"pingshenbaopi"==k.nextProcessRadioOfYW?("processState_6"==k.taskAudit.processState?(k.taskAudit.processState="processState_5",k.taskAudit.nextProcess="processState_6"):a(k),k.taskAudit.processRole=""):"julingdaoshenpi"==k.nextProcessRadio?(a(k),k.taskAudit.processRole=""):"jingBanRenBanli_juzhang"==k.nextProcessRadio?(k.taskAudit.processState="processState_4",k.taskAudit.nextProcess="processState_5",k.taskAudit.processRole=""):"pingshentuihui"==k.nextProcessRadio?(k.taskAudit.processState="processState_8",k.taskAudit.nextProcess="processState_9",k.taskAudit.processRole=""):"tuihuijingbanren"==k.nextProcessRadio?(k.taskAudit.processState=k.taskAudit.nextProcess,k.taskAudit.nextProcess="processState_5",k.taskAudit.processRole=""):"jingbanrensongshen"==k.nextProcessRadio?(a(k),k.taskAudit.processRole=""):"songshen"==k.nextProcessRadio?(a(k),k.taskAudit.processRole=""):"pingswancheng"==k.nextProcessRadio?(a(k),k.taskAudit.processRole=""):"pingshenbaopi"==k.nextProcessRadioOfYW&&"kezhangshenhe"==k.nextProcessRadio?(a(k),k.taskAudit.processRole=""):"fawen"==k.nextProcessRadioOfYW&&"kezhangshenhe"==k.nextProcessRadio?("processState_4"==k.taskAudit.processState&&(k.taskAudit.processState="processState_5"),"processState_10"==k.taskAudit.processState&&(k.taskAudit.processState="processState_17"),k.taskAudit.nextProcess="processState_18",k.taskAudit.processRole=""):"keyuantuiwen"==k.nextProcessRadioOfYW&&"kezhangshenhe"==k.nextProcessRadio?(k.taskAudit.processState="processState_5",k.taskAudit.nextProcess="processState_4",k.taskAudit.processRole="",k.taskAudit.tuiwen=!0):"pingshenweituo"==k.nextProcessRadioOfYW&&"kezhangshenhe"==k.nextProcessRadio?(k.taskAudit.processState="processState_9",k.taskAudit.nextProcess="processState_18",k.taskAudit.processRole=""):"renmikehegao"==k.nextProcessRadio?("processState_17"!=k.taskAudit.processState?(k.taskAudit.processState="processState_18",k.taskAudit.nextProcess="processState_19"):a(k),k.taskAudit.nextUser=""):"julingdaofushen"==k.nextProcessRadio?(a(k),k.taskAudit.processRole=""):"bangongshifawen"==k.nextProcessRadio?(a(k),k.taskAudit.nextUser=""):"bangongshifawen"==k.nextProcessRadio?(a(k),k.taskAudit.nextUser=""):"fawendengji"==k.nextProcessRadio&&(k.taskAudit.processState="processState_21",a(k),k.taskAudit.nextUser="",k.taskAudit.processRole=""),b.handle(k))},k.dialog_shenbaoInfo=function(){$("#shenbaoInfo").modal({backdrop:"static",keyboard:!0})},k.dialog_shenbaoInfoEdit=function(){$("#shenbaoInfoEdit").modal({backdrop:"static",keyboard:!0})},k.updateSelection=function(a){var b=k.projectTypes.indexOf(a);b==-1?k.projectTypes.push(a):k.projectTypes.splice(b,1)},k.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){k.model.shenBaoInfo.attachmentDtos?k.model.shenBaoInfo.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):k.model.shenBaoInfo.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},k.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:k,msg:"上传文件过大！"})})})},k.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.delFile=function(a){var b=k.model.shenBaoInfo.attachmentDtos[a];if(b){var c=b.type;k.model.shenBaoInfo["pifu"+c+"_wenhao"]="",k.model.shenBaoInfo.attachmentDtos.splice(a,1)}},k.choseDocument=function(a){k.pifuType=$(a.target).parents(".uploadBox").attr("data-type"),$("#documentRecords").modal({backdrop:"static",keyboard:!0}),k.replyFileGridOptions.dataSource.read()},k.pifuChoseConfirm=function(){$("#documentRecords").modal("hide");var a=common.getKendoCheckId(".grid"),b=a[0].value;if(b){var c=common.stringToArray(b,","),d=c[0],e=c[1],f=c[2];k.model.shenBaoInfo["pifu"+k.pifuType+"_wenhao"]=d,k.model.shenBaoInfo.attachmentDtos?k.model.shenBaoInfo.attachmentDtos.push({name:e,url:f,type:k.pifuType}):k.model.shenBaoInfo.attachmentDtos=[{name:e,url:f,type:k.pifuType}]}},k.dismissReplyFile=function(){$("#documentRecords").modal("hide")},k.saveShenBaoInfo=function(){b.saveShenBaoInfo(k)}}var k=this;k.title="",k.model={},k.search={},k.basicData={},k.page="todoAuditList",k.taskType=c.params.taskType,k.taskId=c.params.taskId,k.relId=c.params.relId,k.nextProcessRadio="",h()}angular.module("app").controller("taskAuditCtrl",a),a.$inject=["$location","taskAuditSvc","$state","$scope","$sce","$rootScope"]}(),function(){"use strict";function a(a,b){function c(b){b.review.projectName=b.model.shenBaoInfo.projectName,b.review.constructionUnit=b.model.shenBaoInfo.constructionUnit,b.review.approvalEndDate=new Date,b.review.receiptDate=new Date(b.model.shenBaoInfo.createdDate),b.review.unitName=b.proxy.unitName,b.review.approvalDate=b.proxy.beginDate,b.review.nuclear=b.nuclear,b.review.cut=b.cut,common.initJqValidation();var c=$("#formResult").valid();if(c){var d={method:"post",url:common.format(I+"/"+b.taskAudit.id),data:b.review},e=function(a){$("#reviewResult").modal("hide"),common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function d(b){var c={method:"get",url:common.format(I+"/"+b.taskAudit.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.review=a.data||{},""==b.review?b.projectInvestSum=b.model.shenBaoInfo.projectInvestSum:(b.nuclear=b.review.nuclear,b.cut=b.review.cut,b.projectInvestSum=b.review.projectInvestSum),b.review.beginDate=common.formatDate(b.review.beginDate)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(b){b.proxy.approvalType=b.approvalType,b.proxy.projectName=b.model.shenBaoInfo.projectName,b.proxy.unitName=b.approval.unitName,b.proxy.constructionUnit=b.model.shenBaoInfo.constructionUnit,b.proxy.processRole=b.taskAudit.operator,b.proxy.beginDate=new Date,b.proxy.contacts=b.nameAndTel,b.proxy.capitalBaoSong=b.approval.capitalBaoSong,b.proxy.processSuggestion_JBR=b.processSuggestion_JBR_WTS,common.initJqValidation();var c=$("#formproxy").valid();if(c){var d={method:"post",url:common.format(H+"/"+b.taskAudit.id),data:b.proxy},e=function(a){$("#proxy").modal("hide"),common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function f(b){var c={method:"get",url:common.format(H+"/"+b.taskAudit.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.proxy=a.data||{},b.proxy.beginDate=common.formatDate(b.proxy.beginDate),b.approval.processSuggestion_JBR!=b.proxy.processSuggestion_JBR?b.processSuggestion_JBR_WTS=b.proxy.processSuggestion_JBR:b.processSuggestion_JBR_WTS=b.approval.processSuggestion_JBR;for(var c=0;c<b.model.depts.length;c++)for(var d=0;d<b.model.depts[c].userDtos.length;d++)b.model.depts[c].userDtos[d].id==b.proxy.processRole&&(b.proxy.processRole=b.model.depts[c].userDtos[d].displayName)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"get",url:common.format(G+"/"+b.taskAudit.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.approval=a.data||{},b.approval.beginDate=common.formatDate(b.approval.beginDate)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(b){b.approval.approvalType=b.approvalType,b.approval.projectName=b.model.shenBaoInfo.projectName,b.approval.constructionUnit=b.model.shenBaoInfo.constructionUnit,b.approval.processRole=b.taskAudit.operator,b.approval.beginDate=new Date,common.initJqValidation();var c=$("#formApproval").valid();if(c){var d={method:"post",url:common.format(G+"/"+b.taskAudit.id),data:b.approval},e=function(a){$("#approval").modal("hide"),common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function i(b){b.draft.projectName=b.model.shenBaoInfo.projectName,b.draft.unitName=b.model.shenBaoInfo.constructionUnit,b.draft.capitalTotal=b.capitalTotal,b.draft.userNameAndUnit=b.userNameAndUnit,common.initJqValidation();var c=$("#formDraft").valid();if(c){var d={method:"post",url:common.format(F+"/"+b.taskAudit.id),data:b.draft},e=function(a){$("#draft_issued").modal("hide"),common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function j(b){var c={method:"get",url:common.format(F+"/"+b.taskAudit.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.draft=a.data||{},b.draft.draftDate=common.formatDate(b.draft.draftDate)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function k(b){var c={method:"put",url:E,data:b.model.opinion},d=function(a){b.opinionGrid.dataSource.read(),$(".opinionEdit").modal("hide")};common.http({vm:b,$http:a,httpOptions:c,success:d})}function l(b,c){b.isSubmit=!0;var d={method:"delete",url:E,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.opinionGrid.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function m(b){var c={method:"get",url:E},d=function(a){b.model.opinionDtos=a.data.value||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function n(b){b.opinion={opinion:b.processSuggestion};var c={method:"post",url:E,data:b.opinion},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function o(b){var c={method:"get",url:D},d=function(a){b.model.roles=a.data.value||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function p(b){var c={method:"put",url:z,data:b.model.shenBaoInfo},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function q(b){var c={method:"get",url:common.format(y+"?$filter=id eq '{0}'",b.taskId)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.taskAudit=a.data.value[0]||{}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function r(b){var c={method:"get",url:common.format(z+"?$filter=id eq '{0}'",b.relId)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.model.shenBaoInfo=a.data.value[0]||{},b.projectTypes=common.stringToArray(b.model.shenBaoInfo.projectType,","),b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH?(b.isSHInvestment=!0,b.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),b.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),b.projectIndustryChange=function(){b.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==b.model.projectIndustryParent}).toArray()}):b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF&&(b.isZFInvestment=!0,b.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),b.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray()),b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_projectProposal?(b.isProjectProposal=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_projectProposal):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_KXXYJBG?(b.isKXXYJBG=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_KXXYJBG):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_CBSJYGS?(b.isCBSJYGS=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_CBSJYGS):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_prePlanFee?(b.isPrePlanFee=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_prePlanFee):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_newStratPlan?(b.isNewStart=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_newStart):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_xuJianPlan?(b.isXuJian=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_xuJian):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan?(b.isYearPlan=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_YearPlan,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_junGong&&(b.isJunGong=!0,
b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_junGong),b.model.shenBaoInfo.createdDate=common.formatDate(b.model.shenBaoInfo.createdDate),b.model.shenBaoInfo.beginDate=common.formatDate(b.model.shenBaoInfo.beginDate),b.model.shenBaoInfo.endDate=common.formatDate(b.model.shenBaoInfo.endDate),b.model.shenBaoInfo.pifuJYS_date=common.formatDate(b.model.shenBaoInfo.pifuJYS_date),b.model.shenBaoInfo.pifuKXXYJBG_date=common.formatDate(b.model.shenBaoInfo.pifuKXXYJBG_date),b.model.shenBaoInfo.pifuCBSJYGS_date=common.formatDate(b.model.shenBaoInfo.pifuCBSJYGS_date),b.capitalTotal=function(){return common.getSum([b.model.shenBaoInfo.capitalSCZ_ggys||0,b.model.shenBaoInfo.capitalSCZ_gtzj||0,b.model.shenBaoInfo.capitalSCZ_zxzj||0,b.model.shenBaoInfo.capitalQCZ_ggys||0,b.model.shenBaoInfo.capitalQCZ_gtzj||0,b.model.shenBaoInfo.capitalSHTZ||0,b.model.shenBaoInfo.capitalZYYS||0,b.model.shenBaoInfo.capitalOther||0])}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function s(b){var c={method:"get",url:common.format(A)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.model.depts=a.data.value||{}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function t(b){b.taskAudit.processSuggestion=b.processSuggestion,common.initJqValidation();var c=$("form").valid();if(c){var d={method:"put",url:x+"/"+b.taskId,data:b.taskAudit},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=B}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function u(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(E),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"opinion",title:"意见",width:450,filterable:!0},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,a.opinion)}}];a.opinionGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function v(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(C),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='radio'  relId='{0},{1},{2}' name='checkbox'/>",a.number,a.name,a.fullName)},filterable:!1,width:40,title:""},{field:"number",title:"文号",width:180,filterable:!0},{field:"name",title:"文件名",width:450,template:function(a){return common.format("<a href='/contents/upload/{1}'>{0}</a>",a.name,a.fullName)},filterable:!0}];a.replyFileGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function w(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(y),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isComplete",operator:"eq",value:!1},requestEnd:function(a){$("#todoNumber_audit").html(a.response.count)},change:function(){var a=$(".grid").data("kendoGrid");window.todo_auditOption=a.getOptions()}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!0,width:500,template:function(a){return common.format("<a href='#/task/handle_audit/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.id,a.relId)}},{field:"unitName",title:"建设单位",width:300,filterable:!0},{field:"projectIndustry",title:"项目行业",width:120,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectIndustry_ZF,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"taskType",title:"任务类型",width:120,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.taskType,dataTextField:"description",dataValueField:"id",filter:"startswith"})}},template:function(a){return common.getBasicDataDesc(a.taskType)}},{field:"",title:"创建日期",width:180,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];window.todo_auditOption&&""!=window.todo_auditOption?a.gridOptions=window.todo_auditOption:a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,scrollable:!0}}var x="/management/task",y="/management/task/audit",z="/management/shenbao",A="/org",B="#/task/todo",C="/management/replyFile",D="/role",E="/opin",F="/management/draft",G="/management/approval",H="/management/proxy",I="/management/review",J={grid:w,getTaskInfoById:q,getShenBaoInfoById:r,getDepts:s,handle:t,replyFileGird:v,saveShenBaoInfo:p,getRoles:o,saveOpinion:n,getOpinion:m,opinionGird:u,deleteOpin:l,editOpin:k,getDraftIssued:j,saveDraft:i,saveApproval:h,getApproval:g,getComission:f,saveProxy:e,getReviewResult:d,saveReview:c};return J}angular.module("app").factory("taskAuditSvc",a),a.$inject=["$http","$location"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){"task_handle_plan"==c.current.name&&(m.page="handlePlan"),"task_plan"==c.current.name&&(m.page="task_plan"),"task_planDetails"==c.current.name&&(m.page="task_planDetails"),m.formatDate=function(a){return common.formatDate(a)},m.getProcessUser=function(a){return common.getUserById(a)},m.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},m.checkLength=function(a,b,c){common.checkLength(a,b,c)},m.html=function(a){return e.trustAsHtml(a)},m.getUnitName=function(a){return common.getUnitName(a)},m.processState_msFenBan=common.basicDataConfig().processState_msFenBan,m.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),m.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),m.basicData.projectShenBaoStage=common.getBacicDataByIndectity(common.basicDataConfig().projectShenBaoStage),m.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),m.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),m.basicData.projectConstrChar=common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),m.basicData.unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),m.basicData.processState=common.getBacicDataByIndectity(common.basicDataConfig().processState),m.basicData.auditState=common.getBacicDataByIndectity(common.basicDataConfig().auditState),m.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),m.basicData.userUnit=common.getUserUnits(),b.getShenBaoInfoById(m)}function h(){g(),"todoPlanList"==m.page&&k(),"handlePlan"==m.page&&l(),"task_plan"==m.page&&j(),"task_planDetails"==m.page&&i()}function i(){b.getTaskById(m),m.draftOpen=function(){b.getDraftIssued(m),$(".draft_issued").modal({backdrop:"static",keyboard:!1}),m.basicData.hecretHierarchy=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().hecretHierarchy&&a.pId==common.basicDataConfig().hecretHierarchy}).toArray(),m.basicData.fileSet=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().fileSet&&a.pId==common.basicDataConfig().fileSet}).toArray(),m.basicData.documentType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().documentType&&a.pId==common.basicDataConfig().documentType}).toArray(),m.basicData.openType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().openType&&a.pId==common.basicDataConfig().openType}).toArray(),m.basicData.postingCategory=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().postingCategory&&a.pId==common.basicDataConfig().postingCategory}).toArray()}}function j(){m.draftOpen=function(){b.getDraftIssued(m),$(".draft_issued").modal({backdrop:"static",keyboard:!1}),m.basicData.hecretHierarchy=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().hecretHierarchy&&a.pId==common.basicDataConfig().hecretHierarchy}).toArray(),m.basicData.fileSet=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().fileSet&&a.pId==common.basicDataConfig().fileSet}).toArray(),m.basicData.documentType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().documentType&&a.pId==common.basicDataConfig().documentType}).toArray(),m.basicData.openType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().openType&&a.pId==common.basicDataConfig().openType}).toArray(),m.basicData.postingCategory=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().postingCategory&&a.pId==common.basicDataConfig().postingCategory}).toArray()},b.complete_PlanGird(m)}function k(){b.grid_plan(m),m.search=function(){var a=[];a.push({field:"isComplete",operator:"eq",value:!1}),null!=m.search.title&&""!=m.search.title&&a.push({field:"title",operator:"contains",value:m.search.title}),null!=m.search.unitName&&""!=m.search.unitName&&a.push({field:"unitName",operator:"contains",value:m.search.unitName}),null!=m.search.projectIndustry&&""!=m.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:m.search.projectIndustry}),m.gridOptions_plan.dataSource.filter(a)},m.filterClear=function(){location.reload()}}function l(){function a(a){var b=a.taskPlan.processState;"processState_1"==b?(a.taskPlan.processState="processState_3",a.taskPlan.nextProcess="processState_4"):"processState_3"==b?(a.taskPlan.processState="processState_4",a.taskPlan.nextProcess="processState_5"):"processState_4"==b?(a.taskPlan.processState="processState_5",a.taskPlan.nextProcess="processState_6"):"processState_5"==b?(a.taskPlan.processState="processState_6",a.taskPlan.nextProcess="processState_8"):"processState_6"==b?(a.taskPlan.processState="processState_8",a.taskPlan.nextProcess="processState_22"):"processState_8"==b?(a.taskPlan.processState="processState_9",a.taskPlan.nextProcess="processState_10"):"processState_9"==b?(a.taskPlan.processState="processState_10",a.taskPlan.nextProcess="processState_17"):"processState_10"==b?(a.taskPlan.processState="processState_17",a.taskPlan.nextProcess="processState_18"):"processState_17"==b?(a.taskPlan.processState="processState_18",a.taskPlan.nextProcess="processState_19"):"processState_18"==b?(a.taskPlan.processState="processState_19",a.taskPlan.nextProcess="processState_21"):"processState_19"==b?(a.taskPlan.processState="processState_21",a.taskPlan.nextProcess="processState_22"):"processState_21"==b&&(a.taskPlan.processState="processState_23",a.taskPlan.nextProcess="")}function c(a){for(var b=0;b<m.model.roles.length;b++)if(m.model.roles[b].roleName==a)return m.model.roles[b].id}b.getTaskInfoById(m),b.getDepts(m),b.replyFileGird(m),b.getRoles(m),b.opinionGird(m),b.getOpinion(m),m.saveDraft=function(){b.saveDraft(m)},m.draftOpen=function(){b.getDraftIssued(m);for(var a=0;a<m.model.depts.length;a++)for(var c=0;c<m.model.depts[a].userDtos.length;c++)m.model.depts[a].userDtos[c].id==m.taskPlan.operator&&(m.userNameAndUnit=m.model.depts[a].name+"、"+m.model.depts[a].userDtos[c].displayName);$(".draft_issued").modal({backdrop:"static",keyboard:!1}),m.basicData.hecretHierarchy=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().hecretHierarchy&&a.pId==common.basicDataConfig().hecretHierarchy}).toArray(),m.basicData.fileSet=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().fileSet&&a.pId==common.basicDataConfig().fileSet}).toArray(),m.basicData.documentType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().documentType&&a.pId==common.basicDataConfig().documentType}).toArray(),m.basicData.openType=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().openType&&a.pId==common.basicDataConfig().openType}).toArray(),m.basicData.postingCategory=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().postingCategory&&a.pId==common.basicDataConfig().postingCategory}).toArray()},m.opinion=function(){b.getOpinion(m)},m.saveOpinion=function(){""!=m.processSuggestion&&void 0!=m.processSuggestion&&b.saveOpinion(m)},m.closeOpin=function(){$("#opinionEdit").model("hide")},m.showOpinion=function(){$(".opinion").modal({backdrop:"static",keyboard:!1}),m.opinionGrid.dataSource.read()},m.editOpin=function(){b.editOpin(m)},m.edit=function(a,b){$(".opinionEdit").modal({backdrop:"static",keyboard:!1}),m.model.opinion={opinion:b,id:a}},m.remove=function(a){b.deleteOpin(m,a)},m.changeOpin=function(){m.processSuggestion=m.model.opinion},m.del=function(a){$(".confirmDialog").modal("hide"),b.deleteOpin(m,a)},m.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:m,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");m.del(d)}},m.changeDept=function(){for(var a=0;a<m.model.depts.length;a++)if(m.model.depts[a].id==m.model.deptId)for(var b=0;b<m.model.depts[a].userDtos.length;b++)for(var c=0;c<m.model.depts[a].userDtos[b].roles.length;c++)"科长"==m.model.depts[a].userDtos[b].roles[c].roleName&&(m.taskPlan.nextUser=m.model.depts[a].userDtos[b].id)},m.clickedYW=function(a){"yewu"==a&&(m.nextProcessRadioOfYW="yewu"),"pingshenbaopi"==a&&(m.nextProcessRadioOfYW="pingshenbaopi"),"fawen"==a&&(m.nextProcessRadioOfYW="fawen"),"keyuantuiwen"==a&&(m.nextProcessRadioOfYW="keyuantuiwen"),"pingshenweituo"==a&&(m.nextProcessRadioOfYW="pingshenweituo"),"fawennigao"==a&&(m.nextProcessRadioOfYW="fawennigao")},m.clicked=function(a){if("bumen"==a?(m.showDept=!0,m.nextProcessRadio="bumen"):m.showDept=!1,"tuiwenbanjie"==a){m.nextProcessRadio="tuiwenbanjie";for(var b=0;b<m.model.depts.length;b++)for(var c=0;c<m.model.depts[b].userDtos.length;c++)for(var d=0;d<m.model.depts[b].userDtos[c].roles.length;d++)"人秘科发文人员"==m.model.depts[b].userDtos[c].roles[d].roleName&&(m.taskPlan.processRole=m.model.depts[b].userDtos[c].roles[d].id)}if("tuiwen"==a&&(m.nextProcessRadio="tuiwen"),"banjie"==a&&(m.nextProcessRadio="banjie"),"tuihuiChongban"==a&&(m.nextProcessRadio="tuihuiChongban"),"jingBanRenBanli"==a){m.nextProcessRadio="jingBanRenBanli";a:for(var b=0;b<m.model.depts.length;b++)for(var c=0;c<m.model.depts[b].userDtos.length;c++)for(var d=0;d<m.model.depts[b].userDtos[c].roles.length;d++)if("科长"==m.model.depts[b].userDtos[c].roles[d].roleName&&m.model.depts[b].userDtos[c].id==m.taskPlan.nextUser){m.model.depts[b].userDtos.splice(c,1),m.users=m.model.depts[b].userDtos;break a}}if("keshibanli"==a&&(m.nextProcessRadio="keshibanli"),"keyuanbanli"==a){m.nextProcessRadio="keyuanbanli";for(var b=0;b<m.model.depts.length;b++)for(var c=0;c<m.model.depts[b].userDtos.length;c++)for(var d=0;d<m.model.depts[b].userDtos[c].roles.length;d++)m.model.depts[b].userDtos[c].id==m.taskPlan.nextUser&&(m.users=m.model.depts[b].userDtos)}if("kezhangshenhe"==a){m.nextProcessRadio="kezhangshenhe";for(var b=0;b<m.model.depts.length;b++)for(var c=0;c<m.model.depts[b].userDtos.length;c++)for(var d=0;d<m.model.depts[b].userDtos[c].roles.length;d++)if("科员"==m.model.depts[b].userDtos[c].roles[d].roleName&&m.model.depts[b].userDtos[c].id==m.taskPlan.nextUser)for(var e=0;e<m.model.depts[b].userDtos.length;e++)for(var f=0;f<m.model.depts[b].userDtos[e].roles.length;f++)"科长"==m.model.depts[b].userDtos[e].roles[f].roleName&&(m.taskPlan.nextUser=m.model.depts[b].userDtos[e].id)}if("tuihuijingbanren"!=a&&"jingbanrensongshen"!=a&&"pingswancheng"!=a&&"jingBanRenBanli_juzhang"!=a||("tuihuijingbanren"==a?m.nextProcessRadio="tuihuijingbanren":"jingbanrensongshen"==a?m.nextProcessRadio="jingbanrensongshen":"pingswancheng"==a?m.nextProcessRadio="pingswancheng":"jingBanRenBanli_juzhang"==a&&(m.nextProcessRadio="jingBanRenBanli_juzhang"),m.taskPlan.nextUser=m.taskPlan.operator),"julingdaoshenpi"==a){m.nextProcessRadio="julingdaoshenpi";for(var b=0;b<m.model.depts.length;b++)"局领导"==m.model.depts[b].name&&(m.users=m.model.depts[b].userDtos)}if("renmikehegao"==a){m.nextProcessRadio="renmikehegao";for(var b=0;b<m.model.depts.length;b++)for(var c=0;c<m.model.depts[b].userDtos.length;c++)for(var d=0;d<m.model.depts[b].userDtos[c].roles.length;d++)"人秘科发文人员"==m.model.depts[b].userDtos[c].roles[d].roleName&&(m.taskPlan.processRole=m.model.depts[b].userDtos[c].roles[d].id)}if("julingdaofushen"==a){m.nextProcessRadio="julingdaofushen";for(var b=0;b<m.model.depts.length;b++)"局领导"==m.model.depts[b].name&&(m.users=m.model.depts[b].userDtos)}if("bangongshifawen"==a){m.nextProcessRadio="bangongshifawen";for(var b=0;b<m.model.depts.length;b++)for(var c=0;c<m.model.depts[b].userDtos.length;c++)for(var d=0;d<m.model.depts[b].userDtos[c].roles.length;d++)"人秘科发文人员"==m.model.depts[b].userDtos[c].roles[d].roleName&&(m.taskPlan.processRole=m.model.depts[b].userDtos[c].roles[d].id)}"fawendengji"==a&&(m.nextProcessRadio="fawendengji")},m.selectUser=function(a){m.taskPlan.nextUser=a,"tuihuijingbanren"!=m.nextProcessRadio&&"jingBanRenBanli"!=m.nextProcessRadio&&"pingswancheng"!=m.nextProcessRadio||(m.taskPlan.operator=a)},m.handle=function(){m.taskPlan.tuiwen=!1,common.initJqValidation();var d=$("form").valid();d&&("bumen"==m.nextProcessRadio?("processState_4"==m.taskPlan.processState?(m.taskPlan.processState="processState_3",m.taskPlan.nextProcess="processState_4"):a(m),m.taskPlan.processRole=""):"tuiwen"==m.nextProcessRadio?(m.taskPlan.processState="processState_15",m.taskPlan.nextProcess="processState_3",m.taskPlan.processRole=""):"tuiwenbanjie"==m.nextProcessRadio?(m.taskPlan.processState="processState_3",m.taskPlan.nextUser="",m.taskPlan.nextProcess="processState_22"):"banjie"==m.nextProcessRadio?(m.taskPlan.processState="processState_11",m.taskPlan.nextProcess="",m.taskPlan.processRole=""):"tuihuiChongban"==m.nextProcessRadio?(m.taskPlan.processState="processState_4",m.taskPlan.nextProcess="processState_3",m.taskPlan.processRole=c("秘书科分办人员"),m.taskPlan.nextUser=""):"jingBanRenBanli"==m.nextProcessRadio?("processState_3"!=m.taskPlan.processState&&(m.taskPlan.processState="processState_3"),a(m),m.taskPlan.processRole=""):"keshibanli"==m.nextProcessRadio?(m.taskPlan.processState="processState_5",m.taskPlan.nextProcess="processState_4"):"keyuanbanli"==m.nextProcessRadio?(m.taskPlan.processState="processState_4",m.taskPlan.nextProcess="processState_5",m.taskPlan.processRole=""):"kezhangshenhe"==m.nextProcessRadio&&"pingshenbaopi"==m.nextProcessRadioOfYW?("processState_6"==m.taskPlan.processState?(m.taskPlan.processState="processState_5",m.taskPlan.nextProcess="processState_6"):a(m),m.taskPlan.processRole=""):"julingdaoshenpi"==m.nextProcessRadio?(a(m),m.taskPlan.processRole=""):"jingBanRenBanli_juzhang"==m.nextProcessRadio?(m.taskPlan.processState="processState_4",m.taskPlan.nextProcess="processState_5",m.taskPlan.processRole=""):"pingshentuihui"==m.nextProcessRadio?(m.taskPlan.processState="processState_8",m.taskPlan.nextProcess="processState_9",m.taskPlan.processRole=""):"tuihuijingbanren"==m.nextProcessRadio?(m.taskPlan.processState=m.taskPlan.nextProcess,m.taskPlan.nextProcess="processState_5",m.taskPlan.processRole=""):"jingbanrensongshen"==m.nextProcessRadio?(a(m),m.taskPlan.processRole=""):"songshen"==m.nextProcessRadio?(a(m),m.taskPlan.processRole=""):"pingswancheng"==m.nextProcessRadio?(a(m),m.taskPlan.processRole=""):"pingshenbaopi"==m.nextProcessRadioOfYW&&"kezhangshenhe"==m.nextProcessRadio?(a(m),m.taskPlan.processRole=""):"fawen"==m.nextProcessRadioOfYW&&"kezhangshenhe"==m.nextProcessRadio?(m.taskPlan.fawen=!0,"processState_4"==m.taskPlan.processState&&(m.taskPlan.processState="processState_5"),"processState_10"==m.taskPlan.processState&&(m.taskPlan.processState="processState_17"),m.taskPlan.nextProcess="processState_18",m.taskPlan.processRole=""):"keyuantuiwen"==m.nextProcessRadioOfYW&&"kezhangshenhe"==m.nextProcessRadio?(m.taskPlan.processState="processState_5",m.taskPlan.nextProcess="processState_4",m.taskPlan.processRole="",m.taskPlan.tuiwen=!0):"pingshenweituo"==m.nextProcessRadioOfYW&&"kezhangshenhe"==m.nextProcessRadio?(m.taskPlan.processState="processState_9",m.taskPlan.nextProcess="processState_18",m.taskPlan.processRole=""):"renmikehegao"==m.nextProcessRadio?("processState_17"!=m.taskPlan.processState?(m.taskPlan.processState="processState_18",m.taskPlan.nextProcess="processState_19"):a(m),m.taskPlan.nextUser=""):"julingdaofushen"==m.nextProcessRadio?(a(m),m.taskPlan.processRole=""):"bangongshifawen"==m.nextProcessRadio?(a(m),m.taskPlan.nextUser=""):"bangongshifawen"==m.nextProcessRadio?(a(m),m.taskPlan.nextUser=""):"fawendengji"==m.nextProcessRadio&&(m.taskPlan.processState="processState_21",a(m),m.taskPlan.nextUser="",m.taskPlan.processRole=""),b.handle(m))},m.dialog_shenbaoInfo=function(){$("#shenbaoInfo").modal({backdrop:"static",keyboard:!1})},m.dialog_shenbaoInfoEdit=function(){$("#shenbaoInfoEdit").modal({backdrop:"static",keyboard:!1})},m.updateSelection=function(a){var b=m.projectTypes.indexOf(a);b==-1?m.projectTypes.push(a):m.projectTypes.splice(b,1)},m.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){m.model.shenBaoInfo.attachmentDtos?m.model.shenBaoInfo.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):m.model.shenBaoInfo.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},m.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:m,msg:"上传文件过大！"})})})},m.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:m.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:m.onSelect},m.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:m.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:m.onSelect},m.delFile=function(a){var b=m.model.shenBaoInfo.attachmentDtos[a];if(b){var c=b.type;m.model.shenBaoInfo["pifu"+c+"_wenhao"]="",m.model.shenBaoInfo.attachmentDtos.splice(a,1)}},m.choseDocument=function(a){m.pifuType=$(a.target).parents(".uploadBox").attr("data-type"),$("#documentRecords").modal({backdrop:"static",keyboard:!1}),m.replyFileGridOptions.dataSource.read()},m.pifuChoseConfirm=function(){$("#documentRecords").modal("hide");var a=common.getKendoCheckId(".grid"),b=a[0].value;if(b){var c=common.stringToArray(b,","),d=c[0],e=c[1],f=c[2];m.model.shenBaoInfo["pifu"+m.pifuType+"_wenhao"]=d,m.model.shenBaoInfo.attachmentDtos?m.model.shenBaoInfo.attachmentDtos.push({name:e,url:f,type:m.pifuType}):m.model.shenBaoInfo.attachmentDtos=[{name:e,url:f,type:m.pifuType}]}},m.dismissReplyFile=function(){$("#documentRecords").modal("hide")},m.saveShenBaoInfo=function(){b.saveShenBaoInfo(m)}}var m=this;m.title="",m.model={},m.search={},m.basicData={},m.page="todoPlanList",m.task="",m.taskType=c.params.taskType,m.taskId=c.params.taskId,m.relId=c.params.relId,h()}angular.module("app").controller("taskPlanCtrl",a),a.$inject=["$location","taskPlanSvc","$state","$scope","$sce","$rootScope"]}(),function(){"use strict";function a(a,b){function c(b){b.draft.projectName=b.model.shenBaoInfo.projectName,b.draft.unitName=b.model.shenBaoInfo.constructionUnit,b.draft.capitalTotal=b.capitalTotal,b.draft.userNameAndUnit=b.userNameAndUnit,common.initJqValidation();var c=$("#formDraft").valid();if(c){var d={method:"post",url:common.format(B+"/"+b.taskPlan.id),data:b.draft},e=function(a){$("#draft_issued").modal("hide"),common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function d(b){var c={method:"get",url:common.format(B+"/"+b.task.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.draft=a.data||{},b.draft.draftDate=common.formatDate(b.draft.draftDate)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(b){var c={method:"put",url:A,data:b.model.opinion},d=function(a){b.opinionGrid.dataSource.read(),$(".opinionEdit").modal("hide")};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b,c){b.isSubmit=!0;var d={method:"delete",url:A,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.opinionGrid.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function g(b){var c={method:"get",url:A},d=function(a){b.model.opinionDtos=a.data.value||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(b){b.opinion={opinion:b.processSuggestion};var c={method:"post",url:A,data:b.opinion},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(b){var c={method:"get",url:z},d=function(a){b.model.roles=a.data.value||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function j(b){var c={method:"put",url:v,data:b.model.shenBaoInfo},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"保存成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function k(b){var c={method:"get",url:common.format(t+"?$filter=id eq '{0}'",b.taskId)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.task=a.data.value[0]||{},b.task&&(b.task.taskTypeDesc=common.getBasicDataDesc(b.task.taskType),b.task.isComplete&&(b.isComplete=!0))}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function l(b){var c={method:"get",url:common.format(u+"?$filter=id eq '{0}'",b.taskId)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.taskPlan=a.data.value[0]||{}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function m(b){var c={method:"get",url:common.format(v+"?$filter=id eq '{0}'",b.relId)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.model.shenBaoInfo=a.data.value[0]||{},b.projectTypes=common.stringToArray(b.model.shenBaoInfo.projectType,","),b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH?(b.isSHInvestment=!0,b.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),b.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),b.projectIndustryChange=function(){b.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==b.model.projectIndustryParent}).toArray()}):b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF&&(b.isZFInvestment=!0,b.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),b.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray()),b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_projectProposal?(b.isProjectProposal=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_projectProposal,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]):b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_KXXYJBG?(b.isKXXYJBG=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_KXXYJBG,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]):b.model.shenBaoInfo.projectShenBaoStage==common.uploadFileTypeConfig().projectShenBaoStage_CBSJYGS&&(b.isCBSJYGS=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_CBSJYGS,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]),b.model.shenBaoInfo.createdDate=common.formatDate(b.model.shenBaoInfo.createdDate),b.model.shenBaoInfo.beginDate=common.formatDate(b.model.shenBaoInfo.beginDate),b.model.shenBaoInfo.endDate=common.formatDate(b.model.shenBaoInfo.endDate),b.model.shenBaoInfo.pifuJYS_date=common.formatDate(b.model.shenBaoInfo.pifuJYS_date),b.model.shenBaoInfo.pifuKXXYJBG_date=common.formatDate(b.model.shenBaoInfo.pifuKXXYJBG_date),b.model.shenBaoInfo.pifuCBSJYGS_date=common.formatDate(b.model.shenBaoInfo.pifuCBSJYGS_date),b.capitalTotal=function(){return common.getSum([b.model.shenBaoInfo.capitalSCZ_ggys||0,b.model.shenBaoInfo.capitalSCZ_gtzj||0,b.model.shenBaoInfo.capitalSCZ_zxzj||0,b.model.shenBaoInfo.capitalQCZ_ggys||0,b.model.shenBaoInfo.capitalQCZ_gtzj||0,b.model.shenBaoInfo.capitalSHTZ||0,b.model.shenBaoInfo.capitalZYYS||0,b.model.shenBaoInfo.capitalOther||0])}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function n(b){var c={method:"get",url:common.format(w)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.model.depts=a.data.value||{}}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function o(b){b.taskPlan.processSuggestion=b.processSuggestion,common.initJqValidation();var c=$("form").valid();if(c){var d={method:"put",url:t+"/"+b.taskId,data:b.taskPlan},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=x}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function p(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(A),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"opinion",title:"意见",width:450,filterable:!0},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,a.opinion)}}];a.opinionGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function q(a){var b=new kendo.data.DataSource({
type:"odata",transport:common.kendoGridConfig().transport(y),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='radio'  relId='{0},{1},{2}' name='checkbox'/>",a.number,a.name,a.fullName)},filterable:!1,width:40,title:""},{field:"number",title:"文号",width:180,filterable:!0},{field:"name",title:"文件名",width:450,template:function(a){return common.format("<a href='/contents/upload/{1}'>{0}</a>",a.name,a.fullName)},filterable:!0}];a.replyFileGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function r(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(C),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},change:function(c){var d=b.filter();a.filters=d}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!0,template:function(a){return common.format("<a href='#/task/plan_details/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.taskId,a.relId)}},{field:"unitName",title:"建设单位",width:400,filterable:!0},{field:"projectIndustry",title:"项目行业",width:200,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),dataTextField:"description",dataValueField:"id"})}}},{field:"taskType",title:"任务类型",width:180,filterable:!1,template:function(a){return common.getBasicDataDesc(a.taskType)}},{field:"",title:"创建日期",width:180,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];a.gridOptions_complete_plan={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function s(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isComplete",operator:"eq",value:!1},requestEnd:function(a){$("#todoNumber_plan").html(a.response.count)},change:function(){var a=$(".grid").data("kendoGrid");window.todo_planOption=a.getOptions()}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!0,template:function(a){return common.format("<a href='#/task/handle_plan/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.id,a.relId)}},{field:"unitName",title:"建设单位",width:400,filterable:!0},{field:"projectIndustry",title:"项目行业",width:200,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectIndustry_ZF,dataTextField:"description",dataValueField:"id"})}}},{field:"taskType",title:"任务类型",width:180,filterable:!1,template:function(a){return common.getBasicDataDesc(a.taskType)}},{field:"",title:"创建日期",width:180,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];window.todo_planOption&&""!=window.todo_planOption?a.gridOptions_plan=window.todo_planOption:a.gridOptions_plan={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var t="/management/task",u="/management/task/plan",v="/management/shenbao",w="/org",x="#/task/todo",y="/management/replyFile",z="/role",A="/opin",B="/management/draft",C="/management/taskRecord/plan",D={grid_plan:s,getTaskInfoById:l,getShenBaoInfoById:m,getDepts:n,handle:o,replyFileGird:q,saveShenBaoInfo:j,getRoles:i,saveOpinion:h,getOpinion:g,opinionGird:p,deleteOpin:f,editOpin:e,saveDraft:c,getDraftIssued:d,complete_PlanGird:r,getTaskById:k};return D}angular.module("app").factory("taskPlanSvc",a),a.$inject=["$http","$location"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){"yearPlan_shenbaoInfoEdit"==c.current.name&&(n.page="shenbaoInfoAdd"),"yearPlan_shenbaoInfoEdit"==c.current.name&&n.id&&(n.page="shenbaoInfoEdit"),"yearPlan_planList"==c.current.name&&(n.page="planList"),"yearPlan_planEdit"==c.current.name&&(n.page="plan_create"),"yearPlan_planEdit"==c.current.name&&n.id&&(n.page="plan_update"),"yearPlan_planBZ"==c.current.name&&(n.page="planBZ"),n.checkLength=function(a,b,c){common.checkLength(a,b,c)},n.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},n.html=function(a){return e.trustAsHtml(a)},$(document).on("click","#checkboxAll_shenBaoList",function(){var a=$(this).is(":checked");$(".yearPlanCapitalGrid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),window.global_basicData=null,n.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),n.basicData.projectConstrChar=common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),n.basicData.auditState=common.getBacicDataByIndectity(common.basicDataConfig().auditState),n.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),n.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),n.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),n.basicData.projectConstrChar=common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),n.basicData.unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),n.basicData.projectIndustryAll=common.getBacicDataByIndectity(common.basicDataConfig().projectIndustry),n.basicData.projectIndustry_ZF=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),n.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),n.basicData.userUnit=common.getUserUnits(),n.basicData.roles=common.getRoles(),n.basicData.users=[],n.basicData.packageType=common.getBacicDataByIndectity(common.basicDataConfig().packageType),n.searchIndustryChange=function(){n.searchIndustryIsZF=!1,n.searchIndustryIsSH=!1,n.searchIndustryFather==common.basicDataConfig().projectIndustry_ZF?n.searchIndustryIsZF=!0:n.searchIndustryFather==common.basicDataConfig().projectIndustry_SH&&(n.searchIndustryIsSH=!0)}}function g(){"shenbaoInfoList"==n.page&&h(),"shenbaoInfoAdd"==n.page&&(n.shenBaoInfoAdd=!0,i()),"shenbaoInfoEdit"==n.page&&(n.shenBaoInfoEdit=!0,i()),"planList"==n.page&&j(),"plan_create"==n.page&&k(),"plan_update"==n.page&&(n.isPlanEdit=!0,l()),"planBZ"==n.page&&m(),$(document).on("click","#checkboxAll_shenBaoList",function(){var a=$(this).is(":checked");$(".yearPlanCapitalGrid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)})}function h(){b.grid_shenbaoInfoList(n),n.search=function(){var a=[];a.push({field:"projectShenBaoStage",operator:"eq",value:common.basicDataConfig().projectShenBaoStage_nextYearPlan}),a.push({field:"processState",operator:"eq",value:common.basicDataConfig().processState_qianShou}),null!=n.search.projectName&&""!=n.search.projectName&&a.push({field:"projectName",operator:"contains",value:n.search.projectName}),null!=n.search.projectCategory&&""!=n.search.projectCategory&&a.push({field:"projectCategory",operator:"eq",value:n.search.projectCategory}),null!=n.search.planYear&&""!=n.search.planYear&&a.push({field:"planYear",operator:"eq",value:parseInt(n.search.planYear,10)}),null!=n.search.constructionUnit&&""!=n.search.constructionUnit&&a.push({field:"constructionUnit",operator:"contains",value:n.search.constructionUnit}),null!=n.search.auditState&&""!=n.search.auditState&&a.push({field:"auditState",operator:"eq",value:n.search.auditState}),null!=n.search.projectConstrChar&&""!=n.search.projectConstrChar&&a.push({field:"projectConstrChar",operator:"eq",value:n.search.projectConstrChar}),null!=n.search.projectIndustry&&""!=n.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:n.search.projectIndustry}),null!=n.search.receiver&&""!=n.search.receiver&&("me"==n.search.receiver?a.push({field:"receiver",operator:"eq",value:window.profile_userId}):"other"==n.search.receiver?a.push({field:"receiver",operator:"ne",value:window.profile_userId}):"all"==n.search.receiver),null!=n.search.packageType&&""!=n.search.packageType&&a.push({field:"packageType",operator:"eq",value:n.search.packageType}),n.gridOptions.dataSource.filter(a)},n.filterClear=function(){location.reload()},n.dialog_shenbaoInfo=function(a){n.id=a,b.getShenBaoInfoById(n),$("#shenbaoInfo").modal({backdrop:"static",keyboard:!1}),n.tabStripOptions={}},n.retreat=function(a){common.confirm({vm:n,msg:"确定需要退文吗？",fn:function(){$(".confirmDialog").modal("hide"),$("#shenbaoInfoTuiWen").modal({backdrop:"static",keyboard:!1}),n.model.relId=a,n.model.processState=common.basicDataConfig().processState_tuiWen,n.retreatSubmit=function(){$("#shenbaoInfoTuiWen").modal("hide"),b.updateShenBaoInfoState(n)}}})},n.addShenBaoInfo=function(){var b=common.basicDataConfig().projectInvestmentType_ZF,c=common.basicDataConfig().projectShenBaoStage_nextYearPlan;a.path("/yearPlan/shenbaoInfoEdit//"+b+"/"+c)}}function i(){n.auditState_auditPass=common.basicDataConfig().auditState_auditPass,n.auditState_auditNotPass=common.basicDataConfig().auditState_auditNotPass;var a=function(){n.isYearPlan=n.stage==common.basicDataConfig().projectShenBaoStage_nextYearPlan,n.isYearPlan&&(n.isYearPlan=!0,n.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_YearPlan,n.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]),n.shenBaoInfoAdd&&(n.isShenBaoInfoAdd=!0,$("#tab1").attr("disabled","true"),$("#tab2").attr("disabled","true"),$("#tab3").attr("disabled","true"),$("#tab4").attr("disabled","true"))},c=function(){n.investmentType==common.basicDataConfig().projectInvestmentType_ZF?(n.isZFInvestment=!0,n.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),n.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray()):n.investmentType==common.basicDataConfig().projectInvestmentType_SH&&(n.isSHInvestment=!0,n.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),n.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),n.projectIndustryChange=function(){n.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==n.model.projectIndustryParent}).toArray()})};a(),c(),b.getShenBaoInfoById(n),n.unitNameChange=function(){b.getUserUnit(n)},n.updateSelection=function(a){n.projectTypes.constructor==String&&(n.projectTypes=common.stringToArray(n.projectTypes));var b=n.projectTypes.indexOf(a);b==-1?n.projectTypes.push(a):n.projectTypes.splice(b,1)},n.changeYear=function(){n.planYear=parseInt(n.model.shenBaoInfo.planYear,10)},n.choseDocument=function(a){n.pifuType=$(a.target).parents(".uploadBox").attr("data-type"),$("#documentRecords").modal({backdrop:"static",keyboard:!0}),n.grid_documentRecords.dataSource.read()},b.documentRecordsGird(n),n.pifuChoseConfirm=function(){$("#documentRecords").modal("hide"),$(".modal-backdrop").remove();var a=common.getKendoCheckId(".grid"),b=a[0].value;if(b){var c=common.stringToArray(b,","),d=c[0],e=c[1],f=c[2];n.model.shenBaoInfo["pifu"+n.pifuType+"_wenhao"]=d,n.model.shenBaoInfo.attachmentDtos?n.model.shenBaoInfo.attachmentDtos.push({name:e,url:f,type:n.pifuType}):n.model.shenBaoInfo.attachmentDtos=[{name:e,url:f,type:n.pifuType}]}},n.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){n.model.shenBaoInfo.attachmentDtos?n.model.shenBaoInfo.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):n.model.shenBaoInfo.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},n.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:n,msg:"上传文件过大！"})})})},n.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:n.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:n.onSelect},n.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:n.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:n.onSelect},n.delFile=function(a){var b=n.model.shenBaoInfo.attachmentDtos[a];if(b){var c=b.type;n.model.shenBaoInfo["pifu"+c+"_wenhao"]="",n.model.shenBaoInfo.attachmentDtos.splice(a,1)}},n.tabReturn=function(a){var b=$("#tab"+a);n.tabStrip.activateTab(b)},n.tabChange=function(a){common.initJqValidation();var b=$("form").valid(),c=$("#tab"+a);b&&n.tabStrip.activateTab(c)},n.addUnit=function(){n.constructionUnits.constructor==String&&(n.constructionUnits=common.stringToArray(n.constructionUnits)),n.constructionUnits.push(""),n.constructionUnits.length>1&&(n.canDelete=!0)},n.deleteUnit=function(a){n.canDelete&&(n.constructionUnits.constructor==String&&(n.constructionUnits=common.stringToArray(n.constructionUnits)),n.constructionUnits.splice(a,1),n.constructionUnits.length<=1&&(n.canDelete=!1))},n.packageTypeChange=function(){n.isOtherPackageType=!1,"other"==n.model.shenBaoInfo.packageType&&(n.isOtherPackageType=!0)},n.savePackageType=function(){b.savePackageType(n)},n.addProjectToLibray=function(){b.addProjectToLibrary(n)},n.updateProject=function(){b.updateProject(n)},n.update=function(){n.model.shenBaoInfo.auditState=common.basicDataConfig().auditState_noAudit,b.updateShenBaoInfo(n)},n.updateAuditState=function(a){n.isAudit=!0,n.model.shenBaoInfo.auditState=a,a==common.basicDataConfig().auditState_auditPass&&(n.model.shenBaoInfo.isIncludLibrary=!0),b.updateShenBaoInfo(n)},n.create=function(){b.createShenBaoInfo(n)}}function j(){b.grid_planList(n),n.deletePlan=function(a){common.confirm({vm:n,msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.plan_delete(n,a)}})},n.deletePlans=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:n,msg:"请选择数据!"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");n.deletePlan(d)}}}function k(){n.create=function(){b.plan_create(n)}}function l(){b.getPlanById(n),n.update=function(){b.plan_update(n)}}function m(){b.grid_yearPlan_shenbaoInfoList(n),b.grid_yearPlan_addShenbaoInfoList(n),n.dialog_addPlan=function(){$("#addPlanList").modal({backdrop:"static",keyboard:!1})},$("#addPlanSearchBtn").keydown(function(){n.search()}),n.search=function(){var a=[];a.push({field:"projectShenBaoStage",operator:"eq",value:common.basicDataConfig().projectShenBaoStage_nextYearPlan}),a.push({field:"processState",operator:"eq",value:common.basicDataConfig().processState_qianShou}),null!=n.search.projectName&&""!=n.search.projectName&&a.push({field:"projectName",operator:"contains",value:n.search.projectName}),null!=n.search.projectIndustry&&""!=n.search.projectIndustry&&a.push({field:"projectIndustry",operator:"eq",value:n.search.projectIndustry}),null!=n.search.planYear&&""!=n.search.planYear&&a.push({field:"planYear",operator:"eq",value:parseInt(n.search.planYear,10)}),null!=n.search.constructionUnit&&""!=n.search.constructionUnit&&a.push({field:"constructionUnit",operator:"contains",value:n.search.constructionUnit}),null!=n.search.auditState&&""!=n.search.auditState&&a.push({field:"auditState",operator:"eq",value:n.search.auditState}),null!=n.search.projectConstrChar&&""!=n.search.projectConstrChar&&a.push({field:"projectConstrChar",operator:"eq",value:n.search.projectConstrChar}),null!=n.search.packageType&&""!=n.search.packageType&&a.push({field:"packageType",operator:"eq",value:n.search.packageType}),n.addPlanGridOptions.dataSource.filter(a)},n.filterClear=function(){n.search.projectName="",n.search.projectIndustry="",n.search.planYear="",n.search.constructionUnit="",n.search.auditState="",n.search.projectConstrChar="",n.search.packageType="";var a=[];a.push({field:"projectShenBaoStage",operator:"eq",value:common.basicDataConfig().projectShenBaoStage_nextYearPlan}),a.push({field:"processState",operator:"eq",value:common.basicDataConfig().processState_qianShou}),n.addPlanGridOptions.dataSource.filter(a)},n.dialogConfirmSubmit=function(){var a=common.getKendoCheckId(".grid");if(0!=a.length){for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");$("#addPlanList").modal("toggle"),b.addShenBaoInfoconfirm(n,e)}},n.popOver=function(a,c){n.currentCapitalId=c,b.getYearPlanCapitalById(n,c),n.isPopOver=!0;var d=$(document).height()-50-230;a.pageY>d&&(a.pageY=d),n.popStyle={left:a.pageX+"px",top:a.pageY+"px"}},n.updateCapital=function(){b.updateYearPlanCapital(n)},n.removeYearPlanCapital=function(){var a=common.getKendoCheckId(".yearPlanCapitalGrid");if(0==a.length)common.alert({vm:n,msg:"请选择数据"});else{for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");b.removeYearPlanCapital(n,e)}},n.exportExcelForYS=function(){b.exportExcelForYS(n)},d.$on("kendoRendered",function(a){var b=n.planGrid;b.table.kendoSortable({filter:">tbody >tr",hint:$.noop,cursor:"move",placeholder:function(a){return a.clone().addClass("k-state-hover").css("opacity",.65)},container:"#planGird tbody",change:function(a){var c=b.dataSource.skip()||0,d=(a.oldIndex+c,a.newIndex+c),e=(b.dataSource.data(),b.dataSource.getByUid(a.item.data("uid")));b.dataSource.remove(e),b.dataSource.insert(d,e)}})})}var n=this;n.model={},n.basicData={},n.title="申报信息编辑",n.search={},n.packageType={},n.id=c.params.id,n.investmentType=c.params.projectInvestmentType,n.stage=c.params.stage,n.page="shenbaoInfoList",n.planYear=2018,f(),g()}angular.module("app").controller("yearPlanCtrl",a),a.$inject=["$location","yearPlanSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a,b){function c(b){for(var c=[],d=0,e=0;e<b.basicData.packageType.length;e++){var f=b.basicData.packageType[e].id,g=f.split("_");c[d+e]=parseInt(g[g.length-1],10)}var h=Math.max.apply(null,c),i=b.basicData.packageType[0].id,j=i.split("_");j[j.length-1]=h+1;var k=j.join("_");b.packageType.id=k,b.packageType.pId=b.basicData.packageType[0].pId,b.packageType.identity=b.basicData.packageType[0].identity,b.packageType.canEdit=b.basicData.packageType[0].canEdit;var l={method:"post",url:G,data:b.packageType},m=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.basicData.packageType.push(b.packageType),b.model.shenBaoInfo.packageType=b.packageType.id,b.isOtherPackageType=!1}})};common.http({vm:b,$http:a,httpOptions:l,success:m})}function d(b){var c={method:"get",url:common.format(F+"?planId={0}",b.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"导出成功！",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(c){common.initJqValidation();var d=$("form").valid();if(d){c.isSubmit=!0,c.model.shenBaoInfo.projectType=common.arrayToString(c.projectTypes,","),c.model.shenBaoInfo.constructionUnit=common.arrayToString(c.constructionUnits,","),c.model.shenBaoInfo.yearInvestApproval=parseFloat(c.model.shenBaoInfo.capitalAP_ggys_TheYear||0)+parseFloat(c.model.shenBaoInfo.capitalAP_gtzj_TheYear||0),c.model.shenBaoInfo.yearInvestApproval_lastYear=parseFloat(c.model.shenBaoInfo.capitalAP_ggys_LastYear||0)+parseFloat(c.model.shenBaoInfo.capitalAP_gtzj_LastYear||0),c.model.shenBaoInfo.yearInvestApproval_lastTwoYear=parseFloat(c.model.shenBaoInfo.capitalAP_ggys_LastTwoYear||0)+parseFloat(c.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear||0),c.model.shenBaoInfo.beginDate=""!=c.model.shenBaoInfo.beginDate?c.model.shenBaoInfo.beginDate:null,c.model.shenBaoInfo.endDate=""!=c.model.shenBaoInfo.endDate?c.model.shenBaoInfo.endDate:null;var e={method:"put",url:common.format(y),data:c.model.shenBaoInfo},f=function(a){common.alert({vm:c,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.isSubmit=!1,c.isAudit&&b.path(E)}})};common.http({vm:c,$http:a,httpOptions:e,success:f})}else common.alert({vm:c,msg:"您填写的信息不正确,请核对后提交!"})}function f(c){common.initJqValidation();var d=$("form").valid();if(d){c.isSubmit=!0,c.model.shenBaoInfo.projectType=common.arrayToString(c.projectTypes,","),c.model.shenBaoInfo.constructionUnit=common.arrayToString(c.constructionUnits,","),c.model.shenBaoInfo.applyYearInvest=common.getSum([c.model.shenBaoInfo.capitalSCZ_ggys_TheYear||0,c.model.shenBaoInfo.capitalSCZ_gtzj_TheYear||0]),c.model.shenBaoInfo.applyYearInvest_LastYear=common.getSum([c.model.shenBaoInfo.capitalSCZ_ggys_LastYear||0,c.model.shenBaoInfo.capitalSCZ_gtzj_LastYear||0]),c.model.shenBaoInfo.applyYearInvest_LastTwoYear=common.getSum([c.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear||0,c.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear||0]),c.model.shenBaoInfo.yearInvestApproval=common.getSum([c.model.shenBaoInfo.capitalAP_ggys_TheYear||0,c.model.shenBaoInfo.capitalAP_gtzj_TheYear||0]),c.model.shenBaoInfo.yearInvestApproval_lastYear=common.getSum([c.model.shenBaoInfo.capitalAP_ggys_LastYear||0,c.model.shenBaoInfo.capitalAP_gtzj_LastYear||0]),c.model.shenBaoInfo.yearInvestApproval_lastTwoYear=common.getSum([c.model.shenBaoInfo.capitalAP_ggys_LastTwoYear||0,c.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear||0]),c.model.shenBaoInfo.beginDate=""!=c.model.shenBaoInfo.beginDate?c.model.shenBaoInfo.beginDate:null,c.model.shenBaoInfo.endDate=""!=c.model.shenBaoInfo.endDate?c.model.shenBaoInfo.endDate:null;var e={method:"post",url:y,data:c.model.shenBaoInfo},f=function(a){common.requestSuccess({vm:c,response:a,fn:function(){common.alert({vm:c,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.isSubmit=!1,b.path(E)}})}})};common.http({vm:c,$http:a,httpOptions:e,success:f})}else common.alert({vm:c,msg:"您填写的信息不正确,请核对后提交!"})}function g(b){var c={method:"get",url:common.format(z+"?$filter=id eq '{0}'",b.model.shenBaoInfo.unitName)},d=function(a){b.model.shenBaoInfo.shenBaoUnitInfoDto=a.data.value[0]||{},b.model.shenBaoInfo.shenBaoUnitInfoDto&&(b.constructionUnits.splice(0,b.constructionUnits.length),b.constructionUnits.push(b.model.shenBaoInfo.shenBaoUnitInfoDto.unitName))};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(D),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='radio'  relId='{0},{1},{2}' name='checkbox'/>",a.number,a.name,a.fullName)},filterable:!1,width:40,title:""},{field:"number",title:"文号",width:180,filterable:!0},{field:"name",title:"文件名",width:550,template:function(a){return common.format("<a href='/contents/upload/{1}'>{0}</a>",a.name,a.fullName)},filterable:!0}];a.gridOptions_documentRecords={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function i(b){var c={method:"post",url:common.format(y+"/addProjectToLibrary?shenbaoInfoId={0}",b.id)},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function j(b){b.model.shenBaoInfo.projectType=common.arrayToString(b.projectTypes,","),b.model.shenBaoInfo.constructionUnit=common.arrayToString(b.constructionUnits,",");var c={method:"put",url:common.format(y+"/updateProjectBasic"),data:b.model.shenBaoInfo},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function k(b){var c={method:"post",url:common.format(y+"/updateState"),data:b.model},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.grid.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function l(b,c){var d={method:"post",url:common.format(A+"/removeCapital?planId={0}&yearPlanCapitalId={1}",b.id,c)},e=function(a){b.planGridOptions.dataSource.read()};common.http({vm:b,$http:a,httpOptions:d,success:e})}function m(b){b.model.capital.capitalSum=common.toDecimal4(parseFloat(b.model.capital.capitalSCZ_ggys||0)+parseFloat(b.model.capital.capitalSCZ_gtzj||0)+parseFloat(b.model.capital.capitalSCZ_zxzj||0)+parseFloat(b.model.capital.capitalQCZ_ggys||0)+parseFloat(b.model.capital.capitalQCZ_gtzj||0)+parseFloat(b.model.capital.capitalSHTZ||0)+parseFloat(b.model.capital.capitalZYYS||0)+parseFloat(b.model.capital.capitalOther||0));var c={method:"put",url:B,data:b.model.capital},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){q(b),$("#capitalSum_"+b.currentCapitalId).val(b.model.capital.capitalSum),b.isPopOver=!1,b.planGridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function n(b,c){var d={method:"get",url:common.format(B+"?$filter=id eq '{0}'",c)},e=function(a){b.model.capital=a.data.value[0]||{},b.model.capital.capitalSCZ_ggys=common.toMoney(b.model.capital.capitalSCZ_ggys),b.model.capital.capitalSCZ_gtzj=common.toMoney(b.model.capital.capitalSCZ_gtzj),b.model.capital.capitalSCZ_zxzj=common.toMoney(b.model.capital.capitalSCZ_zxzj),b.model.capital.capitalQCZ_ggys=common.toMoney(b.model.capital.capitalQCZ_ggys),b.model.capital.capitalQCZ_gtzj=common.toMoney(b.model.capital.capitalQCZ_gtzj),b.model.capital.capitalSHTZ=common.toMoney(b.model.capital.capitalSHTZ),b.model.capital.capitalZYYS=common.toMoney(b.model.capital.capitalZYYS),b.model.capital.capitalOther=common.toMoney(b.model.capital.capitalOther)};common.http({vm:b,$http:a,httpOptions:d,success:e})}function o(b){var c={method:"get",url:common.format(y+"?$filter=id eq '{0}'",b.id)},d=function(a){if(b.model.shenBaoInfo=a.data.value[0]||{},b.shenBaoInfoEdit&&(b.planYear=b.model.shenBaoInfo.planYear),b.shenBaoInfoAdd){b.model.shenBaoInfo.projectInvestmentType=b.investmentType,b.model.shenBaoInfo.projectShenBaoStage=b.stage;var c=new Date;b.planYear=b.model.shenBaoInfo.planYear=parseInt(c.getFullYear()+1,10)}b.model.shenBaoInfo.packageType=b.model.shenBaoInfo.packageType||common.basicDataConfig().packageType_danLie,b.projectTypes=common.stringToArray(b.model.shenBaoInfo.projectType,","),b.constructionUnits=common.stringToArray(b.model.shenBaoInfo.constructionUnit,","),b.constructionUnits.length>1?b.canDelete=!0:b.canDelete=!1,b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH?b.isSHInvestment=!0:b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF&&(b.isZFInvestment=!0),b.model.shenBaoInfo.beginDate=common.formatDate(b.model.shenBaoInfo.beginDate),b.model.shenBaoInfo.endDate=common.formatDate(b.model.shenBaoInfo.endDate),b.model.shenBaoInfo.pifuJYS_date=common.formatDate(b.model.shenBaoInfo.pifuJYS_date),b.model.shenBaoInfo.pifuKXXYJBG_date=common.formatDate(b.model.shenBaoInfo.pifuKXXYJBG_date),b.model.shenBaoInfo.pifuCBSJYGS_date=common.formatDate(b.model.shenBaoInfo.pifuCBSJYGS_date),b.model.shenBaoInfo.projectInvestSum=common.toMoney(b.model.shenBaoInfo.projectInvestSum),b.model.shenBaoInfo.projectInvestAccuSum=common.toMoney(b.model.shenBaoInfo.projectInvestAccuSum),b.model.shenBaoInfo.capitalSCZ_ggys=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys),b.model.shenBaoInfo.capitalSCZ_gtzj=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj),b.model.shenBaoInfo.capitalSCZ_zxzj=common.toMoney(b.model.shenBaoInfo.capitalSCZ_zxzj),b.model.shenBaoInfo.capitalQCZ_ggys=common.toMoney(b.model.shenBaoInfo.capitalQCZ_ggys),b.model.shenBaoInfo.capitalQCZ_gtzj=common.toMoney(b.model.shenBaoInfo.capitalQCZ_gtzj),b.model.shenBaoInfo.capitalZYYS=common.toMoney(b.model.shenBaoInfo.capitalZYYS),b.model.shenBaoInfo.capitalSHTZ=common.toMoney(b.model.shenBaoInfo.capitalSHTZ),b.model.shenBaoInfo.capitalOther=common.toMoney(b.model.shenBaoInfo.capitalOther),b.model.shenBaoInfo.capitalSCZ_gtzj_TheYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj_TheYear),b.model.shenBaoInfo.capitalSCZ_ggys_TheYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys_TheYear),b.model.shenBaoInfo.capitalSCZ_qita=common.toMoney(b.model.shenBaoInfo.capitalSCZ_qita),b.model.shenBaoInfo.capitalSCZ_gtzj_LastYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj_LastYear),b.model.shenBaoInfo.capitalSCZ_ggys_LastYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys_LastYear),b.model.shenBaoInfo.capitalSCZ_qita_LastYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_qita_LastYear),b.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear),b.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear),b.model.shenBaoInfo.capitalSCZ_qita_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalSCZ_qita_LastTwoYear),b.model.shenBaoInfo.apInvestSum=common.toMoney(b.model.shenBaoInfo.apInvestSum),b.model.shenBaoInfo.capitalAP_ggys_TheYear=common.toMoney(b.model.shenBaoInfo.capitalAP_ggys_TheYear),b.model.shenBaoInfo.capitalAP_gtzj_TheYear=common.toMoney(b.model.shenBaoInfo.capitalAP_gtzj_TheYear),b.model.shenBaoInfo.capitalAP_qita=common.toMoney(b.model.shenBaoInfo.capitalAP_qita),b.model.shenBaoInfo.capitalAP_gtzj_LastYear=common.toMoney(b.model.shenBaoInfo.capitalAP_gtzj_LastYear),b.model.shenBaoInfo.capitalAP_ggys_LastYear=common.toMoney(b.model.shenBaoInfo.capitalAP_ggys_LastYear),b.model.shenBaoInfo.capitalAP_qita_LastYear=common.toMoney(b.model.shenBaoInfo.capitalAP_qita_LastYear),b.model.shenBaoInfo.capitalAP_ggys_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalAP_ggys_LastTwoYear),b.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear),b.model.shenBaoInfo.capitalAP_qita_LastTwoYear=common.toMoney(b.model.shenBaoInfo.capitalAP_qita_LastTwoYear),b.capitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_zxzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSHTZ)||0)+(parseFloat(b.model.shenBaoInfo.capitalZYYS)||0)+(parseFloat(b.model.shenBaoInfo.capitalOther)||0);
},b.lastTwoYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_LastTwoYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_LastTwoYear)||0)},b.lastYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_LastYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_LastYear)||0)},b.theYearCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys_TheYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj_TheYear)||0)},b.lastTwoYearAPCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalAP_ggys_LastTwoYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalAP_gtzj_LastTwoYear)||0)},b.lastYearAPCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalAP_ggys_LastYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalAP_gtzj_LastYear)||0)},b.theYearAPCapitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalAP_ggys_TheYear)||0)+(parseFloat(b.model.shenBaoInfo.capitalAP_gtzj_TheYear)||0)},"shenbaoInfoList"==b.page&&b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan&&(b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_YearPlan,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]],b.isYearPlan=!0)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function p(b,c){var d={method:"post",url:common.format(A+"/addCapital/{0}",b.id,c),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),b.planGridOptions.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function q(b){var c={method:"get",url:common.format(A+"?$filter=id eq '{0}'",b.id)},d=function(a){if("plan_update"==b.page&&(b.model=a.data.value[0]||{}),"planBZ"==b.page){b.model.plan=a.data.value[0]||{};var c=b.model.plan.yearPlanCapitalDtos,d=b.planGridOptions.dataSource._data;b.model.shenBaoInfoTotal=d.length,b.model.QianQiTotal=0,b.model.NewStratTotal=0,b.model.XuJianTotal=0,b.model.ChuBeiTotal=0,b.model.projectInvestSumTotal=0,b.model.applyYearInvestTotal=0;for(var e=0;e<d.length;e++){var f=d[e];f.projectConstrChar&&f.projectConstrChar==common.basicDataConfig().projectConstrChar_qianqi&&b.model.QianQiTotal++,f.projectConstrChar&&f.projectConstrChar==common.basicDataConfig().projectConstrChar_xinkaigong&&b.model.NewStratTotal++,f.projectConstrChar&&f.projectConstrChar==common.basicDataConfig().projectConstrChar_xujian&&b.model.XuJianTotal++,f.projectConstrChar&&f.projectConstrChar==common.basicDataConfig().projectConstrChar_chubei&&b.model.ChuBeiTotal++,f.projectInvestSum&&(b.model.projectInvestSumTotal+=f.projectInvestSum),f.applyYearInvest&&(b.model.applyYearInvestTotal+=f.applyYearInvest)}b.model.yearInvestApprovalTotal=0,b.model.capitalSCZ_ggysTotal=0,b.model.capitalSCZ_gtzjTotal=0,b.model.capitalSCZ_zxzjTotal=0,b.model.capitalQCZ_ggysTotal=0,b.model.capitalQCZ_gtzjTotal=0,b.model.capitalZYYSTotal=0,b.model.capitalSHTZTotal=0,b.model.capitalOtherTotal=0;for(var g=0;g<c.length;g++)c[g].capitalSCZ_ggys&&(b.model.capitalSCZ_ggysTotal+=c[g].capitalSCZ_ggys),c[g].capitalSCZ_gtzj&&(b.model.capitalSCZ_gtzjTotal+=c[g].capitalSCZ_gtzj),c[g].capitalSCZ_zxzj&&(b.model.capitalSCZ_zxzjTotal+=c[g].capitalSCZ_zxzj),c[g].capitalQCZ_ggys&&(b.model.capitalQCZ_ggysTotal+=c[g].capitalQCZ_ggys),c[g].capitalQCZ_gtzj&&(b.model.capitalQCZ_gtzjTotal+=c[g].capitalQCZ_gtzj),c[g].capitalZYYS&&(b.model.capitalZYYSTotal+=c[g].capitalZYYS),c[g].capitalSHTZ&&(b.model.capitalSHTZTotal+=c[g].capitalSHTZ),c[g].capitalOther&&(b.model.capitalOtherTotal+=c[g].capitalOther),c[g].capitalSum&&(b.model.yearInvestApprovalTotal+=c[g].capitalSum)}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function r(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(A+"/"+a.id+"/projectList"),schema:common.kendoGridConfig().schema({id:"yearPlanCapitalId"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},requestEnd:function(){q(a)}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll_shenBaoList' type='checkbox'  class='checkbox'/>",headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"constructionUnit",title:"建设单位",width:200,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"projectName",title:"项目名称",template:function(a){return common.format('<a href="#/projectDetails/{0}/{1}" >{2}</a>',a.projectId,a.projectInvestmentType,a.projectName)},width:300,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;",rowspan:2}},{field:"functionSubjects",title:"功能科目",width:80,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"econClassSubjects",title:"经济分类科目",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"projectIndustry",title:"行业领域",template:function(a){return common.getBasicDataDesc(a.projectIndustry)},width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"projectCategory",title:"项目类别",width:80,template:function(a){return common.getBasicDataDesc(a.projectCategory)},filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"projectConstrChar",title:"建设性质",template:function(a){return common.getBasicDataDesc(a.projectConstrChar)},width:80,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"beginDate",title:"开工/竣工时间",width:120,template:function(a){return common.format((common.formatDate(a.beginDate)?common.formatDate(a.beginDate):"")+"~\n"+(common.formatDate(a.endDate)?common.formatDate(a.endDate):""))},filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"projectGuiMo",title:"建设规模及主要建设内容",width:200,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.projectGuiMo||"")},filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"projectInvestSum",title:"总投资（万元）",width:120,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"projectInvestAccuSum",title:"累计完成投资（万元）",width:120,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"apInvestSum",title:"累计安排资金（万元）",width:120,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"yearConstructionContent",width:200,title:a.planYear+"年度建设内容",template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContent||"")},filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{title:a.planYear+"年资金来源及需求(万元)",columns:[{field:"capitalSCZ_ggys_TheYear",title:"公共预算",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;"}},{field:"capitalSCZ_gtzj_TheYear",title:"国土基金",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;"}},{field:"capitalSCZ_qita",title:"其他",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;"}}],headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"yearInvestApproval",title:"安排资金合计",template:function(a){return common.format($("#input").html(),a.id,a.yearInvestApproval||0)},width:130,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{title:"安排资金（万元）",columns:[{field:"capitalAP_ggys_TheYear",title:"公共预算",width:130,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"capitalAP_gtzj_TheYear",title:"国土基金",width:130,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}}],headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"yearConstructionContentLastYear",title:a.planYear+1+"年度建设内容",width:200,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContentLastYear||"")},filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{title:a.planYear+1+"年资金来源及需求(万元)",columns:[{field:"capitalSCZ_ggys_LastYear",title:"公共预算",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"capitalSCZ_gtzj_LastYear",title:"国土基金",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"capitalSCZ_qita_LastYear",title:"其他",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}}],headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"yearConstructionContentLastTwoYear",title:a.planYear+2+"年度建设内容",width:200,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContentLastTwoYear||"")},filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{title:a.planYear+2+"年资金来源及需求(万元)",columns:[{field:"capitalSCZ_ggys_LastTwoYear",title:"公共预算",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"capitalSCZ_gtzj_LastTwoYear",title:"国土基金",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"capitalSCZ_qita_LastTwoYear",title:"其他",width:100,filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}}],headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}},{field:"yearConstructionContentShenBao",title:"备注",width:150,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:10px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContentShenBao||"")},filterable:!1,headerAttributes:{"class":"table-header-cell",style:"text-align: center;vertical-align: middle;"}}],d=function(b){for(var c=a.planGrid.dataSource.data(),d=b.workbook.sheets[0],e=this.columns[8].template,f=0;f<c.length;f++){var g=e(c[f]),h=d.rows[f+2];h.cells[4].value=a.getBasicDataDesc(h.cells[4].value),h.cells[5].value=a.getBasicDataDesc(h.cells[5].value),h.cells[6].value=a.getBasicDataDesc(h.cells[6].value),h.cells[7].value=g}};a.planGridOptions={excel:{fileName:"年度计划编制.xlsx"},dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,scrollable:!0,excelExport:d}}function s(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(y),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"projectIndustry",dir:"desc"},filter:[{field:"projectShenBaoStage",operator:"eq",value:common.basicDataConfig().projectShenBaoStage_nextYearPlan},{field:"processState",operator:"eq",value:common.basicDataConfig().processState_qianShou}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"planYear",title:"计划年度",width:80,filterable:!1},{field:"projectName",title:"项目名称",width:300,filterable:!0},{field:"constructionUnit",title:"建设单位",width:200,filterable:!0},{field:"projectConstrChar",title:"建设性质",width:120,template:function(a){return common.getBasicDataDesc(a.projectConstrChar)},filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectConstrChar,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"projectIndustry",title:"项目行业",template:function(a){return common.getBasicDataDesc(a.projectIndustry)},width:120,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.projectIndustry_ZF,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"auditState",title:"审批状态",template:function(a){return common.getBasicDataDesc(a.auditState)},width:100,filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.auditState,dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"projectInvestSum",title:"总投资（万元）",width:120,filterable:!1},{field:"applyYearInvest",title:"申请年度投资（万元）",width:150,filterable:!1},{field:"createdDate",title:"创建日期",width:180,filterable:!1,template:function(a){return common.formatDateTime(a.createdDate)}}];a.addPlanGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}function t(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"post",url:A,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=C}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function u(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"put",url:A,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=C}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function v(b,c){b.isSubmit=!0;var d={method:"delete",url:A,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功!",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.gridOptions.dataSource.read()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function w(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(A),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"编制名称",filterable:!0},{field:"year",title:"计划年度",width:150,filterable:!1},{field:"createdDate",title:"创建日期",width:180,filterable:!1,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}},{field:"",title:"操作",width:200,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,a.projectShenBaoStage,"vm.deletePlan('"+a.id+"')")}}];a.gridOptions={excel:{fileName:"年度计划项目库.xlsx"},dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,sortable:!0,scrollable:!0}}function x(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(y),schema:common.kendoGridConfig().schema({id:"id",fields:{isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"projectIndustry",dir:"desc"},filter:[{field:"projectShenBaoStage",operator:"eq",value:common.basicDataConfig().projectShenBaoStage_nextYearPlan},{field:"processState",operator:"eq",value:common.basicDataConfig().processState_qianShou}],change:function(){var a=$(".grid").data("kendoGrid");window.yearPlanListOptions=a.getOptions()}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='javascript:void(0)' ng-click='vm.dialog_shenbaoInfo(\"{0}\")'>{1}</a>",a.id,a.projectName)},width:200,filterable:!0,attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}},{field:"constructionUnit",title:"建设单位",width:200,filterable:!0,attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}},{field:"projectConstrChar",title:"建设性质",width:105,template:function(a){return common.getBasicDataDesc(a.projectConstrChar)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),dataTextField:"description",dataValueField:"id",filter:"startswith"})}},attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}},{field:"projectCategory",title:"项目类别",width:105,template:function(a){return common.getBasicDataDesc(a.projectCategory)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),dataTextField:"description",dataValueField:"id"})}},attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}},{field:"projectIndustry",title:"项目行业",width:120,template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),dataTextField:"description",dataValueField:"id",filter:"startswith"})}},attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}},{field:"planYear",title:"计划年度",width:100,filterable:!1,attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}},{field:"auditState",title:"审核状态",width:100,template:function(a){return common.getBasicDataDesc(a.auditState)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().auditState),dataTextField:"description",dataValueField:"id",filter:"startswith"})}},attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}},{filed:"",title:"操作",width:150,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,a.projectShenBaoStage)},attributes:{style:"font-size: 14.5px"},headerAttributes:{style:"text-align:center;font-size: 14.5px"}}],d=function(a){for(var b=(a.data,a.workbook.sheets[0]),c=1;c<b.rows.length;c++){var d=b.rows[c];d.cells[2].value=common.getBasicDataDesc(d.cells[2].value),d.cells[3].value=common.getBasicDataDesc(d.cells[3].value),d.cells[4].value=common.getBasicDataDesc(d.cells[4].value),d.cells[6].value=common.getBasicDataDesc(d.cells[6].value),d.cells[7].value=common.formatDateTime(d.cells[7].value)}};null!=window.yearPlanListOptions&&""!=window.yearPlanListOptions?a.gridOptions=window.yearPlanListOptions:a.gridOptions={excel:{fileName:"年度计划项目库.xlsx"},dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,excelExport:d,resizable:!0,sortable:!0,scrollable:!0}}var y="/management/shenbao",z="/management/userUnit",A="/management/yearPlan",B="/management/yearPlanCapital",C="#/yearPlan/planList",D="/management/replyFile",E="/yearPlan/shenbaoInfoList",F="/common/exportExcel",G="/management/basicData",H={grid_shenbaoInfoList:x,updateShenBaoInfoState:k,addProjectToLibrary:i,updateShenBaoInfo:e,createShenBaoInfo:f,updateProject:j,grid_planList:w,plan_create:t,plan_update:u,plan_delete:v,getPlanById:q,grid_yearPlan_shenbaoInfoList:r,grid_yearPlan_addShenbaoInfoList:s,addShenBaoInfoconfirm:p,getShenBaoInfoById:o,getYearPlanCapitalById:n,updateYearPlanCapital:m,removeYearPlanCapital:l,documentRecordsGird:h,getUserUnit:g,exportExcelForYS:d,savePackageType:c};return H}angular.module("app").factory("yearPlanSvc",a),a.$inject=["$http","$location"]}();