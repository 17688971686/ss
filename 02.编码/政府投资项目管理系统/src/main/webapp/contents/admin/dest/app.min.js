!function(){"use strict";function a(){$("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form")}function b(a){var b="发生错误,系统已记录,我们会尽快处理！";void 0!=a.response&&(401==a.response.status&&(location.href=A.loginUrl),b=a.response.data.message||b),A.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})}function c(a){console.log(a);var b=function(b){A.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(a.response.status>400)b("发生错误！");else{var c=a.response.data;c&&555==c.status?b(c.message):a.fn&&a.fn(c)}}function d(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a}function e(a){var b=a.toString().replace(/[^0-9]/g,"");return parseInt(b,10)}function f(a){return isNaN(parseFloat(a,10))?0:parseFloat(a,10)}function g(){return $(window).height()-180}function h(a){a.vm.alertDialogMessage=a.msg,a.vm.alertDialogFn=function(){a.fn?a.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})}function i(a){a.vm.dialogConfirmTitle=a.title,a.vm.dialogConfirmMessage=a.msg,$(".confirmDialog").modal({backdrop:"static"}),a.vm.dialogConfirmSubmit=a.fn}function j(a,b){null==b&&(b=""),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(window.location.href);return null==d?b:d[1]}function k(){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0},schema:function(a){return{data:"value",total:function(a){return a.count},model:a}},transport:function(a){return{read:{url:a,dataType:"json",type:"GET",beforeSend:function(a){a.setRequestHeader("Token",A.getToken())}}}},noRecordMessage:{template:"暂时没有数据."}}}function l(a){var b=$(a).find("tr td:nth-child(1)").find("input:checked"),c=[];return b.each(function(){var a=$(this).attr("relId");c.push({name:"id",value:a})}),c}function m(a){a.headers={Token:A.getToken()},a.$http(a.httpOptions).then(a.success,function(b){common.requestError({vm:a.vm,response:b})})}function n(){var a={get:function(a,b){var c=this.getAll(a);return c?c[b]:null},getAll:function(a){var b=encodeURIComponent(a)+"=",c=document.cookie.indexOf(b),d=null,e={};if(c>-1){var f=document.cookie.indexOf(";",c);if(f==-1&&(f=document.cookie.length),d=document.cookie.substring(c+b.length,f),d.length>0){for(var g=d.split("&"),h=0,i=g.length;h<i;h++){var j=g[h].split("=");e[decodeURIComponent(j[0])]=decodeURIComponent(j[1])}return e}}return null},set:function(a,b,c,d,e,f,g){var h=this.getAll(a)||{};h[b]=c,this.setAll(a,h,d,e,f,g)},setAll:function(a,b,c,d,e,f){var g=encodeURIComponent(a)+"=",h=new Array;for(var i in b)i.length>0&&b.hasOwnProperty(i)&&h.push(encodeURIComponent(i)+"="+encodeURIComponent(b[i]));h.length>0?(g+=h.join("&"),c instanceof Date&&(g+=";expires="+c.toGMTString()),d&&(g+=";path="+d),e&&(g+=";domain="+e),f&&(g+=";secure")):g+=";expires="+new Date(0).toGMTString(),document.cookie=g},unset:function(a,b,c,d,e){var f=this.getAll(a);f&&(delete f[b],this.setAll(a,f,null,c,d,e))},unsetAll:function(a,b,c,d){this.setAll(a,null,new Date(0),b,c,d)}};return a}function o(){var a=n().getAll("data");return null!=a?a.token:""}function p(a){return a.error=function(a){401==a.status&&(location.href=A.loginUrl)},a}function q(){return window.global_basicData?window.global_basicData:($.ajax({url:"/common/basicData/all",async:!1,success:function(a){window.global_basicData=a}}),window.global_basicData)}function r(a){var b=$linq(common.getBasicData()).where(function(b){return b.id==a}).firstOrDefault();return b?b.description:""}function s(a){var b=$linq(this.getBasicData()).where(function(b){return b.identity==a&&b.pId==a}).toArray();return b?b:""}function t(a){return a?new Date(a):null}function u(a){return a?a:0}function v(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd"):null}function w(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd HH:mm:ss"):null}function x(){return{uploadSize:5242880,processState_waitQianShou:"processState_1",processState_qianShou:"processState_2",processState_banJie:"processState_7",processState_tuiWen:"processState_11",projectShenBaoStage:"projectShenBaoStage",projectShenBaoStage_nextYearPlan:"projectShenBaoStage_7",projectCategory:"projectCategory",projectCategory_A:"projectCategory_1",projectCategory_B:"projectCategory_2",projectCategory_C:"projectCategory_3",projectCategory_D:"projectCategory_4",projectClassify:"projectClassify",projectClassify_ZF:"projectClassify_1",projectClassify_SH:"projectClassify_2",projectConstrChar:"projectConstrChar",projectConstrChar_qianqi:"projectConstrChar_1",projectConstrChar_xinkaigong:"projectConstrChar_2",projectConstrChar_xujian:"projectConstrChar_3",projectFunctionClassify:"projectFunctionClassify",projectGoverEconClassify:"projectGoverEconClassify",projectInvestmentType:"projectInvestmentType",projectInvestmentType_ZF:"projectInvestmentType_1",projectInvestmentType_SH:"projectInvestmentType_2",projectIndustry:"projectIndustry",projectIndustry_ZF:"projectIndustry_1",projectIndustry_SH:"projectIndustry_2",projectInvestmentType:"projectInvestmentType",projectProgress:"projectProgress",projectStage:"projectStage",projectType:"projectType",approvalType:"approvalType",unitProperty:"unitProperty",area:"area",area_GM:"area_1",capitalOtherType:"capitalOtherType",taskType:"taskType",taskType_monthReport:"taskType_1",taskType_yearPlan:"taskType_2",taskType_sendMesg:"taskType_3"}}function y(a,b,c){if(a){var d=a.length;d>b?$("#"+c).html("<font size='5'>0</font>"):d<=b&&$("#"+c).html("<font size='5'>"+(b-d)+"</font>")}else $("#"+c).html("<font size='5'>"+b+"</font>")}function z(){$(document).on("click","#checkboxAll",function(){var a=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),$("body").on("click",".grid tr",function(a){$(this).parent().find("tr").removeClass("selected"),$(this).addClass("selected")})}var A={initJqValidation:a,requestError:b,requestSuccess:c,format:d,blockNonNumber:e,floatNumberInput:f,adminContentHeight:g,alert:h,confirm:i,getQuerystring:j,kendoGridConfig:k,getKendoCheckId:l,cookie:n,getToken:o,appPath:"",http:m,gridDataSource:p,loginUrl:"/",getBasicData:q,getBasicDataDesc:r,getBacicDataByIndectity:s,toDate:t,toMoney:u,formatDate:v,formatDateTime:w,basicDataConfig:x,checkLength:y};window.common=A,z()}(),function(){"use strict";angular.module("app",["ui.router","kendo.directives","textAngular"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",templateUrl:"/admin/welcome.html",controller:"roleCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("portal",{url:"/portal/:type",templateUrl:"/management/portal/html/list",controller:"portalCtrl",controllerAs:"vm"}).state("portalEdit",{url:"/portal/:type/:id",templateUrl:"/management/portal/html/edit",controller:"portalCtrl",controllerAs:"vm"}).state("monthReport",{url:"/monthReport",templateUrl:"/management/monthReport/html/list",controller:"monthReportCtrl",controllerAs:"vm"}).state("monthReportChange",{url:"/monthReportChange/:projectId/:year/:month",templateUrl:"/management/monthReport/html/changeDetails",controller:"monthReportCtrl",controllerAs:"vm"}).state("monthReport_details",{url:"/monthReport/:projectId/:year/:month",templateUrl:"/management/monthReport/html/details",controller:"monthReportCtrl",controllerAs:"vm"}).state("project",{url:"/project",templateUrl:"/management/project/html/list.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectEdit",{url:"/projectEdit/:id/:projectInvestmentType",templateUrl:"/management/project/html/edit.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectDetails",{url:"/projectDetails/:id/:projectInvestmentType",templateUrl:"/management/project/html/details.html",controller:"projectCtrl",controllerAs:"vm"}).state("unitManagement",{url:"/unitManagement",templateUrl:"/unitManagement/html/list.html",controller:"unitManagementCtrl",controllerAs:"vm"}).state("unitManagementEdit",{url:"/unitManagementEdit/:id",templateUrl:"/unitManagement/html/edit.html",controller:"unitManagementEditCtrl",controllerAs:"vm"}).state("basicData",{url:"/basicData",templateUrl:"/management/basicData/html/index",controller:"basicDataCtrl",controllerAs:"vm"}).state("sysConfig",{url:"/sysConfig",templateUrl:"/sys/html/index",controller:"sysConfigCtrl",controllerAs:"vm"}).state("yearPlan_shenbaoInfoList",{url:"/yearPlan/shenbaoInfoList",templateUrl:"/management/yearPlan/html/shenbaoInfoList",controller:"yearPlanCtrl",controllerAs:"vm"}).state("yearPlan_planList",{url:"/yearPlan/planList",templateUrl:"/management/yearPlan/html/planList",controller:"yearPlanCtrl",controllerAs:"vm"}).state("yearPlan_planEdit",{url:"/yearPlan/planEdit/:id",templateUrl:"/management/yearPlan/html/planEdit",controller:"yearPlanCtrl",controllerAs:"vm"}).state("yearPlan_planBZ",{url:"/yearPlan/planBZ/:id",templateUrl:"/management/yearPlan/html/planBZ",controller:"yearPlanCtrl",controllerAs:"vm"}).state("task_todo",{url:"/task/todo",templateUrl:"/management/task/html/todo",controller:"taskCtrl",controllerAs:"vm"}).state("task_handle",{url:"/task/todo/:taskType/:taskId/:relId",templateUrl:"/management/task/html/handle",controller:"taskCtrl",controllerAs:"vm"}).state("task_complete",{url:"/task/complete",templateUrl:"/management/task/html/complete",controller:"taskCtrl",controllerAs:"vm"})}])}(),function(){"use strict";function a(a,b){function c(){$("#datepicker").kendoDatePicker({culture:"zh-CN"})}function d(){$("#files").kendoUpload({async:{saveUrl:"/demo/save",removeUrl:"/demo/remove",autoUpload:!0}}),$("#files2").kendoUpload({async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},showFileList:!1,select:function(a){console.log("select:"),console.log(a)},error:function(a){if(console.log("error:"),console.log(a),200==a.XMLHttpRequest.status){var b=a.XMLHttpRequest.response;alert("文件名："+b)}},localization:{select:"选择文件"}})}function e(){c(),d(),b.treeList(f),f.init_select()}var f=this;f.title="",f.tabActive=1,f.tab=function(a){f.tabActive=a},f.showDialog=function(){$(".myDialog").modal({backdrop:"static",keyboard:!1})},f.setCookie=function(){common.cookie().set("myCookie","userName",f.cookie.userName),common.cookie().set("myCookie","password",f.cookie.password)},f.getCookie=function(){var a=common.cookie().get("myCookie","userName"),b=common.cookie().get("myCookie","password");alert(common.format("用户名:{0},密码:{1}",a,b))},f.textSubmit=function(){alert(f.content)},f.init_select=function(){f.parentCategory="",f.childCategory="";var a=common.getBasicData();f.parentList=$linq(a).where(function(a){return"projectIndustry"==a.identity&&""==a.pId}).toArray(),f.parentChange=function(){f.childList=$linq(a).where(function(a){return a.pId==f.parentCategory}).toArray()}},f.popOver=function(a){f.isPopOver=!0,f.popStyle={border:"1px solid #ccc",height:"200px",width:"120px",position:"absolute",background:"white",left:a.pageX+"px",top:a.pageY+"px"},f.content="内容"},e()}angular.module("app").controller("demoCtrl",a),a.$inject=["$location","demoSvc"]}(),function(){"use strict";function a(a){function b(a){var b="https://demos.telerik.com/kendo-ui/service",c={transport:{read:{url:b+"/EmployeeDirectory/All",dataType:"jsonp"}},schema:{model:{id:"EmployeeId",parentId:"ReportsTo",fields:{EmployeeId:{type:"number",editable:!1,nullable:!1},ReportsTo:{nullable:!0,type:"number"},FirstName:{validation:{required:!0}},LastName:{validation:{required:!0}},HireDate:{type:"date"},Phone:{type:"string"},BirthDate:{type:"date"},Extension:{type:"number",validation:{min:0,required:!0}},Position:{type:"string"}}}}},d=[{field:"FirstName",title:"First Name",width:"150px"},{field:"LastName",title:"Last Name",width:"150px"},{field:"Position"},{title:"Location",template:"{{ dataItem.City }}, {{ dataItem.Country }}"},{command:["edit"]}];a.treelistOptions={dataSource:c,columns:d}}function c(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var e={method:"put",url:d,data:b.model.password},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}}var d="/account/password",e={upload:c,treeList:b};return e}angular.module("app").factory("demoSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b){function c(){}var d=this;d.title="",d.changePwd=function(){b.changePwd(d)},c()}angular.module("app").controller("homeCtrl",a),a.$inject=["$location","homeSvc"]}(),function(){"use strict";function a(a){function b(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0;var e={method:"put",url:c,data:b.model.password},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}}var c="/account/password",d={changePwd:b};return d}angular.module("app").factory("homeSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="日志列表",c()}angular.module("app").controller("logCtrl",a),a.$inject=["$location","logSvc"]}(),function(){"use strict";function a(a,b){function c(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(d),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"id",title:"ID",width:80,filterable:!1},{field:"level",title:"级别",width:100,filterable:!0},{field:"message",title:"日志内容",filterable:!1},{field:"userId",title:"操作者",width:150,filterable:!0},{field:"createdDate",title:"操作时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var d="/log",e={grid:c};return e}angular.module("app").factory("logSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="部门列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteOrg(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("app").controller("orgCtrl",a),a.$inject=["$location","orgSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate&&b.getOrgById(e)}var e=this;e.title="新增部门",e.isorgExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新部门"),e.create=function(){b.createOrg(e)},e.update=function(){b.updateOrg(e)},d()}angular.module("app").controller("orgEditCtrl",a),a.$inject=["$location","orgSvc","$state"]}(),function(){"use strict";function a(a,b,c,d){function e(){c.getOrgById(f),d.orgUserGrid(f),d.allUserGrid(f)}var f=this;f.id=b.params.id,f.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),f.orgUserGrid.dataSource.read()},f.closeAddUserDialog=function(){$(".addUser").modal("hide")},f.add=function(a){d.add(f,a)},f.remove=function(a){d.remove(f,a)},f.removes=function(){var a=common.getKendoCheckId(".orgUserGrid");if(0==a.length)common.alert({vm:f,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");f.remove(d)}},e()}angular.module("app").controller("orgUserCtrl",a),a.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function a(a,b){function c(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"orgIdentity",title:"部门标识",width:200,filterable:!1},{field:"name",title:"部门名称",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:280,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function d(b){common.initJqValidation();var c=$("form").valid();if(c&&0==b.isorgExist){b.isSubmit=!0;var d={method:"post",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function e(b){var c={method:"get",url:common.format(h+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{},b.isUpdate};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){common.initJqValidation();var c=$("form").valid();if(c&&0==b.isorgExist){b.isSubmit=!0,b.model.id=b.id;var d={method:"put",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function g(b,c){b.isSubmit=!0;var d={method:"delete",url:h,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}var h="/org",i="#/org",j={grid:c,createOrg:d,getOrgById:e,updateOrg:f,deleteOrg:g};return j}angular.module("app").factory("orgSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(b,c){var d={method:"delete",url:common.format(h,b.id),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(b,c){var d={method:"post",url:common.format(h,b.id),data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.orgUserGrid.dataSource.read(),b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(g,a.id)),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(a){return common.format($("#allUserGridBtns").html(),"vm.add('"+a.id+"')",a.id)}}];a.orgUserGrid={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(h,a.id)),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.remove('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var g="/org/{0}/userNotIn",h="/org/{0}/users",i={orgUserGrid:f,allUserGrid:e,add:d,remove:c};return i}angular.module("app").factory("orgUserSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="角色列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteRole(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("app").controller("roleCtrl",a),a.$inject=["$location","roleSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate?b.getRoleById(e):b.initZtreeClient(e)}var e=this;e.title="添加角色",e.isRoleExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新角色"),e.create=function(){b.createRole(e)},e.update=function(){b.updateRole(e)},e.checkRole=function(){b.checkRole(e)},d()}angular.module("app").controller("roleEditCtrl",a),a.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function a(a,b){function c(){var a=$.fn.zTree.getZTreeObj("zTree"),b=a.getCheckedNodes(!0);return b}function d(a){for(var b=$.fn.zTree.getZTreeObj("zTree"),c=$linq(a.model.resources).select(function(a){return a.path}).toArray(),d=b.getNodesByParam("level",1,null),e=$linq(d).where(function(a){return $linq(c).contains(a.path)}).toArray(),f=0,g=e.length;f<g;f++)b.checkNode(e[f],!0,!0)}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(b){common.initJqValidation();var d=$("form").valid();if(d&&0==b.isRoleExist){b.isSubmit=!0;var e=c(),f=$linq(e).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,name:a.name,path:a.path,method:a.method}}).toArray();b.model.resources=f;var g={method:"post",url:l,data:b.model},h=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=m}})}})};common.http({vm:b,$http:a,httpOptions:g,success:h})}}function g(a){}function h(b){var c={method:"get",url:common.format(l+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.isUpdate&&k(b)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function i(b){common.initJqValidation();var d=$("form").valid();if(d&&0==b.isRoleExist){b.isSubmit=!0,b.model.id=b.id;var e=c(),f=$linq(e).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,name:a.name,path:a.path,method:a.method}}).toArray();b.model.resources=f;var g={method:"put",url:l,data:b.model},h=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:g,success:h})}}function j(b,c){b.isSubmit=!0;var d={method:"delete",url:l,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function k(b){var c={method:"get",url:n},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){var c,e={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},f=a.data;c=$.fn.zTree.init($("#zTree"),e,f),b.isUpdate&&d(b)}})};common.http({vm:b,$http:a,httpOptions:c,success:e})}var l="/role",m="#/role",n="/sys/resource",o={grid:e,createRole:f,checkRole:g,getRoleById:h,updateRole:i,deleteRole:j,initZtreeClient:k};return o}angular.module("app").factory("roleSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b){function c(){b.grid(d)}var d=this;d.title="用户列表",d.del=function(a){common.confirm({vm:d,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteUser(d,a)}})},d.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:d,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var e=b.join(",");d.del(e)}},c()}angular.module("app").controller("userCtrl",a),a.$inject=["$location","userSvc"]}(),function(){"use strict";function a(a,b,c){function d(){e.isUpdate?b.getUserById(e):b.initZtreeClient(e)}var e=this;e.model={},e.title="添加用户",e.isuserExist=!1,e.id=c.params.id,e.id&&(e.isUpdate=!0,e.title="更新用户"),e.create=function(){b.createUser(e)},e.update=function(){b.updateUser(e)},e.initPassword=function(a){var b=$("#initPassword").is(":checked");b?(e.model.password="888888",e.model.passwordConfirm="888888"):(e.model.password="",e.model.passwordConfirm="")},d()}angular.module("app").controller("userEditCtrl",a),a.$inject=["$location","userSvc","$state"]}(),function(){"use strict";function a(a){function b(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id;var d=h(),e=$linq(d).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,roleName:a.name}}).toArray();b.model.roles=e;var f={method:"put",url:j,data:b.model},g=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:f,success:g})}}function c(b,c){b.isSubmit=!0;var d={method:"delete",url:j,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d=h(),e=$linq(d).where(function(a){return 0==a.isParent}).select(function(a){return{id:a.id,roleName:a.name}}).toArray();b.model.roles=e;var f={method:"post",url:j,data:b.model},g=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=k}})}})};common.http({vm:b,$http:a,httpOptions:f,success:g})}}function e(b){var c={method:"get",url:l},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){var c,d={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},e=$linq(a.data.value).select(function(a){return{id:a.id,name:a.roleName}}).toArray(),f={id:"",name:"角色集合",children:e};c=$.fn.zTree.init($("#zTree"),d,f),b.isUpdate&&i(b)}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(j+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.isUpdate&&e(b)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(j),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),"vm.del('"+a.id+"')",a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function h(){var a=$.fn.zTree.getZTreeObj("zTree"),b=a.getCheckedNodes(!0);return b}function i(a){for(var b=$.fn.zTree.getZTreeObj("zTree"),c=$linq(a.model.roles).select(function(a){return a.roleName}).toArray(),d=b.getNodesByParam("level",1,null),e=$linq(d).where(function(a){return $linq(c).contains(a.name)}).toArray(),f=0,g=e.length;f<g;f++)b.checkNode(e[f],!0,!0)}var j="/user",k="#/user",l="/role",m={grid:g,getUserById:f,initZtreeClient:e,createUser:d,deleteUser:c,updateUser:b};return m}angular.module("app").factory("userSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d){function e(){var a,c=common.getBasicData(),d={view:{nameIsHTML:!0,addHoverDom:function(a,d){if(0!=d.level&&d.canEdit){var e=$("#"+d.tId+"_span");if(d.editNameFlag||$("#addBtn_"+d.tId).length>0)return;var f="<span class='button add' id='addBtn_"+d.tId+"' title='添加子节点' onfocus='this.blur();'></span>";e.after(f);var h=$("#addBtn_"+d.tId);h&&h.bind("click",function(){window.global_basicData=null,c=common.getBasicData();var a,e,f=$.fn.zTree.getZTreeObj("zTree"),h=$linq(c).where(function(a){return a.pId==d.id}).select(function(a){return{id:a.id}}).toArray();if(h.length>0){for(var i=[],j=0,k=0;k<h.length;k++){var l=h[k].id,m=l.split("_");i[j+k]=parseInt(m[m.length-1])}var n=Math.max.apply(null,i);a=h[0].id,e=a.replace(a[a.length-1],n+1)}else a=d.id,e=a+"_1";var o={
id:e,name:"请编辑命名",identity:d.identity,pId:d.id,canEdit:!0};f.addNodes(d,o),g.model.id=o.id,g.model.description=o.name,g.model.identity=o.identity,g.model.pId=o.pId,g.model.canEdit=o.canEdit,b.createBasicData(g)})}},removeHoverDom:function(a,b){$("#addBtn_"+b.tId).unbind().remove()},showIcon:!0,selectedMulti:!0},edit:{enable:!0,showRenameBtn:function(a,b){return!(0==b.level||!b.canEdit)},showRemoveBtn:function(a,b){return!(b.isParent||!b.canEdit)},removeTitle:"删除",renameTitle:"编辑"},callback:{onRename:function(a,c,d){g.model.id=d.id,g.model.description=d.name,g.model.identity=d.identity,g.model.pId=d.pId,b.updateBasicData(g)},onRemove:function(a,c,d){b.deleteBasicData(g,d.id)}}},e=function(a){return $linq(c).where(function(b){return b.pId==a}).select(function(a){return{id:a.id,name:a.description,pId:a.pId,identity:a.identity,canEdit:a.canEdit,children:e(a.id)}}).toArray()},f=$linq(c).where(function(a){return""==a.pId}).select(function(a){return{id:a.id,name:common.format("{0}{1}",a.description,a.canEdit?"":'<span style="color:red">[不可编辑]</span>'),pId:a.pId,canEdit:a.canEdit,identity:a.identity,children:e(a.id)}}).toArray(),h={id:"",name:"基础数据",children:f};a=$.fn.zTree.init($("#zTree"),d,h)}function f(){g.init()}var g=this;g.init=function(){g.model={},e()},f()}angular.module("app").controller("basicDataCtrl",a),a.$inject=["$location","basicDataSvc","$state","$scope"]}(),function(){"use strict";function a(a,b){function c(b){var c={method:"put",url:f,data:b.model},d=function(a){common.requestSuccess({vm:b,response:a})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b,c){var d={method:"delete",url:f,data:c},e=function(a){common.requestSuccess({vm:b,response:a})};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(b){var c={method:"post",url:f,data:b.model},d=function(a){common.requestSuccess({vm:b,response:a})};common.http({vm:b,$http:a,httpOptions:c,success:d})}var f="/management/basicData",g={createBasicData:e,deleteBasicData:d,updateBasicData:c};return g}angular.module("app").factory("basicDataSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d){function e(){g.init(),"list"==g.page&&b.grid(g),"details"==g.page&&f(),"changeDetails"==g.page&&f()}function f(){b.getProjectById(g),g.model.isReportExist=!1,g.createProblem=function(){g.model.monthReport.monthReportProblemDtos?g.model.monthReport.monthReportProblemDtos.push({problemIntroduction:"",solutionsAndSuggest:""}):g.model.monthReport.monthReportProblemDtos=[{problemIntroduction:"",solutionsAndSuggest:""}]},g.deleteProblem=function(a){g.model.monthReport.monthReportProblemDtos.splice(a,1)},g.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){g.model.monthReport.attachmentDtos?g.model.monthReport.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):g.model.monthReport.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},g.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:g,msg:"上传文件过大！"})})})},g.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:g.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:g.onSelect},g.delFile=function(a){g.model.monthReport.attachmentDtos.splice(a,1)},g.basicData_approvalType=$linq(common.getBasicData()).where(function(a){return"approvalType"==a.identity&&"approvalType"==a.pId}).toArray(),g.basicData_projectProgress=$linq(common.getBasicData()).where(function(a){return"projectProgress"==a.identity&&"projectProgress"==a.pId}).toArray(),g.uploadType=[["scenePicture","现场图片"],["other","其它材料"]],g.submit=function(){b.submitMonthReport(g)},g.change=function(){location.href="#/monthReportChange/"+g.projectId+"/"+g.year+"/"+g.month},g.befor=function(){g.model.display=!0,b.getProjectById(g)},g.back=function(a){location.href="#/monthReport"}}var g=this;g.projectId=c.params.projectId,g.year=c.params.year,g.month=c.params.month,g.model={},g.page="list",g.model.display=!1,g.init=function(){"monthReport_details"==c.current.name?g.page="details":"monthReportChange"==c.current.name&&(g.page="changeDetails"),g.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},g.checkLength=function(a,b,c){common.checkLength(a,b,c)}},e()}angular.module("app").controller("monthReportCtrl",a),a.$inject=["$location","monthReportSvc","$state","$scope"]}(),function(){"use strict";function a(a,b,c){function d(b){var c={method:"get",url:common.format(g+"?$filter=id eq '{0}'",b.projectId)},d=function(a){if(b.model.projectInfo=a.data.value[0]||{},"details"==b.page||"changeDetails"==b.page){var c=$linq(b.model.projectInfo.monthReportDtos).where(function(a){return a.submitYear==b.year&&a.submitMonth==b.month}).toArray();if(c.length>0){if(1==b.model.display)for(var d=0;d<c.length;d++)0==c[d].isLatestVersion&&(b.model.monthReport=c[d]);else for(var e=0;e<c.length;e++)1==c[e].isLatestVersion&&(b.model.monthReport=c[e]);b.model.monthReport.pifuJYS_date=common.toDate(b.model.projectInfo.pifuJYS_date),b.model.monthReport.pifuKXXYJBG_date=common.toDate(b.model.projectInfo.pifuKXXYJBG_date),b.model.monthReport.pifuCBSJYGS_date=common.toDate(b.model.projectInfo.pifuCBSJYGS_date),b.model.monthReport.beginDate=common.formatDate(b.model.monthReport.beginDate),b.model.monthReport.endDate=common.formatDate(b.model.monthReport.endDate),b.model.monthReport.invertPlanTotal=common.toMoney(b.model.monthReport.invertPlanTotal),b.model.monthReport.actuallyFinishiInvestment=common.toMoney(b.model.monthReport.actuallyFinishiInvestment),b.model.monthReport.thisYearPlanInvestment=common.toMoney(b.model.monthReport.thisYearPlanInvestment),b.model.monthReport.thisYearAccumulatedInvestment=common.toMoney(b.model.monthReport.thisYearAccumulatedInvestment),b.model.monthReport.thisMonthInvestTotal=common.toMoney(b.model.monthReport.thisMonthInvestTotal),b.model.monthReport.firstQuarCompInvestment=common.toMoney(b.model.monthReport.firstQuarCompInvestment),b.model.monthReport.secondQuarCompInvestment=common.toMoney(b.model.monthReport.secondQuarCompInvestment),b.model.monthReport.thirdQuarCompInvestment=common.toMoney(b.model.monthReport.thirdQuarCompInvestment),b.model.monthReport.fourthQuarCompInvestment=common.toMoney(b.model.monthReport.fourthQuarCompInvestment)}}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(b){common.initJqValidation();var d=$("form").valid();if(d){b.model.monthReport.submitYear=b.year,b.model.monthReport.submitMonth=b.month,b.model.monthReport.projectId=b.projectId;var e={method:"post",url:h,data:b.model.monthReport},f=function(a){b.model.isReportExist=!0,b.model.isSubmit=!1,common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path(i)}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}}function f(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(g),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isLatestVersion",operator:"eq",value:!0}}),c=[{field:"projectName",title:"项目名称",template:function(a){return common.format('<a href="#/projectDetails/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"",title:"填报月份",template:function(a){var b="";return a.monthReportDtos.forEach(function(a,c){b+=common.format('<a class="btn btn-xs btn-success" ng-show="{3}" href="#/monthReport/{0}/{1}/{2}">{1}年{2}月</a> ',a.projectId,a.submitYear,a.submitMonth,a.isLatestVersion)}),b},width:800,filterable:!1}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var g="/management/project",h="/management/monthReport",i="/monthReport",j={grid:f,getProjectById:d,submitMonthReport:e};return j}angular.module("app").factory("monthReportSvc",a),a.$inject=["$http","$compile","$location"]}(),function(){"use strict";function a(a,b,c,d){function e(){f.init(),"list"==f.page&&b.grid(f),"update"==f.page&&b.getById(f),"create"!=f.page&&"update"!=f.page||f.init_upload()}var f=this;f.type=c.params.type,f.id=c.params.id,f.init=function(){switch(f.type){case"tzgg":f.title="通知公告";break;case"zcfg":f.title="政策法规";break;case"bszn":f.title="办事指南";break;case"cybg":f.title="常用表格"}switch(f.id){case void 0:f.page="list";break;case"":f.page="create";break;default:f.page="update"}},f.init_upload=function(){f.files=[],$("#files").kendoUpload({async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},showFileList:!1,select:function(a){console.log("select:"),console.log(a)},success:function(a){},error:function(a){if(console.log("error:"),console.log(a),200==a.XMLHttpRequest.status){var b=a.XMLHttpRequest.response;d.$apply(function(){f.files.push(b)})}},localization:{select:"上传文件"}})},f.delFile=function(a){f.files.splice(a,1)},f.del=function(a){common.confirm({vm:f,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.del(f,a)}})},f.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:f,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");f.del(d)}},f.create=function(){b.create(f)},f.update=function(){b.update(f)},e()}angular.module("app").controller("portalCtrl",a),a.$inject=["$location","portalSvc","$state","$scope"]}(),function(){"use strict";function a(a,b){function c(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"type",operator:"eq",value:a.type}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"title",title:"标题",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0,b.model.type=b.type,b.model.files=b.files.join(";");var d={method:"post",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i+b.type}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function e(b){var c={method:"get",url:common.format(h+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0],b.model.files&&(b.files=b.model.files.split(";"))};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c=$("form").valid();if(c){b.isSubmit=!0,b.model.id=b.id,b.model.files=b.files.join(";");var d={method:"put",url:h,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function g(b,c){b.isSubmit=!0;var d={method:"delete",url:h,data:c},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){b.isSubmit=!1,b.gridOptions.dataSource.read()}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}var h="/management/portal",i="#/portal/",j={grid:c,create:d,getById:e,update:f,del:g};return j}angular.module("app").factory("portalSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d){function e(){"projectEdit"==c.current.name&&(k.page="create"),k.id&&(k.page="update"),"projectDetails"==c.current.name&&(k.page="details"),k.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},k.checkLength=function(a,b,c){common.checkLength(a,b,c)}}function f(){"list"==k.page&&g(),"create"==k.page&&(k.model.projectType=[],h()),"update"==k.page&&(h(),i()),"details"==k.page&&j()}function g(){b.grid(k),k.basicData.investmentType=common.getBacicDataByIndectity(common.basicDataConfig().projectInvestmentType),k.addProject=function(){$("#myModal_add").modal({backdrop:"static",keyboard:!1})},k.confirmInvestmentType=function(){$(".modal-backdrop").remove(),a.path("/projectEdit//"+k.model.projectInvestmentType)},k.model.projectInvestmentType=common.basicDataConfig().projectInvestmentType_ZF,k.isMonthReport=function(a,b){k.model.isMonthReport=b,k.model.id=a,$("#myModal_edit").modal({backdrop:"static",keyboard:!1})},k.updateIsMonthReport=function(){b.updateIsMonthReport(k)},k.del=function(a){common.confirm({vm:k,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),b.deleteProject(k,a)}})},k.dels=function(){var a=common.getKendoCheckId(".grid");if(0==a.length)common.alert({vm:k,msg:"请选择数据"});else{for(var b=[],c=0;c<a.length;c++)b.push(a[c].value);var d=b.join(",");k.del(d)}}}function h(){k.model.projectInvestmentType=k.projectInvestmentType,k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(k.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),k.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),k.isZFInvestment=!0):k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(k.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),k.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),k.projectIndustryChange=function(){k.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==k.model.projectIndustryParent}).toArray()},k.isSHInvestment=!0),b.getUserUnits(k),k.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),k.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),k.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),k.basicData.capitalOther=common.getBacicDataByIndectity(common.basicDataConfig().capitalOtherType),k.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),k.updateSelection=function(a){var b=k.model.projectType.indexOf(a);b==-1?k.model.projectType.push(a):k.model.projectType.splice(b,1)},k.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]],k.relatedType=[["XMJYSPF","项目建议书批复文件"],["KXXYJBGPF","可行性研究报告批复文件"],["ZGSPFTZ","总概算批复及调整文件"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]],k.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){k.model.attachmentDtos?k.model.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):k.model.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},k.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:k,msg:"上传文件过大！"})})})},k.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.delFile=function(a){k.model.attachmentDtos.splice(a,1)},k.capitalTotal=function(){return(parseFloat(k.model.capitalSCZ_ggys)||0)+(parseFloat(k.model.capitalSCZ_gtzj)||0)+(parseFloat(k.model.capitalSCZ_zxzj)||0)+(parseFloat(k.model.capitalQCZ_ggys)||0)+(parseFloat(k.model.capitalQCZ_gtzj)||0)+(parseFloat(k.model.capitalSHTZ)||0)+(parseFloat(k.model.capitalZYYS)||0)+(parseFloat(k.model.capitalOther)||0)},k.create=function(){k.model.projectType=k.model.projectType.join(","),b.createProject(k)}}function i(){k.title="编辑项目",b.getProjectById(k),k.update=function(){k.model.projectType=k.model.projectType.join(","),b.updateProject(k)}}function j(){b.getProjectById(k),k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?k.isZFInvestment=!0:k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(k.isSHInvestment=!0),k.relatedType=[["XMJYSPF","项目建议书批复文件"],["KXXYJBGPF","可行性研究报告批复文件"],["ZGSPFTZ","总概算批复及调整文件"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]]}var k=this;k.title="新增项目",k.model={},k.basicData={},k.id=c.params.id,k.projectInvestmentType=c.params.projectInvestmentType,k.page="list",e(),f()}angular.module("app").controller("projectCtrl",a),a.$inject=["$location","projectSvc","$state","$scope"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:common.format(j+"?$filter=userName eq '{0}'",b.model.unitName)},d=function(a){b.userUnit=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(b){var c={method:"get",url:j},d=function(a){b.userUnits=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"post",url:i,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=k}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else b.model.projectType=b.model.projectType.split(",")}function e(b){var c={method:"put",url:i+"/isMonthReport",data:b.model},d=function(a){$("#myModal_edit").modal("hide"),b.gridOptions.dataSource.read()};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"put",url:i,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=k}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else b.model.projectType=b.model.projectType.split(","),common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function g(c){var d={method:"get",url:common.format(i+"?$filter=id eq '{0}'",c.id)},e=function(a){if(c.model=a.data.value[0]||{},b(c),""!=c.model.projectType&&null!=c.model.projectType?c.model.projectType=c.model.projectType.split(","):c.model.projectType=[],c.model.beginDate=common.formatDate(c.model.beginDate),c.model.endDate=common.formatDate(c.model.endDate),c.model.pifuJYS_date=common.formatDate(c.model.pifuJYS_date),c.model.pifuKXXYJBG_date=common.formatDate(c.model.pifuKXXYJBG_date),c.model.pifuCBSJYGS_date=common.formatDate(c.model.pifuCBSJYGS_date),c.model.projectInvestSum=common.toMoney(c.model.projectInvestSum),c.model.projectInvestAccuSum=common.toMoney(c.model.projectInvestAccuSum),c.model.capitalSCZ_ggys=common.toMoney(c.model.capitalSCZ_ggys),c.model.capitalSCZ_gtzj=common.toMoney(c.model.capitalSCZ_gtzj),c.model.capitalSCZ_zxzj=common.toMoney(c.model.capitalSCZ_zxzj),c.model.capitalQCZ_ggys=common.toMoney(c.model.capitalQCZ_ggys),c.model.capitalQCZ_gtzj=common.toMoney(c.model.capitalQCZ_gtzj),c.model.capitalZYYS=common.toMoney(c.model.capitalZYYS),c.model.capitalSHTZ=common.toMoney(c.model.capitalSHTZ),c.model.capitalOther=common.toMoney(c.model.capitalOther),"update"==c.page&&c.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var d=$linq(common.getBasicData()).where(function(a){return a.id==c.model.projectIndustry}).toArray()[0];c.model.projectIndustryParent=d.pId,c.projectIndustryChange()}"details"==c.page&&(c.capitalTotal=function(){return(parseFloat(c.model.capitalSCZ_ggys)||0)+(parseFloat(c.model.capitalSCZ_gtzj)||0)+(parseFloat(c.model.capitalSCZ_zxzj)||0)+(parseFloat(c.model.capitalQCZ_ggys)||0)+(parseFloat(c.model.capitalQCZ_gtzj)||0)+(parseFloat(c.model.capitalSHTZ)||0)+(parseFloat(c.model.capitalZYYS)||0)+(parseFloat(c.model.capitalOther)||0)})};common.http({vm:c,$http:a,httpOptions:d,success:e})}function h(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(i),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isLatestVersion",operator:"eq",value:!0}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectNumber",title:"项目代码",width:180,filterable:!1},{field:"projectName",title:"项目名称",template:function(a){return common.format("<a href='#/projectDetails/{0}/{1}'>{2}</a>",a.id,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"projectStage",title:"项目阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:!1},{field:"projectClassify",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1},{field:"isMonthReport",title:"是否月报",template:function(a){return a.isMonthReport?"是":a.isMonthReport?void 0:"否"},width:150,filterable:!1},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,"vm.isMonthReport('"+a.id+"','"+a.isMonthReport+"')")}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var i="/management/project",j="/management/userUnit",k="#/project",l={grid:h,getProjectById:g,getUserUnits:c,updateProject:f,createProject:d,updateIsMonthReport:e};return l}angular.module("app").factory("projectSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d){function e(){h(),g(),f()}function f(){b.getSysConfigs(i);for(var a=0;a<i.model.taskList.length;a++)i.model.checkedButton[a]=!0;i.checked=function(a){for(var b=0;b<i.model.checkedButton.length;b++)a==b&&(i.model.checkedButton[b]=!1)},i.userChange=function(a,b){i.model.taskList[a].taskUser=b,i.hasChange=!0},i.create=function(){b.createTaskUser(i)}}function g(){b.getAllUser(i)}function h(){b.getAllTask(i)}var i=this;i.title="",i.model={},i.model.config=[],i.model.checkedButton=[],e()}angular.module("app").controller("sysConfigCtrl",a),a.$inject=["$location","sysConfigSvc","$state","$scope"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:h,data:b.model},d=function(a){b.userTaskList=a.data;for(var c=0;c<b.userTaskList.length;c++)for(var d=0;d<b.model.taskList.length;d++)b.userTaskList[c].configName==b.model.taskList[d].id&&b.userTaskList[c].configType==common.basicDataConfig().taskType&&(b.userTaskList[c].configName==common.basicDataConfig().taskType_monthReport||b.userTaskList[c].configName==common.basicDataConfig().taskType_yearPlan?b.model.taskList[d].taskUser=b.userTaskList[c].configValue:b.userTaskList[c].configName==common.basicDataConfig().taskType_sendMesg&&(b.model.taskList[d].taskEnable=b.userTaskList[c].enable))};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(b){var c=[];for(var d in b.model.taskList)c.push({configName:b.model.taskList[d].id,configValue:b.model.taskList[d].taskUser,enable:b.model.config[d].enable});var e={method:"post",url:g,data:c},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.reload()}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}function d(b){var c={method:"get",url:f,data:b.model},d=function(a){b.userList=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(a){a.model.taskList=common.getBacicDataByIndectity(common.basicDataConfig().taskType)}var f="/user",g="/sys/create",h="/sys/getSysConfigs",i={getAllUser:d,getAllTask:e,createTaskUser:c,getSysConfigs:b};return i}angular.module("app").factory("sysConfigSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d){function e(){"task_todo"==c.current.name&&(j.page="todoList"),"task_handle"==c.current.name&&(j.page="handle"),"task_complete"==c.current.name&&(j.page="complete"),j.formatDate=function(a){return common.formatDate(a)},j.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},j.checkLength=function(a,b,c){common.checkLength(a,b,c)}}function f(){e(),"todoList"==j.page&&g(),"handle"==j.page&&i(),"complete"==j.page&&h()}function g(){b.grid(j)}function h(){b.completeGird(j)}function i(){j.processState_qianShou=common.basicDataConfig().processState_qianShou,j.processState_tuiWen=common.basicDataConfig().processState_tuiWen,b.getTaskById(j),j.taskType==common.basicDataConfig().taskType_yearPlan?(j.isYearPlan=!0,b.getShenBaoInfoById(j)):j.taskType==common.basicDataConfig().taskType_monthReport&&(j.isMonthReport=!0,b.getMonthReportById(j)),j.dialog_shenbaoInfo=function(){$("#shenbaoInfo").modal({backdrop:"static",keyboard:!1}),j.tabStripOptions={}},j.handle=function(a){common.initJqValidation();var c=$("form").valid();c&&(j.isSubmit=!0,j.model.taskRecord.processState=a,b.handle(j))}}var j=this;j.title="",j.model={},j.taskType=c.params.taskType,j.taskId=c.params.taskId,j.relId=c.params.relId,j.page="todoList",f()}angular.module("app").controller("taskCtrl",a),a.$inject=["$location","taskSvc","$state","$scope"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:common.format(m+"?$filter=id eq '{0}'",b.model.monthReport.projectId)},d=function(a){b.model.project=a.data.value[0]||{},""!=b.model.project.projectType&&void 0!=b.model.project.projectType?b.model.project.projectType=b.model.project.projectType.split(","):b.model.project.projectType=[]};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(c){var d={method:"get",url:common.format(l+"?$filter=id eq '{0}'",c.relId)},e=function(a){c.model.monthReport=a.data.value[0]||{},b(c),c.model.monthReport.beginDate=common.formatDate(c.model.monthReport.beginDate),c.model.monthReport.endDate=common.formatDate(c.model.monthReport.endDate),c.uploadType=[["scenePicture","现场图片"],["other","其它材料"]]};common.http({vm:c,$http:a,httpOptions:d,success:e})}function d(b){var c={method:"get",url:common.format(k+"?$filter=id eq '{0}'",b.relId)},d=function(a){b.model.shenBaoInfo=a.data.value[0]||{},""!=b.model.shenBaoInfo.projectType?b.model.shenBaoInfo.projectType=b.model.shenBaoInfo.projectType.split(","):b.model.shenBaoInfo.projectType=[],b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH?b.isSHInvestment=!0:b.model.shenBaoInfo.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF&&(b.isZFInvestment=!0),b.model.shenBaoInfo.beginDate=common.formatDate(b.model.shenBaoInfo.beginDate),b.model.shenBaoInfo.endDate=common.formatDate(b.model.shenBaoInfo.endDate),b.model.shenBaoInfo.pifuJYS_date=common.formatDate(b.model.shenBaoInfo.pifuJYS_date),b.model.shenBaoInfo.pifuKXXYJBG_date=common.formatDate(b.model.shenBaoInfo.pifuKXXYJBG_date),b.model.shenBaoInfo.pifuCBSJYGS_date=common.formatDate(b.model.shenBaoInfo.pifuCBSJYGS_date),b.model.shenBaoInfo.projectInvestSum=common.toMoney(b.model.shenBaoInfo.projectInvestSum),b.model.shenBaoInfo.projectInvestAccuSum=common.toMoney(b.model.shenBaoInfo.projectInvestAccuSum),b.model.shenBaoInfo.capitalSCZ_ggys=common.toMoney(b.model.shenBaoInfo.capitalSCZ_ggys),b.model.shenBaoInfo.capitalSCZ_gtzj=common.toMoney(b.model.shenBaoInfo.capitalSCZ_gtzj),b.model.shenBaoInfo.capitalSCZ_zxzj=common.toMoney(b.model.shenBaoInfo.capitalSCZ_zxzj),b.model.shenBaoInfo.capitalQCZ_ggys=common.toMoney(b.model.shenBaoInfo.capitalQCZ_ggys),b.model.shenBaoInfo.capitalQCZ_gtzj=common.toMoney(b.model.shenBaoInfo.capitalQCZ_gtzj),b.model.shenBaoInfo.capitalZYYS=common.toMoney(b.model.shenBaoInfo.capitalZYYS),b.model.shenBaoInfo.capitalSHTZ=common.toMoney(b.model.shenBaoInfo.capitalSHTZ),b.model.shenBaoInfo.capitalOther=common.toMoney(b.model.shenBaoInfo.capitalOther),b.capitalTotal=function(){return(parseFloat(b.model.shenBaoInfo.capitalSCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSCZ_zxzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_ggys)||0)+(parseFloat(b.model.shenBaoInfo.capitalQCZ_gtzj)||0)+(parseFloat(b.model.shenBaoInfo.capitalSHTZ)||0)+(parseFloat(b.model.shenBaoInfo.capitalZYYS)||0)+(parseFloat(b.model.shenBaoInfo.capitalOther)||0)},b.model.shenBaoInfo.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan&&(b.materialsType=[["XXJD","项目工程形象进度及年度资金需求情况"],["WCJSNR","年度完成建设内容及各阶段工作内容完成时间表"],["TTJH","历年政府投资计划下大文件(*)"],["GCXKZ","建设工程规划许可证"],["TDQK","土地落实情况、征地拆迁有关情况"],["XMJZ","项目进展情况相关资料"],["QQGZJH","前期工作计划文件"],["XMSSYJ","项目实施依据文件"],["HYJY","会议纪要"]],b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]],b.isYearPlan=!0)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function e(b){var c={method:"put",url:i+"/"+b.taskId,data:b.model.taskRecord},d=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=n}})}})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(i+"?$filter=id eq '{0}'",b.taskId)},d=function(a){b.task=a.data.value[0]||{},b.task&&(b.task.taskTypeDesc=common.getBasicDataDesc(b.task.taskType),b.task.isComplete&&(b.isComplete=!0))};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(i),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isComplete",operator:"eq",value:!1},requestEnd:function(a){$("#todoNumber").html(a.response.count)}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!0,template:function(a){return common.format("<a href='#/task/todo/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.id,a.relId);
}},{field:"taskType",title:"任务类型",width:180,filterable:!1,template:function(a){return common.getBasicDataDesc(a.taskType)}},{field:"",title:"创建日期",width:180,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function h(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(j),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"title",title:"标题",filterable:!0,template:function(a){return common.format("<a href='#/task/todo/{1}/{2}/{3}'>{0}</a>",a.title,a.taskType,a.taskId,a.relId)}},{field:"taskType",title:"任务类型",width:180,filterable:!1,template:function(a){var b=$linq(common.getBasicData()).where(function(b){return b.id==a.taskType}).firstOrDefault();return b?b.description:""}},{field:"",title:"创建日期",width:180,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];a.gridOptions_complete={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var i="/management/task",j="/management/taskRecord",k="/management/shenbao",l="/management/monthReport",m="/management/project",n="#/task/todo",o={grid:g,completeGird:h,getTaskById:f,getShenBaoInfoById:d,getMonthReportById:c,handle:e};return o}angular.module("app").factory("taskSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){"yearPlan_planList"==c.current.name&&(m.page="planList"),"yearPlan_planEdit"==c.current.name&&(m.page="plan_create"),"yearPlan_planEdit"==c.current.name&&m.id&&(m.page="plan_update"),"yearPlan_planBZ"==c.current.name&&(m.page="planBZ"),m.checkLength=function(a,b,c){common.checkLength(a,b,c)}}function g(){"shenbaoInfoList"==m.page&&h(),"planList"==m.page&&i(),"plan_create"==m.page&&j(),"plan_update"==m.page&&(m.isPlanEdit=!0,k()),"planBZ"==m.page&&l()}function h(){b.grid_shenbaoInfoList(m),m.dialog_shenbaoInfo=function(a){b.getShenBaoInfoById(m,a),$("#shenbaoInfo").modal({backdrop:"static",keyboard:!1}),m.tabStripOptions={}}}function i(){b.grid_planList(m)}function j(){m.create=function(){b.plan_create(m)}}function k(){b.getPlanById(m),m.update=function(){b.plan_update(m)}}function l(){b.grid_yearPlan_shenbaoInfoList(m),b.grid_yearPlan_addShenbaoInfoList(m),m.dialog_addPlan=function(){$("#addPlanList").modal({backdrop:"static",keyboard:!1})},m.dialogConfirmSubmit=function(){var a=common.getKendoCheckId(".grid");if(0!=a.length){for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");$("#addPlanList").modal("toggle"),b.addShenBaoInfoconfirm(m,e)}},m.popOver=function(a,c){m.currentCapitalId=c,b.getYearPlanCapitalById(m,c),m.isPopOver=!0;var d=$(document).height()-50-230;a.pageY>d&&(a.pageY=d),m.popStyle={left:a.pageX+"px",top:a.pageY+"px"}},m.updateCapital=function(a){b.updateYearPlanCapital(m)},m.removeYearPlanCapital=function(){var a=common.getKendoCheckId(".yearPlanCapitalGrid");if(0==a.length)common.alert({vm:m,msg:"请选择数据"});else{for(var c=[],d=0;d<a.length;d++)c.push(a[d].value);var e=c.join(",");b.removeYearPlanCapital(m,e)}}}var m=this;m.model={},m.id=c.params.id,m.page="shenbaoInfoList",f(),g()}angular.module("app").controller("yearPlanCtrl",a),a.$inject=["$location","yearPlanSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a){function b(b,c){var d={method:"post",url:common.format(o+"/removeCapital?planId={0}&yearPlanCapitalId={1}",b.id,c)},e=function(a){b.planGridOptions.dataSource.read()};common.http({vm:b,$http:a,httpOptions:d,success:e})}function c(b){b.model.capital.capitalSum=parseFloat(b.model.capital.capitalSCZ_ggys||0)+parseFloat(b.model.capital.capitalSCZ_gtzj||0)+parseFloat(b.model.capital.capitalSCZ_zxzj||0)+parseFloat(b.model.capital.capitalQCZ_ggys||0)+parseFloat(b.model.capital.capitalQCZ_gtzj||0)+parseFloat(b.model.capital.capitalSHTZ||0)+parseFloat(b.model.capital.capitalZYYS||0)+parseFloat(b.model.capital.capitalOther||0);var c={method:"put",url:p,data:b.model.capital},d=function(a){g(b),$("#capitalSum_"+b.currentCapitalId).val(b.model.capital.capitalSum),b.isPopOver=!1};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b,c){var d={method:"get",url:common.format(p+"?$filter=id eq '{0}'",c)},e=function(a){b.model.capital=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:d,success:e})}function e(b,c){var d={method:"get",url:common.format(n+"?$filter=id eq '{0}'",c)},e=function(a){return b.model.shenBaoInfo=a.data.value[0]||{},b.model.shenBaoInfo.projectInvestSum?b.model.shenBaoInfo.projectInvestSum:0};common.http({vm:b,$http:a,httpOptions:d,success:e})}function f(b,c){var d={method:"get",url:common.format(o+"/addCapital?planId={0}&shenBaoId={1}",b.id,c)},e=function(a){b.planGridOptions.dataSource.read()};common.http({vm:b,$http:a,httpOptions:d,success:e})}function g(b){var c={method:"get",url:common.format(o+"?$filter=id eq '{0}'",b.id)},d=function(a){if("plan_update"==b.page&&(b.model=a.data.value[0]||{}),"planBZ"==b.page){b.model.plan=a.data.value[0]||{};var c=b.model.plan.yearPlanCapitalDtos,d=b.planGridOptions.dataSource._data;b.model.shenBaoInfoTotal=d.length,b.model.QianQiTotal=0,b.model.NewStratTotal=0,b.model.XuJianTotal=0,b.model.projectInvestSumTotal=0,b.model.applyYearInvestTotal=0,b.model.yearInvestApprovalTotal=0;for(var e=0;e<d.length;e++){var f=d[e];f.projectConstrChar&&f.projectConstrChar==common.basicDataConfig().projectConstrChar_qianqi&&b.model.QianQiTotal++,f.projectConstrChar&&f.projectConstrChar==common.basicDataConfig().projectConstrChar_xinkaigong&&b.model.NewStratTotal++,f.projectConstrChar&&f.projectConstrChar==common.basicDataConfig().projectConstrChar_xujian&&b.model.XuJianTotal++,f.projectInvestSum&&(b.model.projectInvestSumTotal+=f.projectInvestSum),f.applyYearInvest&&(b.model.applyYearInvestTotal+=f.applyYearInvest),f.yearInvestApproval&&(b.model.yearInvestApprovalTotal+=f.yearInvestApproval)}b.model.capitalSCZ_ggysTotal=0,b.model.capitalSCZ_gtzjTotal=0,b.model.capitalSCZ_zxzjTotal=0,b.model.capitalQCZ_ggysTotal=0,b.model.capitalQCZ_gtzjTotal=0,b.model.capitalZYYSTotal=0,b.model.capitalSHTZTotal=0,b.model.capitalOtherTotal=0;for(var g=0;g<c.length;g++)c[g].capitalSCZ_ggys&&(b.model.capitalSCZ_ggysTotal+=c[g].capitalSCZ_ggys),c[g].capitalSCZ_gtzj&&(b.model.capitalSCZ_gtzjTotal+=c[g].capitalSCZ_gtzj),c[g].capitalSCZ_zxzj&&(b.model.capitalSCZ_zxzjTotal+=c[g].capitalSCZ_zxzj),c[g].capitalQCZ_ggys&&(b.model.capitalQCZ_ggysTotal+=c[g].capitalQCZ_ggys),c[g].capitalQCZ_gtzj&&(b.model.capitalQCZ_gtzjTotal+=c[g].capitalQCZ_gtzj),c[g].capitalZYYS&&(b.model.capitalZYYSTotal+=c[g].capitalZYYS),c[g].capitalSHTZ&&(b.model.capitalSHTZTotal+=c[g].capitalSHTZ),c[g].capitalOther&&(b.model.capitalOtherTotal+=c[g].capitalOther)}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o+"/"+a.id+"/projectList"),schema:common.kendoGridConfig().schema({id:"yearPlanCapitalId"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:1e3,sort:{field:"createdDate",dir:"desc"},requestEnd:function(){g(a)}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"shenBaoUnitInfoDto.unitName",title:"建设单位",width:120,template:function(a){return common.format(a.shenBaoUnitInfoDto.unitName)},filterable:!1},{field:"projectName",title:"项目名称",template:function(a){return common.format('<a href="#/projectDetails/{0}/{1}" >{2}</a>',a.projectId,a.projectInvestmentType,a.projectName)},width:200,filterable:!1},{field:"functionSubjects",title:"功能科目",width:110,filterable:!1},{field:"econClassSubjects",title:"经济分类科目",width:140,filterable:!1},{field:"projectIndustryDesc",title:"行业领域",template:function(a){return common.getBasicDataDesc(a.projectIndustry)},width:100,filterable:!1},{field:"projectCategoryDesc",title:"项目类别",width:80,template:function(a){return common.getBasicDataDesc(a.projectCategory)},filterable:!1},{field:"projectConstrCharDesc",title:"建设性质",template:function(a){return common.getBasicDataDesc(a.projectConstrChar)},width:80,filterable:!1},{field:"beginDate",title:"开工/竣工时间",width:100,template:function(a){return a.projectCategory==common.basicDataConfig().projectCategory_A?common.formatDate(a.endDate):a.projectCategory==common.basicDataConfig().projectCategory_B||a.projectCategory==common.basicDataConfig().projectCategory_C||a.projectCategory==common.basicDataConfig().projectCategory_D?common.formatDate(a.beginDate):void 0},filterable:!1},{field:"projectGuiMo",title:"建设规模及主要建设内容",width:120,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.projectGuiMo)},filterable:!1},{field:"yearConstructionTask",title:"本年度建设任务",width:120,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionTask)},filterable:!1},{field:"projectInvestSum",title:"总投资（万元）",width:120,filterable:!1},{field:"projectInvestAccuSum",title:"已拨付资金（万元）",width:145,filterable:!1},{field:"planYear",title:"计划年度",width:100,filterable:!1},{field:"yearConstructionContent",title:"本年度建设内容",width:120,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContent)},filterable:!1},{field:"applyYearInvest",title:"申请年度投资（万元）",filterable:!1},{field:"yearInvestApproval",title:"安排资金（万元）",template:function(a){return common.format($("#input").html(),a.id,a.yearInvestApproval||0)},width:130,filterable:!1},{field:"remark",title:"备注",width:150,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:10px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.remark)},filterable:!1}],d=function(a){for(var b=a.data,c=a.workbook.sheets[0],d=this.columns[8].template,e=0;e<b.length;e++)for(var f=d(b[e]),g=1;g<c.rows.length;g++){var h=c.rows[g];h.cells[7].value=f}};a.planGridOptions={excel:{fileName:"年度计划编制.xlsx"},dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,excelExport:d}}function i(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"projectShenBaoStage",operator:"eq",value:common.basicDataConfig().projectShenBaoStage_nextYearPlan},{field:"processState",operator:"eq",value:common.basicDataConfig().processState_qianShou}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectName",title:"项目名称",width:200,filterable:!0},{field:"projectConstrCharDesc",title:"建设性质",width:150,template:function(a){return common.getBasicDataDesc(a.projectConstrChar)},filterable:!1},{field:"planYear",title:"计划年度",width:150,filterable:!1},{field:"projectClassifyDesc",title:"项目分类",template:function(a){return common.getBasicDataDesc(a.projectClassify)},width:150,filterable:!1},{field:"projectInvestSum",title:"总投资（万元）",width:150,filterable:!1},{field:"applyYearInvest",title:"申请年度投资（万元）",width:150,filterable:!1},{field:"createdDate",title:"创建日期",width:180,filterable:!1,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}];a.addPlanGridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function j(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"post",url:o,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=q}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function k(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"put",url:o,data:b.model},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=q}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function l(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"name",title:"编制名称",filterable:!0},{field:"year",title:"计划年度",width:150,filterable:!1},{field:"createdDate",title:"创建日期",width:180,filterable:!1,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id)}}];a.gridOptions={excel:{fileName:"年度计划项目库.xlsx"},dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function m(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"projectShenBaoStage",operator:"eq",value:common.basicDataConfig().projectShenBaoStage_nextYearPlan},{field:"processState",operator:"eq",value:common.basicDataConfig().processState_qianShou}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectName",title:"项目名称",template:function(a){return common.format('<a href="#/projectDetails/{0}/{1}" >{2}</a>',a.projectId,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"projectConstrCharDesc",title:"建设性质",width:150,template:function(a){return common.getBasicDataDesc(a.projectConstrChar)},filterable:!1},{field:"planYear",title:"计划年度",width:150,filterable:!1},{field:"projectClassifyDesc",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1},{field:"projectInvestSum",title:"总投资",width:150,filterable:!1},{field:"applyYearInvest",title:"申请年度投资",width:150,filterable:!1},{field:"createdDate",title:"创建日期",width:180,filterable:!1,template:function(a){return kendo.toString(new Date(a.createdDate),"yyyy/MM/dd HH:mm:ss")}}],d=function(a){for(var b=a.workbook.sheets[0],c=1;c<b.rows.length;c++){var d=b.rows[c];d.cells[6].value=common.formatDateTime(d.cells[6].value)}};a.gridOptions={excel:{fileName:"年度计划项目库.xlsx"},dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,excelExport:d,resizable:!0}}var n="/management/shenbao",o="/management/yearPlan",p="/management/yearPlanCapital",q="#/yearPlan/planList",r={grid_shenbaoInfoList:m,grid_planList:l,plan_create:j,plan_update:k,getPlanById:g,grid_yearPlan_shenbaoInfoList:h,grid_yearPlan_addShenbaoInfoList:i,addShenBaoInfoconfirm:f,getShenBaoInfoById:e,getYearPlanCapitalById:d,updateYearPlanCapital:c,removeYearPlanCapital:b};return r}angular.module("app").factory("yearPlanSvc",a),a.$inject=["$http"]}();