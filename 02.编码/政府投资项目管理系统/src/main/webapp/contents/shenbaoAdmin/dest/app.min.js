!function(){"use strict";function a(){$("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form")}function b(a){var b="发生错误,系统已记录,我们会尽快处理！";void 0!=a.response&&(401==a.response.status&&(location.href=I.loginUrl),b=a.response.data.message||b),I.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})}function c(a){console.log(a);var b=function(b){I.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(a.response.status>400)b("发生错误！");else{var c=a.response.data;c&&555==c.status?b(c.message):a.fn&&a.fn(c)}}function d(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a}function e(a){var b=a.toString().replace(/[^0-9]/g,"");return parseInt(b,10)}function f(a){return isNaN(parseFloat(a,10))?0:parseFloat(a,10)}function g(){return $(window).height()-180}function h(a){a.vm.alertDialogMessage=a.msg,a.vm.alertDialogFn=function(){a.fn?a.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})}function i(a){a.vm.dialogConfirmTitle=a.title,a.vm.dialogConfirmMessage=a.msg,$(".confirmDialog").modal({backdrop:"static"}),a.vm.dialogConfirmSubmit=a.fn}function j(a,b){null==b&&(b=""),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(window.location.href);return null==d?b:d[1]}function k(){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0},schema:function(a){return{data:"value",total:function(a){return a.count},model:a}},transport:function(a){return{read:{url:a,dataType:"json",type:"GET",beforeSend:function(a){a.setRequestHeader("Token",I.getToken())}}}},noRecordMessage:{template:"暂时没有数据."}}}function l(a){var b=$(a).find("tr td:nth-child(1)").find("input:checked"),c=[];return b.each(function(){var a=$(this).attr("relId");c.push({name:"id",value:a})}),c}function m(a){a.headers={Token:I.getToken()},a.$http(a.httpOptions).then(a.success,function(b){common.requestError({vm:a.vm,response:b})})}function n(){var a={get:function(a,b){var c=this.getAll(a);return c?c[b]:null},getAll:function(a){var b=encodeURIComponent(a)+"=",c=document.cookie.indexOf(b),d=null,e={};if(c>-1){var f=document.cookie.indexOf(";",c);if(f==-1&&(f=document.cookie.length),d=document.cookie.substring(c+b.length,f),d.length>0){for(var g=d.split("&"),h=0,i=g.length;h<i;h++){var j=g[h].split("=");e[decodeURIComponent(j[0])]=decodeURIComponent(j[1])}return e}}return null},set:function(a,b,c,d,e,f,g){var h=this.getAll(a)||{};h[b]=c,this.setAll(a,h,d,e,f,g)},setAll:function(a,b,c,d,e,f){var g=encodeURIComponent(a)+"=",h=[];for(var i in b)i.length>0&&b.hasOwnProperty(i)&&h.push(encodeURIComponent(i)+"="+encodeURIComponent(b[i]));h.length>0?(g+=h.join("&"),c instanceof Date&&(g+=";expires="+c.toGMTString()),d&&(g+=";path="+d),e&&(g+=";domain="+e),f&&(g+=";secure")):g+=";expires="+new Date(0).toGMTString(),document.cookie=g},unset:function(a,b,c,d,e){var f=this.getAll(a);f&&(delete f[b],this.setAll(a,f,null,c,d,e))},unsetAll:function(a,b,c,d){this.setAll(a,null,new Date(0),b,c,d)}};return a}function o(){var a=n().getAll("data");return null!=a?a.token:""}function p(a){return a.error=function(a){401==a.status&&(location.href=I.loginUrl)},a}function q(){return window.global_basicData?window.global_basicData:($.ajax({url:"/common/basicData/all",async:!1,success:function(a){window.global_basicData=a}}),window.global_basicData)}function r(a){var b=$linq(common.getBasicData()).where(function(b){return b.id==a}).firstOrDefault();return b?b.description:""}function s(a){var b=$linq(q()).where(function(b){return b.identity==a&&b.pId==a}).toArray();return b?b:""}function t(a){return a?new Date(a):null}function u(a){return a?a:0}function v(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd"):null}function w(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd HH:mm:ss"):null}function x(){return{uploadSize:10485760,processState:"processState",processState_waitQianShou:"processState_1",processState_qianShou:"processState_2",processState_banJie:"processState_7",processState_tuiWen:"processState_11",projectShenBaoStage:"projectShenBaoStage",projectShenBaoStage_nextYearPlan:"projectShenBaoStage_7",projectShenBaoStage_projectProposal:"projectShenBaoStage_9",projectShenBaoStage_KXXYJBG:"projectShenBaoStage_10",projectShenBaoStage_CBSJYGS:"projectShenBaoStage_11",projectShenBaoStage_junGong:"projectShenBaoStage_6",projectCategory:"projectCategory",projectCategory_A:"projectCategory_1",projectCategory_B:"projectCategory_2",projectCategory_C:"projectCategory_3",projectCategory_D:"projectCategory_4",projectClassify:"projectClassify",projectClassify_ZF:"projectClassify_1",projectClassify_SH:"projectClassify_2",projectConstrChar:"projectConstrChar",projectConstrChar_qianqi:"projectConstrChar_1",projectConstrChar_xinkaigong:"projectConstrChar_2",projectConstrChar_xujian:"projectConstrChar_3",projectConstrChar_chubei:"projectConstrChar_4",projectFunctionClassify:"projectFunctionClassify",projectGoverEconClassify:"projectGoverEconClassify",projectInvestmentType:"projectInvestmentType",projectInvestmentType_ZF:"projectInvestmentType_1",projectInvestmentType_SH:"projectInvestmentType_2",projectIndustry:"projectIndustry",projectIndustry_ZF:"projectIndustry_1",projectIndustry_SH:"projectIndustry_2",projectProgress:"projectProgress",projectStage:"projectStage",projectType:"projectType",approvalType:"approvalType",unitProperty:"unitProperty",area:"area",area_GM:"area_1",capitalOtherType:"capitalOtherType",taskType:"taskType",taskType_monthReport:"taskType_1",taskType_yearPlan:"taskType_2",taskType_sendMesg:"taskType_3",taskType_shenBao:"taskType_4",taskType_JYS:"taskType_5",taskType_KXXYJBG:"taskType_6",taskType_CBSJYGS:"taskType_7",taskType_qianQi:"taskType_8",taskType_newStart:"taskType_9",taskType_xuJian:"taskType_10",auditState:"auditState",auditState_noAudit:"auditState_1",auditState_auditPass:"auditState_2",auditState_auditNotPass:"auditState_3",management:"管理员"}}function y(a,b,c){if(a){var d=a.length;d>b?$("#"+c).html("<font size='5'>0</font>"):d<=b&&$("#"+c).html("<font size='5'>"+(b-d)+"</font>")}else $("#"+c).html("<font size='5'>"+b+"</font>")}function z(){return{projectShenBaoStage_projectProposal:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["HYJY",'会议纪要及依据 <span class="required">(*)</span>'],["Project_ProPosal","项目建议书（需委托有相应资质的咨询机构按照规范编写）"],["other","其他资料"]],projectShenBaoStage_KXXYJBG:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["ProjectProPosalReply_Scanning",'项目建议书（或前期工作计划）批复扫描件 <span class="required">(*)</span>'],["KXXYJ_Report","项目可行性研究报告（包括项目建设、管养、招投标等内容）"],["GHXZProposal_Scanning","规划选址意见书扫描件"],["YDYS_Scanning","用地预审扫描件"],["HPPW_Scanning","环评批文扫描件"],["other","其他资料"]],projectShenBaoStage_CBSJYGS:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["ProjectProPosal_Reply","项目建议书（或前期工作计划）、可行性研究报告"],["CBSJYGS_Material","初步设计及项目总概算材料（项目单位需委托有相应资质的咨询机构编制项目总概算）"],["YDGHXKZ_Scanning","用地规划许可证扫描件"],["other","其他资料"]],projectShenBaoStage_YearPlan:[["XXJD","项目工程形象进度及年度资金需求情况"],["WCJSNR","年度完成建设内容及各阶段工作内容完成时间表"],["TTJH",'历年政府投资计划下大文件  <span class="required">(*)</span>'],["GCXKZ","建设工程规划许可证"],["TDQK","土地落实情况、征地拆迁有关情况"],["XMJZ","项目进展情况相关资料"],["QQGZJH","前期工作计划文件"],["XMSSYJ","项目实施依据文件"],["HYJY","会议纪要"]],projectShenBaoStage_qianQi:[["ProjectBasis",'项目依据  <span class="required">(*)</span>'],["other","其他"]],projectShenBaoStage_newStart:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["BudgetReply_Scanning",'概算批复扫描件 <span class="required">(*)</span>'],["GCGHXKZ_Scanning","工程规划许可证扫描件"],["IssuedReplyFile_Scanning",'全部已下达计划批复文件扫描件 <span class="required">(*)</span>'],["other","其他"]],projectShenBaoStage_xuJian:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["LastYearPlanReply_Copy",'上一年度计划批文复印件 <span class="required">(*)</span>'],["IssuedReplyFile_Scanning",'全部已下达计划批复文件扫描件 <span class="required">(*)</span>'],["other","其他"]],projectShenBaoStage_junGong:[["ApplyReport_pdf",'申请报告（pdf版，加盖公章）<span class="required">(*)</span>'],["ApplyReport_word",'申请报告（Word版）<span class="required">(*)</span>'],["LastYearPlanReply_Copy",'上一年度计划批文复印件 <span class="required">(*)</span>'],["IssuedReplyFile_Scanning",'全部已下达计划批复文件扫描件 <span class="required">(*)</span>'],["other","其他"]],projectEdit:[["XMJYSPF","项目建议书批复文本"],["KXXYJBGPF","可行性研究报告批复文本"],["ZGSPFTZ","总概算批复及调整文本"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]],projectEdit_SH:[["XMJYSPF","项目建议书批复文本"],["KXXYJBGPF","可行性研究报告批复文本"],["ZGSPFTZ","总概算批复及调整文本"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]]}}function A(a,b){var c=[];if(null!=a&&""!=a){if(a.constructor==Array)return a;if(""==b)return c.push(a),c;for(var d=0,e=0,f=a.length;d<f;)e=a.indexOf(b,d),e!=-1?(""!=a.substring(d,e)&&c.push(a.substring(d,e)),d=e+1):(""!=a.substring(d,f)&&c.push(a.substring(d,f)),d=f)}return c}function B(a,b){var c="";if(null!=a&&a.length>0){if(a.constructor==String)return b;for(var d=0;d<a.length;d++)""!=a[d]&&(c=""==c?a[d]:c+b+a[d])}return c}function C(a){var b=parseFloat(a);if(!isNaN(b))return b=Math.round(1e4*a)/1e4}function D(){return window.global_userUnits?window.global_userUnits:($.ajax({url:"/common/userUnit",async:!1,success:function(a){window.global_userUnits=a}}),window.global_userUnits)}function E(a){for(var b=D(),c="",d=0;d<b.length;d++){var e=b[d];if(a==e.id){c=e.unitName;break}}return c}function F(a){function b(a,b,d){c+=parseFloat(a)}var c=0;return a.forEach(b),C(c)}function G(a){for(var b="",c=0,d=0;d<a.length;d++)c=a.charCodeAt(d),b+=String.fromCharCode(c>0&&c<128?c+65248:c);return b}function H(){$(document).on("click","#checkboxAll",function(){var a=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),$("body").on("click",".grid tr",function(a){$(this).parent().find("tr").removeClass("selected"),$(this).addClass("selected")})}var I={initJqValidation:a,requestError:b,requestSuccess:c,format:d,blockNonNumber:e,floatNumberInput:f,adminContentHeight:g,alert:h,confirm:i,getQuerystring:j,kendoGridConfig:k,getKendoCheckId:l,cookie:n,getToken:o,appPath:"",http:m,gridDataSource:p,loginUrl:"/",getBasicData:q,getBasicDataDesc:r,getBacicDataByIndectity:s,toDate:t,toMoney:u,formatDate:v,formatDateTime:w,basicDataConfig:x,checkLength:y,uploadFileTypeConfig:z,stringToArray:A,arrayToString:B,toDecimal4:C,getUserUnits:D,getUnitName:E,getSum:F,repSign:G};window.common=I,H()}(),function(){"use strict";angular.module("app",["ui.router","kendo.directives"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",templateUrl:"/shenbaoAdmin/html/welcome",controller:"indexCtrl",controllerAs:"vm"}).state("task",{url:"/task",templateUrl:"/shenbaoAdmin/task/html/list",controller:"indexCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:"/account/html/changePwdQ.html",controller:"indexCtrl",controllerAs:"vm"}).state("monthReportDetails",{url:"/monthReportDetails/:monthReportId",templateUrl:"/shenbaoAdmin/projectMonthReport/html/details.html",controller:"indexCtrl",controllerAs:"vm"}).state("deptInfoMaintain",{url:"/deptInfoMaintain",templateUrl:"/contents/shenbaoAdmin/deptInfoMaintain/html/deptInfoManager.html",controller:"deptInfoMaintainCtrl",controllerAs:"vm"}).state("project",{url:"/project",templateUrl:"/shenbaoAdmin/project/html/list.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectEdit",{url:"/projectEdit/:id/:projectInvestmentType",templateUrl:"/shenbaoAdmin/project/html/edit.html",controller:"projectCtrl",controllerAs:"vm"}).state("project_projectInfo",{url:"/project/projectInfo/:id/:projectInvestmentType",templateUrl:"/shenbaoAdmin/project/html/projectInfo.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectMonthReport",{url:"/projectMonthReport",templateUrl:"/shenbaoAdmin/projectMonthReport/html/list.html",controller:"projectMonthReportCtrl",controllerAs:"vm"}).state("projectMonthReportFill",{url:"/projectMonthReportFill/:projectId",templateUrl:"/shenbaoAdmin/projectMonthReport/html/selectMonth",controller:"projectMonthReportCtrl",controllerAs:"vm"}).state("projectMonthReportInfoFill",{url:"/projectMonthReportInfoFill/:projectId/:year/:month",templateUrl:"/shenbaoAdmin/projectMonthReport/html/fillInfo",controller:"projectMonthReportCtrl",controllerAs:"vm"}).state("shenbao",{url:"/shenbao",templateUrl:"/shenbaoAdmin/shenbao/html/list.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_edit",{url:"/shenbao/:id/:projectInvestmentType/:stage",templateUrl:"/shenbaoAdmin/shenbao/html/edit.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_records",{url:"/shenbao_records",templateUrl:"/shenbaoAdmin/shenbao/html/records.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_record",{url:"/shenbao_record/:id",templateUrl:"/shenbaoAdmin/shenbao/html/shenBaoInfo.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_record_edit",{url:"/shenbao_record_edit/:id/:projectInvestmentType/:stage",templateUrl:"/shenbaoAdmin/shenbao/html/edit.html",controller:"shenbaoCtrl",controllerAs:"vm"})}])}(),function(){"use strict";function a(a,b,c){function d(){"task"==b.current.name&&(j.page="taskList"),"monthReportDetails"==b.current.name&&(j.page="monthReportDetails"),"accountPwd"==b.current.name&&(j.page="changePwd"),j.formatDate=function(a){return common.formatDate(a)},j.formatDateTime=function(a){return common.formatDateTime(a)},j.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},j.taskType_yearPlan=common.basicDataConfig().taskType_yearPlan,j.taskType_monthReport=common.basicDataConfig().taskType_monthReport}function e(){d(),"index"==j.page&&f(),"taskList"==j.page&&g(),"monthReportDetails"==j.page&&i(),"changePwd"==j.page&&h()}function f(){c.getTask(j),c.getUnitShenBaoInfos(j)}function g(){c.taskList(j)}function h(){j.changePwd=function(){c.changePwd(j)}}function i(){c.getMonthReportById(j)}var j=this;j.model={},j.monthReportId=b.params.monthReportId,j.page="index",e()}angular.module("app").controller("indexCtrl",a),a.$inject=["$location","$state","indexSvc"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:common.format(l+"?$filter=id eq '{0}'",b.model.monthReport.projectId)},d=function(a){b.model.project=a.data.value[0]||{},""!=b.model.project.projectType?b.model.project.projectType=b.model.project.projectType.split(","):b.model.project.projectType=[]};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(c){var d={method:"get",url:common.format(k+"?$filter=id eq '{0}'",c.monthReportId)},e=function(a){c.model.monthReport=a.data.value[0]||{},b(c),c.model.monthReport.beginDate=common.formatDate(c.model.monthReport.beginDate),c.model.monthReport.endDate=common.formatDate(c.model.monthReport.endDate),c.uploadType=[["scenePicture","现场图片"],["other","其它材料"]]};common.http({vm:c,$http:a,httpOptions:d,success:e})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"put",url:j,data:b.model.password},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),location.href=m}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"title",title:"名称",template:function(b){return b.taskType==a.taskType_yearPlan?common.format('<a href="#/shenbao_record/{0}">{1}</a>',b.relId,b.title):b.taskType==a.taskType_monthReport?common.format('<a href="#/monthReportDetails/{0}">{1}</a>',b.relId,b.title):void 0},width:305,filterable:!1},{field:"processSuggestion",title:"信息",width:441,template:function(a){return common.format('<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:441px;" title="{0}">{0}</span>',a.processSuggestion)},filterable:!1},{field:"processState",title:"状态",template:function(a){return common.getBasicDataDesc(a.processState)},width:210,filterable:!1},{field:"createdDate",title:"创建时间",width:165,template:function(a){return common.formatDateTime(a.createdDate)},filterable:!1}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(b){var c={method:"get",url:i+"/unit"},d=function(a){b.model.shenBaoInfo=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"get",url:h+"?$orderby=createdDate desc"},d=function(a){b.model.task=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}var h="/shenbaoAdmin/task",i="/shenbaoAdmin/shenbao",j="/account/password",k="/shenbaoAdmin/projectMonthReport",l="/shenbaoAdmin/project",m="/",n={getTask:g,getUnitShenBaoInfos:f,getMonthReportById:c,taskList:e,changePwd:d};return n}angular.module("app").factory("indexSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b){function c(){f.basicData_unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),f.basicData_area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray()}function d(){c(),"index"==f.page&&e()}function e(){b.getDeptInfo(f),f.submit=function(){b.save(f)}}var f=this;f.page="index",d()}angular.module("app").controller("deptInfoMaintainCtrl",a),a.$inject=["$location","deptInfoMaintainSvc"]}(),function(){"use strict";function a(a,b){function c(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"post",url:e,data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),location.reload()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:f})}}function d(b){var c={method:"get",url:e},d=function(a){b.model=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}var e="/shenbaoAdmin/userUnitInfo",f={getDeptInfo:d,save:c};return f}angular.module("app").factory("deptInfoMaintainSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d){function e(){i.init(),"list"==i.page&&f(),"selectMonth"==i.page&&g(),"fillReport"==i.page&&h()}function f(){b.grid(i),i.search=function(){var a=[];a.push({field:"isLatestVersion",operator:"eq",value:!0}),a.push({field:"isMonthReport",operator:"eq",value:!0}),null!=i.search.projectName&&""!=i.search.projectName&&a.push({field:"projectName",operator:"contains",value:i.search.projectName}),null!=i.search.projectStage&&""!=i.search.projectStage&&a.push({field:"projectStage",operator:"eq",value:i.search.projectStage}),null!=i.search.projectInvestmentType&&""!=i.search.projectInvestmentType&&a.push({field:"projectInvestmentType",operator:"eq",value:i.search.projectInvestmentType}),i.gridOptions.dataSource.filter(a),i.gridOptions.dataSource.read()}}function g(){b.getProjectById(i);var a=new Date;i.submitYear=a.getFullYear(),i.submitYearMonth={},i.tuiwenYearMonth={},i.monthRow1=["一月","二月","三月","四月","五月","六月"],i.monthRow2=["七月","八月","九月","十月","十一月","十二月"],i.setMonthSelected=function(){for(var a=1;a<=12;a++)i.submitYearMonth["m"+a]=!1,i.tuiwenYearMonth["m"+a]=!1;var b=$linq(i.model.projectInfo.monthReportDtos).where(function(a){return a.submitYear==i.submitYear});b.foreach(function(a){null!=a.processState&&(a.processState==common.basicDataConfig().processState_tuiWen?i.tuiwenYearMonth["m"+a.submitMonth]=!0:i.submitYearMonth["m"+a.submitMonth]=!0)})},i.fillReport=function(a){location.href="#/projectMonthReportInfoFill/"+i.projectId+"/"+i.submitYear+"/"+a}}function h(){i.model.monthReport={},i.years=[],i.currentYear=(new Date).getFullYear(),i.years.push(i.currentYear);for(var a=1;a<=5;a++)i.years.push(i.currentYear+a),i.years.push(i.currentYear-a);i.years=i.years.sort(),i.model.monthReport.proposalsYear=i.currentYear,i.model.monthReport.reportYear=i.currentYear,i.model.monthReport.allEstimateYear=i.currentYear,b.getProjectById(i),i.submit=function(){b.submitMonthReport(i)},i.page_fillReport_init=function(){i.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){i.model.monthReport.attachmentDtos?i.model.monthReport.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):i.model.monthReport.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},i.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:i,msg:"上传文件过大！"})})})},i.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:i.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:i.onSelect}},i.delFile=function(a){i.model.monthReport.attachmentDtos.splice(a,1)},i.createProblem=function(){i.model.monthReport.monthReportProblemDtos?i.model.monthReport.monthReportProblemDtos.push({problemIntroduction:"",solutionsAndSuggest:""}):i.model.monthReport.monthReportProblemDtos=[{problemIntroduction:"",solutionsAndSuggest:""}]},i.deleteProblem=function(a){i.model.monthReport.monthReportProblemDtos.splice(a,1)},i.basicData_approvalType=common.getBacicDataByIndectity(common.basicDataConfig().approvalType),i.basicData_projectProgress=common.getBacicDataByIndectity(common.basicDataConfig().projectProgress),i.uploadType=[["scenePicture","现场图片"],["other","其它材料"]]}var i=this;i.model={},i.basicData={},i.search={},i.page="list",i.init=function(){i.projectId=c.params.projectId,i.month=c.params.month,i.year=c.params.year,i.processState=c.params.processState,i.projectId&&(i.page="selectMonth"),i.month&&(i.page="fillReport"),i.checkLength=function(a,b,c){common.checkLength(a,b,c)},i.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),i.basicData.projectInvestmentType=common.getBacicDataByIndectity(common.basicDataConfig().projectInvestmentType)},e()}angular.module("app").controller("projectMonthReportCtrl",a),a.$inject=["$location","projectMonthReportSvc","$state","$scope"]}(),function(){"use strict";function a(a,b){function c(b){var c={method:"get",url:common.format(f+"?$filter=id eq '{0}' ",b.projectId)},d=function(a){if(b.model.projectInfo=a.data.value[0]||{},"selectMonth"==b.page&&b.setMonthSelected(),"fillReport"==b.page){var c=$linq(b.model.projectInfo.monthReportDtos).where(function(a){return a.submitYear==b.year&&a.submitMonth==b.month}).toArray();if(c.length>0){b.isReportExist=!0;for(var d=0;d<c.length;d++)1==c[d].isLatestVersion&&(b.model.monthReport=c[d])}else b.isReportExist=!1;b.model.monthReport.projectId=b.model.projectInfo.id,b.model.monthReport.projectNumber=b.model.projectInfo.projectNumber,b.model.monthReport.projectRepName=b.model.projectInfo.projectRepName,b.model.monthReport.projectRepMobile=b.model.projectInfo.projectRepMobile,b.model.monthReport.beginDate=common.formatDate(b.model.projectInfo.beginDate),b.model.monthReport.endDate=common.formatDate(b.model.projectInfo.endDate),b.model.monthReport.invertPlanTotal=common.toMoney(b.model.projectInfo.projectInvestSum),b.model.monthReport.actuallyFinishiInvestment=common.toMoney(b.model.projectInfo.projectInvestAccuSum),b.model.monthReport.releasePlanTotal=common.toMoney(b.model.monthReport.releasePlanTotal),b.model.monthReport.thisYearPlanInvestment=common.toMoney(b.model.monthReport.thisYearPlanInvestment),b.model.monthReport.thisYearPlanHasInvestment=common.toMoney(b.model.monthReport.thisYearPlanHasInvestment),b.model.monthReport.thisYearAccumulatedInvestment=common.toMoney(b.model.monthReport.thisYearAccumulatedInvestment),b.model.monthReport.thisMonthPlanInvestTotal=common.toMoney(b.model.monthReport.thisMonthPlanInvestTotal),b.model.monthReport.thisMonthInvestTotal=common.toMoney(b.model.monthReport.thisMonthInvestTotal),b.model.monthReport.thisYearAccumulatedInvestment=common.toMoney(b.model.monthReport.thisYearAccumulatedInvestment),b.model.monthReport.firstQuarCompInvestment=common.toMoney(b.model.monthReport.firstQuarCompInvestment),b.model.monthReport.secondQuarCompInvestment=common.toMoney(b.model.monthReport.secondQuarCompInvestment),b.model.monthReport.thirdQuarCompInvestment=common.toMoney(b.model.monthReport.thirdQuarCompInvestment),b.model.monthReport.fourthQuarCompInvestment=common.toMoney(b.model.monthReport.fourthQuarCompInvestment)}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.model.monthReport.submitYear=b.year,b.model.monthReport.submitMonth=b.month,b.model.monthReport.projectId=b.projectId,b.isSubmit=!0;var d={method:"post",url:g,data:b.model.monthReport},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),location.reload()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(f),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isMonthReport",operator:"eq",value:!0},{field:"isLatestVersion",operator:"eq",value:!0}]}),c=[{field:"projectName",title:"项目名称",filterable:!0,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)}},{field:"projectStage",title:"项目阶段",width:150,filterable:!1,template:function(a){return common.getBasicDataDesc(a.projectStage)}},{field:"projectClassify",title:"项目分类",width:150,filterable:!1,template:function(a){return common.getBasicDataDesc(a.projectClassify)}},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,"vm.del('"+a.id+"')")}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var f="/shenbaoAdmin/project/unitProject",g="/shenbaoAdmin/projectMonthReport",h={grid:e,submitMonthReport:d,getProjectById:c};return h}angular.module("app").factory("projectMonthReportSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){k.init(),"list"==k.page&&g(),"create"==k.page&&(k.model.projectType=[],h()),"update"==k.page&&(h(),i()),"projectInfo"==k.page&&j()}function g(){b.grid(k),k.addProject=function(){$("#myModal").modal({backdrop:"static",keyboard:!1}),k.model.projectInvestmentType=common.basicDataConfig().projectInvestmentType_ZF},k.confirmInvestmentType=function(){$(".modal-backdrop").remove(),a.path("/projectEdit//"+k.model.projectInvestmentType)},k.search=function(){var a=[];a.push({field:"isLatestVersion",operator:"eq",value:!0}),null!=k.search.projectName&&""!=k.search.projectName&&a.push({field:"projectName",operator:"contains",value:k.search.projectName}),null!=k.search.projectStage&&""!=k.search.projectStage&&a.push({field:"projectStage",operator:"eq",value:k.search.projectStage}),null!=k.search.isIncludLibrary&&null!=k.search.isIncludLibrary&&("true"==k.search.isIncludLibrary?a.push({field:"isIncludLibrary",operator:"eq",value:!0}):"false"==k.search.isIncludLibrary&&a.push({field:"isIncludLibrary",operator:"eq",value:!1})),null!=k.search.unitName&&""!=k.search.unitName&&a.push({field:"unitName",operator:"eq",value:k.search.unitName}),k.gridOptions.dataSource.filter(a)}}function h(){k.model.projectInvestmentType=k.projectInvestmentType,k.model.projectInvestSum=common.toMoney(k.model.projectInvestSum),k.model.projectInvestAccuSum=common.toMoney(k.model.projectInvestAccuSum),k.model.capitalSCZ_ggys=common.toMoney(k.model.capitalSCZ_ggys),k.model.capitalSCZ_gtzj=common.toMoney(k.model.capitalSCZ_gtzj),k.model.capitalSCZ_zxzj=common.toMoney(k.model.capitalSCZ_zxzj),k.model.capitalQCZ_ggys=common.toMoney(k.model.capitalQCZ_ggys),k.model.capitalQCZ_gtzj=common.toMoney(k.model.capitalQCZ_gtzj),k.model.capitalZYYS=common.toMoney(k.model.capitalZYYS),k.model.capitalSHTZ=common.toMoney(k.model.capitalSHTZ),k.model.capitalOther=common.toMoney(k.model.capitalOther),k.capitalTotal=function(){return common.getSum([k.model.capitalSCZ_ggys||0,k.model.capitalSCZ_gtzj||0,k.model.capitalSCZ_zxzj||0,k.model.capitalQCZ_ggys||0,k.model.capitalQCZ_gtzj||0,k.model.capitalSHTZ||0,k.model.capitalZYYS||0,k.model.capitalOther||0])},k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(k.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),k.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),k.isZFInvestment=!0,k.relatedType=common.uploadFileTypeConfig().projectEdit):k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(k.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),k.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),k.projectIndustryChange=function(){k.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==k.model.projectIndustryParent}).toArray()},k.isSHInvestment=!0,k.relatedType=common.uploadFileTypeConfig().projectEdit_SH),b.getUserUnit(k),k.updateSelection=function(a){var b=k.model.projectType.indexOf(a);b==-1?k.model.projectType.push(a):k.model.projectType.splice(b,1)},k.uploadType=[["JYS","项目建议书批复"],["KXXYJBG","可行性研究报告批复"],["CBSJYGS","初步设计与概算批复"]],k.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){k.model.attachmentDtos?k.model.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):k.model.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},k.choseDocument=function(a){k.pifuType=$(a.target).parents(".uploadBox").attr("data-type"),$("#documentRecords").modal({backdrop:"static",keyboard:!1}),k.grid_documentRecords.dataSource.read()},b.documentRecordsGird(k),k.pifuChoseConfirm=function(){$("#documentRecords").modal("hide"),$(".modal-backdrop").remove();var a=common.getKendoCheckId(".grid"),b=a[0].value;if(b){var c=common.stringToArray(b,","),d=c[0],e=c[1],f=c[2];
k.model["pifu"+k.pifuType+"_wenhao"]=d,k.model.attachmentDtos?k.model.attachmentDtos.push({name:e,url:f,type:k.pifuType}):k.model.attachmentDtos=[{name:e,url:f,type:k.pifuType}]}},k.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:k,msg:"上传文件过大！"})})})},k.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.delFile=function(a){var b=k.model.attachmentDtos[a];if(b){var c=b.type;k.model["pifu"+c+"_wenhao"]="",k.model.attachmentDtos.splice(a,1)}},k.create=function(){b.createProject(k)}}function i(){k.title="编辑项目",b.getProjectById(k),k.update=function(){b.updateProject(k)}}function j(){$(".modal-backdrop").remove(),b.getProjectById(k),k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(k.isZFInvestment=!0,k.relatedType=common.uploadFileTypeConfig().projectEdit):k.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(k.isSHInvestment=!0,k.relatedType=common.uploadFileTypeConfig().projectEdit_SH),k.capitalTotal=function(){return common.getSum([k.model.capitalSCZ_ggys||0,k.model.capitalSCZ_gtzj||0,k.model.capitalSCZ_zxzj||0,k.model.capitalQCZ_ggys||0,k.model.capitalQCZ_gtzj||0,k.model.capitalSHTZ||0,k.model.capitalZYYS||0,k.model.capitalOther||0])},k.relatedType=common.uploadFileTypeConfig().projectEdit}var k=this;k.title="新增项目",k.id=c.params.id,k.projectInvestmentType=c.params.projectInvestmentType,k.model={},k.basicData={},k.search={},k.page="list",k.init=function(){"projectEdit"==c.current.name&&(k.page="create"),k.id&&(k.page="update"),"project_projectInfo"==c.current.name&&(k.page="projectInfo"),k.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},k.checkLength=function(a,b,c){common.checkLength(a,b,c)},k.html=function(a){return e.trustAsHtml(a)},k.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),k.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),k.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),k.basicData.investmentType=common.getBacicDataByIndectity(common.basicDataConfig().projectInvestmentType),k.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),k.basicData.userUnit=common.getUserUnits()},f()}angular.module("app").controller("projectCtrl",a),a.$inject=["$location","projectSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a,b,c){function d(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0,b.model.projectType=common.arrayToString(b.model.projectType,","),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther);var e={method:"put",url:k+"/unitProject",data:b.model},f=function(a){b.model.projectType=b.model.projectType.split(","),common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path(m)}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function e(b){var c={method:"get",url:common.format(k+"?$filter=id eq '{0}'",b.id)},d=function(a){b.model=a.data.value[0]||{},f(b),b.model.projectType=common.stringToArray(b.model.projectType,","),b.model.beginDate=common.formatDate(b.model.beginDate),b.model.endDate=common.formatDate(b.model.endDate),b.model.pifuJYS_date=common.formatDate(b.model.pifuJYS_date),b.model.pifuKXXYJBG_date=common.formatDate(b.model.pifuKXXYJBG_date),b.model.pifuCBSJYGS_date=common.formatDate(b.model.pifuCBSJYGS_date),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(l+"/userName?$filter=id eq '{0}'",b.model.unitName)},d=function(a){b.userUnit=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"get",url:l},d=function(a){b.userUnit=a.data.value[0]||{},b.model.unitName=b.userUnit.id};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(b){common.initJqValidation();var d=$("form").valid();if(d){b.model.projectType=common.arrayToString(b.model.projectType,","),b.isSubmit=!0;var e={method:"post",url:k+"/unitProject",data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path(m)}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function i(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='radio'  relId='{0},{1},{2}' name='checkbox'/>",a.number,a.name,a.fullName)},filterable:!1,width:40,title:""},{field:"number",title:"文号",width:180,filterable:!0},{field:"name",title:"文件名",width:550,template:function(a){return common.format("<a href='/contents/upload/{1}'>{0}</a>",a.name,a.fullName)},filterable:!0}];a.gridOptions_documentRecords={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function j(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(k+"/unitProject")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isLatestVersion",operator:"eq",value:!0}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectName",title:"项目名称",filterable:!0,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)}},{field:"unitName",title:"所属单位",filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},template:function(a){return common.getUnitName(a.unitName)}},{field:"projectStage",title:"项目阶段",template:function(a){return common.getBasicDataDesc(a.projectStage)},width:150,filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectStage),dataTextField:"description",dataValueField:"id",filter:"startswith"})}}},{field:"projectClassify",title:"项目分类",template:function(a){return common.getBasicDataDesc(a.projectClassify)},width:150,filterable:!1},{field:"isIncludLibrary",title:"是否已纳入项目库",template:function(a){return a.isIncludLibrary?"已纳入":"未纳入"},width:150,filterable:!0},{field:"",title:"操作",width:180,template:function(a){var b=a.isIncludLibrary;return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,b?"display:none":"")}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var k="/shenbaoAdmin/project",l="/shenbaoAdmin/userUnitInfo",m="/project",n="/shenbaoAdmin/replyFile",o={grid:j,createProject:h,getUserUnit:g,getProjectById:e,updateProject:d,documentRecordsGird:i};return o}angular.module("app").factory("projectSvc",a),a.$inject=["$http","$compile","$location"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){k.init(),"list"==k.page&&g(),"edit"==k.page&&h(),"records"==k.page&&i(),"record"==k.page&&j(),"record_edit"==k.page&&(k.isRecordEdit=!0,k.title="申报信息编辑",h(),j())}function g(){b.grid(k),k.search=function(){var a=[];a.push({field:"isLatestVersion",operator:"eq",value:!0}),a.push({field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF}),null!=k.search.projectName&&""!=k.search.projectName&&a.push({field:"projectName",operator:"contains",value:k.search.projectName}),null!=k.search.projectStage&&""!=k.search.projectStage&&a.push({field:"projectStage",operator:"eq",value:k.search.projectStage}),null!=k.search.isIncludLibrary&&null!=k.search.isIncludLibrary&&("true"==k.search.isIncludLibrary?a.push({field:"isIncludLibrary",operator:"eq",value:!0}):"false"==k.search.isIncludLibrary&&a.push({field:"isIncludLibrary",operator:"eq",value:!1})),null!=k.search.unitName&&""!=k.search.unitName&&a.push({field:"unitName",operator:"eq",value:k.search.unitName}),k.gridOptions.dataSource.filter(a)},k.shenbaoBtn=function(a,c,d){b.getShenBaoPortState(k,a,c,d)},k.change=function(){k.massage="",b.getShenBaoInfoByProjectId(k)},k.confirm=function(){$("#myModal").modal("hide"),$(".modal-backdrop").remove(),location.href="#/shenbao/"+k.projectId+"/"+k.projectInvestmentType+"/"+k.projectShenBaoStage},k.checkShenBaoRecords=function(a){$("#shenBaoRecords").modal({backdrop:"static",keyboard:!1}),k.projectNumber=a,k.gridOptions_shenBaoRecords.dataSource.filter({field:"projectNumber",operator:"eq",value:k.projectNumber}),k.gridOptions_shenBaoRecords.dataSource.read()},b.projectShenBaoRecordsGird(k)}function h(){var a=function(){k.isYearPlan=k.stage==common.basicDataConfig().projectShenBaoStage_nextYearPlan,k.isProjectProposal=k.stage==common.basicDataConfig().projectShenBaoStage_projectProposal,k.isKXXYJBG=k.stage==common.basicDataConfig().projectShenBaoStage_KXXYJBG,k.isCBSJYGS=k.stage==common.basicDataConfig().projectShenBaoStage_CBSJYGS,k.isQianQi=k.stage==common.basicDataConfig().projectShenBaoStage_qianQi,k.isNewStart=k.stage==common.basicDataConfig().projectShenBaoStage_newStart,k.isXuJian=k.stage==common.basicDataConfig().projectShenBaoStage_xuJian,k.isJunGong=k.stage==common.basicDataConfig().projectShenBaoStage_junGong,k.isYearPlan&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_YearPlan,k.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]),k.isProjectProposal&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_projectProposal),k.isKXXYJBG&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_KXXYJBG),k.isCBSJYGS&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_CBSJYGS),k.isQianQi&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_qianQi),k.isNewStart&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_newStart),k.isXuJian&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_xuJian),k.isJunGong&&(k.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_junGong),$("#tab1").attr("disabled","true"),$("#tab2").attr("disabled","true"),$("#tab3").attr("disabled","true"),$("#tab4").attr("disabled","true"),$("#tab5").attr("disabled","true"),$("#tab6").attr("disabled","true")},c=function(){k.investmentType==common.basicDataConfig().projectInvestmentType_ZF?(k.isZFInvestment=!0,k.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),k.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray()):k.investmentType==common.basicDataConfig().projectInvestmentType_SH&&(k.isSHInvestment=!0,k.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),k.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),k.projectIndustryChange=function(){k.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==k.model.projectIndustryParent}).toArray()})};a(),c(),k.changeYear=function(){k.planYear=parseInt(k.model.planYear)},"edit"==k.page&&b.getProjectById(k),k.updateSelection=function(a){var b=k.model.projectType.indexOf(a);b==-1?k.model.projectType.push(a):k.model.projectType.splice(b,1)},k.choseDocument=function(a){k.pifuType=$(a.target).parents(".uploadBox").attr("data-type"),$("#documentRecords").modal({backdrop:"static",keyboard:!1}),k.grid_documentRecords.dataSource.read()},b.documentRecordsGird(k),k.pifuChoseConfirm=function(){$("#documentRecords").modal("hide"),$(".modal-backdrop").remove();var a=common.getKendoCheckId(".grid"),b=a[0].value;if(b){var c=common.stringToArray(b,","),d=c[0],e=c[1],f=c[2];k.model["pifu"+k.pifuType+"_wenhao"]=d,k.model.attachmentDtos?k.model.attachmentDtos.push({name:e,url:f,type:k.pifuType}):k.model.attachmentDtos=[{name:e,url:f,type:k.pifuType}]}},k.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){k.model.attachmentDtos?k.model.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):k.model.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},k.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:k,msg:"上传文件过大！"})})})},k.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:k.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:k.onSelect},k.delFile=function(a){var b=k.model.attachmentDtos[a];if(b){var c=b.type;k.model["pifu"+c+"_wenhao"]="",k.model.attachmentDtos.splice(a,1)}},k.tabReturn=function(a){var b=$("#tab"+a);k.tabStrip.activateTab(b)},k.tabChange=function(a){common.initJqValidation();var b=$("form").valid(),c=$("#tab"+a);b&&k.tabStrip.activateTab(c)},k.addUnit=function(){k.model.constructionUnit.constructor==String&&(k.model.constructionUnit=common.stringToArray(k.model.constructionUnit)),k.model.constructionUnit.push(""),k.model.constructionUnit.length>1&&(k.canDelete=!0)},k.deleteUnit=function(a){k.canDelete&&(k.model.constructionUnit.splice(a,1),k.model.constructionUnit.length<=1&&(k.canDelete=!1))},k.submit=function(){b.createShenBaoInfo(k)}}function i(){b.recordsGird(k),k.search=function(){var a=[];null!=k.search.projectName&&""!=k.search.projectName&&a.push({field:"projectName",operator:"contains",value:k.search.projectName}),null!=k.search.projectShenBaoStage&&""!=k.search.projectShenBaoStage&&a.push({field:"projectShenBaoStage",operator:"eq",value:k.search.projectShenBaoStage}),null!=k.search.planYear&&""!=k.search.planYear&&a.push({field:"planYear",operator:"eq",value:parseInt(k.search.planYear)}),null!=k.search.constructionUnit&&""!=k.search.constructionUnit&&a.push({field:"constructionUnit",operator:"contains",value:k.search.constructionUnit}),null!=k.search.processState&&""!=k.search.processState&&a.push({field:"processState",operator:"eq",value:k.search.processState}),null!=k.search.auditState&&""!=k.search.auditState&&a.push({field:"auditState",operator:"eq",value:k.search.auditState}),k.gridOptions_records.dataSource.filter(a),k.gridOptions_records.dataSource.read()}}function j(){b.getShenBaoInfoById(k),$(".modal-backdrop").remove(),k.update=function(){b.updateShenBaoInfo(k)}}var k=this;k.id=c.params.id,k.investmentType=c.params.projectInvestmentType,k.stage=c.params.stage,k.model={},k.basicData={},k.search={},k.sysConfig={},k.page="list",k.title="申报信息录入",d.animationsEnabled=!0,k.init=function(){"shenbao_edit"==c.current.name&&(k.page="edit"),"shenbao_records"==c.current.name&&(k.page="records"),"shenbao_record"==c.current.name&&(k.page="record",$(".modal-backdrop").remove()),"shenbao_record_edit"==c.current.name&&(k.page="record_edit"),k.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},k.checkLength=function(a,b,c){common.checkLength(a,b,c)},k.html=function(a){return e.trustAsHtml(a)},$(document).on("click","#checkboxAll_shenBaoRecords",function(){var a=$(this).is(":checked");$(".shenBaoRecordsGrid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),k.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),k.basicData.projectShenBaoStage=common.getBacicDataByIndectity(common.basicDataConfig().projectShenBaoStage),k.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),k.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),k.basicData.projectConstrChar=common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),k.basicData.unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),k.basicData.processState=common.getBacicDataByIndectity(common.basicDataConfig().processState),k.basicData.auditState=common.getBacicDataByIndectity(common.basicDataConfig().auditState),k.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),k.basicData.userUnit=common.getUserUnits()},f()}angular.module("app").controller("shenbaoCtrl",a),a.$inject=["$location","shenbaoSvc","$state","$scope","$sce"]}(),function(){"use strict";function a(a,b,c){function d(b,c,d,e){var f={method:"get",url:common.format(t+"?configName={0}",common.basicDataConfig().taskType_shenBao)},g=function(a){b.sysConfing=a.data,b.sysConfing.enable?(b.projectId=c,b.projectInvestmentType=d,b.projectName=e,b.projectShenBaoStage="",b.massage="",b.isHased=!1,$("#myModal").modal("show")):common.alert({vm:b,msg:"申报端口已关闭,请联系管理人员!"})};common.http({vm:b,$http:a,httpOptions:f,success:g})}function e(b){var c={method:"get",url:common.format(r+"?$filter=projectId eq '{0}'",b.projectId)},d=function(a){b.model.shenBaoInfoRecords=a.data.value;var c=[];if(b.model.shenBaoInfoRecords.length>0){for(var d=0;d<b.model.shenBaoInfoRecords.length;d++)c.push(b.model.shenBaoInfoRecords[d].projectShenBaoStage);c.indexOf(b.projectShenBaoStage)>-1&&b.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan?(b.massage="下一年度计划已申报！",b.isHased=!0):b.isHased=!1}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b,c,d){var e={method:"get",url:common.format(r+"?$filter=projectNumber eq '{0}'",c)},f=function(a){if(b.model.shenBaoRecords=a.data.value,b.model.shenBaoRecords.length>0){for(var c=0,e=0;e<b.model.shenBaoRecords.length;e++){var f=b.model.shenBaoRecords[e];f.processState==common.basicDataConfig().processState_tuiWen&&(c+=1)}c>0&&$("#tuiwenNumber"+d).html(c)}};common.http({vm:b,$http:a,httpOptions:e,success:f})}function g(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"projectName",title:"项目名称",width:200,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.projectId,a.projectInvestmentType,a.projectName)},filterable:!1},{field:"processState",title:"审批状态",width:150,filterable:!1,template:function(a){var b=common.getBasicDataDesc(a.processState),c="text-danger";return common.format("<span class='{1}'>{0}</span>",b,c)}},{field:"projectShenBaoStage",title:"申报阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectShenBaoStage)},filterable:!1},{field:"planYear",title:"计划年度",width:100,filterable:!1},{field:"",title:"操作",width:200,template:function(a){var b=a.processState==common.basicDataConfig().processState_waitQianShou||a.processState==common.basicDataConfig().processState_tuiWen;return common.format($("#columnBtns_Record").html(),a.id,a.projectInvestmentType,a.projectShenBaoStage,b?"":"display:none")}}];a.gridOptions_shenBaoRecords={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function h(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0,b.model.projectType=common.arrayToString(b.model.projectType,","),b.model.constructionUnit=common.arrayToString(b.model.constructionUnit,",");var e={method:"put",url:r,data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path(u)}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function i(b){var c={method:"get",url:common.format(r+"?$filter=id eq '{0}'",b.id)},d=function(a){if(b.model=a.data.value[0]||{},k(b),b.model.projectType=common.stringToArray(b.model.projectType,","),b.model.constructionUnit=common.stringToArray(b.model.constructionUnit,","),b.model.constructionUnit.length>1?b.canDelete=!0:b.canDelete=!1,b.model.beginDate=common.formatDate(b.model.beginDate),b.model.endDate=common.formatDate(b.model.endDate),b.model.pifuJYS_date=common.formatDate(b.model.pifuJYS_date),b.model.pifuKXXYJBG_date=common.formatDate(b.model.pifuKXXYJBG_date),b.model.pifuCBSJYGS_date=common.formatDate(b.model.pifuCBSJYGS_date),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther),b.model.applyYearInvest=common.toMoney(b.model.applyYearInvest),b.model.capitalSCZ_gtzj_TheYear=common.toMoney(b.model.capitalSCZ_gtzj_TheYear),b.model.capitalSCZ_ggys_TheYear=common.toMoney(b.model.capitalSCZ_ggys_TheYear),b.model.capitalSCZ_qita=common.toMoney(b.model.capitalSCZ_qita),b.model.applyYearInvest_LastYear=common.toMoney(b.model.applyYearInvest_LastYear),b.model.capitalSCZ_gtzj_LastYear=common.toMoney(b.model.capitalSCZ_gtzj_LastYear),b.model.capitalSCZ_ggys_LastYear=common.toMoney(b.model.capitalSCZ_ggys_LastYear),b.model.capitalSCZ_qita_LastYear=common.toMoney(b.model.capitalSCZ_qita_LastYear),b.model.applyYearInvest_LastTwoYear=common.toMoney(b.model.applyYearInvest_LastTwoYear),b.model.capitalSCZ_gtzj_LastTwoYear=common.toMoney(b.model.capitalSCZ_gtzj_LastTwoYear),b.model.capitalSCZ_ggys_LastTwoYear=common.toMoney(b.model.capitalSCZ_ggys_LastTwoYear),b.model.capitalSCZ_qita_LastTwoYear=common.toMoney(b.model.capitalSCZ_qita_LastTwoYear),b.model.apInvestSum=common.toMoney(b.model.apInvestSum),b.capitalTotal=function(){return common.getSum([b.model.capitalSCZ_ggys||0,b.model.capitalSCZ_gtzj||0,b.model.capitalSCZ_zxzj||0,b.model.capitalQCZ_ggys||0,b.model.capitalQCZ_gtzj||0,b.model.capitalSHTZ||0,b.model.capitalZYYS||0,b.model.capitalOther||0])},b.lastTwoYearCapitalTotal=function(){return b.model.applyYearInvest_LastTwoYear=common.getSum([b.model.capitalSCZ_ggys_LastTwoYear||0,b.model.capitalSCZ_gtzj_LastTwoYear||0])},b.lastYearCapitalTotal=function(){return b.model.applyYearInvest_LastYear=common.getSum([b.model.capitalSCZ_ggys_LastYear||0,b.model.capitalSCZ_gtzj_LastYear||0])},b.theYearCapitalTotal=function(){return b.model.applyYearInvest=common.getSum([b.model.capitalSCZ_ggys_TheYear||0,b.model.capitalSCZ_gtzj_TheYear||0])},"record"==b.page&&(b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan?(b.isYearPlan=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_YearPlan,b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_projectProposal?(b.isProjectProposal=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_projectProposal):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_KXXYJBG?(b.isKXXYJBG=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_KXXYJBG):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_CBSJYGS?(b.isCBSJYGS=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_CBSJYGS):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_qianQi?(b.isQianQi=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_qianQi):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_newStart?(b.isNewStart=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_newStart):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_xuJian?(b.isXuJian=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_xuJian):b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_junGong&&(b.isJunGong=!0,b.materialsType=common.uploadFileTypeConfig().projectShenBaoStage_junGong)),"record_edit"==b.page&&b.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var c=$linq(common.getBasicData()).where(function(a){return a.id==b.model.projectIndustry}).toArray()[0];b.model.projectIndustryParent=c.pId,b.projectIndustryChange()}b.planYear=b.model.planYear};common.http({vm:b,$http:a,httpOptions:c,success:d})}function j(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0,b.model.projectType=common.arrayToString(b.model.projectType,","),b.model.constructionUnit=common.arrayToString(b.model.constructionUnit,",");var e={method:"post",url:r,data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功,等待管理员签收！",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path(u)}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function k(b){var c={method:"get",url:common.format(q+"/userName?$filter=id eq '{0}'",b.model.unitName)},d=function(a){var c=a.data.value[0]||{};"edit"!=b.page&&"record_edit"!=b.page||("edit"==b.page&&(b.model.shenBaoUnitInfoDto=c,b.model.constructionUnit.push(b.model.shenBaoUnitInfoDto.unitName)),"record_edit"==b.page&&(b.model.shenBaoUnitInfoDto.unitName=c.unitName),b.model.constructionUnit.length>1?b.canDelete=!0:b.canDelete=!1),"record"==b.page&&(b.model.unitName=c.unitName)};common.http({vm:b,$http:a,httpOptions:c,success:d})}function l(b){var c={method:"get",url:common.format(p+"?$filter=id eq '{0}'",b.id)},d=function(a){if(b.model=a.data.value[0]||{},b.model.constructionUnit=[],k(b),"edit"==b.page){if(b.model.projectType=common.stringToArray(b.model.projectType,","),b.model.beginDate=common.formatDate(b.model.beginDate),b.model.endDate=common.formatDate(b.model.endDate),b.model.pifuJYS_date=common.formatDate(b.model.pifuJYS_date),b.model.pifuKXXYJBG_date=common.formatDate(b.model.pifuKXXYJBG_date),b.model.pifuCBSJYGS_date=common.formatDate(b.model.pifuCBSJYGS_date),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther),b.model.applyYearInvest=common.toMoney(b.model.applyYearInvest),b.model.capitalSCZ_gtzj_TheYear=common.toMoney(b.model.capitalSCZ_gtzj_TheYear),b.model.capitalSCZ_ggys_TheYear=common.toMoney(b.model.capitalSCZ_ggys_TheYear),b.model.capitalSCZ_qita=common.toMoney(b.model.capitalSCZ_qita),b.model.applyYearInvest_LastYear=common.toMoney(b.model.applyYearInvest_LastYear),b.model.capitalSCZ_gtzj_LastYear=common.toMoney(b.model.capitalSCZ_gtzj_LastYear),b.model.capitalSCZ_ggys_LastYear=common.toMoney(b.model.capitalSCZ_ggys_LastYear),b.model.capitalSCZ_qita_LastYear=common.toMoney(b.model.capitalSCZ_qita_LastYear),b.model.applyYearInvest_LastTwoYear=common.toMoney(b.model.applyYearInvest_LastTwoYear),b.model.capitalSCZ_gtzj_LastTwoYear=common.toMoney(b.model.capitalSCZ_gtzj_LastTwoYear),b.model.capitalSCZ_ggys_LastTwoYear=common.toMoney(b.model.capitalSCZ_ggys_LastTwoYear),b.model.capitalSCZ_qita_LastTwoYear=common.toMoney(b.model.capitalSCZ_qita_LastTwoYear),b.model.apInvestSum=common.toMoney(b.model.apInvestSum),b.capitalTotal=function(){return common.getSum([b.model.capitalSCZ_ggys||0,b.model.capitalSCZ_gtzj||0,b.model.capitalSCZ_zxzj||0,b.model.capitalQCZ_ggys||0,b.model.capitalQCZ_gtzj||0,b.model.capitalSHTZ||0,b.model.capitalZYYS||0,b.model.capitalOther||0])},b.lastTwoYearCapitalTotal=function(){return b.model.applyYearInvest_LastTwoYear=common.getSum([b.model.capitalSCZ_ggys_LastTwoYear||0,b.model.capitalSCZ_gtzj_LastTwoYear||0])},b.lastYearCapitalTotal=function(){return b.model.applyYearInvest_LastYear=common.getSum([b.model.capitalSCZ_ggys_LastYear||0,b.model.capitalSCZ_gtzj_LastYear||0])},b.theYearCapitalTotal=function(){return b.model.applyYearInvest=common.getSum([b.model.capitalSCZ_ggys_TheYear||0,b.model.capitalSCZ_gtzj_TheYear||0]);
},b.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var c=$linq(common.getBasicData()).where(function(a){return a.id==b.model.projectIndustry}).toArray()[0];b.model.projectIndustryParent=c.pId,b.projectIndustryChange()}b.model.projectId=b.model.id;var d=new Date;b.planYear=b.model.planYear=parseInt(d.getFullYear()+1)}b.model.projectShenBaoStage=b.stage};common.http({vm:b,$http:a,httpOptions:c,success:d})}function m(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r+"/unit"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"constructionUnit",title:"建设单位",width:200,filterable:!0},{field:"projectName",title:"项目名称",width:200,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.projectId,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"functionSubjects",title:"功能科目",width:110,filterable:!1},{field:"econClassSubjects",title:"经济分类科目",width:140,filterable:!1},{field:"projectIndustry",title:"行业领域",template:function(a){return common.getBasicDataDesc(a.projectIndustry)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().processState),dataTextField:"description",dataValueField:"id"})}},width:100},{field:"projectCategory",title:"项目类别",width:80,template:function(a){return common.getBasicDataDesc(a.projectCategory)},filterable:!1},{field:"projectConstrChar",title:"建设性质",template:function(a){return common.getBasicDataDesc(a.projectConstrChar)},width:80,filterable:!1},{field:"beginDate",title:"开工/竣工时间",width:100,template:function(a){return a.projectCategory==common.basicDataConfig().projectCategory_A?common.formatDate(a.endDate):a.projectCategory==common.basicDataConfig().projectCategory_B||a.projectCategory==common.basicDataConfig().projectCategory_C||a.projectCategory==common.basicDataConfig().projectCategory_D?common.formatDate(a.beginDate):void 0},filterable:!1},{field:"projectGuiMo",title:"建设规模及主要建设内容",width:200,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.projectGuiMo)},filterable:!1},{field:"projectInvestSum",title:"总投资（万元）",width:120,filterable:!1},{field:"projectInvestAccuSum",title:"已拨付资金（万元）",width:145,filterable:!1},{field:"planYear",title:"计划年度",width:100,filterable:!1},{field:"yearConstructionContent",title:"本年度建设内容",width:120,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContent||"")},filterable:!1},{field:"capitalSCZ_ggys_TheYear",title:"资金需求及资金来源--公共预算（万元）",width:100,filterable:!1},{field:"capitalSCZ_gtzj_TheYear",title:"资金需求及资金来源--国土基金（万元）",width:100,filterable:!1},{field:"capitalSCZ_qita",title:"资金需求及资金来源--其他（万元）",width:100,filterable:!1},{field:"planYear+1",title:"计划年度",width:100,filterable:!1},{field:"yearConstructionContentLastYear",title:"本年度建设内容",width:120,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContentLastYear||"")},filterable:!1},{field:"capitalSCZ_ggys_LastYear",title:"资金需求及资金来源--公共预算（万元）",width:100,filterable:!1},{field:"capitalSCZ_gtzj_LastYear",title:"资金需求及资金来源--国土基金（万元）",width:100,filterable:!1},{field:"capitalSCZ_qita_LastYear",title:"资金需求及资金来源--其他（万元）",width:100,filterable:!1},{field:"planYear+2",title:"计划年度",width:100,filterable:!1},{field:"yearConstructionContentLastTwoYear",title:"本年度建设内容",width:120,template:function(a){return common.format('<span style="text-overflow:ellipsis;width:120px;overflow:hidden;white-space:nowrap;" title="{0}">{0}</span>',a.yearConstructionContentLastTwoYear||"")},filterable:!1},{field:"capitalSCZ_ggys_LastTwoYear",title:"资金需求及资金来源--公共预算（万元）",width:100,filterable:!1},{field:"capitalSCZ_gtzj_LastTwoYear",title:"资金需求及资金来源--国土基金（万元）",width:100,filterable:!1},{field:"capitalSCZ_qita_LastTwoYear",title:"资金需求及资金来源--其他（万元）",width:100,filterable:!1},{field:"processState",title:"审批状态",width:150,template:function(a){var b=common.getBasicDataDesc(a.processState),c="text-danger";return common.format("<span class='{1}'>{0}</span>",b,c)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().processState),dataTextField:"description",dataValueField:"id"})}}},{field:"auditState",title:"审核状态",width:150,template:function(a){return common.getBasicDataDesc(a.auditState)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().auditState),dataTextField:"description",dataValueField:"id"})}}},{field:"",title:"操作",width:150,template:function(a){var b=a.processState==common.basicDataConfig().processState_waitQianShou||a.processState==common.basicDataConfig().processState_tuiWen;return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,a.projectShenBaoStage,b?"":"display:none")}}],d=function(a){for(var b=a.data,c=a.workbook.sheets[0],d=this.columns[8].template,e=0;e<b.length;e++){var f=d(b[e]),g=c.rows[e+1];g.cells[4].value=common.getBasicDataDesc(g.cells[4].value),g.cells[5].value=common.getBasicDataDesc(g.cells[5].value),g.cells[6].value=common.getBasicDataDesc(g.cells[6].value),g.cells[7].value=f,g.cells[26].value=common.getBasicDataDesc(g.cells[26].value),g.cells[27].value=common.getBasicDataDesc(g.cells[27].value)}};a.gridOptions_records={excel:{fileName:"申报记录.xlsx"},dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0,excelExport:d}}function n(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(common.format(p+"/unitProject")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},isIncludLibrary:{type:"boolean"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isLatestVersion",operator:"eq",value:!0},{field:"projectInvestmentType",operator:"eq",value:common.basicDataConfig().projectInvestmentType_ZF}]}),c=[{template:function(a){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox'/>",a.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'/>"},{field:"projectName",title:"项目名称",filterable:!0,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)}},{field:"unitName",title:"所属单位",filterable:{ui:function(b){b.kendoDropDownList({valuePrimitive:!0,dataSource:a.basicData.userUnit,dataTextField:"unitName",dataValueField:"id",filter:"startswith"})}},template:function(a){return common.getUnitName(a.unitName)}},{field:"projectStage",title:"项目阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:{ui:function(a){a.kendoDropDownList({valuePrimitive:!0,dataSource:common.getBacicDataByIndectity(common.basicDataConfig().projectStage),dataTextField:"description",dataValueField:"id"})}}},{field:"projectClassify",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1},{field:"isIncludLibrary",title:"是否已纳入项目库",template:function(a){return a.isIncludLibrary?"已纳入":"未纳入"},width:150,filterable:!0},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,common.repSign(a.projectName),a.projectNumber)}}],d=function(b){for(var c=b.sender._data,d=0;d<c.length;d++){var e=c[d];f(a,e.projectNumber,e.id)}};a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,dataBound:d,resizable:!0}}function o(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),c=[{template:function(a){return kendo.format("<input type='radio'  relId='{0},{1},{2}' name='checkbox'/>",a.number,a.name,a.fullName)},filterable:!1,width:40,title:""},{field:"number",title:"文号",width:180,filterable:!0},{field:"name",title:"文件名",width:550,template:function(a){return common.format("<a href='/contents/upload/{1}'>{0}</a>",a.name,a.fullName)},filterable:!0}];a.gridOptions_documentRecords={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var p="/shenbaoAdmin/project",q="/shenbaoAdmin/userUnitInfo",r="/shenbaoAdmin/shenbao",s="/shenbaoAdmin/replyFile",t="/sys/getSysConfig",u="/shenbao",v={grid:n,getProjectById:l,projectShenBaoRecordsGird:g,createShenBaoInfo:j,recordsGird:m,getShenBaoInfoById:i,updateShenBaoInfo:h,documentRecordsGird:o,getShenBaoInfoByProjectId:e,getShenBaoPortState:d};return v}angular.module("app").factory("shenbaoSvc",a),a.$inject=["$http","$compile","$location"]}();