!function(){"use strict";function a(){$("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form")}function b(a){var b="发生错误,系统已记录,我们会尽快处理！";void 0!=a.response&&(401==a.response.status&&(location.href=A.loginUrl),b=a.response.data.message||b),A.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})}function c(a){console.log(a);var b=function(b){A.alert({vm:a.vm,msg:b,fn:function(){a.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(a.response.status>400)b("发生错误！");else{var c=a.response.data;c&&555==c.status?b(c.message):a.fn&&a.fn(c)}}function d(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a}function e(a){var b=a.toString().replace(/[^0-9]/g,"");return parseInt(b,10)}function f(a){return isNaN(parseFloat(a,10))?0:parseFloat(a,10)}function g(){return $(window).height()-180}function h(a){a.vm.alertDialogMessage=a.msg,a.vm.alertDialogFn=function(){a.fn?a.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})}function i(a){a.vm.dialogConfirmTitle=a.title,a.vm.dialogConfirmMessage=a.msg,$(".confirmDialog").modal({backdrop:"static"}),a.vm.dialogConfirmSubmit=a.fn}function j(a,b){null==b&&(b=""),a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(window.location.href);return null==d?b:d[1]}function k(){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0},schema:function(a){return{data:"value",total:function(a){return a.count},model:a}},transport:function(a){return{read:{url:a,dataType:"json",type:"GET",beforeSend:function(a){a.setRequestHeader("Token",A.getToken())}}}},noRecordMessage:{template:"暂时没有数据."}}}function l(a){var b=$(a).find("tr td:nth-child(1)").find("input:checked"),c=[];return b.each(function(){var a=$(this).attr("relId");c.push({name:"id",value:a})}),c}function m(a){a.headers={Token:A.getToken()},a.$http(a.httpOptions).then(a.success,function(b){common.requestError({vm:a.vm,response:b})})}function n(){var a={get:function(a,b){var c=this.getAll(a);return c?c[b]:null},getAll:function(a){var b=encodeURIComponent(a)+"=",c=document.cookie.indexOf(b),d=null,e={};if(c>-1){var f=document.cookie.indexOf(";",c);if(f==-1&&(f=document.cookie.length),d=document.cookie.substring(c+b.length,f),d.length>0){for(var g=d.split("&"),h=0,i=g.length;h<i;h++){var j=g[h].split("=");e[decodeURIComponent(j[0])]=decodeURIComponent(j[1])}return e}}return null},set:function(a,b,c,d,e,f,g){var h=this.getAll(a)||{};h[b]=c,this.setAll(a,h,d,e,f,g)},setAll:function(a,b,c,d,e,f){var g=encodeURIComponent(a)+"=",h=new Array;for(var i in b)i.length>0&&b.hasOwnProperty(i)&&h.push(encodeURIComponent(i)+"="+encodeURIComponent(b[i]));h.length>0?(g+=h.join("&"),c instanceof Date&&(g+=";expires="+c.toGMTString()),d&&(g+=";path="+d),e&&(g+=";domain="+e),f&&(g+=";secure")):g+=";expires="+new Date(0).toGMTString(),document.cookie=g},unset:function(a,b,c,d,e){var f=this.getAll(a);f&&(delete f[b],this.setAll(a,f,null,c,d,e))},unsetAll:function(a,b,c,d){this.setAll(a,null,new Date(0),b,c,d)}};return a}function o(){var a=n().getAll("data");return null!=a?a.token:""}function p(a){return a.error=function(a){401==a.status&&(location.href=A.loginUrl)},a}function q(){return window.global_basicData?window.global_basicData:($.ajax({url:"/common/basicData/all",async:!1,success:function(a){window.global_basicData=a}}),window.global_basicData)}function r(a){var b=$linq(common.getBasicData()).where(function(b){return b.id==a}).firstOrDefault();return b?b.description:""}function s(a){var b=$linq(this.getBasicData()).where(function(b){return b.identity==a&&b.pId==a}).toArray();return b?b:""}function t(a){return a?new Date(a):null}function u(a){return a?a:0}function v(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd"):null}function w(a){return a?kendo.toString(new Date(a),"yyyy-MM-dd HH:mm:ss"):null}function x(){return{uploadSize:5242880,processState_waitQianShou:"processState_1",processState_qianShou:"processState_2",processState_banJie:"processState_7",processState_tuiWen:"processState_11",projectShenBaoStage:"projectShenBaoStage",projectShenBaoStage_nextYearPlan:"projectShenBaoStage_7",projectCategory:"projectCategory",projectCategory_A:"projectCategory_1",projectCategory_B:"projectCategory_2",projectCategory_C:"projectCategory_3",projectCategory_D:"projectCategory_4",projectClassify:"projectClassify",projectClassify_ZF:"projectClassify_1",projectClassify_SH:"projectClassify_2",projectConstrChar:"projectConstrChar",projectConstrChar_qianqi:"projectConstrChar_1",projectConstrChar_xinkaigong:"projectConstrChar_2",projectConstrChar_xujian:"projectConstrChar_3",projectFunctionClassify:"projectFunctionClassify",projectGoverEconClassify:"projectGoverEconClassify",projectInvestmentType:"projectInvestmentType",projectInvestmentType_ZF:"projectInvestmentType_1",projectInvestmentType_SH:"projectInvestmentType_2",projectIndustry:"projectIndustry",projectIndustry_ZF:"projectIndustry_1",projectIndustry_SH:"projectIndustry_2",projectInvestmentType:"projectInvestmentType",projectProgress:"projectProgress",projectStage:"projectStage",projectType:"projectType",approvalType:"approvalType",unitProperty:"unitProperty",area:"area",area_GM:"area_1",capitalOtherType:"capitalOtherType",taskType:"taskType",taskType_monthReport:"taskType_1",taskType_yearPlan:"taskType_2",taskType_sendMesg:"taskType_3"}}function y(a,b,c){if(a){var d=a.length;d>b?$("#"+c).html("<font size='5'>0</font>"):d<=b&&$("#"+c).html("<font size='5'>"+(b-d)+"</font>")}else $("#"+c).html("<font size='5'>"+b+"</font>")}function z(){$(document).on("click","#checkboxAll",function(){var a=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",a)}),$("body").on("click",".grid tr",function(a){$(this).parent().find("tr").removeClass("selected"),$(this).addClass("selected")})}var A={initJqValidation:a,requestError:b,requestSuccess:c,format:d,blockNonNumber:e,floatNumberInput:f,adminContentHeight:g,alert:h,confirm:i,getQuerystring:j,kendoGridConfig:k,getKendoCheckId:l,cookie:n,getToken:o,appPath:"",http:m,gridDataSource:p,loginUrl:"/",getBasicData:q,getBasicDataDesc:r,getBacicDataByIndectity:s,toDate:t,toMoney:u,formatDate:v,formatDateTime:w,basicDataConfig:x,checkLength:y};window.common=A,z()}(),function(){"use strict";angular.module("app",["ui.router","kendo.directives"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",templateUrl:"/shenbaoAdmin/html/welcome",controller:"indexCtrl",controllerAs:"vm"}).state("task",{url:"/task",templateUrl:"/shenbaoAdmin/task/html/list",controller:"indexCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:"/account/html/changePwdQ.html",controller:"indexCtrl",controllerAs:"vm"}).state("monthReportDetails",{url:"/monthReportDetails/:monthReportId",templateUrl:"/shenbaoAdmin/projectMonthReport/html/details.html",controller:"indexCtrl",controllerAs:"vm"}).state("deptInfoMaintain",{url:"/deptInfoMaintain",templateUrl:"/contents/shenbaoAdmin/deptInfoMaintain/html/deptInfoManager.html",controller:"deptInfoMaintainCtrl",controllerAs:"vm"}).state("project",{url:"/project",templateUrl:"/shenbaoAdmin/project/html/list.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectEdit",{url:"/projectEdit/:id/:projectInvestmentType",templateUrl:"/shenbaoAdmin/project/html/edit.html",controller:"projectCtrl",controllerAs:"vm"}).state("project_projectInfo",{url:"/project/projectInfo/:id/:projectInvestmentType",templateUrl:"/shenbaoAdmin/project/html/projectInfo.html",controller:"projectCtrl",controllerAs:"vm"}).state("projectMonthReport",{url:"/projectMonthReport",templateUrl:"/shenbaoAdmin/projectMonthReport/html/list.html",controller:"projectMonthReportCtrl",controllerAs:"vm"}).state("projectMonthReportFill",{url:"/projectMonthReportFill/:projectId",templateUrl:"/shenbaoAdmin/projectMonthReport/html/selectMonth",controller:"projectMonthReportCtrl",controllerAs:"vm"}).state("projectMonthReportInfoFill",{url:"/projectMonthReportInfoFill/:projectId/:year/:month",templateUrl:"/shenbaoAdmin/projectMonthReport/html/fillInfo",controller:"projectMonthReportCtrl",controllerAs:"vm"}).state("shenbao",{url:"/shenbao",templateUrl:"/shenbaoAdmin/shenbao/html/list.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_edit",{url:"/shenbao/:id/:projectInvestmentType/:stage",templateUrl:"/shenbaoAdmin/shenbao/html/edit.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_records",{url:"/shenbao_records",templateUrl:"/shenbaoAdmin/shenbao/html/records.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_record",{url:"/shenbao_record/:id",templateUrl:"/shenbaoAdmin/shenbao/html/shenBaoInfo.html",controller:"shenbaoCtrl",controllerAs:"vm"}).state("shenbao_record_edit",{url:"/shenbao_record_edit/:id/:projectInvestmentType/:stage",templateUrl:"/shenbaoAdmin/shenbao/html/edit.html",controller:"shenbaoCtrl",controllerAs:"vm"})}])}(),function(){"use strict";function a(a,b,c){function d(){"task"==b.current.name&&(j.page="taskList"),"monthReportDetails"==b.current.name&&(j.page="monthReportDetails"),"accountPwd"==b.current.name&&(j.page="changePwd"),j.formatDate=function(a){return common.formatDate(a)},j.formatDateTime=function(a){return common.formatDateTime(a)},j.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},j.taskType_yearPlan=common.basicDataConfig().taskType_yearPlan,j.taskType_monthReport=common.basicDataConfig().taskType_monthReport}function e(){d(),"index"==j.page&&f(),"taskList"==j.page&&g(),"monthReportDetails"==j.page&&i(),"changePwd"==j.page&&h()}function f(){c.getTask(j),c.getUnitShenBaoInfos(j)}function g(){c.taskList(j)}function h(){j.changePwd=function(){c.changePwd(j)}}function i(){c.getMonthReportById(j)}var j=this;j.model={},j.monthReportId=b.params.monthReportId,j.page="index",e()}angular.module("app").controller("indexCtrl",a),a.$inject=["$location","$state","indexSvc"]}(),function(){"use strict";function a(a){function b(b){var c={method:"get",url:common.format(l+"?$filter=id eq '{0}'",b.model.monthReport.projectId)},d=function(a){b.model.project=a.data.value[0]||{},""!=b.model.project.projectType?b.model.project.projectType=b.model.project.projectType.split(","):b.model.project.projectType=[]};common.http({vm:b,$http:a,httpOptions:c,success:d})}function c(c){var d={method:"get",url:common.format(k+"?$filter=id eq '{0}'",c.monthReportId)},e=function(a){c.model.monthReport=a.data.value[0]||{},b(c),c.model.monthReport.beginDate=common.formatDate(c.model.monthReport.beginDate),c.model.monthReport.endDate=common.formatDate(c.model.monthReport.endDate),c.uploadType=[["scenePicture","现场图片"],["other","其它材料"]]};common.http({vm:c,$http:a,httpOptions:d,success:e})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"put",url:j,data:b.model.password},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),location.href=m}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}else common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(h),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"title",title:"名称",template:function(b){return b.taskType==a.taskType_yearPlan?common.format('<a href="#/shenbao_record/{0}">{1}</a>',b.relId,b.title):b.taskType==a.taskType_monthReport?common.format('<a href="#/monthReportDetails/{0}">{1}</a>',b.relId,b.title):void 0},width:305,filterable:!1},{field:"processSuggestion",title:"信息",width:441,template:function(a){return common.format('<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:441px;" title="{0}">{0}</span>',a.processSuggestion)},filterable:!1},{field:"processState",title:"状态",template:function(a){return common.getBasicDataDesc(a.processState)},width:210,filterable:!1},{field:"createdDate",title:"创建时间",width:165,template:function(a){return common.formatDateTime(a.createdDate)},filterable:!1}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(b){var c={method:"get",url:i+"/unit"},d=function(a){b.model.shenBaoInfo=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"get",url:h+"?$orderby=createdDate desc"},d=function(a){b.model.task=a.data.value};common.http({vm:b,$http:a,httpOptions:c,success:d})}var h="/shenbaoAdmin/task",i="/shenbaoAdmin/shenbao",j="/account/password",k="/shenbaoAdmin/projectMonthReport",l="/shenbaoAdmin/project",m="/",n={getTask:g,getUnitShenBaoInfos:f,getMonthReportById:c,taskList:e,changePwd:d};return n}angular.module("app").factory("indexSvc",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b){function c(){f.basicData_unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),f.basicData_area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray()}function d(){c(),"index"==f.page&&e()}function e(){b.getDeptInfo(f),f.submit=function(){b.save(f)}}var f=this;f.page="index",d()}angular.module("app").controller("deptInfoMaintainCtrl",a),a.$inject=["$location","deptInfoMaintainSvc"]}(),function(){"use strict";function a(a,b){function c(b){common.initJqValidation();var c=$("form").valid();if(c){b.isSubmit=!0;var d={method:"post",url:e,data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),location.reload()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:f})}}function d(b){var c={method:"get",url:e},d=function(a){b.model=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}var e="/shenbaoAdmin/userUnitInfo",f={getDeptInfo:d,save:c};return f}angular.module("app").factory("deptInfoMaintainSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d){function e(){i.init(),"list"==i.page&&f(),"selectMonth"==i.page&&g(),"fillReport"==i.page&&h()}function f(){b.grid(i)}function g(){b.getProjectById(i);var a=new Date;i.submitYear=a.getFullYear(),i.submitYearMonth={},i.tuiwenYearMonth={},i.monthRow1=["一月","二月","三月","四月","五月","六月"],i.monthRow2=["七月","八月","九月","十月","十一月","十二月"],i.setMonthSelected=function(){for(var a=1;a<=12;a++)i.submitYearMonth["m"+a]=!1,i.tuiwenYearMonth["m"+a]=!1;var b=$linq(i.model.projectInfo.monthReportDtos).where(function(a){return a.submitYear==i.submitYear});b.foreach(function(a){null!=a.processState&&(a.processState==common.basicDataConfig().processState_tuiWen?i.tuiwenYearMonth["m"+a.submitMonth]=!0:i.submitYearMonth["m"+a.submitMonth]=!0)})},i.fillReport=function(a){location.href="#/projectMonthReportInfoFill/"+i.projectId+"/"+i.submitYear+"/"+a}}function h(){i.model.monthReport={},i.years=[],i.currentYear=(new Date).getFullYear(),i.years.push(i.currentYear);for(var a=1;a<=5;a++)i.years.push(i.currentYear+a),i.years.push(i.currentYear-a);i.years=i.years.sort(),i.model.monthReport.proposalsYear=i.currentYear,i.model.monthReport.reportYear=i.currentYear,i.model.monthReport.allEstimateYear=i.currentYear,b.getProjectById(i),i.submit=function(){b.submitMonthReport(i)},i.page_fillReport_init=function(){i.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){i.model.monthReport.attachmentDtos?i.model.monthReport.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):i.model.monthReport.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},i.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:i,msg:"上传文件过大！"})})})},i.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:i.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:i.onSelect}},i.delFile=function(a){i.model.monthReport.attachmentDtos.splice(a,1)},i.createProblem=function(){i.model.monthReport.monthReportProblemDtos?i.model.monthReport.monthReportProblemDtos.push({problemIntroduction:"",solutionsAndSuggest:""}):i.model.monthReport.monthReportProblemDtos=[{problemIntroduction:"",solutionsAndSuggest:""}]},i.deleteProblem=function(a){i.model.monthReport.monthReportProblemDtos.splice(a,1)},i.basicData_approvalType=common.getBacicDataByIndectity(common.basicDataConfig().approvalType),i.basicData_projectProgress=common.getBacicDataByIndectity(common.basicDataConfig().projectProgress),i.uploadType=[["scenePicture","现场图片"],["other","其它材料"]]}var i=this;i.model={},i.page="list",i.init=function(){i.projectId=c.params.projectId,i.month=c.params.month,i.year=c.params.year,i.processState=c.params.processState,i.projectId&&(i.page="selectMonth"),i.month&&(i.page="fillReport"),i.checkLength=function(a,b,c){common.checkLength(a,b,c)}},e()}angular.module("app").controller("projectMonthReportCtrl",a),a.$inject=["$location","projectMonthReportSvc","$state","$scope"]}(),function(){"use strict";function a(a,b){function c(b){var c={method:"get",url:common.format(f+"?$filter=id eq '{0}' ",b.projectId)},d=function(a){if(b.model.projectInfo=a.data.value[0]||{},"selectMonth"==b.page&&b.setMonthSelected(),"fillReport"==b.page){var c=$linq(b.model.projectInfo.monthReportDtos).where(function(a){return a.submitYear==b.year&&a.submitMonth==b.month}).toArray();c.length>0?(b.isReportExist=!0,b.model.monthReport=c[0]):b.isReportExist=!1,b.model.monthReport.projectId=b.model.projectInfo.id,b.model.monthReport.projectNumber=b.model.projectInfo.projectNumber,b.model.monthReport.projectRepName=b.model.projectInfo.projectRepName,b.model.monthReport.projectRepMobile=b.model.projectInfo.projectRepMobile,b.model.monthReport.beginDate=common.formatDate(b.model.projectInfo.beginDate),b.model.monthReport.endDate=common.formatDate(b.model.projectInfo.endDate),b.model.monthReport.invertPlanTotal=common.toMoney(b.model.projectInfo.projectInvestSum),b.model.monthReport.actuallyFinishiInvestment=common.toMoney(b.model.projectInfo.projectInvestAccuSum),b.model.monthReport.releasePlanTotal=common.toMoney(b.model.monthReport.releasePlanTotal),b.model.monthReport.thisYearPlanInvestment=common.toMoney(b.model.monthReport.thisYearPlanInvestment),b.model.monthReport.thisYearPlanHasInvestment=common.toMoney(b.model.monthReport.thisYearPlanHasInvestment),b.model.monthReport.thisYearAccumulatedInvestment=common.toMoney(b.model.monthReport.thisYearAccumulatedInvestment),b.model.monthReport.thisMonthPlanInvestTotal=common.toMoney(b.model.monthReport.thisMonthPlanInvestTotal),b.model.monthReport.thisMonthInvestTotal=common.toMoney(b.model.monthReport.thisMonthInvestTotal),b.model.monthReport.thisYearAccumulatedInvestment=common.toMoney(b.model.monthReport.thisYearAccumulatedInvestment),b.model.monthReport.firstQuarCompInvestment=common.toMoney(b.model.monthReport.firstQuarCompInvestment),b.model.monthReport.secondQuarCompInvestment=common.toMoney(b.model.monthReport.secondQuarCompInvestment),b.model.monthReport.thirdQuarCompInvestment=common.toMoney(b.model.monthReport.thirdQuarCompInvestment),b.model.monthReport.fourthQuarCompInvestment=common.toMoney(b.model.monthReport.fourthQuarCompInvestment)}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function d(b){common.initJqValidation();var c=$("form").valid();if(c){b.model.monthReport.submitYear=b.year,b.model.monthReport.submitMonth=b.month,b.model.monthReport.projectId=b.projectId,b.isSubmit=!0;var d={method:"post",url:g,data:b.model.monthReport},e=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),location.reload()}})}})};common.http({vm:b,$http:a,httpOptions:d,success:e})}}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(f),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:[{field:"isMonthReport",operator:"eq",value:!0},{field:"isLatestVersion",operator:"eq",value:!0}]}),c=[{field:"projectName",title:"项目名称",filterable:!0,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)}},{field:"projectStage",title:"项目阶段",width:150,filterable:!1,template:function(a){return common.getBasicDataDesc(a.projectStage)}},{field:"projectClassify",title:"项目分类",width:150,filterable:!1,template:function(a){return common.getBasicDataDesc(a.projectClassify)}},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,"vm.del('"+a.id+"')")}}];a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var f="/shenbaoAdmin/project/unitProject",g="/shenbaoAdmin/projectMonthReport",h={grid:e,submitMonthReport:d,getProjectById:c};return h}angular.module("app").factory("projectMonthReportSvc",a),a.$inject=["$http","$compile"]}(),function(){"use strict";function a(a,b,c,d){function e(){j.init(),"list"==j.page&&f(),"create"==j.page&&(j.model.projectType=[],g()),"update"==j.page&&(g(),h()),"projectInfo"==j.page&&i()}function f(){b.grid(j),j.basicData.investmentType=common.getBacicDataByIndectity(common.basicDataConfig().projectInvestmentType),j.addProject=function(){$("#myModal").modal({backdrop:"static",keyboard:!1}),j.model.projectInvestmentType=common.basicDataConfig().projectInvestmentType_ZF},j.confirmInvestmentType=function(){$(".modal-backdrop").remove(),a.path("/projectEdit//"+j.model.projectInvestmentType)}}function g(){j.model.projectInvestmentType=j.projectInvestmentType,j.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?(j.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),j.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray(),j.isZFInvestment=!0):j.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(j.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),j.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),j.projectIndustryChange=function(){j.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==j.model.projectIndustryParent}).toArray()},j.isSHInvestment=!0),b.getUserUnit(j),j.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),j.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),j.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),j.basicData.capitalOther=common.getBacicDataByIndectity(common.basicDataConfig().capitalOtherType),j.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),j.updateSelection=function(a){var b=j.model.projectType.indexOf(a);b==-1?j.model.projectType.push(a):j.model.projectType.splice(b,1)},j.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]],j.relatedType=[["XMJYSPF","项目建议书批复文件"],["KXXYJBGPF","可行性研究报告批复文件"],["ZGSPFTZ","总概算批复及调整文件"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]],j.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){j.model.attachmentDtos?j.model.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):j.model.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},j.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:j,msg:"上传文件过大！"})})})},j.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:j.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:j.onSelect},j.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:j.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:j.onSelect},j.delFile=function(a){j.model.attachmentDtos.splice(a,1)},j.capitalTotal=function(){return(parseFloat(j.model.capitalSCZ_ggys)||0)+(parseFloat(j.model.capitalSCZ_gtzj)||0)+(parseFloat(j.model.capitalSCZ_zxzj)||0)+(parseFloat(j.model.capitalQCZ_ggys)||0)+(parseFloat(j.model.capitalQCZ_gtzj)||0)+(parseFloat(j.model.capitalSHTZ)||0)+(parseFloat(j.model.capitalZYYS)||0)+(parseFloat(j.model.capitalOther)||0)},j.create=function(){j.model.projectType=j.model.projectType.join(","),b.createProject(j)}}function h(){j.title="编辑项目",b.getProjectById(j),j.update=function(){j.model.projectType=j.model.projectType.join(","),b.updateProject(j)}}function i(){$(".modal-backdrop").remove(),b.getProjectById(j),j.projectInvestmentType==common.basicDataConfig().projectInvestmentType_ZF?j.isZFInvestment=!0:j.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH&&(j.isSHInvestment=!0),j.relatedType=[["XMJYSPF","项目建议书批复文件"],["KXXYJBGPF","可行性研究报告批复文件"],["ZGSPFTZ","总概算批复及调整文件"],["HYJY","会议纪要"],["GHYJ","规划依据"],["SJXGT","设计效果图"],["XMQWT","项目区位图"],["XCTP","现场图片"],["QT","其他"]]}var j=this;j.title="新增项目",j.id=c.params.id,j.projectInvestmentType=c.params.projectInvestmentType,j.model={},j.basicData={},j.page="list",j.init=function(){"projectEdit"==c.current.name&&(j.page="create"),j.id&&(j.page="update"),"project_projectInfo"==c.current.name&&(j.page="projectInfo"),j.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},j.checkLength=function(a,b,c){common.checkLength(a,b,c)}},e()}angular.module("app").controller("projectCtrl",a),a.$inject=["$location","projectSvc","$state","$scope"]}(),function(){"use strict";function a(a,b,c){function d(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0;var e={method:"put",url:j,data:b.model},f=function(a){b.model.projectType=b.model.projectType.split(","),common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path(l)}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}else b.model.projectType=b.model.projectType.split(","),common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function e(b){var c={method:"get",url:common.format(j+"?$filter=id eq '{0}'",b.id)},d=function(a){if(b.model=a.data.value[0]||{},f(b),""!=b.model.projectType&&null!=b.model.projectType?b.model.projectType=b.model.projectType.split(","):b.model.projectType=[],b.model.beginDate=common.formatDate(b.model.beginDate),b.model.endDate=common.formatDate(b.model.endDate),b.model.pifuJYS_date=common.formatDate(b.model.pifuJYS_date),b.model.pifuKXXYJBG_date=common.formatDate(b.model.pifuKXXYJBG_date),b.model.pifuCBSJYGS_date=common.formatDate(b.model.pifuCBSJYGS_date),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther),"update"==b.page&&b.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var c=$linq(common.getBasicData()).where(function(a){return a.id==b.model.projectIndustry}).toArray()[0];b.model.projectIndustryParent=c.pId,b.projectIndustryChange()}"projectInfo"==b.page&&(b.capitalTotal=function(){return(parseFloat(b.model.capitalSCZ_ggys)||0)+(parseFloat(b.model.capitalSCZ_gtzj)||0)+(parseFloat(b.model.capitalSCZ_zxzj)||0)+(parseFloat(b.model.capitalQCZ_ggys)||0)+(parseFloat(b.model.capitalQCZ_gtzj)||0)+(parseFloat(b.model.capitalSHTZ)||0)+(parseFloat(b.model.capitalZYYS)||0)+(parseFloat(b.model.capitalOther)||0)})};common.http({vm:b,$http:a,httpOptions:c,success:d})}function f(b){var c={method:"get",url:common.format(k+"?$filter=userName eq '{0}'",b.model.unitName)},d=function(a){b.userUnit=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function g(b){var c={method:"get",url:k},d=function(a){b.userUnit=a.data.value[0]||{},b.model.unitName=b.userUnit.userName};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0;var e={method:"post",url:j,data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path(l)}})}})},g=function(a){common.requestError({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作失败",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),b.model.projectType=b.model.projectType.split(",")}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f,error:g})}else b.model.projectType=b.model.projectType.split(",")}function i(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(j),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isLatestVersion",operator:"eq",value:!0}}),c=[{field:"projectName",title:"项目名称",filterable:!0,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)}},{field:"projectStage",title:"项目阶段",template:function(a){return common.getBasicDataDesc(a.projectStage)},width:150,filterable:!1},{field:"projectClassify",title:"项目分类",template:function(a){return common.getBasicDataDesc(a.projectClassify)},width:150,filterable:!1},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,"vm.del('"+a.id+"')")}}];a.gridOptions={dataSource:common.gridDataSource(b),
filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}var j="/shenbaoAdmin/project/unitProject",k="/shenbaoAdmin/userUnitInfo",l="/project",m={grid:i,createProject:h,getUserUnit:g,getProjectById:e,updateProject:d};return m}angular.module("app").factory("projectSvc",a),a.$inject=["$http","$compile","$location"]}(),function(){"use strict";function a(a,b,c,d){function e(){j.init(),"list"==j.page&&f(),"edit"==j.page&&g(),"records"==j.page&&h(),"record"==j.page&&i(),"record_edit"==j.page&&(j.isRecordEdit=!0,j.title="申报信息编辑",g(),i())}function f(){b.grid(j),j.shenbaoBtn=function(a,b,c){j.projectId=a,j.projectInvestmentType=b,j.projectName=c,j.projectShenBaoStage="",j.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectShenBaoStage),$("#myModal").modal("show")},j.confirm=function(){$(".modal-backdrop").remove(),location.href="#/shenbao/"+j.projectId+"/"+j.projectInvestmentType+"/"+j.projectShenBaoStage},j.checkShenBaoRecords=function(a){$("#shenBaoRecords").modal({backdrop:"static",keyboard:!1}),j.projectNumber=a,j.gridOptions_shenBaoRecords.dataSource.filter({field:"projectNumber",operator:"eq",value:j.projectNumber}),j.gridOptions_shenBaoRecords.dataSource.read(),j.processState=common.basicDataConfig().processState_tuiWen},b.projectShenBaoRecordsGird(j)}function g(){document.getElementById("tab1").setAttribute("disabled","disabled"),document.getElementById("tab2").setAttribute("disabled","disabled"),document.getElementById("tab3").setAttribute("disabled","disabled"),document.getElementById("tab4").setAttribute("disabled","disabled");var a=function(){j.isYearPlan=j.stage==common.basicDataConfig().projectShenBaoStage_nextYearPlan,j.isYearPlan&&(j.materialsType=[["XXJD","项目工程形象进度及年度资金需求情况"],["WCJSNR","年度完成建设内容及各阶段工作内容完成时间表"],["TTJH","历年政府投资计划下大文件(*)"],["GCXKZ","建设工程规划许可证"],["TDQK","土地落实情况、征地拆迁有关情况"],["XMJZ","项目进展情况相关资料"],["QQGZJH","前期工作计划文件"],["XMSSYJ","项目实施依据文件"],["HYJY","会议纪要"]],j.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]])};a(),"edit"==j.page&&b.getProjectById(j),j.investmentType==common.basicDataConfig().projectInvestmentType_ZF?(j.isZFInvestment=!0,j.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_ZF}).toArray(),j.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_ZF}).toArray()):j.investmentType==common.basicDataConfig().projectInvestmentType_SH&&(j.isSHInvestment=!0,j.basicData.projectClassify=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectClassify&&a.pId==common.basicDataConfig().projectClassify_SH}).toArray(),j.basicData.projectIndustry=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==common.basicDataConfig().projectIndustry_SH}).toArray(),j.projectIndustryChange=function(){j.basicData.projectIndustryChildren=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().projectIndustry&&a.pId==j.model.projectIndustryParent}).toArray()}),j.basicData.projectStage=common.getBacicDataByIndectity(common.basicDataConfig().projectStage),j.basicData.projectType=common.getBacicDataByIndectity(common.basicDataConfig().projectType),j.basicData.projectCategory=common.getBacicDataByIndectity(common.basicDataConfig().projectCategory),j.basicData.projectConstrChar=common.getBacicDataByIndectity(common.basicDataConfig().projectConstrChar),j.basicData.unitProperty=common.getBacicDataByIndectity(common.basicDataConfig().unitProperty),j.basicData.area_Street=$linq(common.getBasicData()).where(function(a){return a.identity==common.basicDataConfig().area&&a.pId==common.basicDataConfig().area_GM}).toArray(),j.basicData.capitalOther=common.getBacicDataByIndectity(common.basicDataConfig().capitalOtherType),j.updateSelection=function(a){var b=j.model.projectType.indexOf(a);b==-1?j.model.projectType.push(a):j.model.projectType.splice(b,1)},j.uploadSuccess=function(a){var b=$(a.sender.element).parents(".uploadBox").attr("data-type");if(200==a.XMLHttpRequest.status){var c=a.XMLHttpRequest.response;d.$apply(function(){j.model.attachmentDtos?j.model.attachmentDtos.push({name:c.split("_")[2],url:c,type:b}):j.model.attachmentDtos=[{name:c.split("_")[2],url:c,type:b}]})}},j.onSelect=function(a){$.each(a.files,function(a,b){b.size>common.basicDataConfig().uploadSize&&d.$apply(function(){common.alert({vm:j,msg:"上传文件过大！"})})})},j.uploadOptions_pifu={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:j.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!1,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:j.onSelect},j.uploadOptions={async:{saveUrl:"/common/save",removeUrl:"/common/remove",autoUpload:!0},error:j.uploadSuccess,localization:{select:"上传文件"},showFileList:!1,multiple:!0,validation:{maxFileSize:common.basicDataConfig().uploadSize},select:j.onSelect},j.delFile=function(a){j.model.attachmentDtos.splice(a,1)},j.tabReturn=function(a){var b=$("#tab"+a);j.tabStrip.activateTab(b)},j.tabChange=function(a){common.initJqValidation();var b=$("form").valid(),c=$("#tab"+a);b&&j.tabStrip.activateTab(c)},j.submit=function(){j.model.projectType=j.model.projectType.join(","),b.createShenBaoInfo(j)}}function h(){b.recordsGird(j)}function i(){b.getShenBaoInfoById(j),$(".modal-backdrop").remove(),j.update=function(){b.updateShenBaoInfo(j)}}var j=this;j.id=c.params.id,j.investmentType=c.params.projectInvestmentType,j.stage=c.params.stage,j.model={},j.basicData={},j.page="list",j.title="申报信息录入",d.animationsEnabled=!0,j.init=function(){"shenbao_edit"==c.current.name&&(j.page="edit"),"shenbao_records"==c.current.name&&(j.page="records"),"shenbao_record"==c.current.name&&(j.page="record",$(".modal-backdrop").remove()),"shenbao_record_edit"==c.current.name&&(j.page="record_edit"),j.getBasicDataDesc=function(a){return common.getBasicDataDesc(a)},j.checkLength=function(a,b,c){common.checkLength(a,b,c)}},e()}angular.module("app").controller("shenbaoCtrl",a),a.$inject=["$location","shenbaoSvc","$state","$scope"]}(),function(){"use strict";function a(a,b,c){function d(b,c,d){var e={method:"get",url:common.format(o+"?$filter=projectNumber eq '{0}'",c)},f=function(a){if(b.model.shenBaoRecords=a.data.value,b.model.shenBaoRecords.length>0){for(var c=0,e=0;e<b.model.shenBaoRecords.length;e++){var f=b.model.shenBaoRecords[e];f.processState==common.basicDataConfig().processState_tuiWen&&(c+=1)}c>0&&$("#tuiwenNumber"+d).html(c)}};common.http({vm:b,$http:a,httpOptions:e,success:f})}function e(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"projectName",title:"项目名称",width:200,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.projectId,a.projectInvestmentType,a.projectName)},filterable:!1},{field:"processState",title:"审批状态",width:150,filterable:!1,template:function(a){var b=common.getBasicDataDesc(a.processState),c="text-danger";return common.format("<span class='{1}'>{0}</span>",b,c)}},{field:"projectShenBaoStage",title:"申报阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectShenBaoStage)},filterable:!1},{field:"planYear",title:"计划年度",width:100,filterable:!1},{field:"",title:"操作",width:200,template:function(a){var b=a.processState==common.basicDataConfig().processState_waitQianShou||a.processState==common.basicDataConfig().processState_tuiWen;return common.format($("#columnBtns_Record").html(),a.id,a.projectInvestmentType,a.projectShenBaoStage,b?"":"display:none")}}];a.gridOptions_shenBaoRecords={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function f(b){common.initJqValidation();var d=$("form").valid();if(d){b.isSubmit=!0,""!=b.model.projectType&&void 0!=b.model.projectType?b.model.projectType=b.model.projectType.join(","):b.model.projectType=[];var e={method:"put",url:o,data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path("/shenbao")}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}else b.model.projectType=b.model.projectType.split(","),common.alert({vm:b,msg:"您填写的信息不正确,请核对后提交!"})}function g(b){var c={method:"get",url:common.format(o+"?$filter=id eq '{0}'",b.id)},d=function(a){if(b.model=a.data.value[0]||{},""!=b.model.projectType?b.model.projectType=b.model.projectType.split(","):b.model.projectType=[],b.model.beginDate=common.formatDate(b.model.beginDate),b.model.endDate=common.formatDate(b.model.endDate),b.model.pifuJYS_date=common.formatDate(b.model.pifuJYS_date),b.model.pifuKXXYJBG_date=common.formatDate(b.model.pifuKXXYJBG_date),b.model.pifuCBSJYGS_date=common.formatDate(b.model.pifuCBSJYGS_date),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther),b.model.applyYearInvest=common.toMoney(b.model.applyYearInvest),b.capitalTotal=function(){return(parseFloat(b.model.capitalSCZ_ggys)||0)+(parseFloat(b.model.capitalSCZ_gtzj)||0)+(parseFloat(b.model.capitalSCZ_zxzj)||0)+(parseFloat(b.model.capitalQCZ_ggys)||0)+(parseFloat(b.model.capitalQCZ_gtzj)||0)+(parseFloat(b.model.capitalSHTZ)||0)+(parseFloat(b.model.capitalOther)||0)},"record"==b.page&&b.model.projectShenBaoStage==common.basicDataConfig().projectShenBaoStage_nextYearPlan&&(b.isYearPlan=!0,b.materialsType=[["XXJD","项目工程形象进度及年度资金需求情况"],["WCJSNR","年度完成建设内容及各阶段工作内容完成时间表"],["TTJH","历年政府投资计划下大文件(*)"],["GCXKZ","建设工程规划许可证"],["TDQK","土地落实情况、征地拆迁有关情况"],["XMJZ","项目进展情况相关资料"],["QQGZJH","前期工作计划文件"],["XMSSYJ","项目实施依据文件"],["HYJY","会议纪要"]],b.uploadType=[["JYS","项目建议书"],["KXXYJBG","可行性研究报告"],["CBSJYGS","初步设计与概算"]]),"record_edit"==b.page&&b.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var c=$linq(common.getBasicData()).where(function(a){return a.id==b.model.projectIndustry}).toArray()[0];b.model.projectIndustryParent=c.pId,b.projectIndustryChange()}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function h(b){common.initJqValidation();var d=function(){var a=[["projectConstrChar","required","年度计划信息-项目建设性质必选"],["planYear","required","年度计划信息-计划年度必填"],["applyYearInvest","required","年度计划信息-申请年度投资必填"],["yearConstructionContent","required","年度计划信息-年度建设内容必填"],["shenBaoUnitInfoDto.unitName","required","项目单位信息-单位名称必填"],["shenBaoUnitInfoDto.unitTel","required","项目单位信息-单位电话必填"],["shenBaoUnitInfoDto.unitEmail","required","项目单位信息-单位邮箱必填"],["shenBaoUnitInfoDto.unitProperty","required","项目单位信息-单位性质必选"],["shenBaoUnitInfoDto.divisionId","required","项目单位信息-单位区域必选"],["shenBaoUnitInfoDto.unitAddress","required","项目单位信息-单位地址必填"],["shenBaoUnitInfoDto.unitResPerson","required","项目单位信息-单位负责人名称必填"],["shenBaoUnitInfoDto.resPersonTel","required","项目单位信息-单位负责人电话必填"],["shenBaoUnitInfoDto.resPersonMobile","required","项目单位信息-单位负责人手机必填"],["shenBaoUnitInfoDto.resPersonEmail","required","项目单位信息-单位负责人邮箱必填"]];return b.validMessage=[],$.each(a,function(a,c){var d="";if(c[0].indexOf(".")>0){var e=c[0].split(".");d=b.model[e[0]][e[1]]}else d=b.model[c[0]];var f=c[2];if("required"==c[1]){var g=d&&""!=d.trim();g||b.validMessage.push(f)}}),!(b.validMessage.length>0)||void $("#validMsgDialog").modal({backdrop:"static",keyboard:!1})};if(d()){b.isSubmit=!0;var e={method:"post",url:o,data:b.model},f=function(a){common.requestSuccess({vm:b,response:a,fn:function(){common.alert({vm:b,msg:"操作成功,等待管理员签收！",fn:function(){b.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),c.path("/shenbao")}})}})};common.http({vm:b,$http:a,httpOptions:e,success:f})}else b.model.projectType=b.model.projectType.split(",")}function i(b){var c={method:"get",url:common.format(n+"?$filter=userName eq '{0}'",b.model.unitName)},d=function(a){b.model.shenBaoUnitInfoDto=a.data.value[0]||{}};common.http({vm:b,$http:a,httpOptions:c,success:d})}function j(b){var c={method:"get",url:common.format(m+"?$filter=id eq '{0}'",b.id)},d=function(a){if(b.model=a.data.value[0]||{},i(b),"edit"==b.page){if(""!=b.model.projectType&&void 0!=b.model.projectType?b.model.projectType=b.model.projectType.split(","):b.model.projectType=[],b.model.beginDate=common.formatDate(b.model.beginDate),b.model.endDate=common.formatDate(b.model.endDate),b.model.pifuJYS_date=common.formatDate(b.model.pifuJYS_date),b.model.pifuKXXYJBG_date=common.formatDate(b.model.pifuKXXYJBG_date),b.model.pifuCBSJYGS_date=common.formatDate(b.model.pifuCBSJYGS_date),b.model.projectInvestSum=common.toMoney(b.model.projectInvestSum),b.model.projectInvestAccuSum=common.toMoney(b.model.projectInvestAccuSum),b.model.capitalSCZ_ggys=common.toMoney(b.model.capitalSCZ_ggys),b.model.capitalSCZ_gtzj=common.toMoney(b.model.capitalSCZ_gtzj),b.model.capitalSCZ_zxzj=common.toMoney(b.model.capitalSCZ_zxzj),b.model.capitalQCZ_ggys=common.toMoney(b.model.capitalQCZ_ggys),b.model.capitalQCZ_gtzj=common.toMoney(b.model.capitalQCZ_gtzj),b.model.capitalZYYS=common.toMoney(b.model.capitalZYYS),b.model.capitalSHTZ=common.toMoney(b.model.capitalSHTZ),b.model.capitalOther=common.toMoney(b.model.capitalOther),b.model.applyYearInvest=common.toMoney(b.model.applyYearInvest),b.capitalTotal=function(){return(parseFloat(b.model.capitalSCZ_ggys)||0)+(parseFloat(b.model.capitalSCZ_gtzj)||0)+(parseFloat(b.model.capitalSCZ_zxzj)||0)+(parseFloat(b.model.capitalQCZ_ggys)||0)+(parseFloat(b.model.capitalQCZ_gtzj)||0)+(parseFloat(b.model.capitalSHTZ)||0)+(parseFloat(b.model.capitalZYYS)||0)+(parseFloat(b.model.capitalOther)||0)},b.model.projectInvestmentType==common.basicDataConfig().projectInvestmentType_SH){var c=$linq(common.getBasicData()).where(function(a){return a.id==b.model.projectIndustry}).toArray()[0];b.model.projectIndustryParent=c.pId,b.projectIndustryChange()}b.model.projectId=b.model.id}b.model.projectShenBaoStage=b.stage};common.http({vm:b,$http:a,httpOptions:c,success:d})}function k(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o+"/unit"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),c=[{field:"projectName",title:"项目名称",template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.projectId,a.projectInvestmentType,a.projectName)},filterable:!0},{field:"processState",title:"审批状态",width:150,filterable:!1,template:function(a){var b=common.getBasicDataDesc(a.processState),c="text-danger";return common.format("<span class='{1}'>{0}</span>",b,c)}},{field:"projectShenBaoStage",title:"申报阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectShenBaoStage)},filterable:!1},{field:"planYear",title:"计划年度",width:100,filterable:!1},{field:"",title:"操作",width:150,template:function(a){var b=a.processState==common.basicDataConfig().processState_waitQianShou||a.processState==common.basicDataConfig().processState_tuiWen;return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,a.projectShenBaoStage,b?"":"display:none")}}];a.gridOptions_records={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,resizable:!0}}function l(a){var b=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"},filter:{field:"isLatestVersion",operator:"eq",value:!0}}),c=[{field:"projectName",title:"项目名称",filterable:!0,template:function(a){return common.format('<a href="#/project/projectInfo/{0}/{1}">{2}</a>',a.id,a.projectInvestmentType,a.projectName)}},{field:"projectStage",title:"项目阶段",width:150,template:function(a){return common.getBasicDataDesc(a.projectStage)},filterable:!1},{field:"projectClassify",title:"项目分类",width:150,template:function(a){return common.getBasicDataDesc(a.projectClassify)},filterable:!1},{field:"",title:"操作",width:180,template:function(a){return common.format($("#columnBtns").html(),a.id,a.projectInvestmentType,a.projectName,a.projectNumber)}}],e=function(b){for(var c=b.sender._data,e=0;e<c.length;e++){var f=c[e];d(a,f.projectNumber,f.id)}};a.gridOptions={dataSource:common.gridDataSource(b),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c,dataBound:e,resizable:!0}}var m="/shenbaoAdmin/project/unitProject",n="/shenbaoAdmin/userUnitInfo",o="/shenbaoAdmin/shenbao",p={grid:l,getProjectById:j,projectShenBaoRecordsGird:e,createShenBaoInfo:h,recordsGird:k,getShenBaoInfoById:g,updateShenBaoInfo:f};return p}angular.module("app").factory("shenbaoSvc",a),a.$inject=["$http","$compile","$location"]}();